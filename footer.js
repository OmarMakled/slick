!function(a, b, c, d) {
    var e = a(b);
    a.fn.lazyload = function(f) {
        function g() {
            var b = 0;
            i.each(function() {
                var c = a(this);
                if (!j.skip_invisible || c.is(":visible"))
                    if (a.abovethetop(this, j) || a.leftofbegin(this, j))
                        ;
                    else if (a.belowthefold(this, j) || a.rightoffold(this, j)) {
                        if (++b > j.failure_limit)
                            return !1
                    } else
                        c.trigger("appear"),
                        b = 0
            })
        }
        var h, i = this, j = {
            threshold: 0,
            failure_limit: 0,
            event: "scroll",
            effect: "show",
            container: b,
            data_attribute: "original",
            skip_invisible: !0,
            appear: null,
            load: null,
            placeholder: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"
        };
        return f && (d !== f.failurelimit && (f.failure_limit = f.failurelimit,
        delete f.failurelimit),
        d !== f.effectspeed && (f.effect_speed = f.effectspeed,
        delete f.effectspeed),
        a.extend(j, f)),
        h = j.container === d || j.container === b ? e : a(j.container),
        0 === j.event.indexOf("scroll") && h.bind(j.event, function() {
            return g()
        }),
        this.each(function() {
            var b = this
              , c = a(b);
            b.loaded = !1,
            (c.attr("src") === d || c.attr("src") === !1) && c.is("img") && c.attr("src", j.placeholder),
            c.one("appear", function() {
                if (!this.loaded) {
                    if (j.appear) {
                        var d = i.length;
                        j.appear.call(b, d, j)
                    }
                    a("<img />").bind("load", function() {
                        var d = c.attr("data-" + j.data_attribute);
                        c.hide(),
                        c.is("img") ? c.attr("src", d) : c.css("background-image", "url('" + d + "')"),
                        c[j.effect](j.effect_speed),
                        b.loaded = !0;
                        var e = a.grep(i, function(a) {
                            return !a.loaded
                        });
                        if (i = a(e),
                        j.load) {
                            var f = i.length;
                            j.load.call(b, f, j)
                        }
                    }).attr("src", c.attr("data-" + j.data_attribute))
                }
            }),
            0 !== j.event.indexOf("scroll") && c.bind(j.event, function() {
                b.loaded || c.trigger("appear")
            })
        }),
        e.bind("resize", function() {
            g()
        }),
        /(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion) && e.bind("pageshow", function(b) {
            b.originalEvent && b.originalEvent.persisted && i.each(function() {
                a(this).trigger("appear")
            })
        }),
        a(c).ready(function() {
            g()
        }),
        this
    }
    ,
    a.belowthefold = function(c, f) {
        var g;
        return g = f.container === d || f.container === b ? (b.innerHeight ? b.innerHeight : e.height()) + e.scrollTop() : a(f.container).offset().top + a(f.container).height(),
        g <= a(c).offset().top - f.threshold
    }
    ,
    a.rightoffold = function(c, f) {
        var g;
        return g = f.container === d || f.container === b ? e.width() + e.scrollLeft() : a(f.container).offset().left + a(f.container).width(),
        g <= a(c).offset().left - f.threshold
    }
    ,
    a.abovethetop = function(c, f) {
        var g;
        return g = f.container === d || f.container === b ? e.scrollTop() : a(f.container).offset().top,
        g >= a(c).offset().top + f.threshold + a(c).height()
    }
    ,
    a.leftofbegin = function(c, f) {
        var g;
        return g = f.container === d || f.container === b ? e.scrollLeft() : a(f.container).offset().left,
        g >= a(c).offset().left + f.threshold + a(c).width()
    }
    ,
    a.inviewport = function(b, c) {
        return !(a.rightoffold(b, c) || a.leftofbegin(b, c) || a.belowthefold(b, c) || a.abovethetop(b, c))
    }
    ,
    a.extend(a.expr[":"], {
        "below-the-fold": function(b) {
            return a.belowthefold(b, {
                threshold: 0
            })
        },
        "above-the-top": function(b) {
            return !a.belowthefold(b, {
                threshold: 0
            })
        },
        "right-of-screen": function(b) {
            return a.rightoffold(b, {
                threshold: 0
            })
        },
        "left-of-screen": function(b) {
            return !a.rightoffold(b, {
                threshold: 0
            })
        },
        "in-viewport": function(b) {
            return a.inviewport(b, {
                threshold: 0
            })
        },
        "above-the-fold": function(b) {
            return !a.belowthefold(b, {
                threshold: 0
            })
        },
        "right-of-fold": function(b) {
            return a.rightoffold(b, {
                threshold: 0
            })
        },
        "left-of-fold": function(b) {
            return !a.rightoffold(b, {
                threshold: 0
            })
        }
    })
}(jQuery, window, document);
(function(f) {
    "use strict";
    "function" === typeof define && define.amd ? define(["jquery"], f) : "undefined" !== typeof module && module.exports ? module.exports = f(require("jquery")) : f(jQuery)
}
)(function($) {
    "use strict";
    function n(a) {
        return !a.nodeName || -1 !== $.inArray(a.nodeName.toLowerCase(), ["iframe", "#document", "html", "body"])
    }
    function h(a) {
        return $.isFunction(a) || $.isPlainObject(a) ? a : {
            top: a,
            left: a
        }
    }
    var p = $.scrollTo = function(a, d, b) {
        return $(window).scrollTo(a, d, b)
    }
    ;
    p.defaults = {
        axis: "xy",
        duration: 0,
        limit: !0
    };
    $.fn.scrollTo = function(a, d, b) {
        "object" === typeof d && (b = d,
        d = 0);
        "function" === typeof b && (b = {
            onAfter: b
        });
        "max" === a && (a = 9e9);
        b = $.extend({}, p.defaults, b);
        d = d || b.duration;
        var u = b.queue && 1 < b.axis.length;
        u && (d /= 2);
        b.offset = h(b.offset);
        b.over = h(b.over);
        return this.each(function() {
            function k(a) {
                var k = $.extend({}, b, {
                    queue: !0,
                    duration: d,
                    complete: a && function() {
                        a.call(q, e, b)
                    }
                });
                r.animate(f, k)
            }
            if (null !== a) {
                var l = n(this), q = l ? this.contentWindow || window : this, r = $(q), e = a, f = {}, t;
                switch (typeof e) {
                case "number":
                case "string":
                    if (/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(e)) {
                        e = h(e);
                        break
                    }
                    e = l ? $(e) : $(e, q);
                case "object":
                    if (e.length === 0)
                        return;
                    if (e.is || e.style)
                        t = (e = $(e)).offset()
                }
                var v = $.isFunction(b.offset) && b.offset(q, e) || b.offset;
                $.each(b.axis.split(""), function(a, c) {
                    var d = "x" === c ? "Left" : "Top"
                      , m = d.toLowerCase()
                      , g = "scroll" + d
                      , h = r[g]()
                      , n = p.max(q, c);
                    t ? (f[g] = t[m] + (l ? 0 : h - r.offset()[m]),
                    b.margin && (f[g] -= parseInt(e.css("margin" + d), 10) || 0,
                    f[g] -= parseInt(e.css("border" + d + "Width"), 10) || 0),
                    f[g] += v[m] || 0,
                    b.over[m] && (f[g] += e["x" === c ? "width" : "height"]() * b.over[m])) : (d = e[m],
                    f[g] = d.slice && "%" === d.slice(-1) ? parseFloat(d) / 100 * n : d);
                    b.limit && /^\d+$/.test(f[g]) && (f[g] = 0 >= f[g] ? 0 : Math.min(f[g], n));
                    !a && 1 < b.axis.length && (h === f[g] ? f = {} : u && (k(b.onAfterFirst),
                    f = {}))
                });
                k(b.onAfter)
            }
        })
    }
    ;
    p.max = function(a, d) {
        var b = "x" === d ? "Width" : "Height"
          , h = "scroll" + b;
        if (!n(a))
            return a[h] - $(a)[b.toLowerCase()]();
        var b = "client" + b
          , k = a.ownerDocument || a.document
          , l = k.documentElement
          , k = k.body;
        return Math.max(l[h], k[h]) - Math.min(l[b], k[b])
    }
    ;
    $.Tween.propHooks.scrollLeft = $.Tween.propHooks.scrollTop = {
        get: function(a) {
            return $(a.elem)[a.prop]()
        },
        set: function(a) {
            var d = this.get(a);
            if (a.options.interrupt && a._last && a._last !== d)
                return $(a.elem).stop();
            var b = Math.round(a.now);
            d !== b && ($(a.elem)[a.prop](b),
            a._last = this.get(a))
        }
    };
    return p
});
(function(a) {
    if (typeof define === "function" && define.amd) {
        define(["jquery"], a)
    } else {
        a(jQuery)
    }
}
)(function($) {
    var g = location.href.replace(/#.*/, "");
    var h = $.localScroll = function(a) {
        $("body").localScroll(a)
    }
    ;
    h.defaults = {
        duration: 1e3,
        axis: "y",
        event: "click",
        stop: true,
        target: window
    };
    $.fn.localScroll = function(a) {
        a = $.extend({}, h.defaults, a);
        if (a.hash && location.hash) {
            if (a.target)
                window.scrollTo(0, 0);
            scroll(0, location, a)
        }
        return a.lazy ? this.on(a.event, "a,area", function(e) {
            if (filter.call(this)) {
                scroll(e, this, a)
            }
        }) : this.find("a,area").filter(filter).bind(a.event, function(e) {
            scroll(e, this, a)
        }).end().end();
        function filter() {
            return !!this.href && !!this.hash && this.href.replace(this.hash, "") === g && (!a.filter || $(this).is(a.filter))
        }
    }
    ;
    h.hash = function() {}
    ;
    function scroll(e, a, b) {
        var c = a.hash.slice(1)
          , elem = document.getElementById(c) || document.getElementsByName(c)[0];
        if (!elem)
            return;
        if (e)
            e.preventDefault();
        var d = $(b.target);
        if (b.lock && d.is(":animated") || b.onBefore && b.onBefore(e, elem, d) === false)
            return;
        if (b.stop) {
            d.stop(true)
        }
        if (b.hash) {
            var f = elem.id === c ? "id" : "name"
              , $a = $("<a> </a>").attr(f, c).css({
                position: "absolute",
                top: $(window).scrollTop(),
                left: $(window).scrollLeft()
            });
            elem[f] = "";
            $("body").prepend($a);
            location.hash = a.hash;
            $a.remove();
            elem[f] = c
        }
        d.scrollTo(elem, b).trigger("notify.serialScroll", [elem])
    }
    return h
});
if ("undefined" == typeof jQuery)
    throw new Error("Bootstrap's JavaScript requires jQuery");
!function(t) {
    "use strict";
    var e = jQuery.fn.jquery.split(" ")[0].split(".");
    if (e[0] < 2 && e[1] < 9 || 1 == e[0] && 9 == e[1] && e[2] < 1 || 3 < e[0])
        throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")
}(),
function(n) {
    "use strict";
    n.fn.emulateTransitionEnd = function(t) {
        var e = !1
          , i = this;
        n(this).one("bsTransitionEnd", function() {
            e = !0
        });
        return setTimeout(function() {
            e || n(i).trigger(n.support.transition.end)
        }, t),
        this
    }
    ,
    n(function() {
        n.support.transition = function o() {
            var t = document.createElement("bootstrap")
              , e = {
                WebkitTransition: "webkitTransitionEnd",
                MozTransition: "transitionend",
                OTransition: "oTransitionEnd otransitionend",
                transition: "transitionend"
            };
            for (var i in e)
                if (t.style[i] !== undefined)
                    return {
                        end: e[i]
                    };
            return !1
        }(),
        n.support.transition && (n.event.special.bsTransitionEnd = {
            bindType: n.support.transition.end,
            delegateType: n.support.transition.end,
            handle: function(t) {
                if (n(t.target).is(this))
                    return t.handleObj.handler.apply(this, arguments)
            }
        })
    })
}(jQuery),
function(s) {
    "use strict";
    var e = '[data-dismiss="alert"]'
      , a = function(t) {
        s(t).on("click", e, this.close)
    };
    a.VERSION = "3.4.1",
    a.TRANSITION_DURATION = 150,
    a.prototype.close = function(t) {
        var e = s(this)
          , i = e.attr("data-target");
        i || (i = (i = e.attr("href")) && i.replace(/.*(?=#[^\s]*$)/, "")),
        i = "#" === i ? [] : i;
        var o = s(document).find(i);
        function n() {
            o.detach().trigger("closed.bs.alert").remove()
        }
        t && t.preventDefault(),
        o.length || (o = e.closest(".alert")),
        o.trigger(t = s.Event("close.bs.alert")),
        t.isDefaultPrevented() || (o.removeClass("in"),
        s.support.transition && o.hasClass("fade") ? o.one("bsTransitionEnd", n).emulateTransitionEnd(a.TRANSITION_DURATION) : n())
    }
    ;
    var t = s.fn.alert;
    s.fn.alert = function o(i) {
        return this.each(function() {
            var t = s(this)
              , e = t.data("bs.alert");
            e || t.data("bs.alert", e = new a(this)),
            "string" == typeof i && e[i].call(t)
        })
    }
    ,
    s.fn.alert.Constructor = a,
    s.fn.alert.noConflict = function() {
        return s.fn.alert = t,
        this
    }
    ,
    s(document).on("click.bs.alert.data-api", e, a.prototype.close)
}(jQuery),
function(s) {
    "use strict";
    var n = function(t, e) {
        this.$element = s(t),
        this.options = s.extend({}, n.DEFAULTS, e),
        this.isLoading = !1
    };
    function i(o) {
        return this.each(function() {
            var t = s(this)
              , e = t.data("bs.button")
              , i = "object" == typeof o && o;
            e || t.data("bs.button", e = new n(this,i)),
            "toggle" == o ? e.toggle() : o && e.setState(o)
        })
    }
    n.VERSION = "3.4.1",
    n.DEFAULTS = {
        loadingText: "loading..."
    },
    n.prototype.setState = function(t) {
        var e = "disabled"
          , i = this.$element
          , o = i.is("input") ? "val" : "html"
          , n = i.data();
        t += "Text",
        null == n.resetText && i.data("resetText", i[o]()),
        setTimeout(s.proxy(function() {
            i[o](null == n[t] ? this.options[t] : n[t]),
            "loadingText" == t ? (this.isLoading = !0,
            i.addClass(e).attr(e, e).prop(e, !0)) : this.isLoading && (this.isLoading = !1,
            i.removeClass(e).removeAttr(e).prop(e, !1))
        }, this), 0)
    }
    ,
    n.prototype.toggle = function() {
        var t = !0
          , e = this.$element.closest('[data-toggle="buttons"]');
        if (e.length) {
            var i = this.$element.find("input");
            "radio" == i.prop("type") ? (i.prop("checked") && (t = !1),
            e.find(".active").removeClass("active"),
            this.$element.addClass("active")) : "checkbox" == i.prop("type") && (i.prop("checked") !== this.$element.hasClass("active") && (t = !1),
            this.$element.toggleClass("active")),
            i.prop("checked", this.$element.hasClass("active")),
            t && i.trigger("change")
        } else
            this.$element.attr("aria-pressed", !this.$element.hasClass("active")),
            this.$element.toggleClass("active")
    }
    ;
    var t = s.fn.button;
    s.fn.button = i,
    s.fn.button.Constructor = n,
    s.fn.button.noConflict = function() {
        return s.fn.button = t,
        this
    }
    ,
    s(document).on("click.bs.button.data-api", '[data-toggle^="button"]', function(t) {
        var e = s(t.target).closest(".btn");
        i.call(e, "toggle"),
        s(t.target).is('input[type="radio"], input[type="checkbox"]') || (t.preventDefault(),
        e.is("input,button") ? e.trigger("focus") : e.find("input:visible,button:visible").first().trigger("focus"))
    }).on("focus.bs.button.data-api blur.bs.button.data-api", '[data-toggle^="button"]', function(t) {
        s(t.target).closest(".btn").toggleClass("focus", /^focus(in)?$/.test(t.type))
    })
}(jQuery),
function(p) {
    "use strict";
    var c = function(t, e) {
        this.$element = p(t),
        this.$indicators = this.$element.find(".carousel-indicators"),
        this.options = e,
        this.paused = null,
        this.sliding = null,
        this.interval = null,
        this.$active = null,
        this.$items = null,
        this.options.keyboard && this.$element.on("keydown.bs.carousel", p.proxy(this.keydown, this)),
        "hover" == this.options.pause && !("ontouchstart"in document.documentElement) && this.$element.on("mouseenter.bs.carousel", p.proxy(this.pause, this)).on("mouseleave.bs.carousel", p.proxy(this.cycle, this))
    };
    function r(n) {
        return this.each(function() {
            var t = p(this)
              , e = t.data("bs.carousel")
              , i = p.extend({}, c.DEFAULTS, t.data(), "object" == typeof n && n)
              , o = "string" == typeof n ? n : i.slide;
            e || t.data("bs.carousel", e = new c(this,i)),
            "number" == typeof n ? e.to(n) : o ? e[o]() : i.interval && e.pause().cycle()
        })
    }
    c.VERSION = "3.4.1",
    c.TRANSITION_DURATION = 600,
    c.DEFAULTS = {
        interval: 5e3,
        pause: "hover",
        wrap: !0,
        keyboard: !0
    },
    c.prototype.keydown = function(t) {
        if (!/input|textarea/i.test(t.target.tagName)) {
            switch (t.which) {
            case 37:
                this.prev();
                break;
            case 39:
                this.next();
                break;
            default:
                return
            }
            t.preventDefault()
        }
    }
    ,
    c.prototype.cycle = function(t) {
        return t || (this.paused = !1),
        this.interval && clearInterval(this.interval),
        this.options.interval && !this.paused && (this.interval = setInterval(p.proxy(this.next, this), this.options.interval)),
        this
    }
    ,
    c.prototype.getItemIndex = function(t) {
        return this.$items = t.parent().children(".item"),
        this.$items.index(t || this.$active)
    }
    ,
    c.prototype.getItemForDirection = function(t, e) {
        var i = this.getItemIndex(e);
        if (("prev" == t && 0 === i || "next" == t && i == this.$items.length - 1) && !this.options.wrap)
            return e;
        var o = (i + ("prev" == t ? -1 : 1)) % this.$items.length;
        return this.$items.eq(o)
    }
    ,
    c.prototype.to = function(t) {
        var e = this
          , i = this.getItemIndex(this.$active = this.$element.find(".item.active"));
        if (!(t > this.$items.length - 1 || t < 0))
            return this.sliding ? this.$element.one("slid.bs.carousel", function() {
                e.to(t)
            }) : i == t ? this.pause().cycle() : this.slide(i < t ? "next" : "prev", this.$items.eq(t))
    }
    ,
    c.prototype.pause = function(t) {
        return t || (this.paused = !0),
        this.$element.find(".next, .prev").length && p.support.transition && (this.$element.trigger(p.support.transition.end),
        this.cycle(!0)),
        this.interval = clearInterval(this.interval),
        this
    }
    ,
    c.prototype.next = function() {
        if (!this.sliding)
            return this.slide("next")
    }
    ,
    c.prototype.prev = function() {
        if (!this.sliding)
            return this.slide("prev")
    }
    ,
    c.prototype.slide = function(t, e) {
        var i = this.$element.find(".item.active")
          , o = e || this.getItemForDirection(t, i)
          , n = this.interval
          , s = "next" == t ? "left" : "right"
          , a = this;
        if (o.hasClass("active"))
            return this.sliding = !1;
        var r = o[0]
          , l = p.Event("slide.bs.carousel", {
            relatedTarget: r,
            direction: s
        });
        if (this.$element.trigger(l),
        !l.isDefaultPrevented()) {
            if (this.sliding = !0,
            n && this.pause(),
            this.$indicators.length) {
                this.$indicators.find(".active").removeClass("active");
                var h = p(this.$indicators.children()[this.getItemIndex(o)]);
                h && h.addClass("active")
            }
            var d = p.Event("slid.bs.carousel", {
                relatedTarget: r,
                direction: s
            });
            return p.support.transition && this.$element.hasClass("slide") ? (o.addClass(t),
            "object" == typeof o && o.length && o[0].offsetWidth,
            i.addClass(s),
            o.addClass(s),
            i.one("bsTransitionEnd", function() {
                o.removeClass([t, s].join(" ")).addClass("active"),
                i.removeClass(["active", s].join(" ")),
                a.sliding = !1,
                setTimeout(function() {
                    a.$element.trigger(d)
                }, 0)
            }).emulateTransitionEnd(c.TRANSITION_DURATION)) : (i.removeClass("active"),
            o.addClass("active"),
            this.sliding = !1,
            this.$element.trigger(d)),
            n && this.cycle(),
            this
        }
    }
    ;
    var t = p.fn.carousel;
    p.fn.carousel = r,
    p.fn.carousel.Constructor = c,
    p.fn.carousel.noConflict = function() {
        return p.fn.carousel = t,
        this
    }
    ;
    var e = function(t) {
        var e = p(this)
          , i = e.attr("href");
        i && (i = i.replace(/.*(?=#[^\s]+$)/, ""));
        var o = e.attr("data-target") || i
          , n = p(document).find(o);
        if (n.hasClass("carousel")) {
            var s = p.extend({}, n.data(), e.data())
              , a = e.attr("data-slide-to");
            a && (s.interval = !1),
            r.call(n, s),
            a && n.data("bs.carousel").to(a),
            t.preventDefault()
        }
    };
    p(document).on("click.bs.carousel.data-api", "[data-slide]", e).on("click.bs.carousel.data-api", "[data-slide-to]", e),
    p(window).on("load", function() {
        p('[data-ride="carousel"]').each(function() {
            var t = p(this);
            r.call(t, t.data())
        })
    })
}(jQuery),
function(a) {
    "use strict";
    var r = function(t, e) {
        this.$element = a(t),
        this.options = a.extend({}, r.DEFAULTS, e),
        this.$trigger = a('[data-toggle="collapse"][href="#' + t.id + '"],[data-toggle="collapse"][data-target="#' + t.id + '"]'),
        this.transitioning = null,
        this.options.parent ? this.$parent = this.getParent() : this.addAriaAndCollapsedClass(this.$element, this.$trigger),
        this.options.toggle && this.toggle()
    };
    function n(t) {
        var e, i = t.attr("data-target") || (e = t.attr("href")) && e.replace(/.*(?=#[^\s]+$)/, "");
        return a(document).find(i)
    }
    function l(o) {
        return this.each(function() {
            var t = a(this)
              , e = t.data("bs.collapse")
              , i = a.extend({}, r.DEFAULTS, t.data(), "object" == typeof o && o);
            !e && i.toggle && /show|hide/.test(o) && (i.toggle = !1),
            e || t.data("bs.collapse", e = new r(this,i)),
            "string" == typeof o && e[o]()
        })
    }
    r.VERSION = "3.4.1",
    r.TRANSITION_DURATION = 350,
    r.DEFAULTS = {
        toggle: !0
    },
    r.prototype.dimension = function() {
        return this.$element.hasClass("width") ? "width" : "height"
    }
    ,
    r.prototype.show = function() {
        if (!this.transitioning && !this.$element.hasClass("in")) {
            var t, e = this.$parent && this.$parent.children(".panel").children(".in, .collapsing");
            if (!(e && e.length && (t = e.data("bs.collapse")) && t.transitioning)) {
                var i = a.Event("show.bs.collapse");
                if (this.$element.trigger(i),
                !i.isDefaultPrevented()) {
                    e && e.length && (l.call(e, "hide"),
                    t || e.data("bs.collapse", null));
                    var o = this.dimension();
                    this.$element.removeClass("collapse").addClass("collapsing")[o](0).attr("aria-expanded", !0),
                    this.$trigger.removeClass("collapsed").attr("aria-expanded", !0),
                    this.transitioning = 1;
                    var n = function() {
                        this.$element.removeClass("collapsing").addClass("collapse in")[o](""),
                        this.transitioning = 0,
                        this.$element.trigger("shown.bs.collapse")
                    };
                    if (!a.support.transition)
                        return n.call(this);
                    var s = a.camelCase(["scroll", o].join("-"));
                    this.$element.one("bsTransitionEnd", a.proxy(n, this)).emulateTransitionEnd(r.TRANSITION_DURATION)[o](this.$element[0][s])
                }
            }
        }
    }
    ,
    r.prototype.hide = function() {
        if (!this.transitioning && this.$element.hasClass("in")) {
            var t = a.Event("hide.bs.collapse");
            if (this.$element.trigger(t),
            !t.isDefaultPrevented()) {
                var e = this.dimension();
                this.$element[e](this.$element[e]())[0].offsetHeight,
                this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded", !1),
                this.$trigger.addClass("collapsed").attr("aria-expanded", !1),
                this.transitioning = 1;
                var i = function() {
                    this.transitioning = 0,
                    this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")
                };
                if (!a.support.transition)
                    return i.call(this);
                this.$element[e](0).one("bsTransitionEnd", a.proxy(i, this)).emulateTransitionEnd(r.TRANSITION_DURATION)
            }
        }
    }
    ,
    r.prototype.toggle = function() {
        this[this.$element.hasClass("in") ? "hide" : "show"]()
    }
    ,
    r.prototype.getParent = function() {
        return a(document).find(this.options.parent).find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]').each(a.proxy(function(t, e) {
            var i = a(e);
            this.addAriaAndCollapsedClass(n(i), i)
        }, this)).end()
    }
    ,
    r.prototype.addAriaAndCollapsedClass = function(t, e) {
        var i = t.hasClass("in");
        t.attr("aria-expanded", i),
        e.toggleClass("collapsed", !i).attr("aria-expanded", i)
    }
    ;
    var t = a.fn.collapse;
    a.fn.collapse = l,
    a.fn.collapse.Constructor = r,
    a.fn.collapse.noConflict = function() {
        return a.fn.collapse = t,
        this
    }
    ,
    a(document).on("click.bs.collapse.data-api", '[data-toggle="collapse"]', function(t) {
        var e = a(this);
        e.attr("data-target") || t.preventDefault();
        var i = n(e)
          , o = i.data("bs.collapse") ? "toggle" : e.data();
        l.call(i, o)
    })
}(jQuery),
function(a) {
    "use strict";
    var r = '[data-toggle="dropdown"]'
      , o = function(t) {
        a(t).on("click.bs.dropdown", this.toggle)
    };
    function l(t) {
        var e = t.attr("data-target");
        e || (e = (e = t.attr("href")) && /#[A-Za-z]/.test(e) && e.replace(/.*(?=#[^\s]*$)/, ""));
        var i = "#" !== e ? a(document).find(e) : null;
        return i && i.length ? i : t.parent()
    }
    function s(o) {
        o && 3 === o.which || (a(".dropdown-backdrop").remove(),
        a(r).each(function() {
            var t = a(this)
              , e = l(t)
              , i = {
                relatedTarget: this
            };
            e.hasClass("open") && (o && "click" == o.type && /input|textarea/i.test(o.target.tagName) && a.contains(e[0], o.target) || (e.trigger(o = a.Event("hide.bs.dropdown", i)),
            o.isDefaultPrevented() || (t.attr("aria-expanded", "false"),
            e.removeClass("open").trigger(a.Event("hidden.bs.dropdown", i)))))
        }))
    }
    o.VERSION = "3.4.1",
    o.prototype.toggle = function(t) {
        var e = a(this);
        if (!e.is(".disabled, :disabled")) {
            var i = l(e)
              , o = i.hasClass("open");
            if (s(),
            !o) {
                "ontouchstart"in document.documentElement && !i.closest(".navbar-nav").length && a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click", s);
                var n = {
                    relatedTarget: this
                };
                if (i.trigger(t = a.Event("show.bs.dropdown", n)),
                t.isDefaultPrevented())
                    return;
                e.trigger("focus").attr("aria-expanded", "true"),
                i.toggleClass("open").trigger(a.Event("shown.bs.dropdown", n))
            }
            return !1
        }
    }
    ,
    o.prototype.keydown = function(t) {
        if (/(38|40|27|32)/.test(t.which) && !/input|textarea/i.test(t.target.tagName)) {
            var e = a(this);
            if (t.preventDefault(),
            t.stopPropagation(),
            !e.is(".disabled, :disabled")) {
                var i = l(e)
                  , o = i.hasClass("open");
                if (!o && 27 != t.which || o && 27 == t.which)
                    return 27 == t.which && i.find(r).trigger("focus"),
                    e.trigger("click");
                var n = i.find(".dropdown-menu li:not(.disabled):visible a");
                if (n.length) {
                    var s = n.index(t.target);
                    38 == t.which && 0 < s && s--,
                    40 == t.which && s < n.length - 1 && s++,
                    ~s || (s = 0),
                    n.eq(s).trigger("focus")
                }
            }
        }
    }
    ;
    var t = a.fn.dropdown;
    a.fn.dropdown = function e(i) {
        return this.each(function() {
            var t = a(this)
              , e = t.data("bs.dropdown");
            e || t.data("bs.dropdown", e = new o(this)),
            "string" == typeof i && e[i].call(t)
        })
    }
    ,
    a.fn.dropdown.Constructor = o,
    a.fn.dropdown.noConflict = function() {
        return a.fn.dropdown = t,
        this
    }
    ,
    a(document).on("click.bs.dropdown.data-api", s).on("click.bs.dropdown.data-api", ".dropdown form", function(t) {
        t.stopPropagation()
    }).on("click.bs.dropdown.data-api", r, o.prototype.toggle).on("keydown.bs.dropdown.data-api", r, o.prototype.keydown).on("keydown.bs.dropdown.data-api", ".dropdown-menu", o.prototype.keydown)
}(jQuery),
function(a) {
    "use strict";
    var s = function(t, e) {
        this.options = e,
        this.$body = a(document.body),
        this.$element = a(t),
        this.$dialog = this.$element.find(".modal-dialog"),
        this.$backdrop = null,
        this.isShown = null,
        this.originalBodyPad = null,
        this.scrollbarWidth = 0,
        this.ignoreBackdropClick = !1,
        this.fixedContent = ".navbar-fixed-top, .navbar-fixed-bottom",
        this.options.remote && this.$element.find(".modal-content").load(this.options.remote, a.proxy(function() {
            this.$element.trigger("loaded.bs.modal")
        }, this))
    };
    function r(o, n) {
        return this.each(function() {
            var t = a(this)
              , e = t.data("bs.modal")
              , i = a.extend({}, s.DEFAULTS, t.data(), "object" == typeof o && o);
            e || t.data("bs.modal", e = new s(this,i)),
            "string" == typeof o ? e[o](n) : i.show && e.show(n)
        })
    }
    s.VERSION = "3.4.1",
    s.TRANSITION_DURATION = 300,
    s.BACKDROP_TRANSITION_DURATION = 150,
    s.DEFAULTS = {
        backdrop: !0,
        keyboard: !0,
        show: !0
    },
    s.prototype.toggle = function(t) {
        return this.isShown ? this.hide() : this.show(t)
    }
    ,
    s.prototype.show = function(i) {
        var o = this
          , t = a.Event("show.bs.modal", {
            relatedTarget: i
        });
        this.$element.trigger(t),
        this.isShown || t.isDefaultPrevented() || (this.isShown = !0,
        this.checkScrollbar(),
        this.setScrollbar(),
        this.$body.addClass("modal-open"),
        this.escape(),
        this.resize(),
        this.$element.on("click.dismiss.bs.modal", '[data-dismiss="modal"]', a.proxy(this.hide, this)),
        this.$dialog.on("mousedown.dismiss.bs.modal", function() {
            o.$element.one("mouseup.dismiss.bs.modal", function(t) {
                a(t.target).is(o.$element) && (o.ignoreBackdropClick = !0)
            })
        }),
        this.backdrop(function() {
            var t = a.support.transition && o.$element.hasClass("fade");
            o.$element.parent().length || o.$element.appendTo(o.$body),
            o.$element.show().scrollTop(0),
            o.adjustDialog(),
            t && o.$element[0].offsetWidth,
            o.$element.addClass("in"),
            o.enforceFocus();
            var e = a.Event("shown.bs.modal", {
                relatedTarget: i
            });
            t ? o.$dialog.one("bsTransitionEnd", function() {
                o.$element.trigger("focus").trigger(e)
            }).emulateTransitionEnd(s.TRANSITION_DURATION) : o.$element.trigger("focus").trigger(e)
        }))
    }
    ,
    s.prototype.hide = function(t) {
        t && t.preventDefault(),
        t = a.Event("hide.bs.modal"),
        this.$element.trigger(t),
        this.isShown && !t.isDefaultPrevented() && (this.isShown = !1,
        this.escape(),
        this.resize(),
        a(document).off("focusin.bs.modal"),
        this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),
        this.$dialog.off("mousedown.dismiss.bs.modal"),
        a.support.transition && this.$element.hasClass("fade") ? this.$element.one("bsTransitionEnd", a.proxy(this.hideModal, this)).emulateTransitionEnd(s.TRANSITION_DURATION) : this.hideModal())
    }
    ,
    s.prototype.enforceFocus = function() {
        a(document).off("focusin.bs.modal").on("focusin.bs.modal", a.proxy(function(t) {
            document === t.target || this.$element[0] === t.target || this.$element.has(t.target).length || this.$element.trigger("focus")
        }, this))
    }
    ,
    s.prototype.escape = function() {
        this.isShown && this.options.keyboard ? this.$element.on("keydown.dismiss.bs.modal", a.proxy(function(t) {
            27 == t.which && this.hide()
        }, this)) : this.isShown || this.$element.off("keydown.dismiss.bs.modal")
    }
    ,
    s.prototype.resize = function() {
        this.isShown ? a(window).on("resize.bs.modal", a.proxy(this.handleUpdate, this)) : a(window).off("resize.bs.modal")
    }
    ,
    s.prototype.hideModal = function() {
        var t = this;
        this.$element.hide(),
        this.backdrop(function() {
            t.$body.removeClass("modal-open"),
            t.resetAdjustments(),
            t.resetScrollbar(),
            t.$element.trigger("hidden.bs.modal")
        })
    }
    ,
    s.prototype.removeBackdrop = function() {
        this.$backdrop && this.$backdrop.remove(),
        this.$backdrop = null
    }
    ,
    s.prototype.backdrop = function(t) {
        var e = this
          , i = this.$element.hasClass("fade") ? "fade" : "";
        if (this.isShown && this.options.backdrop) {
            var o = a.support.transition && i;
            if (this.$backdrop = a(document.createElement("div")).addClass("modal-backdrop " + i).appendTo(this.$body),
            this.$element.on("click.dismiss.bs.modal", a.proxy(function(t) {
                this.ignoreBackdropClick ? this.ignoreBackdropClick = !1 : t.target === t.currentTarget && ("static" == this.options.backdrop ? this.$element[0].focus() : this.hide())
            }, this)),
            o && this.$backdrop[0].offsetWidth,
            this.$backdrop.addClass("in"),
            !t)
                return;
            o ? this.$backdrop.one("bsTransitionEnd", t).emulateTransitionEnd(s.BACKDROP_TRANSITION_DURATION) : t()
        } else if (!this.isShown && this.$backdrop) {
            this.$backdrop.removeClass("in");
            var n = function() {
                e.removeBackdrop(),
                t && t()
            };
            a.support.transition && this.$element.hasClass("fade") ? this.$backdrop.one("bsTransitionEnd", n).emulateTransitionEnd(s.BACKDROP_TRANSITION_DURATION) : n()
        } else
            t && t()
    }
    ,
    s.prototype.handleUpdate = function() {
        this.adjustDialog()
    }
    ,
    s.prototype.adjustDialog = function() {
        var t = this.$element[0].scrollHeight > document.documentElement.clientHeight;
        this.$element.css({
            paddingLeft: !this.bodyIsOverflowing && t ? this.scrollbarWidth : "",
            paddingRight: this.bodyIsOverflowing && !t ? this.scrollbarWidth : ""
        })
    }
    ,
    s.prototype.resetAdjustments = function() {
        this.$element.css({
            paddingLeft: "",
            paddingRight: ""
        })
    }
    ,
    s.prototype.checkScrollbar = function() {
        var t = window.innerWidth;
        if (!t) {
            var e = document.documentElement.getBoundingClientRect();
            t = e.right - Math.abs(e.left)
        }
        this.bodyIsOverflowing = document.body.clientWidth < t,
        this.scrollbarWidth = this.measureScrollbar()
    }
    ,
    s.prototype.setScrollbar = function() {
        var t = parseInt(this.$body.css("padding-right") || 0, 10);
        this.originalBodyPad = document.body.style.paddingRight || "";
        var n = this.scrollbarWidth;
        this.bodyIsOverflowing && (this.$body.css("padding-right", t + n),
        a(this.fixedContent).each(function(t, e) {
            var i = e.style.paddingRight
              , o = a(e).css("padding-right");
            a(e).data("padding-right", i).css("padding-right", parseFloat(o) + n + "px")
        }))
    }
    ,
    s.prototype.resetScrollbar = function() {
        this.$body.css("padding-right", this.originalBodyPad),
        a(this.fixedContent).each(function(t, e) {
            var i = a(e).data("padding-right");
            a(e).removeData("padding-right"),
            e.style.paddingRight = i || ""
        })
    }
    ,
    s.prototype.measureScrollbar = function() {
        var t = document.createElement("div");
        t.className = "modal-scrollbar-measure",
        this.$body.append(t);
        var e = t.offsetWidth - t.clientWidth;
        return this.$body[0].removeChild(t),
        e
    }
    ;
    var t = a.fn.modal;
    a.fn.modal = r,
    a.fn.modal.Constructor = s,
    a.fn.modal.noConflict = function() {
        return a.fn.modal = t,
        this
    }
    ,
    a(document).on("click.bs.modal.data-api", '[data-toggle="modal"]', function(t) {
        var e = a(this)
          , i = e.attr("href")
          , o = e.attr("data-target") || i && i.replace(/.*(?=#[^\s]+$)/, "")
          , n = a(document).find(o)
          , s = n.data("bs.modal") ? "toggle" : a.extend({
            remote: !/#/.test(i) && i
        }, n.data(), e.data());
        e.is("a") && t.preventDefault(),
        n.one("show.bs.modal", function(t) {
            t.isDefaultPrevented() || n.one("hidden.bs.modal", function() {
                e.is(":visible") && e.trigger("focus")
            })
        }),
        r.call(n, s, this)
    })
}(jQuery),
function(g) {
    "use strict";
    var o = ["sanitize", "whiteList", "sanitizeFn"]
      , a = ["background", "cite", "href", "itemtype", "longdesc", "poster", "src", "xlink:href"]
      , t = {
        "*": ["class", "dir", "id", "lang", "role", /^aria-[\w-]*$/i],
        a: ["target", "href", "title", "rel"],
        area: [],
        b: [],
        br: [],
        col: [],
        code: [],
        div: [],
        em: [],
        hr: [],
        h1: [],
        h2: [],
        h3: [],
        h4: [],
        h5: [],
        h6: [],
        i: [],
        img: ["src", "alt", "title", "width", "height"],
        li: [],
        ol: [],
        p: [],
        pre: [],
        s: [],
        small: [],
        span: [],
        sub: [],
        sup: [],
        strong: [],
        u: [],
        ul: []
    }
      , r = /^(?:(?:https?|mailto|ftp|tel|file):|[^&:\/?#]*(?:[\/?#]|$))/gi
      , l = /^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;
    function u(t, e) {
        var i = t.nodeName.toLowerCase();
        if (-1 !== g.inArray(i, e))
            return -1 === g.inArray(i, a) || Boolean(t.nodeValue.match(r) || t.nodeValue.match(l));
        for (var o = g(e).filter(function(t, e) {
            return e instanceof RegExp
        }), n = 0, s = o.length; n < s; n++)
            if (i.match(o[n]))
                return !0;
        return !1
    }
    function n(t, e, i) {
        if (0 === t.length)
            return t;
        if (i && "function" == typeof i)
            return i(t);
        if (!document.implementation || !document.implementation.createHTMLDocument)
            return t;
        var o = document.implementation.createHTMLDocument("sanitization");
        o.body.innerHTML = t;
        for (var n = g.map(e, function(t, e) {
            return e
        }), s = g(o.body).find("*"), a = 0, r = s.length; a < r; a++) {
            var l = s[a]
              , h = l.nodeName.toLowerCase();
            if (-1 !== g.inArray(h, n))
                for (var d = g.map(l.attributes, function(t) {
                    return t
                }), p = [].concat(e["*"] || [], e[h] || []), c = 0, f = d.length; c < f; c++)
                    u(d[c], p) || l.removeAttribute(d[c].nodeName);
            else
                l.parentNode.removeChild(l)
        }
        return o.body.innerHTML
    }
    var m = function(t, e) {
        this.type = null,
        this.options = null,
        this.enabled = null,
        this.timeout = null,
        this.hoverState = null,
        this.$element = null,
        this.inState = null,
        this.init("tooltip", t, e)
    };
    m.VERSION = "3.4.1",
    m.TRANSITION_DURATION = 150,
    m.DEFAULTS = {
        animation: !0,
        placement: "top",
        selector: !1,
        template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
        trigger: "hover focus",
        title: "",
        delay: 0,
        html: !1,
        container: !1,
        viewport: {
            selector: "body",
            padding: 0
        },
        sanitize: !0,
        sanitizeFn: null,
        whiteList: t
    },
    m.prototype.init = function(t, e, i) {
        if (this.enabled = !0,
        this.type = t,
        this.$element = g(e),
        this.options = this.getOptions(i),
        this.$viewport = this.options.viewport && g(document).find(g.isFunction(this.options.viewport) ? this.options.viewport.call(this, this.$element) : this.options.viewport.selector || this.options.viewport),
        this.inState = {
            click: !1,
            hover: !1,
            focus: !1
        },
        this.$element[0]instanceof document.constructor && !this.options.selector)
            throw new Error("`selector` option must be specified when initializing " + this.type + " on the window.document object!");
        for (var o = this.options.trigger.split(" "), n = o.length; n--; ) {
            var s = o[n];
            if ("click" == s)
                this.$element.on("click." + this.type, this.options.selector, g.proxy(this.toggle, this));
            else if ("manual" != s) {
                var a = "hover" == s ? "mouseenter" : "focusin"
                  , r = "hover" == s ? "mouseleave" : "focusout";
                this.$element.on(a + "." + this.type, this.options.selector, g.proxy(this.enter, this)),
                this.$element.on(r + "." + this.type, this.options.selector, g.proxy(this.leave, this))
            }
        }
        this.options.selector ? this._options = g.extend({}, this.options, {
            trigger: "manual",
            selector: ""
        }) : this.fixTitle()
    }
    ,
    m.prototype.getDefaults = function() {
        return m.DEFAULTS
    }
    ,
    m.prototype.getOptions = function(t) {
        var e = this.$element.data();
        for (var i in e)
            e.hasOwnProperty(i) && -1 !== g.inArray(i, o) && delete e[i];
        return (t = g.extend({}, this.getDefaults(), e, t)).delay && "number" == typeof t.delay && (t.delay = {
            show: t.delay,
            hide: t.delay
        }),
        t.sanitize && (t.template = n(t.template, t.whiteList, t.sanitizeFn)),
        t
    }
    ,
    m.prototype.getDelegateOptions = function() {
        var i = {}
          , o = this.getDefaults();
        return this._options && g.each(this._options, function(t, e) {
            o[t] != e && (i[t] = e)
        }),
        i
    }
    ,
    m.prototype.enter = function(t) {
        var e = t instanceof this.constructor ? t : g(t.currentTarget).data("bs." + this.type);
        if (e || (e = new this.constructor(t.currentTarget,this.getDelegateOptions()),
        g(t.currentTarget).data("bs." + this.type, e)),
        t instanceof g.Event && (e.inState["focusin" == t.type ? "focus" : "hover"] = !0),
        e.tip().hasClass("in") || "in" == e.hoverState)
            e.hoverState = "in";
        else {
            if (clearTimeout(e.timeout),
            e.hoverState = "in",
            !e.options.delay || !e.options.delay.show)
                return e.show();
            e.timeout = setTimeout(function() {
                "in" == e.hoverState && e.show()
            }, e.options.delay.show)
        }
    }
    ,
    m.prototype.isInStateTrue = function() {
        for (var t in this.inState)
            if (this.inState[t])
                return !0;
        return !1
    }
    ,
    m.prototype.leave = function(t) {
        var e = t instanceof this.constructor ? t : g(t.currentTarget).data("bs." + this.type);
        if (e || (e = new this.constructor(t.currentTarget,this.getDelegateOptions()),
        g(t.currentTarget).data("bs." + this.type, e)),
        t instanceof g.Event && (e.inState["focusout" == t.type ? "focus" : "hover"] = !1),
        !e.isInStateTrue()) {
            if (clearTimeout(e.timeout),
            e.hoverState = "out",
            !e.options.delay || !e.options.delay.hide)
                return e.hide();
            e.timeout = setTimeout(function() {
                "out" == e.hoverState && e.hide()
            }, e.options.delay.hide)
        }
    }
    ,
    m.prototype.show = function() {
        var t = g.Event("show.bs." + this.type);
        if (this.hasContent() && this.enabled) {
            this.$element.trigger(t);
            var e = g.contains(this.$element[0].ownerDocument.documentElement, this.$element[0]);
            if (t.isDefaultPrevented() || !e)
                return;
            var i = this
              , o = this.tip()
              , n = this.getUID(this.type);
            this.setContent(),
            o.attr("id", n),
            this.$element.attr("aria-describedby", n),
            this.options.animation && o.addClass("fade");
            var s = "function" == typeof this.options.placement ? this.options.placement.call(this, o[0], this.$element[0]) : this.options.placement
              , a = /\s?auto?\s?/i
              , r = a.test(s);
            r && (s = s.replace(a, "") || "top"),
            o.detach().css({
                top: 0,
                left: 0,
                display: "block"
            }).addClass(s).data("bs." + this.type, this),
            this.options.container ? o.appendTo(g(document).find(this.options.container)) : o.insertAfter(this.$element),
            this.$element.trigger("inserted.bs." + this.type);
            var l = this.getPosition()
              , h = o[0].offsetWidth
              , d = o[0].offsetHeight;
            if (r) {
                var p = s
                  , c = this.getPosition(this.$viewport);
                s = "bottom" == s && l.bottom + d > c.bottom ? "top" : "top" == s && l.top - d < c.top ? "bottom" : "right" == s && l.right + h > c.width ? "left" : "left" == s && l.left - h < c.left ? "right" : s,
                o.removeClass(p).addClass(s)
            }
            var f = this.getCalculatedOffset(s, l, h, d);
            this.applyPlacement(f, s);
            var u = function() {
                var t = i.hoverState;
                i.$element.trigger("shown.bs." + i.type),
                i.hoverState = null,
                "out" == t && i.leave(i)
            };
            g.support.transition && this.$tip.hasClass("fade") ? o.one("bsTransitionEnd", u).emulateTransitionEnd(m.TRANSITION_DURATION) : u()
        }
    }
    ,
    m.prototype.applyPlacement = function(t, e) {
        var i = this.tip()
          , o = i[0].offsetWidth
          , n = i[0].offsetHeight
          , s = parseInt(i.css("margin-top"), 10)
          , a = parseInt(i.css("margin-left"), 10);
        isNaN(s) && (s = 0),
        isNaN(a) && (a = 0),
        t.top += s,
        t.left += a,
        g.offset.setOffset(i[0], g.extend({
            using: function(t) {
                i.css({
                    top: Math.round(t.top),
                    left: Math.round(t.left)
                })
            }
        }, t), 0),
        i.addClass("in");
        var r = i[0].offsetWidth
          , l = i[0].offsetHeight;
        "top" == e && l != n && (t.top = t.top + n - l);
        var h = this.getViewportAdjustedDelta(e, t, r, l);
        h.left ? t.left += h.left : t.top += h.top;
        var d = /top|bottom/.test(e)
          , p = d ? 2 * h.left - o + r : 2 * h.top - n + l
          , c = d ? "offsetWidth" : "offsetHeight";
        i.offset(t),
        this.replaceArrow(p, i[0][c], d)
    }
    ,
    m.prototype.replaceArrow = function(t, e, i) {
        this.arrow().css(i ? "left" : "top", 50 * (1 - t / e) + "%").css(i ? "top" : "left", "")
    }
    ,
    m.prototype.setContent = function() {
        var t = this.tip()
          , e = this.getTitle();
        this.options.html ? (this.options.sanitize && (e = n(e, this.options.whiteList, this.options.sanitizeFn)),
        t.find(".tooltip-inner").html(e)) : t.find(".tooltip-inner").text(e),
        t.removeClass("fade in top bottom left right")
    }
    ,
    m.prototype.hide = function(t) {
        var e = this
          , i = g(this.$tip)
          , o = g.Event("hide.bs." + this.type);
        function n() {
            "in" != e.hoverState && i.detach(),
            e.$element && e.$element.removeAttr("aria-describedby").trigger("hidden.bs." + e.type),
            t && t()
        }
        if (this.$element.trigger(o),
        !o.isDefaultPrevented())
            return i.removeClass("in"),
            g.support.transition && i.hasClass("fade") ? i.one("bsTransitionEnd", n).emulateTransitionEnd(m.TRANSITION_DURATION) : n(),
            this.hoverState = null,
            this
    }
    ,
    m.prototype.fixTitle = function() {
        var t = this.$element;
        (t.attr("title") || "string" != typeof t.attr("data-original-title")) && t.attr("data-original-title", t.attr("title") || "").attr("title", "")
    }
    ,
    m.prototype.hasContent = function() {
        return this.getTitle()
    }
    ,
    m.prototype.getPosition = function(t) {
        var e = (t = t || this.$element)[0]
          , i = "BODY" == e.tagName
          , o = e.getBoundingClientRect();
        null == o.width && (o = g.extend({}, o, {
            width: o.right - o.left,
            height: o.bottom - o.top
        }));
        var n = window.SVGElement && e instanceof window.SVGElement
          , s = i ? {
            top: 0,
            left: 0
        } : n ? null : t.offset()
          , a = {
            scroll: i ? document.documentElement.scrollTop || document.body.scrollTop : t.scrollTop()
        }
          , r = i ? {
            width: g(window).width(),
            height: g(window).height()
        } : null;
        return g.extend({}, o, a, r, s)
    }
    ,
    m.prototype.getCalculatedOffset = function(t, e, i, o) {
        return "bottom" == t ? {
            top: e.top + e.height,
            left: e.left + e.width / 2 - i / 2
        } : "top" == t ? {
            top: e.top - o,
            left: e.left + e.width / 2 - i / 2
        } : "left" == t ? {
            top: e.top + e.height / 2 - o / 2,
            left: e.left - i
        } : {
            top: e.top + e.height / 2 - o / 2,
            left: e.left + e.width
        }
    }
    ,
    m.prototype.getViewportAdjustedDelta = function(t, e, i, o) {
        var n = {
            top: 0,
            left: 0
        };
        if (!this.$viewport)
            return n;
        var s = this.options.viewport && this.options.viewport.padding || 0
          , a = this.getPosition(this.$viewport);
        if (/right|left/.test(t)) {
            var r = e.top - s - a.scroll
              , l = e.top + s - a.scroll + o;
            r < a.top ? n.top = a.top - r : l > a.top + a.height && (n.top = a.top + a.height - l)
        } else {
            var h = e.left - s
              , d = e.left + s + i;
            h < a.left ? n.left = a.left - h : d > a.right && (n.left = a.left + a.width - d)
        }
        return n
    }
    ,
    m.prototype.getTitle = function() {
        var t = this.$element
          , e = this.options;
        return t.attr("data-original-title") || ("function" == typeof e.title ? e.title.call(t[0]) : e.title)
    }
    ,
    m.prototype.getUID = function(t) {
        for (; t += ~~(1e6 * Math.random()),
        document.getElementById(t); )
            ;
        return t
    }
    ,
    m.prototype.tip = function() {
        if (!this.$tip && (this.$tip = g(this.options.template),
        1 != this.$tip.length))
            throw new Error(this.type + " `template` option must consist of exactly 1 top-level element!");
        return this.$tip
    }
    ,
    m.prototype.arrow = function() {
        return this.$arrow = this.$arrow || this.tip().find(".tooltip-arrow")
    }
    ,
    m.prototype.enable = function() {
        this.enabled = !0
    }
    ,
    m.prototype.disable = function() {
        this.enabled = !1
    }
    ,
    m.prototype.toggleEnabled = function() {
        this.enabled = !this.enabled
    }
    ,
    m.prototype.toggle = function(t) {
        var e = this;
        t && ((e = g(t.currentTarget).data("bs." + this.type)) || (e = new this.constructor(t.currentTarget,this.getDelegateOptions()),
        g(t.currentTarget).data("bs." + this.type, e))),
        t ? (e.inState.click = !e.inState.click,
        e.isInStateTrue() ? e.enter(e) : e.leave(e)) : e.tip().hasClass("in") ? e.leave(e) : e.enter(e)
    }
    ,
    m.prototype.destroy = function() {
        var t = this;
        clearTimeout(this.timeout),
        this.hide(function() {
            t.$element.off("." + t.type).removeData("bs." + t.type),
            t.$tip && t.$tip.detach(),
            t.$tip = null,
            t.$arrow = null,
            t.$viewport = null,
            t.$element = null
        })
    }
    ,
    m.prototype.sanitizeHtml = function(t) {
        return n(t, this.options.whiteList, this.options.sanitizeFn)
    }
    ;
    var e = g.fn.tooltip;
    g.fn.tooltip = function i(o) {
        return this.each(function() {
            var t = g(this)
              , e = t.data("bs.tooltip")
              , i = "object" == typeof o && o;
            !e && /destroy|hide/.test(o) || (e || t.data("bs.tooltip", e = new m(this,i)),
            "string" == typeof o && e[o]())
        })
    }
    ,
    g.fn.tooltip.Constructor = m,
    g.fn.tooltip.noConflict = function() {
        return g.fn.tooltip = e,
        this
    }
}(jQuery),
function(n) {
    "use strict";
    var s = function(t, e) {
        this.init("popover", t, e)
    };
    if (!n.fn.tooltip)
        throw new Error("Popover requires tooltip.js");
    s.VERSION = "3.4.1",
    s.DEFAULTS = n.extend({}, n.fn.tooltip.Constructor.DEFAULTS, {
        placement: "right",
        trigger: "click",
        content: "",
        template: '<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'
    }),
    ((s.prototype = n.extend({}, n.fn.tooltip.Constructor.prototype)).constructor = s).prototype.getDefaults = function() {
        return s.DEFAULTS
    }
    ,
    s.prototype.setContent = function() {
        var t = this.tip()
          , e = this.getTitle()
          , i = this.getContent();
        if (this.options.html) {
            var o = typeof i;
            this.options.sanitize && (e = this.sanitizeHtml(e),
            "string" === o && (i = this.sanitizeHtml(i))),
            t.find(".popover-title").html(e),
            t.find(".popover-content").children().detach().end()["string" === o ? "html" : "append"](i)
        } else
            t.find(".popover-title").text(e),
            t.find(".popover-content").children().detach().end().text(i);
        t.removeClass("fade top bottom left right in"),
        t.find(".popover-title").html() || t.find(".popover-title").hide()
    }
    ,
    s.prototype.hasContent = function() {
        return this.getTitle() || this.getContent()
    }
    ,
    s.prototype.getContent = function() {
        var t = this.$element
          , e = this.options;
        return t.attr("data-content") || ("function" == typeof e.content ? e.content.call(t[0]) : e.content)
    }
    ,
    s.prototype.arrow = function() {
        return this.$arrow = this.$arrow || this.tip().find(".arrow")
    }
    ;
    var t = n.fn.popover;
    n.fn.popover = function e(o) {
        return this.each(function() {
            var t = n(this)
              , e = t.data("bs.popover")
              , i = "object" == typeof o && o;
            !e && /destroy|hide/.test(o) || (e || t.data("bs.popover", e = new s(this,i)),
            "string" == typeof o && e[o]())
        })
    }
    ,
    n.fn.popover.Constructor = s,
    n.fn.popover.noConflict = function() {
        return n.fn.popover = t,
        this
    }
}(jQuery),
function(s) {
    "use strict";
    function n(t, e) {
        this.$body = s(document.body),
        this.$scrollElement = s(t).is(document.body) ? s(window) : s(t),
        this.options = s.extend({}, n.DEFAULTS, e),
        this.selector = (this.options.target || "") + " .nav li > a",
        this.offsets = [],
        this.targets = [],
        this.activeTarget = null,
        this.scrollHeight = 0,
        this.$scrollElement.on("scroll.bs.scrollspy", s.proxy(this.process, this)),
        this.refresh(),
        this.process()
    }
    function e(o) {
        return this.each(function() {
            var t = s(this)
              , e = t.data("bs.scrollspy")
              , i = "object" == typeof o && o;
            e || t.data("bs.scrollspy", e = new n(this,i)),
            "string" == typeof o && e[o]()
        })
    }
    n.VERSION = "3.4.1",
    n.DEFAULTS = {
        offset: 10
    },
    n.prototype.getScrollHeight = function() {
        return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
    }
    ,
    n.prototype.refresh = function() {
        var t = this
          , o = "offset"
          , n = 0;
        this.offsets = [],
        this.targets = [],
        this.scrollHeight = this.getScrollHeight(),
        s.isWindow(this.$scrollElement[0]) || (o = "position",
        n = this.$scrollElement.scrollTop()),
        this.$body.find(this.selector).map(function() {
            var t = s(this)
              , e = t.data("target") || t.attr("href")
              , i = /^#./.test(e) && s(e);
            return i && i.length && i.is(":visible") && [[i[o]().top + n, e]] || null
        }).sort(function(t, e) {
            return t[0] - e[0]
        }).each(function() {
            t.offsets.push(this[0]),
            t.targets.push(this[1])
        })
    }
    ,
    n.prototype.process = function() {
        var t, e = this.$scrollElement.scrollTop() + this.options.offset, i = this.getScrollHeight(), o = this.options.offset + i - this.$scrollElement.height(), n = this.offsets, s = this.targets, a = this.activeTarget;
        if (this.scrollHeight != i && this.refresh(),
        o <= e)
            return a != (t = s[s.length - 1]) && this.activate(t);
        if (a && e < n[0])
            return this.activeTarget = null,
            this.clear();
        for (t = n.length; t--; )
            a != s[t] && e >= n[t] && (n[t + 1] === undefined || e < n[t + 1]) && this.activate(s[t])
    }
    ,
    n.prototype.activate = function(t) {
        this.activeTarget = t,
        this.clear();
        var e = this.selector + '[data-target="' + t + '"],' + this.selector + '[href="' + t + '"]'
          , i = s(e).parents("li").addClass("active");
        i.parent(".dropdown-menu").length && (i = i.closest("li.dropdown").addClass("active")),
        i.trigger("activate.bs.scrollspy")
    }
    ,
    n.prototype.clear = function() {
        s(this.selector).parentsUntil(this.options.target, ".active").removeClass("active")
    }
    ;
    var t = s.fn.scrollspy;
    s.fn.scrollspy = e,
    s.fn.scrollspy.Constructor = n,
    s.fn.scrollspy.noConflict = function() {
        return s.fn.scrollspy = t,
        this
    }
    ,
    s(window).on("load.bs.scrollspy.data-api", function() {
        s('[data-spy="scroll"]').each(function() {
            var t = s(this);
            e.call(t, t.data())
        })
    })
}(jQuery),
function(r) {
    "use strict";
    var a = function(t) {
        this.element = r(t)
    };
    function e(i) {
        return this.each(function() {
            var t = r(this)
              , e = t.data("bs.tab");
            e || t.data("bs.tab", e = new a(this)),
            "string" == typeof i && e[i]()
        })
    }
    a.VERSION = "3.4.1",
    a.TRANSITION_DURATION = 150,
    a.prototype.show = function() {
        var t = this.element
          , e = t.closest("ul:not(.dropdown-menu)")
          , i = t.data("target");
        if (i || (i = (i = t.attr("href")) && i.replace(/.*(?=#[^\s]*$)/, "")),
        !t.parent("li").hasClass("active")) {
            var o = e.find(".active:last a")
              , n = r.Event("hide.bs.tab", {
                relatedTarget: t[0]
            })
              , s = r.Event("show.bs.tab", {
                relatedTarget: o[0]
            });
            if (o.trigger(n),
            t.trigger(s),
            !s.isDefaultPrevented() && !n.isDefaultPrevented()) {
                var a = r(document).find(i);
                this.activate(t.closest("li"), e),
                this.activate(a, a.parent(), function() {
                    o.trigger({
                        type: "hidden.bs.tab",
                        relatedTarget: t[0]
                    }),
                    t.trigger({
                        type: "shown.bs.tab",
                        relatedTarget: o[0]
                    })
                })
            }
        }
    }
    ,
    a.prototype.activate = function(t, e, i) {
        var o = e.find("> .active")
          , n = i && r.support.transition && (o.length && o.hasClass("fade") || !!e.find("> .fade").length);
        function s() {
            o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded", !1),
            t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded", !0),
            n ? (t[0].offsetWidth,
            t.addClass("in")) : t.removeClass("fade"),
            t.parent(".dropdown-menu").length && t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded", !0),
            i && i()
        }
        o.length && n ? o.one("bsTransitionEnd", s).emulateTransitionEnd(a.TRANSITION_DURATION) : s(),
        o.removeClass("in")
    }
    ;
    var t = r.fn.tab;
    r.fn.tab = e,
    r.fn.tab.Constructor = a,
    r.fn.tab.noConflict = function() {
        return r.fn.tab = t,
        this
    }
    ;
    var i = function(t) {
        t.preventDefault(),
        e.call(r(this), "show")
    };
    r(document).on("click.bs.tab.data-api", '[data-toggle="tab"]', i).on("click.bs.tab.data-api", '[data-toggle="pill"]', i)
}(jQuery),
function(l) {
    "use strict";
    var h = function(t, e) {
        this.options = l.extend({}, h.DEFAULTS, e);
        var i = this.options.target === h.DEFAULTS.target ? l(this.options.target) : l(document).find(this.options.target);
        this.$target = i.on("scroll.bs.affix.data-api", l.proxy(this.checkPosition, this)).on("click.bs.affix.data-api", l.proxy(this.checkPositionWithEventLoop, this)),
        this.$element = l(t),
        this.affixed = null,
        this.unpin = null,
        this.pinnedOffset = null,
        this.checkPosition()
    };
    function i(o) {
        return this.each(function() {
            var t = l(this)
              , e = t.data("bs.affix")
              , i = "object" == typeof o && o;
            e || t.data("bs.affix", e = new h(this,i)),
            "string" == typeof o && e[o]()
        })
    }
    h.VERSION = "3.4.1",
    h.RESET = "affix affix-top affix-bottom",
    h.DEFAULTS = {
        offset: 0,
        target: window
    },
    h.prototype.getState = function(t, e, i, o) {
        var n = this.$target.scrollTop()
          , s = this.$element.offset()
          , a = this.$target.height();
        if (null != i && "top" == this.affixed)
            return n < i && "top";
        if ("bottom" == this.affixed)
            return null != i ? !(n + this.unpin <= s.top) && "bottom" : !(n + a <= t - o) && "bottom";
        var r = null == this.affixed
          , l = r ? n : s.top;
        return null != i && n <= i ? "top" : null != o && t - o <= l + (r ? a : e) && "bottom"
    }
    ,
    h.prototype.getPinnedOffset = function() {
        if (this.pinnedOffset)
            return this.pinnedOffset;
        this.$element.removeClass(h.RESET).addClass("affix");
        var t = this.$target.scrollTop()
          , e = this.$element.offset();
        return this.pinnedOffset = e.top - t
    }
    ,
    h.prototype.checkPositionWithEventLoop = function() {
        setTimeout(l.proxy(this.checkPosition, this), 1)
    }
    ,
    h.prototype.checkPosition = function() {
        if (this.$element.is(":visible")) {
            var t = this.$element.height()
              , e = this.options.offset
              , i = e.top
              , o = e.bottom
              , n = Math.max(l(document).height(), l(document.body).height());
            "object" != typeof e && (o = i = e),
            "function" == typeof i && (i = e.top(this.$element)),
            "function" == typeof o && (o = e.bottom(this.$element));
            var s = this.getState(n, t, i, o);
            if (this.affixed != s) {
                null != this.unpin && this.$element.css("top", "");
                var a = "affix" + (s ? "-" + s : "")
                  , r = l.Event(a + ".bs.affix");
                if (this.$element.trigger(r),
                r.isDefaultPrevented())
                    return;
                this.affixed = s,
                this.unpin = "bottom" == s ? this.getPinnedOffset() : null,
                this.$element.removeClass(h.RESET).addClass(a).trigger(a.replace("affix", "affixed") + ".bs.affix")
            }
            "bottom" == s && this.$element.offset({
                top: n - t - o
            })
        }
    }
    ;
    var t = l.fn.affix;
    l.fn.affix = i,
    l.fn.affix.Constructor = h,
    l.fn.affix.noConflict = function() {
        return l.fn.affix = t,
        this
    }
    ,
    l(window).on("load", function() {
        l('[data-spy="affix"]').each(function() {
            var t = l(this)
              , e = t.data();
            e.offset = e.offset || {},
            null != e.offsetBottom && (e.offset.bottom = e.offsetBottom),
            null != e.offsetTop && (e.offset.top = e.offsetTop),
            i.call(t, e)
        })
    })
}(jQuery);
!function(a, b) {
    "function" == typeof define && define.amd ? define("bloodhound", ["jquery"], function(c) {
        return a.Bloodhound = b(c)
    }) : "object" == typeof exports ? module.exports = b(require("jquery")) : a.Bloodhound = b(jQuery)
}(this, function(a) {
    var b = function() {
        "use strict";
        return {
            isMsie: function() {
                return /(msie|trident)/i.test(navigator.userAgent) ? navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2] : !1
            },
            isBlankString: function(a) {
                return !a || /^\s*$/.test(a)
            },
            escapeRegExChars: function(a) {
                return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")
            },
            isString: function(a) {
                return "string" == typeof a
            },
            isNumber: function(a) {
                return "number" == typeof a
            },
            isArray: a.isArray,
            isFunction: a.isFunction,
            isObject: a.isPlainObject,
            isUndefined: function(a) {
                return "undefined" == typeof a
            },
            isElement: function(a) {
                return !(!a || 1 !== a.nodeType)
            },
            isJQuery: function(b) {
                return b instanceof a
            },
            toStr: function(a) {
                return b.isUndefined(a) || null === a ? "" : a + ""
            },
            bind: a.proxy,
            each: function(b, c) {
                function d(a, b) {
                    return c(b, a)
                }
                a.each(b, d)
            },
            map: a.map,
            filter: a.grep,
            every: function(b, c) {
                var d = !0;
                return b ? (a.each(b, function(a, e) {
                    return (d = c.call(null, e, a, b)) ? void 0 : !1
                }),
                !!d) : d
            },
            some: function(b, c) {
                var d = !1;
                return b ? (a.each(b, function(a, e) {
                    return (d = c.call(null, e, a, b)) ? !1 : void 0
                }),
                !!d) : d
            },
            mixin: a.extend,
            identity: function(a) {
                return a
            },
            clone: function(b) {
                return a.extend(!0, {}, b)
            },
            getIdGenerator: function() {
                var a = 0;
                return function() {
                    return a++
                }
            },
            templatify: function(b) {
                function c() {
                    return String(b)
                }
                return a.isFunction(b) ? b : c
            },
            defer: function(a) {
                setTimeout(a, 0)
            },
            debounce: function(a, b, c) {
                var d, e;
                return function() {
                    var f, g, h = this, i = arguments;
                    return f = function() {
                        d = null,
                        c || (e = a.apply(h, i))
                    }
                    ,
                    g = c && !d,
                    clearTimeout(d),
                    d = setTimeout(f, b),
                    g && (e = a.apply(h, i)),
                    e
                }
            },
            throttle: function(a, b) {
                var c, d, e, f, g, h;
                return g = 0,
                h = function() {
                    g = new Date,
                    e = null,
                    f = a.apply(c, d)
                }
                ,
                function() {
                    var i = new Date
                      , j = b - (i - g);
                    return c = this,
                    d = arguments,
                    0 >= j ? (clearTimeout(e),
                    e = null,
                    g = i,
                    f = a.apply(c, d)) : e || (e = setTimeout(h, j)),
                    f
                }
            },
            stringify: function(a) {
                return b.isString(a) ? a : JSON.stringify(a)
            },
            noop: function() {}
        }
    }()
      , c = "0.11.1"
      , d = function() {
        "use strict";
        function a(a) {
            return a = b.toStr(a),
            a ? a.split(/\s+/) : []
        }
        function c(a) {
            return a = b.toStr(a),
            a ? a.split(/\W+/) : []
        }
        function d(a) {
            return function(c) {
                return c = b.isArray(c) ? c : [].slice.call(arguments, 0),
                function(d) {
                    var e = [];
                    return b.each(c, function(c) {
                        e = e.concat(a(b.toStr(d[c])))
                    }),
                    e
                }
            }
        }
        return {
            nonword: c,
            whitespace: a,
            obj: {
                nonword: d(c),
                whitespace: d(a)
            }
        }
    }()
      , e = function() {
        "use strict";
        function c(c) {
            this.maxSize = b.isNumber(c) ? c : 100,
            this.reset(),
            this.maxSize <= 0 && (this.set = this.get = a.noop)
        }
        function d() {
            this.head = this.tail = null
        }
        function e(a, b) {
            this.key = a,
            this.val = b,
            this.prev = this.next = null
        }
        return b.mixin(c.prototype, {
            set: function(a, b) {
                var c, d = this.list.tail;
                this.size >= this.maxSize && (this.list.remove(d),
                delete this.hash[d.key],
                this.size--),
                (c = this.hash[a]) ? (c.val = b,
                this.list.moveToFront(c)) : (c = new e(a,b),
                this.list.add(c),
                this.hash[a] = c,
                this.size++)
            },
            get: function(a) {
                var b = this.hash[a];
                return b ? (this.list.moveToFront(b),
                b.val) : void 0
            },
            reset: function() {
                this.size = 0,
                this.hash = {},
                this.list = new d
            }
        }),
        b.mixin(d.prototype, {
            add: function(a) {
                this.head && (a.next = this.head,
                this.head.prev = a),
                this.head = a,
                this.tail = this.tail || a
            },
            remove: function(a) {
                a.prev ? a.prev.next = a.next : this.head = a.next,
                a.next ? a.next.prev = a.prev : this.tail = a.prev
            },
            moveToFront: function(a) {
                this.remove(a),
                this.add(a)
            }
        }),
        c
    }()
      , f = function() {
        "use strict";
        function c(a, c) {
            this.prefix = ["__", a, "__"].join(""),
            this.ttlKey = "__ttl__",
            this.keyMatcher = new RegExp("^" + b.escapeRegExChars(this.prefix)),
            this.ls = c || h,
            !this.ls && this._noop()
        }
        function d() {
            return (new Date).getTime()
        }
        function e(a) {
            return JSON.stringify(b.isUndefined(a) ? null : a)
        }
        function f(b) {
            return a.parseJSON(b)
        }
        function g(a) {
            var b, c, d = [], e = h.length;
            for (b = 0; e > b; b++)
                (c = h.key(b)).match(a) && d.push(c.replace(a, ""));
            return d
        }
        var h;
        try {
            h = window.localStorage,
            h.setItem("~~~", "!"),
            h.removeItem("~~~")
        } catch (i) {
            h = null
        }
        return b.mixin(c.prototype, {
            _prefix: function(a) {
                return this.prefix + a
            },
            _ttlKey: function(a) {
                return this._prefix(a) + this.ttlKey
            },
            _noop: function() {
                this.get = this.set = this.remove = this.clear = this.isExpired = b.noop
            },
            _safeSet: function(a, b) {
                try {
                    this.ls.setItem(a, b)
                } catch (c) {
                    "QuotaExceededError" === c.name && (this.clear(),
                    this._noop())
                }
            },
            get: function(a) {
                return this.isExpired(a) && this.remove(a),
                f(this.ls.getItem(this._prefix(a)))
            },
            set: function(a, c, f) {
                return b.isNumber(f) ? this._safeSet(this._ttlKey(a), e(d() + f)) : this.ls.removeItem(this._ttlKey(a)),
                this._safeSet(this._prefix(a), e(c))
            },
            remove: function(a) {
                return this.ls.removeItem(this._ttlKey(a)),
                this.ls.removeItem(this._prefix(a)),
                this
            },
            clear: function() {
                var a, b = g(this.keyMatcher);
                for (a = b.length; a--; )
                    this.remove(b[a]);
                return this
            },
            isExpired: function(a) {
                var c = f(this.ls.getItem(this._ttlKey(a)));
                return b.isNumber(c) && d() > c ? !0 : !1
            }
        }),
        c
    }()
      , g = function() {
        "use strict";
        function c(a) {
            a = a || {},
            this.cancelled = !1,
            this.lastReq = null,
            this._send = a.transport,
            this._get = a.limiter ? a.limiter(this._get) : this._get,
            this._cache = a.cache === !1 ? new e(0) : h
        }
        var d = 0
          , f = {}
          , g = 6
          , h = new e(10);
        return c.setMaxPendingRequests = function(a) {
            g = a
        }
        ,
        c.resetCache = function() {
            h.reset()
        }
        ,
        b.mixin(c.prototype, {
            _fingerprint: function(b) {
                return b = b || {},
                b.url + b.type + a.param(b.data || {})
            },
            _get: function(a, b) {
                function c(a) {
                    b(null, a),
                    k._cache.set(i, a)
                }
                function e() {
                    b(!0)
                }
                function h() {
                    d--,
                    delete f[i],
                    k.onDeckRequestArgs && (k._get.apply(k, k.onDeckRequestArgs),
                    k.onDeckRequestArgs = null)
                }
                var i, j, k = this;
                i = this._fingerprint(a),
                this.cancelled || i !== this.lastReq || ((j = f[i]) ? j.done(c).fail(e) : g > d ? (d++,
                f[i] = this._send(a).done(c).fail(e).always(h)) : this.onDeckRequestArgs = [].slice.call(arguments, 0))
            },
            get: function(c, d) {
                var e, f;
                d = d || a.noop,
                c = b.isString(c) ? {
                    url: c
                } : c || {},
                f = this._fingerprint(c),
                this.cancelled = !1,
                this.lastReq = f,
                (e = this._cache.get(f)) ? d(null, e) : this._get(c, d)
            },
            cancel: function() {
                this.cancelled = !0
            }
        }),
        c
    }()
      , h = window.SearchIndex = function() {
        "use strict";
        function c(c) {
            c = c || {},
            c.datumTokenizer && c.queryTokenizer || a.error("datumTokenizer and queryTokenizer are both required"),
            this.identify = c.identify || b.stringify,
            this.datumTokenizer = c.datumTokenizer,
            this.queryTokenizer = c.queryTokenizer,
            this.reset()
        }
        function d(a) {
            return a = b.filter(a, function(a) {
                return !!a
            }),
            a = b.map(a, function(a) {
                return a.toLowerCase()
            })
        }
        function e() {
            var a = {};
            return a[i] = [],
            a[h] = {},
            a
        }
        function f(a) {
            for (var b = {}, c = [], d = 0, e = a.length; e > d; d++)
                b[a[d]] || (b[a[d]] = !0,
                c.push(a[d]));
            return c
        }
        function g(a, b) {
            var c = 0
              , d = 0
              , e = [];
            a = a.sort(),
            b = b.sort();
            for (var f = a.length, g = b.length; f > c && g > d; )
                a[c] < b[d] ? c++ : a[c] > b[d] ? d++ : (e.push(a[c]),
                c++,
                d++);
            return e
        }
        var h = "c"
          , i = "i";
        return b.mixin(c.prototype, {
            bootstrap: function(a) {
                this.datums = a.datums,
                this.trie = a.trie
            },
            add: function(a) {
                var c = this;
                a = b.isArray(a) ? a : [a],
                b.each(a, function(a) {
                    var f, g;
                    c.datums[f = c.identify(a)] = a,
                    g = d(c.datumTokenizer(a)),
                    b.each(g, function(a) {
                        var b, d, g;
                        for (b = c.trie,
                        d = a.split(""); g = d.shift(); )
                            b = b[h][g] || (b[h][g] = e()),
                            b[i].push(f)
                    })
                })
            },
            get: function(a) {
                var c = this;
                return b.map(a, function(a) {
                    return c.datums[a]
                })
            },
            search: function(a) {
                var c, e, j = this;
                return c = d(this.queryTokenizer(a)),
                b.each(c, function(a) {
                    var b, c, d, f;
                    if (e && 0 === e.length)
                        return !1;
                    for (b = j.trie,
                    c = a.split(""); b && (d = c.shift()); )
                        b = b[h][d];
                    return b && 0 === c.length ? (f = b[i].slice(0),
                    void (e = e ? g(e, f) : f)) : (e = [],
                    !1)
                }),
                e ? b.map(f(e), function(a) {
                    return j.datums[a]
                }) : []
            },
            all: function() {
                var a = [];
                for (var b in this.datums)
                    a.push(this.datums[b]);
                return a
            },
            reset: function() {
                this.datums = {},
                this.trie = e()
            },
            serialize: function() {
                return {
                    datums: this.datums,
                    trie: this.trie
                }
            }
        }),
        c
    }()
      , i = function() {
        "use strict";
        function a(a) {
            this.url = a.url,
            this.ttl = a.ttl,
            this.cache = a.cache,
            this.prepare = a.prepare,
            this.transform = a.transform,
            this.transport = a.transport,
            this.thumbprint = a.thumbprint,
            this.storage = new f(a.cacheKey)
        }
        var c;
        return c = {
            data: "data",
            protocol: "protocol",
            thumbprint: "thumbprint"
        },
        b.mixin(a.prototype, {
            _settings: function() {
                return {
                    url: this.url,
                    type: "GET",
                    dataType: "json"
                }
            },
            store: function(a) {
                this.cache && (this.storage.set(c.data, a, this.ttl),
                this.storage.set(c.protocol, location.protocol, this.ttl),
                this.storage.set(c.thumbprint, this.thumbprint, this.ttl))
            },
            fromCache: function() {
                var a, b = {};
                return this.cache ? (b.data = this.storage.get(c.data),
                b.protocol = this.storage.get(c.protocol),
                b.thumbprint = this.storage.get(c.thumbprint),
                a = b.thumbprint !== this.thumbprint || b.protocol !== location.protocol,
                b.data && !a ? b.data : null) : null
            },
            fromNetwork: function(a) {
                function b() {
                    a(!0)
                }
                function c(b) {
                    a(null, e.transform(b))
                }
                var d, e = this;
                a && (d = this.prepare(this._settings()),
                this.transport(d).fail(b).done(c))
            },
            clear: function() {
                return this.storage.clear(),
                this
            }
        }),
        a
    }()
      , j = function() {
        "use strict";
        function a(a) {
            this.url = a.url,
            this.prepare = a.prepare,
            this.transform = a.transform,
            this.transport = new g({
                cache: a.cache,
                limiter: a.limiter,
                transport: a.transport
            })
        }
        return b.mixin(a.prototype, {
            _settings: function() {
                return {
                    url: this.url,
                    type: "GET",
                    dataType: "json"
                }
            },
            get: function(a, b) {
                function c(a, c) {
                    b(a ? [] : e.transform(c))
                }
                var d, e = this;
                if (b)
                    return a = a || "",
                    d = this.prepare(a, this._settings()),
                    this.transport.get(d, c)
            },
            cancelLastRequest: function() {
                this.transport.cancel()
            }
        }),
        a
    }()
      , k = function() {
        "use strict";
        function d(d) {
            var e;
            return d ? (e = {
                url: null,
                ttl: 864e5,
                cache: !0,
                cacheKey: null,
                thumbprint: "",
                prepare: b.identity,
                transform: b.identity,
                transport: null
            },
            d = b.isString(d) ? {
                url: d
            } : d,
            d = b.mixin(e, d),
            !d.url && a.error("prefetch requires url to be set"),
            d.transform = d.filter || d.transform,
            d.cacheKey = d.cacheKey || d.url,
            d.thumbprint = c + d.thumbprint,
            d.transport = d.transport ? h(d.transport) : a.ajax,
            d) : null
        }
        function e(c) {
            var d;
            if (c)
                return d = {
                    url: null,
                    cache: !0,
                    prepare: null,
                    replace: null,
                    wildcard: null,
                    limiter: null,
                    rateLimitBy: "debounce",
                    rateLimitWait: 300,
                    transform: b.identity,
                    transport: null
                },
                c = b.isString(c) ? {
                    url: c
                } : c,
                c = b.mixin(d, c),
                !c.url && a.error("remote requires url to be set"),
                c.transform = c.filter || c.transform,
                c.prepare = f(c),
                c.limiter = g(c),
                c.transport = c.transport ? h(c.transport) : a.ajax,
                delete c.replace,
                delete c.wildcard,
                delete c.rateLimitBy,
                delete c.rateLimitWait,
                c
        }
        function f(a) {
            function b(a, b) {
                return b.url = f(b.url, a),
                b
            }
            function c(a, b) {
                return b.url = b.url.replace(g, encodeURIComponent(a)),
                b
            }
            function d(a, b) {
                return b
            }
            var e, f, g;
            return e = a.prepare,
            f = a.replace,
            g = a.wildcard,
            e ? e : e = f ? b : a.wildcard ? c : d
        }
        function g(a) {
            function c(a) {
                return function(c) {
                    return b.debounce(c, a)
                }
            }
            function d(a) {
                return function(c) {
                    return b.throttle(c, a)
                }
            }
            var e, f, g;
            return e = a.limiter,
            f = a.rateLimitBy,
            g = a.rateLimitWait,
            e || (e = /^throttle$/i.test(f) ? d(g) : c(g)),
            e
        }
        function h(c) {
            return function(d) {
                function e(a) {
                    b.defer(function() {
                        g.resolve(a)
                    })
                }
                function f(a) {
                    b.defer(function() {
                        g.reject(a)
                    })
                }
                var g = a.Deferred();
                return c(d, e, f),
                g
            }
        }
        return function(c) {
            var f, g;
            return f = {
                initialize: !0,
                identify: b.stringify,
                datumTokenizer: null,
                queryTokenizer: null,
                sufficient: 5,
                sorter: null,
                local: [],
                prefetch: null,
                remote: null
            },
            c = b.mixin(f, c || {}),
            !c.datumTokenizer && a.error("datumTokenizer is required"),
            !c.queryTokenizer && a.error("queryTokenizer is required"),
            g = c.sorter,
            c.sorter = g ? function(a) {
                return a.sort(g)
            }
            : b.identity,
            c.local = b.isFunction(c.local) ? c.local() : c.local,
            c.prefetch = d(c.prefetch),
            c.remote = e(c.remote),
            c
        }
    }()
      , l = function() {
        "use strict";
        function c(a) {
            a = k(a),
            this.sorter = a.sorter,
            this.identify = a.identify,
            this.sufficient = a.sufficient,
            this.local = a.local,
            this.remote = a.remote ? new j(a.remote) : null,
            this.prefetch = a.prefetch ? new i(a.prefetch) : null,
            this.index = new h({
                identify: this.identify,
                datumTokenizer: a.datumTokenizer,
                queryTokenizer: a.queryTokenizer
            }),
            a.initialize !== !1 && this.initialize()
        }
        var e;
        return e = window && window.Bloodhound,
        c.noConflict = function() {
            return window && (window.Bloodhound = e),
            c
        }
        ,
        c.tokenizers = d,
        b.mixin(c.prototype, {
            __ttAdapter: function() {
                function a(a, b, d) {
                    return c.search(a, b, d)
                }
                function b(a, b) {
                    return c.search(a, b)
                }
                var c = this;
                return this.remote ? a : b
            },
            _loadPrefetch: function() {
                function b(a, b) {
                    return a ? c.reject() : (e.add(b),
                    e.prefetch.store(e.index.serialize()),
                    void c.resolve())
                }
                var c, d, e = this;
                return c = a.Deferred(),
                this.prefetch ? (d = this.prefetch.fromCache()) ? (this.index.bootstrap(d),
                c.resolve()) : this.prefetch.fromNetwork(b) : c.resolve(),
                c.promise()
            },
            _initialize: function() {
                function a() {
                    b.add(b.local)
                }
                var b = this;
                return this.clear(),
                (this.initPromise = this._loadPrefetch()).done(a),
                this.initPromise
            },
            initialize: function(a) {
                return !this.initPromise || a ? this._initialize() : this.initPromise
            },
            add: function(a) {
                return this.index.add(a),
                this
            },
            get: function(a) {
                return a = b.isArray(a) ? a : [].slice.call(arguments),
                this.index.get(a)
            },
            search: function(a, c, d) {
                function e(a) {
                    var c = [];
                    b.each(a, function(a) {
                        !b.some(f, function(b) {
                            return g.identify(a) === g.identify(b)
                        }) && c.push(a)
                    }),
                    d && d(c)
                }
                var f, g = this;
                return f = this.sorter(this.index.search(a)),
                c(this.remote ? f.slice() : f),
                this.remote && f.length < this.sufficient ? this.remote.get(a, e) : this.remote && this.remote.cancelLastRequest(),
                this
            },
            all: function() {
                return this.index.all()
            },
            clear: function() {
                return this.index.reset(),
                this
            },
            clearPrefetchCache: function() {
                return this.prefetch && this.prefetch.clear(),
                this
            },
            clearRemoteCache: function() {
                return g.resetCache(),
                this
            },
            ttAdapter: function() {
                return this.__ttAdapter()
            }
        }),
        c
    }();
    return l
}),
function(a, b) {
    "function" == typeof define && define.amd ? define("typeahead.js", ["jquery"], function(a) {
        return b(a)
    }) : "object" == typeof exports ? module.exports = b(require("jquery")) : b(jQuery)
}(this, function(a) {
    var b = function() {
        "use strict";
        return {
            isMsie: function() {
                return /(msie|trident)/i.test(navigator.userAgent) ? navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2] : !1
            },
            isBlankString: function(a) {
                return !a || /^\s*$/.test(a)
            },
            escapeRegExChars: function(a) {
                return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")
            },
            isString: function(a) {
                return "string" == typeof a
            },
            isNumber: function(a) {
                return "number" == typeof a
            },
            isArray: a.isArray,
            isFunction: a.isFunction,
            isObject: a.isPlainObject,
            isUndefined: function(a) {
                return "undefined" == typeof a
            },
            isElement: function(a) {
                return !(!a || 1 !== a.nodeType)
            },
            isJQuery: function(b) {
                return b instanceof a
            },
            toStr: function(a) {
                return b.isUndefined(a) || null === a ? "" : a + ""
            },
            bind: a.proxy,
            each: function(b, c) {
                function d(a, b) {
                    return c(b, a)
                }
                a.each(b, d)
            },
            map: a.map,
            filter: a.grep,
            every: function(b, c) {
                var d = !0;
                return b ? (a.each(b, function(a, e) {
                    return (d = c.call(null, e, a, b)) ? void 0 : !1
                }),
                !!d) : d
            },
            some: function(b, c) {
                var d = !1;
                return b ? (a.each(b, function(a, e) {
                    return (d = c.call(null, e, a, b)) ? !1 : void 0
                }),
                !!d) : d
            },
            mixin: a.extend,
            identity: function(a) {
                return a
            },
            clone: function(b) {
                return a.extend(!0, {}, b)
            },
            getIdGenerator: function() {
                var a = 0;
                return function() {
                    return a++
                }
            },
            templatify: function(b) {
                function c() {
                    return String(b)
                }
                return a.isFunction(b) ? b : c
            },
            defer: function(a) {
                setTimeout(a, 0)
            },
            debounce: function(a, b, c) {
                var d, e;
                return function() {
                    var f, g, h = this, i = arguments;
                    return f = function() {
                        d = null,
                        c || (e = a.apply(h, i))
                    }
                    ,
                    g = c && !d,
                    clearTimeout(d),
                    d = setTimeout(f, b),
                    g && (e = a.apply(h, i)),
                    e
                }
            },
            throttle: function(a, b) {
                var c, d, e, f, g, h;
                return g = 0,
                h = function() {
                    g = new Date,
                    e = null,
                    f = a.apply(c, d)
                }
                ,
                function() {
                    var i = new Date
                      , j = b - (i - g);
                    return c = this,
                    d = arguments,
                    0 >= j ? (clearTimeout(e),
                    e = null,
                    g = i,
                    f = a.apply(c, d)) : e || (e = setTimeout(h, j)),
                    f
                }
            },
            stringify: function(a) {
                return b.isString(a) ? a : JSON.stringify(a)
            },
            noop: function() {}
        }
    }()
      , c = function() {
        "use strict";
        function a(a) {
            var g, h;
            return h = b.mixin({}, f, a),
            g = {
                css: e(),
                classes: h,
                html: c(h),
                selectors: d(h)
            },
            {
                css: g.css,
                html: g.html,
                classes: g.classes,
                selectors: g.selectors,
                mixin: function(a) {
                    b.mixin(a, g)
                }
            }
        }
        function c(a) {
            return {
                wrapper: '<span class="' + a.wrapper + '"></span>',
                menu: '<div class="' + a.menu + '"></div>'
            }
        }
        function d(a) {
            var c = {};
            return b.each(a, function(a, b) {
                c[b] = "." + a
            }),
            c
        }
        function e() {
            var a = {
                wrapper: {
                    position: "relative",
                    display: "inline-block"
                },
                hint: {
                    position: "absolute",
                    top: "0",
                    left: "0",
                    borderColor: "transparent",
                    boxShadow: "none",
                    opacity: "1"
                },
                input: {
                    position: "relative",
                    verticalAlign: "top",
                    backgroundColor: "transparent"
                },
                inputWithNoHint: {
                    position: "relative",
                    verticalAlign: "top"
                },
                menu: {
                    position: "absolute",
                    top: "100%",
                    left: "0",
                    zIndex: "100",
                    display: "none"
                },
                ltr: {
                    left: "0",
                    right: "auto"
                },
                rtl: {
                    left: "auto",
                    right: " 0"
                }
            };
            return b.isMsie() && b.mixin(a.input, {
                backgroundImage: "url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"
            }),
            a
        }
        var f = {
            wrapper: "twitter-typeahead",
            input: "tt-input",
            hint: "tt-hint",
            menu: "tt-menu",
            dataset: "tt-dataset",
            suggestion: "tt-suggestion",
            selectable: "tt-selectable",
            empty: "tt-empty",
            open: "tt-open",
            cursor: "tt-cursor",
            highlight: "tt-highlight"
        };
        return a
    }()
      , d = function() {
        "use strict";
        function c(b) {
            b && b.el || a.error("EventBus initialized without el"),
            this.$el = a(b.el)
        }
        var d, e;
        return d = "typeahead:",
        e = {
            render: "rendered",
            cursorchange: "cursorchanged",
            select: "selected",
            autocomplete: "autocompleted"
        },
        b.mixin(c.prototype, {
            _trigger: function(b, c) {
                var e;
                return e = a.Event(d + b),
                (c = c || []).unshift(e),
                this.$el.trigger.apply(this.$el, c),
                e
            },
            before: function(a) {
                var b, c;
                return b = [].slice.call(arguments, 1),
                c = this._trigger("before" + a, b),
                c.isDefaultPrevented()
            },
            trigger: function(a) {
                var b;
                this._trigger(a, [].slice.call(arguments, 1)),
                (b = e[a]) && this._trigger(b, [].slice.call(arguments, 1))
            }
        }),
        c
    }()
      , e = function() {
        "use strict";
        function a(a, b, c, d) {
            var e;
            if (!c)
                return this;
            for (b = b.split(i),
            c = d ? h(c, d) : c,
            this._callbacks = this._callbacks || {}; e = b.shift(); )
                this._callbacks[e] = this._callbacks[e] || {
                    sync: [],
                    async: []
                },
                this._callbacks[e][a].push(c);
            return this
        }
        function b(b, c, d) {
            return a.call(this, "async", b, c, d)
        }
        function c(b, c, d) {
            return a.call(this, "sync", b, c, d)
        }
        function d(a) {
            var b;
            if (!this._callbacks)
                return this;
            for (a = a.split(i); b = a.shift(); )
                delete this._callbacks[b];
            return this
        }
        function e(a) {
            var b, c, d, e, g;
            if (!this._callbacks)
                return this;
            for (a = a.split(i),
            d = [].slice.call(arguments, 1); (b = a.shift()) && (c = this._callbacks[b]); )
                e = f(c.sync, this, [b].concat(d)),
                g = f(c.async, this, [b].concat(d)),
                e() && j(g);
            return this
        }
        function f(a, b, c) {
            function d() {
                for (var d, e = 0, f = a.length; !d && f > e; e += 1)
                    d = a[e].apply(b, c) === !1;
                return !d
            }
            return d
        }
        function g() {
            var a;
            return a = window.setImmediate ? function(a) {
                setImmediate(function() {
                    a()
                })
            }
            : function(a) {
                setTimeout(function() {
                    a()
                }, 0)
            }
        }
        function h(a, b) {
            return a.bind ? a.bind(b) : function() {
                a.apply(b, [].slice.call(arguments, 0))
            }
        }
        var i = /\s+/
          , j = g();
        return {
            onSync: c,
            onAsync: b,
            off: d,
            trigger: e
        }
    }()
      , f = function(a) {
        "use strict";
        function c(a, c, d) {
            for (var e, f = [], g = 0, h = a.length; h > g; g++)
                f.push(b.escapeRegExChars(a[g]));
            return e = d ? "\\b(" + f.join("|") + ")\\b" : "(" + f.join("|") + ")",
            c ? new RegExp(e) : new RegExp(e,"i")
        }
        var d = {
            node: null,
            pattern: null,
            tagName: "strong",
            className: null,
            wordsOnly: !1,
            caseSensitive: !1
        };
        return function(e) {
            function f(b) {
                var c, d, f;
                return (c = h.exec(b.data)) && (f = a.createElement(e.tagName),
                e.className && (f.className = e.className),
                d = b.splitText(c.index),
                d.splitText(c[0].length),
                f.appendChild(d.cloneNode(!0)),
                b.parentNode.replaceChild(f, d)),
                !!c
            }
            function g(a, b) {
                for (var c, d = 3, e = 0; e < a.childNodes.length; e++)
                    c = a.childNodes[e],
                    c.nodeType === d ? e += b(c) ? 1 : 0 : g(c, b)
            }
            var h;
            e = b.mixin({}, d, e),
            e.node && e.pattern && (e.pattern = b.isArray(e.pattern) ? e.pattern : [e.pattern],
            h = c(e.pattern, e.caseSensitive, e.wordsOnly),
            g(e.node, f))
        }
    }(window.document)
      , g = function() {
        "use strict";
        function c(c, e) {
            c = c || {},
            c.input || a.error("input is missing"),
            e.mixin(this),
            this.$hint = a(c.hint),
            this.$input = a(c.input),
            this.query = this.$input.val(),
            this.queryWhenFocused = this.hasFocus() ? this.query : null,
            this.$overflowHelper = d(this.$input),
            this._checkLanguageDirection(),
            0 === this.$hint.length && (this.setHint = this.getHint = this.clearHint = this.clearHintIfInvalid = b.noop)
        }
        function d(b) {
            return a('<pre aria-hidden="true"></pre>').css({
                position: "absolute",
                visibility: "hidden",
                whiteSpace: "pre",
                fontFamily: b.css("font-family"),
                fontSize: b.css("font-size"),
                fontStyle: b.css("font-style"),
                fontVariant: b.css("font-variant"),
                fontWeight: b.css("font-weight"),
                wordSpacing: b.css("word-spacing"),
                letterSpacing: b.css("letter-spacing"),
                textIndent: b.css("text-indent"),
                textRendering: b.css("text-rendering"),
                textTransform: b.css("text-transform")
            }).insertAfter(b)
        }
        function f(a, b) {
            return c.normalizeQuery(a) === c.normalizeQuery(b)
        }
        function g(a) {
            return a.altKey || a.ctrlKey || a.metaKey || a.shiftKey
        }
        var h;
        return h = {
            9: "tab",
            27: "esc",
            37: "left",
            39: "right",
            13: "enter",
            38: "up",
            40: "down"
        },
        c.normalizeQuery = function(a) {
            return b.toStr(a).replace(/^\s*/g, "").replace(/\s{2,}/g, " ")
        }
        ,
        b.mixin(c.prototype, e, {
            _onBlur: function() {
                this.resetInputValue(),
                this.trigger("blurred")
            },
            _onFocus: function() {
                this.queryWhenFocused = this.query,
                this.trigger("focused")
            },
            _onKeydown: function(a) {
                var b = h[a.which || a.keyCode];
                this._managePreventDefault(b, a),
                b && this._shouldTrigger(b, a) && this.trigger(b + "Keyed", a)
            },
            _onInput: function() {
                this._setQuery(this.getInputValue()),
                this.clearHintIfInvalid(),
                this._checkLanguageDirection()
            },
            _managePreventDefault: function(a, b) {
                var c;
                switch (a) {
                case "up":
                case "down":
                    c = !g(b);
                    break;
                default:
                    c = !1
                }
                c && b.preventDefault()
            },
            _shouldTrigger: function(a, b) {
                var c;
                switch (a) {
                case "tab":
                    c = !g(b);
                    break;
                default:
                    c = !0
                }
                return c
            },
            _checkLanguageDirection: function() {
                var a = (this.$input.css("direction") || "ltr").toLowerCase();
                this.dir !== a && (this.dir = a,
                this.$hint.attr("dir", a),
                this.trigger("langDirChanged", a))
            },
            _setQuery: function(a, b) {
                var c, d;
                c = f(a, this.query),
                d = c ? this.query.length !== a.length : !1,
                this.query = a,
                b || c ? !b && d && this.trigger("whitespaceChanged", this.query) : this.trigger("queryChanged", this.query)
            },
            bind: function() {
                var a, c, d, e, f = this;
                return a = b.bind(this._onBlur, this),
                c = b.bind(this._onFocus, this),
                d = b.bind(this._onKeydown, this),
                e = b.bind(this._onInput, this),
                this.$input.on("blur.tt", a).on("focus.tt", c).on("keydown.tt", d),
                !b.isMsie() || b.isMsie() > 9 ? this.$input.on("input.tt", e) : this.$input.on("keydown.tt keypress.tt cut.tt paste.tt", function(a) {
                    h[a.which || a.keyCode] || b.defer(b.bind(f._onInput, f, a))
                }),
                this
            },
            focus: function() {
                this.$input.focus()
            },
            blur: function() {
                this.$input.blur()
            },
            getLangDir: function() {
                return this.dir
            },
            getQuery: function() {
                return this.query || ""
            },
            setQuery: function(a, b) {
                this.setInputValue(a),
                this._setQuery(a, b)
            },
            hasQueryChangedSinceLastFocus: function() {
                return this.query !== this.queryWhenFocused
            },
            getInputValue: function() {
                return this.$input.val()
            },
            setInputValue: function(a) {
                this.$input.val(a),
                this.clearHintIfInvalid(),
                this._checkLanguageDirection()
            },
            resetInputValue: function() {
                this.setInputValue(this.query)
            },
            getHint: function() {
                return this.$hint.val()
            },
            setHint: function(a) {
                this.$hint.val(a)
            },
            clearHint: function() {
                this.setHint("")
            },
            clearHintIfInvalid: function() {
                var a, b, c, d;
                a = this.getInputValue(),
                b = this.getHint(),
                c = a !== b && 0 === b.indexOf(a),
                d = "" !== a && c && !this.hasOverflow(),
                !d && this.clearHint()
            },
            hasFocus: function() {
                return this.$input.is(":focus")
            },
            hasOverflow: function() {
                var a = this.$input.width() - 2;
                return this.$overflowHelper.text(this.getInputValue()),
                this.$overflowHelper.width() >= a
            },
            isCursorAtEnd: function() {
                var a, c, d;
                return a = this.$input.val().length,
                c = this.$input[0].selectionStart,
                b.isNumber(c) ? c === a : document.selection ? (d = document.selection.createRange(),
                d.moveStart("character", -a),
                a === d.text.length) : !0
            },
            destroy: function() {
                this.$hint.off(".tt"),
                this.$input.off(".tt"),
                this.$overflowHelper.remove(),
                this.$hint = this.$input = this.$overflowHelper = a("<div>")
            }
        }),
        c
    }()
      , h = function() {
        "use strict";
        function c(c, e) {
            c = c || {},
            c.templates = c.templates || {},
            c.templates.notFound = c.templates.notFound || c.templates.empty,
            c.source || a.error("missing source"),
            c.node || a.error("missing node"),
            c.name && !h(c.name) && a.error("invalid dataset name: " + c.name),
            e.mixin(this),
            this.highlight = !!c.highlight,
            this.name = c.name || j(),
            this.limit = c.limit || 5,
            this.displayFn = d(c.display || c.displayKey),
            this.templates = g(c.templates, this.displayFn),
            this.source = c.source.__ttAdapter ? c.source.__ttAdapter() : c.source,
            this.async = b.isUndefined(c.async) ? this.source.length > 2 : !!c.async,
            this._resetLastSuggestion(),
            this.$el = a(c.node).addClass(this.classes.dataset).addClass(this.classes.dataset + "-" + this.name)
        }
        function d(a) {
            function c(b) {
                return b[a]
            }
            return a = a || b.stringify,
            b.isFunction(a) ? a : c
        }
        function g(c, d) {
            function e(b) {
                return a("<div>").text(d(b))
            }
            return {
                notFound: c.notFound && b.templatify(c.notFound),
                pending: c.pending && b.templatify(c.pending),
                header: c.header && b.templatify(c.header),
                footer: c.footer && b.templatify(c.footer),
                suggestion: c.suggestion || e
            }
        }
        function h(a) {
            return /^[_a-zA-Z0-9-]+$/.test(a)
        }
        var i, j;
        return i = {
            val: "tt-selectable-display",
            obj: "tt-selectable-object"
        },
        j = b.getIdGenerator(),
        c.extractData = function(b) {
            var c = a(b);
            return c.data(i.obj) ? {
                val: c.data(i.val) || "",
                obj: c.data(i.obj) || null
            } : null
        }
        ,
        b.mixin(c.prototype, e, {
            _overwrite: function(a, b) {
                b = b || [],
                b.length ? this._renderSuggestions(a, b) : this.async && this.templates.pending ? this._renderPending(a) : !this.async && this.templates.notFound ? this._renderNotFound(a) : this._empty(),
                this.trigger("rendered", this.name, b, !1)
            },
            _append: function(a, b) {
                b = b || [],
                b.length && this.$lastSuggestion.length ? this._appendSuggestions(a, b) : b.length ? this._renderSuggestions(a, b) : !this.$lastSuggestion.length && this.templates.notFound && this._renderNotFound(a),
                this.trigger("rendered", this.name, b, !0)
            },
            _renderSuggestions: function(a, b) {
                var c;
                c = this._getSuggestionsFragment(a, b),
                this.$lastSuggestion = c.children().last(),
                this.$el.html(c).prepend(this._getHeader(a, b)).append(this._getFooter(a, b))
            },
            _appendSuggestions: function(a, b) {
                var c, d;
                c = this._getSuggestionsFragment(a, b),
                d = c.children().last(),
                this.$lastSuggestion.after(c),
                this.$lastSuggestion = d
            },
            _renderPending: function(a) {
                var b = this.templates.pending;
                this._resetLastSuggestion(),
                b && this.$el.html(b({
                    query: a,
                    dataset: this.name
                }))
            },
            _renderNotFound: function(a) {
                var b = this.templates.notFound;
                this._resetLastSuggestion(),
                b && this.$el.html(b({
                    query: a,
                    dataset: this.name
                }))
            },
            _empty: function() {
                this.$el.empty(),
                this._resetLastSuggestion()
            },
            _getSuggestionsFragment: function(c, d) {
                var e, g = this;
                return e = document.createDocumentFragment(),
                b.each(d, function(b) {
                    var d, f;
                    f = g._injectQuery(c, b),
                    d = a(g.templates.suggestion(f)).data(i.obj, b).data(i.val, g.displayFn(b)).addClass(g.classes.suggestion + " " + g.classes.selectable),
                    e.appendChild(d[0])
                }),
                this.highlight && f({
                    className: this.classes.highlight,
                    node: e,
                    pattern: c
                }),
                a(e)
            },
            _getFooter: function(a, b) {
                return this.templates.footer ? this.templates.footer({
                    query: a,
                    suggestions: b,
                    dataset: this.name
                }) : null
            },
            _getHeader: function(a, b) {
                return this.templates.header ? this.templates.header({
                    query: a,
                    suggestions: b,
                    dataset: this.name
                }) : null
            },
            _resetLastSuggestion: function() {
                this.$lastSuggestion = a()
            },
            _injectQuery: function(a, c) {
                return b.isObject(c) ? b.mixin({
                    _query: a
                }, c) : c
            },
            update: function(b) {
                function c(a) {
                    g || (g = !0,
                    a = (a || []).slice(0, e.limit),
                    h = a.length,
                    e._overwrite(b, a),
                    h < e.limit && e.async && e.trigger("asyncRequested", b))
                }
                function d(c) {
                    c = c || [],
                    !f && h < e.limit && (e.cancel = a.noop,
                    h += c.length,
                    e._append(b, c.slice(0, e.limit - h)),
                    e.async && e.trigger("asyncReceived", b))
                }
                var e = this
                  , f = !1
                  , g = !1
                  , h = 0;
                this.cancel(),
                this.cancel = function() {
                    f = !0,
                    e.cancel = a.noop,
                    e.async && e.trigger("asyncCanceled", b)
                }
                ,
                this.source(b, c, d),
                !g && c([])
            },
            cancel: a.noop,
            clear: function() {
                this._empty(),
                this.cancel(),
                this.trigger("cleared")
            },
            isEmpty: function() {
                return this.$el.is(":empty")
            },
            destroy: function() {
                this.$el = a("<div>")
            }
        }),
        c
    }()
      , i = function() {
        "use strict";
        function c(c, d) {
            function e(b) {
                var c = f.$node.find(b.node).first();
                return b.node = c.length ? c : a("<div>").appendTo(f.$node),
                new h(b,d)
            }
            var f = this;
            c = c || {},
            c.node || a.error("node is required"),
            d.mixin(this),
            this.$node = a(c.node),
            this.query = null,
            this.datasets = b.map(c.datasets, e)
        }
        return b.mixin(c.prototype, e, {
            _onSelectableClick: function(b) {
                this.trigger("selectableClicked", a(b.currentTarget))
            },
            _onRendered: function(a, b, c, d) {
                this.$node.toggleClass(this.classes.empty, this._allDatasetsEmpty()),
                this.trigger("datasetRendered", b, c, d)
            },
            _onCleared: function() {
                this.$node.toggleClass(this.classes.empty, this._allDatasetsEmpty()),
                this.trigger("datasetCleared")
            },
            _propagate: function() {
                this.trigger.apply(this, arguments)
            },
            _allDatasetsEmpty: function() {
                function a(a) {
                    return a.isEmpty()
                }
                return b.every(this.datasets, a)
            },
            _getSelectables: function() {
                return this.$node.find(this.selectors.selectable)
            },
            _removeCursor: function() {
                var a = this.getActiveSelectable();
                a && a.removeClass(this.classes.cursor)
            },
            _ensureVisible: function(a) {
                var b, c, d, e;
                b = a.position().top,
                c = b + a.outerHeight(!0),
                d = this.$node.scrollTop(),
                e = this.$node.height() + parseInt(this.$node.css("paddingTop"), 10) + parseInt(this.$node.css("paddingBottom"), 10),
                0 > b ? this.$node.scrollTop(d + b) : c > e && this.$node.scrollTop(d + (c - e))
            },
            bind: function() {
                var a, c = this;
                return a = b.bind(this._onSelectableClick, this),
                this.$node.on("click.tt", this.selectors.selectable, a),
                b.each(this.datasets, function(a) {
                    a.onSync("asyncRequested", c._propagate, c).onSync("asyncCanceled", c._propagate, c).onSync("asyncReceived", c._propagate, c).onSync("rendered", c._onRendered, c).onSync("cleared", c._onCleared, c)
                }),
                this
            },
            isOpen: function() {
                return this.$node.hasClass(this.classes.open)
            },
            open: function() {
                this.$node.addClass(this.classes.open)
            },
            close: function() {
                this.$node.removeClass(this.classes.open),
                this._removeCursor()
            },
            setLanguageDirection: function(a) {
                this.$node.attr("dir", a)
            },
            selectableRelativeToCursor: function(a) {
                var b, c, d, e;
                return c = this.getActiveSelectable(),
                b = this._getSelectables(),
                d = c ? b.index(c) : -1,
                e = d + a,
                e = (e + 1) % (b.length + 1) - 1,
                e = -1 > e ? b.length - 1 : e,
                -1 === e ? null : b.eq(e)
            },
            setCursor: function(a) {
                this._removeCursor(),
                (a = a && a.first()) && (a.addClass(this.classes.cursor),
                this._ensureVisible(a))
            },
            getSelectableData: function(a) {
                return a && a.length ? h.extractData(a) : null
            },
            getActiveSelectable: function() {
                var a = this._getSelectables().filter(this.selectors.cursor).first();
                return a.length ? a : null
            },
            getTopSelectable: function() {
                var a = this._getSelectables().first();
                return a.length ? a : null
            },
            update: function(a) {
                function c(b) {
                    b.update(a)
                }
                var d = a !== this.query;
                return d && (this.query = a,
                b.each(this.datasets, c)),
                d
            },
            empty: function() {
                function a(a) {
                    a.clear()
                }
                b.each(this.datasets, a),
                this.query = null,
                this.$node.addClass(this.classes.empty)
            },
            destroy: function() {
                function c(a) {
                    a.destroy()
                }
                this.$node.off(".tt"),
                this.$node = a("<div>"),
                b.each(this.datasets, c)
            }
        }),
        c
    }()
      , j = function() {
        "use strict";
        function a() {
            i.apply(this, [].slice.call(arguments, 0))
        }
        var c = i.prototype;
        return b.mixin(a.prototype, i.prototype, {
            open: function() {
                return !this._allDatasetsEmpty() && this._show(),
                c.open.apply(this, [].slice.call(arguments, 0))
            },
            close: function() {
                return this._hide(),
                c.close.apply(this, [].slice.call(arguments, 0))
            },
            _onRendered: function() {
                return this._allDatasetsEmpty() ? this._hide() : this.isOpen() && this._show(),
                c._onRendered.apply(this, [].slice.call(arguments, 0))
            },
            _onCleared: function() {
                return this._allDatasetsEmpty() ? this._hide() : this.isOpen() && this._show(),
                c._onCleared.apply(this, [].slice.call(arguments, 0))
            },
            setLanguageDirection: function(a) {
                return this.$node.css("ltr" === a ? this.css.ltr : this.css.rtl),
                c.setLanguageDirection.apply(this, [].slice.call(arguments, 0))
            },
            _hide: function() {
                this.$node.hide()
            },
            _show: function() {
                this.$node.css("display", "block")
            }
        }),
        a
    }()
      , k = function() {
        "use strict";
        function c(c, e) {
            var f, g, h, i, j, k, l, m, n, o, p;
            c = c || {},
            c.input || a.error("missing input"),
            c.menu || a.error("missing menu"),
            c.eventBus || a.error("missing event bus"),
            e.mixin(this),
            this.eventBus = c.eventBus,
            this.minLength = b.isNumber(c.minLength) ? c.minLength : 1,
            this.input = c.input,
            this.menu = c.menu,
            this.enabled = !0,
            this.active = !1,
            this.input.hasFocus() && this.activate(),
            this.dir = this.input.getLangDir(),
            this._hacks(),
            this.menu.bind().onSync("selectableClicked", this._onSelectableClicked, this).onSync("asyncRequested", this._onAsyncRequested, this).onSync("asyncCanceled", this._onAsyncCanceled, this).onSync("asyncReceived", this._onAsyncReceived, this).onSync("datasetRendered", this._onDatasetRendered, this).onSync("datasetCleared", this._onDatasetCleared, this),
            f = d(this, "activate", "open", "_onFocused"),
            g = d(this, "deactivate", "_onBlurred"),
            h = d(this, "isActive", "isOpen", "_onEnterKeyed"),
            i = d(this, "isActive", "isOpen", "_onTabKeyed"),
            j = d(this, "isActive", "_onEscKeyed"),
            k = d(this, "isActive", "open", "_onUpKeyed"),
            l = d(this, "isActive", "open", "_onDownKeyed"),
            m = d(this, "isActive", "isOpen", "_onLeftKeyed"),
            n = d(this, "isActive", "isOpen", "_onRightKeyed"),
            o = d(this, "_openIfActive", "_onQueryChanged"),
            p = d(this, "_openIfActive", "_onWhitespaceChanged"),
            this.input.bind().onSync("focused", f, this).onSync("blurred", g, this).onSync("enterKeyed", h, this).onSync("tabKeyed", i, this).onSync("escKeyed", j, this).onSync("upKeyed", k, this).onSync("downKeyed", l, this).onSync("leftKeyed", m, this).onSync("rightKeyed", n, this).onSync("queryChanged", o, this).onSync("whitespaceChanged", p, this).onSync("langDirChanged", this._onLangDirChanged, this)
        }
        function d(a) {
            var c = [].slice.call(arguments, 1);
            return function() {
                var d = [].slice.call(arguments);
                b.each(c, function(b) {
                    return a[b].apply(a, d)
                })
            }
        }
        return b.mixin(c.prototype, {
            _hacks: function() {
                var c, d;
                c = this.input.$input || a("<div>"),
                d = this.menu.$node || a("<div>"),
                c.on("blur.tt", function(a) {
                    var e, f, g;
                    e = document.activeElement,
                    f = d.is(e),
                    g = d.has(e).length > 0,
                    b.isMsie() && (f || g) && (a.preventDefault(),
                    a.stopImmediatePropagation(),
                    b.defer(function() {
                        c.focus()
                    }))
                }),
                d.on("mousedown.tt", function(a) {
                    a.preventDefault()
                })
            },
            _onSelectableClicked: function(a, b) {
                this.select(b)
            },
            _onDatasetCleared: function() {
                this._updateHint()
            },
            _onDatasetRendered: function(a, b, c, d) {
                this._updateHint(),
                this.eventBus.trigger("render", c, d, b)
            },
            _onAsyncRequested: function(a, b, c) {
                this.eventBus.trigger("asyncrequest", c, b)
            },
            _onAsyncCanceled: function(a, b, c) {
                this.eventBus.trigger("asynccancel", c, b)
            },
            _onAsyncReceived: function(a, b, c) {
                this.eventBus.trigger("asyncreceive", c, b)
            },
            _onFocused: function() {
                this._minLengthMet() && this.menu.update(this.input.getQuery())
            },
            _onBlurred: function() {
                this.input.hasQueryChangedSinceLastFocus() && this.eventBus.trigger("change", this.input.getQuery())
            },
            _onEnterKeyed: function(a, b) {
                var c;
                (c = this.menu.getActiveSelectable()) && this.select(c) && b.preventDefault()
            },
            _onTabKeyed: function(a, b) {
                var c;
                (c = this.menu.getActiveSelectable()) ? this.select(c) && b.preventDefault() : (c = this.menu.getTopSelectable()) && this.autocomplete(c) && b.preventDefault()
            },
            _onEscKeyed: function() {
                this.close()
            },
            _onUpKeyed: function() {
                this.moveCursor(-1)
            },
            _onDownKeyed: function() {
                this.moveCursor(1)
            },
            _onLeftKeyed: function() {
                "rtl" === this.dir && this.input.isCursorAtEnd() && this.autocomplete(this.menu.getTopSelectable())
            },
            _onRightKeyed: function() {
                "ltr" === this.dir && this.input.isCursorAtEnd() && this.autocomplete(this.menu.getTopSelectable())
            },
            _onQueryChanged: function(a, b) {
                this._minLengthMet(b) ? this.menu.update(b) : this.menu.empty()
            },
            _onWhitespaceChanged: function() {
                this._updateHint()
            },
            _onLangDirChanged: function(a, b) {
                this.dir !== b && (this.dir = b,
                this.menu.setLanguageDirection(b))
            },
            _openIfActive: function() {
                this.isActive() && this.open()
            },
            _minLengthMet: function(a) {
                return a = b.isString(a) ? a : this.input.getQuery() || "",
                a.length >= this.minLength
            },
            _updateHint: function() {
                var a, c, d, e, f, h, i;
                a = this.menu.getTopSelectable(),
                c = this.menu.getSelectableData(a),
                d = this.input.getInputValue(),
                !c || b.isBlankString(d) || this.input.hasOverflow() ? this.input.clearHint() : (e = g.normalizeQuery(d),
                f = b.escapeRegExChars(e),
                h = new RegExp("^(?:" + f + ")(.+$)","i"),
                i = h.exec(c.val),
                i && this.input.setHint(d + i[1]))
            },
            isEnabled: function() {
                return this.enabled
            },
            enable: function() {
                this.enabled = !0
            },
            disable: function() {
                this.enabled = !1
            },
            isActive: function() {
                return this.active
            },
            activate: function() {
                return this.isActive() ? !0 : !this.isEnabled() || this.eventBus.before("active") ? !1 : (this.active = !0,
                this.eventBus.trigger("active"),
                !0)
            },
            deactivate: function() {
                return this.isActive() ? this.eventBus.before("idle") ? !1 : (this.active = !1,
                this.close(),
                this.eventBus.trigger("idle"),
                !0) : !0
            },
            isOpen: function() {
                return this.menu.isOpen()
            },
            open: function() {
                return this.isOpen() || this.eventBus.before("open") || (this.menu.open(),
                this._updateHint(),
                this.eventBus.trigger("open")),
                this.isOpen()
            },
            close: function() {
                return this.isOpen() && !this.eventBus.before("close") && (this.menu.close(),
                this.input.clearHint(),
                this.input.resetInputValue(),
                this.eventBus.trigger("close")),
                !this.isOpen()
            },
            setVal: function(a) {
                this.input.setQuery(b.toStr(a))
            },
            getVal: function() {
                return this.input.getQuery()
            },
            select: function(a) {
                var b = this.menu.getSelectableData(a);
                return b && !this.eventBus.before("select", b.obj) ? (this.input.setQuery(b.val, !0),
                this.eventBus.trigger("select", b.obj),
                this.close(),
                !0) : !1
            },
            autocomplete: function(a) {
                var b, c, d;
                return b = this.input.getQuery(),
                c = this.menu.getSelectableData(a),
                d = c && b !== c.val,
                d && !this.eventBus.before("autocomplete", c.obj) ? (this.input.setQuery(c.val),
                this.eventBus.trigger("autocomplete", c.obj),
                !0) : !1
            },
            moveCursor: function(a) {
                var b, c, d, e, f;
                return b = this.input.getQuery(),
                c = this.menu.selectableRelativeToCursor(a),
                d = this.menu.getSelectableData(c),
                e = d ? d.obj : null,
                f = this._minLengthMet() && this.menu.update(b),
                f || this.eventBus.before("cursorchange", e) ? !1 : (this.menu.setCursor(c),
                d ? this.input.setInputValue(d.val) : (this.input.resetInputValue(),
                this._updateHint()),
                this.eventBus.trigger("cursorchange", e),
                !0)
            },
            destroy: function() {
                this.input.destroy(),
                this.menu.destroy()
            }
        }),
        c
    }();
    !function() {
        "use strict";
        function e(b, c) {
            b.each(function() {
                var b, d = a(this);
                (b = d.data(p.typeahead)) && c(b, d)
            })
        }
        function f(a, b) {
            return a.clone().addClass(b.classes.hint).removeData().css(b.css.hint).css(l(a)).prop("readonly", !0).removeAttr("id name placeholder required").attr({
                autocomplete: "off",
                spellcheck: "false",
                tabindex: -1
            })
        }
        function h(a, b) {
            a.data(p.attrs, {
                dir: a.attr("dir"),
                autocomplete: a.attr("autocomplete"),
                spellcheck: a.attr("spellcheck"),
                style: a.attr("style")
            }),
            a.addClass(b.classes.input).attr({
                autocomplete: "off",
                spellcheck: !1
            });
            try {
                !a.attr("dir") && a.attr("dir", "auto")
            } catch (c) {}
            return a
        }
        function l(a) {
            return {
                backgroundAttachment: a.css("background-attachment"),
                backgroundClip: a.css("background-clip"),
                backgroundColor: a.css("background-color"),
                backgroundImage: a.css("background-image"),
                backgroundOrigin: a.css("background-origin"),
                backgroundPosition: a.css("background-position"),
                backgroundRepeat: a.css("background-repeat"),
                backgroundSize: a.css("background-size")
            }
        }
        function m(a) {
            var c, d;
            c = a.data(p.www),
            d = a.parent().filter(c.selectors.wrapper),
            b.each(a.data(p.attrs), function(c, d) {
                b.isUndefined(c) ? a.removeAttr(d) : a.attr(d, c)
            }),
            a.removeData(p.typeahead).removeData(p.www).removeData(p.attr).removeClass(c.classes.input),
            d.length && (a.detach().insertAfter(d),
            d.remove())
        }
        function n(c) {
            var d, e;
            return d = b.isJQuery(c) || b.isElement(c),
            e = d ? a(c).first() : [],
            e.length ? e : null
        }
        var o, p, q;
        o = a.fn.typeahead,
        p = {
            www: "tt-www",
            attrs: "tt-attrs",
            typeahead: "tt-typeahead"
        },
        q = {
            initialize: function(e, l) {
                function m() {
                    var c, m, q, r, s, t, u, v, w, x, y;
                    b.each(l, function(a) {
                        a.highlight = !!e.highlight
                    }),
                    c = a(this),
                    m = a(o.html.wrapper),
                    q = n(e.hint),
                    r = n(e.menu),
                    s = e.hint !== !1 && !q,
                    t = e.menu !== !1 && !r,
                    s && (q = f(c, o)),
                    t && (r = a(o.html.menu).css(o.css.menu)),
                    q && q.val(""),
                    c = h(c, o),
                    (s || t) && (m.css(o.css.wrapper),
                    c.css(s ? o.css.input : o.css.inputWithNoHint),
                    c.wrap(m).parent().prepend(s ? q : null).append(t ? r : null)),
                    y = t ? j : i,
                    u = new d({
                        el: c
                    }),
                    v = new g({
                        hint: q,
                        input: c
                    },o),
                    w = new y({
                        node: r,
                        datasets: l
                    },o),
                    x = new k({
                        input: v,
                        menu: w,
                        eventBus: u,
                        minLength: e.minLength
                    },o),
                    c.data(p.www, o),
                    c.data(p.typeahead, x)
                }
                var o;
                return l = b.isArray(l) ? l : [].slice.call(arguments, 1),
                e = e || {},
                o = c(e.classNames),
                this.each(m)
            },
            isEnabled: function() {
                var a;
                return e(this.first(), function(b) {
                    a = b.isEnabled()
                }),
                a
            },
            enable: function() {
                return e(this, function(a) {
                    a.enable()
                }),
                this
            },
            disable: function() {
                return e(this, function(a) {
                    a.disable()
                }),
                this
            },
            isActive: function() {
                var a;
                return e(this.first(), function(b) {
                    a = b.isActive()
                }),
                a
            },
            activate: function() {
                return e(this, function(a) {
                    a.activate()
                }),
                this
            },
            deactivate: function() {
                return e(this, function(a) {
                    a.deactivate()
                }),
                this
            },
            isOpen: function() {
                var a;
                return e(this.first(), function(b) {
                    a = b.isOpen()
                }),
                a
            },
            open: function() {
                return e(this, function(a) {
                    a.open()
                }),
                this
            },
            close: function() {
                return e(this, function(a) {
                    a.close()
                }),
                this
            },
            select: function(b) {
                var c = !1
                  , d = a(b);
                return e(this.first(), function(a) {
                    c = a.select(d)
                }),
                c
            },
            autocomplete: function(b) {
                var c = !1
                  , d = a(b);
                return e(this.first(), function(a) {
                    c = a.autocomplete(d)
                }),
                c
            },
            moveCursor: function(a) {
                var b = !1;
                return e(this.first(), function(c) {
                    b = c.moveCursor(a)
                }),
                b
            },
            val: function(a) {
                var b;
                return arguments.length ? (e(this, function(b) {
                    b.setVal(a)
                }),
                this) : (e(this.first(), function(a) {
                    b = a.getVal()
                }),
                b)
            },
            destroy: function() {
                return e(this, function(a, b) {
                    m(b),
                    a.destroy()
                }),
                this
            }
        },
        a.fn.typeahead = function(a) {
            return q[a] ? q[a].apply(this, [].slice.call(arguments, 1)) : q.initialize.apply(this, arguments)
        }
        ,
        a.fn.typeahead.noConflict = function() {
            return a.fn.typeahead = o,
            this
        }
    }()
});
var Hogan = {};
(function(Hogan, useArrayBuffer) {
    Hogan.Template = function(renderFunc, text, compiler, options) {
        this.r = renderFunc || this.r;
        this.c = compiler;
        this.options = options;
        this.text = text || "";
        this.buf = useArrayBuffer ? [] : ""
    }
    ;
    Hogan.Template.prototype = {
        r: function(context, partials, indent) {
            return ""
        },
        v: hoganEscape,
        t: coerceToString,
        render: function render(context, partials, indent) {
            return this.ri([context], partials || {}, indent)
        },
        ri: function(context, partials, indent) {
            return this.r(context, partials, indent)
        },
        rp: function(name, context, partials, indent) {
            var partial = partials[name];
            if (!partial) {
                return ""
            }
            if (this.c && typeof partial == "string") {
                partial = this.c.compile(partial, this.options)
            }
            return partial.ri(context, partials, indent)
        },
        rs: function(context, partials, section) {
            var tail = context[context.length - 1];
            if (!isArray(tail)) {
                section(context, partials, this);
                return
            }
            for (var i = 0; i < tail.length; i++) {
                context.push(tail[i]);
                section(context, partials, this);
                context.pop()
            }
        },
        s: function(val, ctx, partials, inverted, start, end, tags) {
            var pass;
            if (isArray(val) && val.length === 0) {
                return false
            }
            if (typeof val == "function") {
                val = this.ls(val, ctx, partials, inverted, start, end, tags)
            }
            pass = val === "" || !!val;
            if (!inverted && pass && ctx) {
                ctx.push(typeof val == "object" ? val : ctx[ctx.length - 1])
            }
            return pass
        },
        d: function(key, ctx, partials, returnFound) {
            var names = key.split(".")
              , val = this.f(names[0], ctx, partials, returnFound)
              , cx = null;
            if (key === "." && isArray(ctx[ctx.length - 2])) {
                return ctx[ctx.length - 1]
            }
            for (var i = 1; i < names.length; i++) {
                if (val && typeof val == "object" && names[i]in val) {
                    cx = val;
                    val = val[names[i]]
                } else {
                    val = ""
                }
            }
            if (returnFound && !val) {
                return false
            }
            if (!returnFound && typeof val == "function") {
                ctx.push(cx);
                val = this.lv(val, ctx, partials);
                ctx.pop()
            }
            return val
        },
        f: function(key, ctx, partials, returnFound) {
            var val = false
              , v = null
              , found = false;
            for (var i = ctx.length - 1; i >= 0; i--) {
                v = ctx[i];
                if (v && typeof v == "object" && key in v) {
                    val = v[key];
                    found = true;
                    break
                }
            }
            if (!found) {
                return returnFound ? false : ""
            }
            if (!returnFound && typeof val == "function") {
                val = this.lv(val, ctx, partials)
            }
            return val
        },
        ho: function(val, cx, partials, text, tags) {
            var compiler = this.c;
            var options = this.options;
            options.delimiters = tags;
            var text = val.call(cx, text);
            text = text == null ? String(text) : text.toString();
            this.b(compiler.compile(text, options).render(cx, partials));
            return false
        },
        b: useArrayBuffer ? function(s) {
            this.buf.push(s)
        }
        : function(s) {
            this.buf += s
        }
        ,
        fl: useArrayBuffer ? function() {
            var r = this.buf.join("");
            this.buf = [];
            return r
        }
        : function() {
            var r = this.buf;
            this.buf = "";
            return r
        }
        ,
        ls: function(val, ctx, partials, inverted, start, end, tags) {
            var cx = ctx[ctx.length - 1]
              , t = null;
            if (!inverted && this.c && val.length > 0) {
                return this.ho(val, cx, partials, this.text.substring(start, end), tags)
            }
            t = val.call(cx);
            if (typeof t == "function") {
                if (inverted) {
                    return true
                } else if (this.c) {
                    return this.ho(t, cx, partials, this.text.substring(start, end), tags)
                }
            }
            return t
        },
        lv: function(val, ctx, partials) {
            var cx = ctx[ctx.length - 1];
            var result = val.call(cx);
            if (typeof result == "function") {
                result = coerceToString(result.call(cx));
                if (this.c && ~result.indexOf("{{")) {
                    return this.c.compile(result, this.options).render(cx, partials)
                }
            }
            return coerceToString(result)
        }
    };
    var rAmp = /&/g
      , rLt = /</g
      , rGt = />/g
      , rApos = /\'/g
      , rQuot = /\"/g
      , hChars = /[&<>\"\']/;
    function coerceToString(val) {
        return String(val === null || val === undefined ? "" : val)
    }
    function hoganEscape(str) {
        str = coerceToString(str);
        return hChars.test(str) ? str.replace(rAmp, "&amp;").replace(rLt, "&lt;").replace(rGt, "&gt;").replace(rApos, "&#39;").replace(rQuot, "&quot;") : str
    }
    var isArray = Array.isArray || function(a) {
        return Object.prototype.toString.call(a) === "[object Array]"
    }
}
)(typeof exports !== "undefined" ? exports : Hogan);
(function(Hogan) {
    var rIsWhitespace = /\S/
      , rQuot = /\"/g
      , rNewline = /\n/g
      , rCr = /\r/g
      , rSlash = /\\/g
      , tagTypes = {
        "#": 1,
        "^": 2,
        "/": 3,
        "!": 4,
        ">": 5,
        "<": 6,
        "=": 7,
        _v: 8,
        "{": 9,
        "&": 10
    };
    Hogan.scan = function scan(text, delimiters) {
        var len = text.length
          , IN_TEXT = 0
          , IN_TAG_TYPE = 1
          , IN_TAG = 2
          , state = IN_TEXT
          , tagType = null
          , tag = null
          , buf = ""
          , tokens = []
          , seenTag = false
          , i = 0
          , lineStart = 0
          , otag = "{{"
          , ctag = "}}";
        function addBuf() {
            if (buf.length > 0) {
                tokens.push(new String(buf));
                buf = ""
            }
        }
        function lineIsWhitespace() {
            var isAllWhitespace = true;
            for (var j = lineStart; j < tokens.length; j++) {
                isAllWhitespace = tokens[j].tag && tagTypes[tokens[j].tag] < tagTypes["_v"] || !tokens[j].tag && tokens[j].match(rIsWhitespace) === null;
                if (!isAllWhitespace) {
                    return false
                }
            }
            return isAllWhitespace
        }
        function filterLine(haveSeenTag, noNewLine) {
            addBuf();
            if (haveSeenTag && lineIsWhitespace()) {
                for (var j = lineStart, next; j < tokens.length; j++) {
                    if (!tokens[j].tag) {
                        if ((next = tokens[j + 1]) && next.tag == ">") {
                            next.indent = tokens[j].toString()
                        }
                        tokens.splice(j, 1)
                    }
                }
            } else if (!noNewLine) {
                tokens.push({
                    tag: "\n"
                })
            }
            seenTag = false;
            lineStart = tokens.length
        }
        function changeDelimiters(text, index) {
            var close = "=" + ctag
              , closeIndex = text.indexOf(close, index)
              , delimiters = trim(text.substring(text.indexOf("=", index) + 1, closeIndex)).split(" ");
            otag = delimiters[0];
            ctag = delimiters[1];
            return closeIndex + close.length - 1
        }
        if (delimiters) {
            delimiters = delimiters.split(" ");
            otag = delimiters[0];
            ctag = delimiters[1]
        }
        for (i = 0; i < len; i++) {
            if (state == IN_TEXT) {
                if (tagChange(otag, text, i)) {
                    --i;
                    addBuf();
                    state = IN_TAG_TYPE
                } else {
                    if (text.charAt(i) == "\n") {
                        filterLine(seenTag)
                    } else {
                        buf += text.charAt(i)
                    }
                }
            } else if (state == IN_TAG_TYPE) {
                i += otag.length - 1;
                tag = tagTypes[text.charAt(i + 1)];
                tagType = tag ? text.charAt(i + 1) : "_v";
                if (tagType == "=") {
                    i = changeDelimiters(text, i);
                    state = IN_TEXT
                } else {
                    if (tag) {
                        i++
                    }
                    state = IN_TAG
                }
                seenTag = i
            } else {
                if (tagChange(ctag, text, i)) {
                    tokens.push({
                        tag: tagType,
                        n: trim(buf),
                        otag: otag,
                        ctag: ctag,
                        i: tagType == "/" ? seenTag - ctag.length : i + otag.length
                    });
                    buf = "";
                    i += ctag.length - 1;
                    state = IN_TEXT;
                    if (tagType == "{") {
                        if (ctag == "}}") {
                            i++
                        } else {
                            cleanTripleStache(tokens[tokens.length - 1])
                        }
                    }
                } else {
                    buf += text.charAt(i)
                }
            }
        }
        filterLine(seenTag, true);
        return tokens
    }
    ;
    function cleanTripleStache(token) {
        if (token.n.substr(token.n.length - 1) === "}") {
            token.n = token.n.substring(0, token.n.length - 1)
        }
    }
    function trim(s) {
        if (s.trim) {
            return s.trim()
        }
        return s.replace(/^\s*|\s*$/g, "")
    }
    function tagChange(tag, text, index) {
        if (text.charAt(index) != tag.charAt(0)) {
            return false
        }
        for (var i = 1, l = tag.length; i < l; i++) {
            if (text.charAt(index + i) != tag.charAt(i)) {
                return false
            }
        }
        return true
    }
    function buildTree(tokens, kind, stack, customTags) {
        var instructions = []
          , opener = null
          , token = null;
        while (tokens.length > 0) {
            token = tokens.shift();
            if (token.tag == "#" || token.tag == "^" || isOpener(token, customTags)) {
                stack.push(token);
                token.nodes = buildTree(tokens, token.tag, stack, customTags);
                instructions.push(token)
            } else if (token.tag == "/") {
                if (stack.length === 0) {
                    throw new Error("Closing tag without opener: /" + token.n)
                }
                opener = stack.pop();
                if (token.n != opener.n && !isCloser(token.n, opener.n, customTags)) {
                    throw new Error("Nesting error: " + opener.n + " vs. " + token.n)
                }
                opener.end = token.i;
                return instructions
            } else {
                instructions.push(token)
            }
        }
        if (stack.length > 0) {
            throw new Error("missing closing tag: " + stack.pop().n)
        }
        return instructions
    }
    function isOpener(token, tags) {
        for (var i = 0, l = tags.length; i < l; i++) {
            if (tags[i].o == token.n) {
                token.tag = "#";
                return true
            }
        }
    }
    function isCloser(close, open, tags) {
        for (var i = 0, l = tags.length; i < l; i++) {
            if (tags[i].c == close && tags[i].o == open) {
                return true
            }
        }
    }
    Hogan.generate = function(tree, text, options) {
        var code = 'var _=this;_.b(i=i||"");' + walk(tree) + "return _.fl();";
        if (options.asString) {
            return "function(c,p,i){" + code + ";}"
        }
        return new Hogan.Template(new Function("c","p","i",code),text,Hogan,options)
    }
    ;
    function esc(s) {
        return s.replace(rSlash, "\\\\").replace(rQuot, '\\"').replace(rNewline, "\\n").replace(rCr, "\\r")
    }
    function chooseMethod(s) {
        return ~s.indexOf(".") ? "d" : "f"
    }
    function walk(tree) {
        var code = "";
        for (var i = 0, l = tree.length; i < l; i++) {
            var tag = tree[i].tag;
            if (tag == "#") {
                code += section(tree[i].nodes, tree[i].n, chooseMethod(tree[i].n), tree[i].i, tree[i].end, tree[i].otag + " " + tree[i].ctag)
            } else if (tag == "^") {
                code += invertedSection(tree[i].nodes, tree[i].n, chooseMethod(tree[i].n))
            } else if (tag == "<" || tag == ">") {
                code += partial(tree[i])
            } else if (tag == "{" || tag == "&") {
                code += tripleStache(tree[i].n, chooseMethod(tree[i].n))
            } else if (tag == "\n") {
                code += text('"\\n"' + (tree.length - 1 == i ? "" : " + i"))
            } else if (tag == "_v") {
                code += variable(tree[i].n, chooseMethod(tree[i].n))
            } else if (tag === undefined) {
                code += text('"' + esc(tree[i]) + '"')
            }
        }
        return code
    }
    function section(nodes, id, method, start, end, tags) {
        return "if(_.s(_." + method + '("' + esc(id) + '",c,p,1),' + "c,p,0," + start + "," + end + ',"' + tags + '")){' + "_.rs(c,p," + "function(c,p,_){" + walk(nodes) + "});c.pop();}"
    }
    function invertedSection(nodes, id, method) {
        return "if(!_.s(_." + method + '("' + esc(id) + '",c,p,1),c,p,1,0,0,"")){' + walk(nodes) + "};"
    }
    function partial(tok) {
        return '_.b(_.rp("' + esc(tok.n) + '",c,p,"' + (tok.indent || "") + '"));'
    }
    function tripleStache(id, method) {
        return "_.b(_.t(_." + method + '("' + esc(id) + '",c,p,0)));'
    }
    function variable(id, method) {
        return "_.b(_.v(_." + method + '("' + esc(id) + '",c,p,0)));'
    }
    function text(id) {
        return "_.b(" + id + ");"
    }
    Hogan.parse = function(tokens, text, options) {
        options = options || {};
        return buildTree(tokens, "", [], options.sectionTags || [])
    }
    ,
    Hogan.cache = {};
    Hogan.compile = function(text, options) {
        options = options || {};
        var key = text + "||" + !!options.asString;
        var t = this.cache[key];
        if (t) {
            return t
        }
        t = this.generate(this.parse(this.scan(text, options.delimiters), text, options), text, options);
        return this.cache[key] = t
    }
}
)(typeof exports !== "undefined" ? exports : Hogan);
(function($, guruApp) {
    "use strict";
    if (!guruApp.libs) {
        guruApp.libs = {}
    }
    guruApp.libs.localStorage = {
        get: function(name) {
            var data = localStorage.getItem(name);
            return data ? JSON.parse(data) : null
        },
        set: function(name, data) {
            return localStorage.setItem(name, JSON.stringify(data))
        },
        delete: function(name) {
            return localStorage.removeItem(name)
        }
    }
}
)(jQuery, guruApp);
function checkLoginState() {
    $("body").trigger("ga.listing.continue-with-fb.click")
}
function checkUserLoggedIn(page, source) {
    localStorage.fbLoginSignupPage = page;
    localStorage.fbLoginSignupSource = source;
    if (page === "Registration") {
        page = "Registration Submit"
    }
    guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent("Personalizing", "Facebook " + page + " Attempt", source, null, "non-interactive");
    FB.getLoginStatus(loginStateChangeCallback)
}
function loginStateChangeCallback(response) {
    if (response.status === "connected") {
        if (typeof guruApp.widgetGoogleAnalytics !== "undefined") {
            if (localStorage.fbLoginSignupPage && localStorage.fbLoginSignupSource) {
                guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent("Personalizing", "Facebook " + localStorage.fbLoginSignupPage + " Successful", localStorage.fbLoginSignupSource, null, "non-interactive");
                localStorage.removeItem("fbLoginSignupPage");
                localStorage.removeItem("fbLoginSignupSource")
            }
        }
        var token = response.authResponse.accessToken;
        var accountId = response.authResponse.userID;
        socialLoginSignup(accountId, token, "facebook", function() {
            location.reload()
        })
    } else {
        document.getElementById("status").innerHTML = "Please log into this app."
    }
}
(function(global, factory) {
    typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory() : typeof define === "function" && define.amd ? define(factory) : global.moment = factory()
}
)(this, function() {
    "use strict";
    var hookCallback;
    function hooks() {
        return hookCallback.apply(null, arguments)
    }
    function setHookCallback(callback) {
        hookCallback = callback
    }
    function isArray(input) {
        return input instanceof Array || Object.prototype.toString.call(input) === "[object Array]"
    }
    function isObject(input) {
        return input != null && Object.prototype.toString.call(input) === "[object Object]"
    }
    function isObjectEmpty(obj) {
        if (Object.getOwnPropertyNames) {
            return Object.getOwnPropertyNames(obj).length === 0
        } else {
            var k;
            for (k in obj) {
                if (obj.hasOwnProperty(k)) {
                    return false
                }
            }
            return true
        }
    }
    function isUndefined(input) {
        return input === void 0
    }
    function isNumber(input) {
        return typeof input === "number" || Object.prototype.toString.call(input) === "[object Number]"
    }
    function isDate(input) {
        return input instanceof Date || Object.prototype.toString.call(input) === "[object Date]"
    }
    function map(arr, fn) {
        var res = [], i;
        for (i = 0; i < arr.length; ++i) {
            res.push(fn(arr[i], i))
        }
        return res
    }
    function hasOwnProp(a, b) {
        return Object.prototype.hasOwnProperty.call(a, b)
    }
    function extend(a, b) {
        for (var i in b) {
            if (hasOwnProp(b, i)) {
                a[i] = b[i]
            }
        }
        if (hasOwnProp(b, "toString")) {
            a.toString = b.toString
        }
        if (hasOwnProp(b, "valueOf")) {
            a.valueOf = b.valueOf
        }
        return a
    }
    function createUTC(input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, true).utc()
    }
    function defaultParsingFlags() {
        return {
            empty: false,
            unusedTokens: [],
            unusedInput: [],
            overflow: -2,
            charsLeftOver: 0,
            nullInput: false,
            invalidMonth: null,
            invalidFormat: false,
            userInvalidated: false,
            iso: false,
            parsedDateParts: [],
            meridiem: null,
            rfc2822: false,
            weekdayMismatch: false
        }
    }
    function getParsingFlags(m) {
        if (m._pf == null) {
            m._pf = defaultParsingFlags()
        }
        return m._pf
    }
    var some;
    if (Array.prototype.some) {
        some = Array.prototype.some
    } else {
        some = function(fun) {
            var t = Object(this);
            var len = t.length >>> 0;
            for (var i = 0; i < len; i++) {
                if (i in t && fun.call(this, t[i], i, t)) {
                    return true
                }
            }
            return false
        }
    }
    function isValid(m) {
        if (m._isValid == null) {
            var flags = getParsingFlags(m);
            var parsedParts = some.call(flags.parsedDateParts, function(i) {
                return i != null
            });
            var isNowValid = !isNaN(m._d.getTime()) && flags.overflow < 0 && !flags.empty && !flags.invalidMonth && !flags.invalidWeekday && !flags.weekdayMismatch && !flags.nullInput && !flags.invalidFormat && !flags.userInvalidated && (!flags.meridiem || flags.meridiem && parsedParts);
            if (m._strict) {
                isNowValid = isNowValid && flags.charsLeftOver === 0 && flags.unusedTokens.length === 0 && flags.bigHour === undefined
            }
            if (Object.isFrozen == null || !Object.isFrozen(m)) {
                m._isValid = isNowValid
            } else {
                return isNowValid
            }
        }
        return m._isValid
    }
    function createInvalid(flags) {
        var m = createUTC(NaN);
        if (flags != null) {
            extend(getParsingFlags(m), flags)
        } else {
            getParsingFlags(m).userInvalidated = true
        }
        return m
    }
    var momentProperties = hooks.momentProperties = [];
    function copyConfig(to, from) {
        var i, prop, val;
        if (!isUndefined(from._isAMomentObject)) {
            to._isAMomentObject = from._isAMomentObject
        }
        if (!isUndefined(from._i)) {
            to._i = from._i
        }
        if (!isUndefined(from._f)) {
            to._f = from._f
        }
        if (!isUndefined(from._l)) {
            to._l = from._l
        }
        if (!isUndefined(from._strict)) {
            to._strict = from._strict
        }
        if (!isUndefined(from._tzm)) {
            to._tzm = from._tzm
        }
        if (!isUndefined(from._isUTC)) {
            to._isUTC = from._isUTC
        }
        if (!isUndefined(from._offset)) {
            to._offset = from._offset
        }
        if (!isUndefined(from._pf)) {
            to._pf = getParsingFlags(from)
        }
        if (!isUndefined(from._locale)) {
            to._locale = from._locale
        }
        if (momentProperties.length > 0) {
            for (i = 0; i < momentProperties.length; i++) {
                prop = momentProperties[i];
                val = from[prop];
                if (!isUndefined(val)) {
                    to[prop] = val
                }
            }
        }
        return to
    }
    var updateInProgress = false;
    function Moment(config) {
        copyConfig(this, config);
        this._d = new Date(config._d != null ? config._d.getTime() : NaN);
        if (!this.isValid()) {
            this._d = new Date(NaN)
        }
        if (updateInProgress === false) {
            updateInProgress = true;
            hooks.updateOffset(this);
            updateInProgress = false
        }
    }
    function isMoment(obj) {
        return obj instanceof Moment || obj != null && obj._isAMomentObject != null
    }
    function absFloor(number) {
        if (number < 0) {
            return Math.ceil(number) || 0
        } else {
            return Math.floor(number)
        }
    }
    function toInt(argumentForCoercion) {
        var coercedNumber = +argumentForCoercion
          , value = 0;
        if (coercedNumber !== 0 && isFinite(coercedNumber)) {
            value = absFloor(coercedNumber)
        }
        return value
    }
    function compareArrays(array1, array2, dontConvert) {
        var len = Math.min(array1.length, array2.length), lengthDiff = Math.abs(array1.length - array2.length), diffs = 0, i;
        for (i = 0; i < len; i++) {
            if (dontConvert && array1[i] !== array2[i] || !dontConvert && toInt(array1[i]) !== toInt(array2[i])) {
                diffs++
            }
        }
        return diffs + lengthDiff
    }
    function warn(msg) {
        if (hooks.suppressDeprecationWarnings === false && typeof console !== "undefined" && console.warn) {
            console.warn("Deprecation warning: " + msg)
        }
    }
    function deprecate(msg, fn) {
        var firstTime = true;
        return extend(function() {
            if (hooks.deprecationHandler != null) {
                hooks.deprecationHandler(null, msg)
            }
            if (firstTime) {
                var args = [];
                var arg;
                for (var i = 0; i < arguments.length; i++) {
                    arg = "";
                    if (typeof arguments[i] === "object") {
                        arg += "\n[" + i + "] ";
                        for (var key in arguments[0]) {
                            arg += key + ": " + arguments[0][key] + ", "
                        }
                        arg = arg.slice(0, -2)
                    } else {
                        arg = arguments[i]
                    }
                    args.push(arg)
                }
                warn(msg + "\nArguments: " + Array.prototype.slice.call(args).join("") + "\n" + (new Error).stack);
                firstTime = false
            }
            return fn.apply(this, arguments)
        }, fn)
    }
    var deprecations = {};
    function deprecateSimple(name, msg) {
        if (hooks.deprecationHandler != null) {
            hooks.deprecationHandler(name, msg)
        }
        if (!deprecations[name]) {
            warn(msg);
            deprecations[name] = true
        }
    }
    hooks.suppressDeprecationWarnings = false;
    hooks.deprecationHandler = null;
    function isFunction(input) {
        return input instanceof Function || Object.prototype.toString.call(input) === "[object Function]"
    }
    function set(config) {
        var prop, i;
        for (i in config) {
            prop = config[i];
            if (isFunction(prop)) {
                this[i] = prop
            } else {
                this["_" + i] = prop
            }
        }
        this._config = config;
        this._dayOfMonthOrdinalParseLenient = new RegExp((this._dayOfMonthOrdinalParse.source || this._ordinalParse.source) + "|" + /\d{1,2}/.source)
    }
    function mergeConfigs(parentConfig, childConfig) {
        var res = extend({}, parentConfig), prop;
        for (prop in childConfig) {
            if (hasOwnProp(childConfig, prop)) {
                if (isObject(parentConfig[prop]) && isObject(childConfig[prop])) {
                    res[prop] = {};
                    extend(res[prop], parentConfig[prop]);
                    extend(res[prop], childConfig[prop])
                } else if (childConfig[prop] != null) {
                    res[prop] = childConfig[prop]
                } else {
                    delete res[prop]
                }
            }
        }
        for (prop in parentConfig) {
            if (hasOwnProp(parentConfig, prop) && !hasOwnProp(childConfig, prop) && isObject(parentConfig[prop])) {
                res[prop] = extend({}, res[prop])
            }
        }
        return res
    }
    function Locale(config) {
        if (config != null) {
            this.set(config)
        }
    }
    var keys;
    if (Object.keys) {
        keys = Object.keys
    } else {
        keys = function(obj) {
            var i, res = [];
            for (i in obj) {
                if (hasOwnProp(obj, i)) {
                    res.push(i)
                }
            }
            return res
        }
    }
    var defaultCalendar = {
        sameDay: "[Today at] LT",
        nextDay: "[Tomorrow at] LT",
        nextWeek: "dddd [at] LT",
        lastDay: "[Yesterday at] LT",
        lastWeek: "[Last] dddd [at] LT",
        sameElse: "L"
    };
    function calendar(key, mom, now) {
        var output = this._calendar[key] || this._calendar["sameElse"];
        return isFunction(output) ? output.call(mom, now) : output
    }
    var defaultLongDateFormat = {
        LTS: "h:mm:ss A",
        LT: "h:mm A",
        L: "MM/DD/YYYY",
        LL: "MMMM D, YYYY",
        LLL: "MMMM D, YYYY h:mm A",
        LLLL: "dddd, MMMM D, YYYY h:mm A"
    };
    function longDateFormat(key) {
        var format = this._longDateFormat[key]
          , formatUpper = this._longDateFormat[key.toUpperCase()];
        if (format || !formatUpper) {
            return format
        }
        this._longDateFormat[key] = formatUpper.replace(/MMMM|MM|DD|dddd/g, function(val) {
            return val.slice(1)
        });
        return this._longDateFormat[key]
    }
    var defaultInvalidDate = "Invalid date";
    function invalidDate() {
        return this._invalidDate
    }
    var defaultOrdinal = "%d";
    var defaultDayOfMonthOrdinalParse = /\d{1,2}/;
    function ordinal(number) {
        return this._ordinal.replace("%d", number)
    }
    var defaultRelativeTime = {
        future: "in %s",
        past: "%s ago",
        s: "a few seconds",
        ss: "%d seconds",
        m: "a minute",
        mm: "%d minutes",
        h: "an hour",
        hh: "%d hours",
        d: "a day",
        dd: "%d days",
        M: "a month",
        MM: "%d months",
        y: "a year",
        yy: "%d years"
    };
    function relativeTime(number, withoutSuffix, string, isFuture) {
        var output = this._relativeTime[string];
        return isFunction(output) ? output(number, withoutSuffix, string, isFuture) : output.replace(/%d/i, number)
    }
    function pastFuture(diff, output) {
        var format = this._relativeTime[diff > 0 ? "future" : "past"];
        return isFunction(format) ? format(output) : format.replace(/%s/i, output)
    }
    var aliases = {};
    function addUnitAlias(unit, shorthand) {
        var lowerCase = unit.toLowerCase();
        aliases[lowerCase] = aliases[lowerCase + "s"] = aliases[shorthand] = unit
    }
    function normalizeUnits(units) {
        return typeof units === "string" ? aliases[units] || aliases[units.toLowerCase()] : undefined
    }
    function normalizeObjectUnits(inputObject) {
        var normalizedInput = {}, normalizedProp, prop;
        for (prop in inputObject) {
            if (hasOwnProp(inputObject, prop)) {
                normalizedProp = normalizeUnits(prop);
                if (normalizedProp) {
                    normalizedInput[normalizedProp] = inputObject[prop]
                }
            }
        }
        return normalizedInput
    }
    var priorities = {};
    function addUnitPriority(unit, priority) {
        priorities[unit] = priority
    }
    function getPrioritizedUnits(unitsObj) {
        var units = [];
        for (var u in unitsObj) {
            units.push({
                unit: u,
                priority: priorities[u]
            })
        }
        units.sort(function(a, b) {
            return a.priority - b.priority
        });
        return units
    }
    function zeroFill(number, targetLength, forceSign) {
        var absNumber = "" + Math.abs(number)
          , zerosToFill = targetLength - absNumber.length
          , sign = number >= 0;
        return (sign ? forceSign ? "+" : "" : "-") + Math.pow(10, Math.max(0, zerosToFill)).toString().substr(1) + absNumber
    }
    var formattingTokens = /(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
    var localFormattingTokens = /(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;
    var formatFunctions = {};
    var formatTokenFunctions = {};
    function addFormatToken(token, padded, ordinal, callback) {
        var func = callback;
        if (typeof callback === "string") {
            func = function() {
                return this[callback]()
            }
        }
        if (token) {
            formatTokenFunctions[token] = func
        }
        if (padded) {
            formatTokenFunctions[padded[0]] = function() {
                return zeroFill(func.apply(this, arguments), padded[1], padded[2])
            }
        }
        if (ordinal) {
            formatTokenFunctions[ordinal] = function() {
                return this.localeData().ordinal(func.apply(this, arguments), token)
            }
        }
    }
    function removeFormattingTokens(input) {
        if (input.match(/\[[\s\S]/)) {
            return input.replace(/^\[|\]$/g, "")
        }
        return input.replace(/\\/g, "")
    }
    function makeFormatFunction(format) {
        var array = format.match(formattingTokens), i, length;
        for (i = 0,
        length = array.length; i < length; i++) {
            if (formatTokenFunctions[array[i]]) {
                array[i] = formatTokenFunctions[array[i]]
            } else {
                array[i] = removeFormattingTokens(array[i])
            }
        }
        return function(mom) {
            var output = "", i;
            for (i = 0; i < length; i++) {
                output += isFunction(array[i]) ? array[i].call(mom, format) : array[i]
            }
            return output
        }
    }
    function formatMoment(m, format) {
        if (!m.isValid()) {
            return m.localeData().invalidDate()
        }
        format = expandFormat(format, m.localeData());
        formatFunctions[format] = formatFunctions[format] || makeFormatFunction(format);
        return formatFunctions[format](m)
    }
    function expandFormat(format, locale) {
        var i = 5;
        function replaceLongDateFormatTokens(input) {
            return locale.longDateFormat(input) || input
        }
        localFormattingTokens.lastIndex = 0;
        while (i >= 0 && localFormattingTokens.test(format)) {
            format = format.replace(localFormattingTokens, replaceLongDateFormatTokens);
            localFormattingTokens.lastIndex = 0;
            i -= 1
        }
        return format
    }
    var match1 = /\d/;
    var match2 = /\d\d/;
    var match3 = /\d{3}/;
    var match4 = /\d{4}/;
    var match6 = /[+-]?\d{6}/;
    var match1to2 = /\d\d?/;
    var match3to4 = /\d\d\d\d?/;
    var match5to6 = /\d\d\d\d\d\d?/;
    var match1to3 = /\d{1,3}/;
    var match1to4 = /\d{1,4}/;
    var match1to6 = /[+-]?\d{1,6}/;
    var matchUnsigned = /\d+/;
    var matchSigned = /[+-]?\d+/;
    var matchOffset = /Z|[+-]\d\d:?\d\d/gi;
    var matchShortOffset = /Z|[+-]\d\d(?::?\d\d)?/gi;
    var matchTimestamp = /[+-]?\d+(\.\d{1,3})?/;
    var matchWord = /[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;
    var regexes = {};
    function addRegexToken(token, regex, strictRegex) {
        regexes[token] = isFunction(regex) ? regex : function(isStrict, localeData) {
            return isStrict && strictRegex ? strictRegex : regex
        }
    }
    function getParseRegexForToken(token, config) {
        if (!hasOwnProp(regexes, token)) {
            return new RegExp(unescapeFormat(token))
        }
        return regexes[token](config._strict, config._locale)
    }
    function unescapeFormat(s) {
        return regexEscape(s.replace("\\", "").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function(matched, p1, p2, p3, p4) {
            return p1 || p2 || p3 || p4
        }))
    }
    function regexEscape(s) {
        return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&")
    }
    var tokens = {};
    function addParseToken(token, callback) {
        var i, func = callback;
        if (typeof token === "string") {
            token = [token]
        }
        if (isNumber(callback)) {
            func = function(input, array) {
                array[callback] = toInt(input)
            }
        }
        for (i = 0; i < token.length; i++) {
            tokens[token[i]] = func
        }
    }
    function addWeekParseToken(token, callback) {
        addParseToken(token, function(input, array, config, token) {
            config._w = config._w || {};
            callback(input, config._w, config, token)
        })
    }
    function addTimeToArrayFromToken(token, input, config) {
        if (input != null && hasOwnProp(tokens, token)) {
            tokens[token](input, config._a, config, token)
        }
    }
    var YEAR = 0;
    var MONTH = 1;
    var DATE = 2;
    var HOUR = 3;
    var MINUTE = 4;
    var SECOND = 5;
    var MILLISECOND = 6;
    var WEEK = 7;
    var WEEKDAY = 8;
    addFormatToken("Y", 0, 0, function() {
        var y = this.year();
        return y <= 9999 ? "" + y : "+" + y
    });
    addFormatToken(0, ["YY", 2], 0, function() {
        return this.year() % 100
    });
    addFormatToken(0, ["YYYY", 4], 0, "year");
    addFormatToken(0, ["YYYYY", 5], 0, "year");
    addFormatToken(0, ["YYYYYY", 6, true], 0, "year");
    addUnitAlias("year", "y");
    addUnitPriority("year", 1);
    addRegexToken("Y", matchSigned);
    addRegexToken("YY", match1to2, match2);
    addRegexToken("YYYY", match1to4, match4);
    addRegexToken("YYYYY", match1to6, match6);
    addRegexToken("YYYYYY", match1to6, match6);
    addParseToken(["YYYYY", "YYYYYY"], YEAR);
    addParseToken("YYYY", function(input, array) {
        array[YEAR] = input.length === 2 ? hooks.parseTwoDigitYear(input) : toInt(input)
    });
    addParseToken("YY", function(input, array) {
        array[YEAR] = hooks.parseTwoDigitYear(input)
    });
    addParseToken("Y", function(input, array) {
        array[YEAR] = parseInt(input, 10)
    });
    function daysInYear(year) {
        return isLeapYear(year) ? 366 : 365
    }
    function isLeapYear(year) {
        return year % 4 === 0 && year % 100 !== 0 || year % 400 === 0
    }
    hooks.parseTwoDigitYear = function(input) {
        return toInt(input) + (toInt(input) > 68 ? 1900 : 2e3)
    }
    ;
    var getSetYear = makeGetSet("FullYear", true);
    function getIsLeapYear() {
        return isLeapYear(this.year())
    }
    function makeGetSet(unit, keepTime) {
        return function(value) {
            if (value != null) {
                set$1(this, unit, value);
                hooks.updateOffset(this, keepTime);
                return this
            } else {
                return get(this, unit)
            }
        }
    }
    function get(mom, unit) {
        return mom.isValid() ? mom._d["get" + (mom._isUTC ? "UTC" : "") + unit]() : NaN
    }
    function set$1(mom, unit, value) {
        if (mom.isValid() && !isNaN(value)) {
            if (unit === "FullYear" && isLeapYear(mom.year()) && mom.month() === 1 && mom.date() === 29) {
                mom._d["set" + (mom._isUTC ? "UTC" : "") + unit](value, mom.month(), daysInMonth(value, mom.month()))
            } else {
                mom._d["set" + (mom._isUTC ? "UTC" : "") + unit](value)
            }
        }
    }
    function stringGet(units) {
        units = normalizeUnits(units);
        if (isFunction(this[units])) {
            return this[units]()
        }
        return this
    }
    function stringSet(units, value) {
        if (typeof units === "object") {
            units = normalizeObjectUnits(units);
            var prioritized = getPrioritizedUnits(units);
            for (var i = 0; i < prioritized.length; i++) {
                this[prioritized[i].unit](units[prioritized[i].unit])
            }
        } else {
            units = normalizeUnits(units);
            if (isFunction(this[units])) {
                return this[units](value)
            }
        }
        return this
    }
    function mod(n, x) {
        return (n % x + x) % x
    }
    var indexOf;
    if (Array.prototype.indexOf) {
        indexOf = Array.prototype.indexOf
    } else {
        indexOf = function(o) {
            var i;
            for (i = 0; i < this.length; ++i) {
                if (this[i] === o) {
                    return i
                }
            }
            return -1
        }
    }
    function daysInMonth(year, month) {
        if (isNaN(year) || isNaN(month)) {
            return NaN
        }
        var modMonth = mod(month, 12);
        year += (month - modMonth) / 12;
        return modMonth === 1 ? isLeapYear(year) ? 29 : 28 : 31 - modMonth % 7 % 2
    }
    addFormatToken("M", ["MM", 2], "Mo", function() {
        return this.month() + 1
    });
    addFormatToken("MMM", 0, 0, function(format) {
        return this.localeData().monthsShort(this, format)
    });
    addFormatToken("MMMM", 0, 0, function(format) {
        return this.localeData().months(this, format)
    });
    addUnitAlias("month", "M");
    addUnitPriority("month", 8);
    addRegexToken("M", match1to2);
    addRegexToken("MM", match1to2, match2);
    addRegexToken("MMM", function(isStrict, locale) {
        return locale.monthsShortRegex(isStrict)
    });
    addRegexToken("MMMM", function(isStrict, locale) {
        return locale.monthsRegex(isStrict)
    });
    addParseToken(["M", "MM"], function(input, array) {
        array[MONTH] = toInt(input) - 1
    });
    addParseToken(["MMM", "MMMM"], function(input, array, config, token) {
        var month = config._locale.monthsParse(input, token, config._strict);
        if (month != null) {
            array[MONTH] = month
        } else {
            getParsingFlags(config).invalidMonth = input
        }
    });
    var MONTHS_IN_FORMAT = /D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;
    var defaultLocaleMonths = "January_February_March_April_May_June_July_August_September_October_November_December".split("_");
    function localeMonths(m, format) {
        if (!m) {
            return isArray(this._months) ? this._months : this._months["standalone"]
        }
        return isArray(this._months) ? this._months[m.month()] : this._months[(this._months.isFormat || MONTHS_IN_FORMAT).test(format) ? "format" : "standalone"][m.month()]
    }
    var defaultLocaleMonthsShort = "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");
    function localeMonthsShort(m, format) {
        if (!m) {
            return isArray(this._monthsShort) ? this._monthsShort : this._monthsShort["standalone"]
        }
        return isArray(this._monthsShort) ? this._monthsShort[m.month()] : this._monthsShort[MONTHS_IN_FORMAT.test(format) ? "format" : "standalone"][m.month()]
    }
    function handleStrictParse(monthName, format, strict) {
        var i, ii, mom, llc = monthName.toLocaleLowerCase();
        if (!this._monthsParse) {
            this._monthsParse = [];
            this._longMonthsParse = [];
            this._shortMonthsParse = [];
            for (i = 0; i < 12; ++i) {
                mom = createUTC([2e3, i]);
                this._shortMonthsParse[i] = this.monthsShort(mom, "").toLocaleLowerCase();
                this._longMonthsParse[i] = this.months(mom, "").toLocaleLowerCase()
            }
        }
        if (strict) {
            if (format === "MMM") {
                ii = indexOf.call(this._shortMonthsParse, llc);
                return ii !== -1 ? ii : null
            } else {
                ii = indexOf.call(this._longMonthsParse, llc);
                return ii !== -1 ? ii : null
            }
        } else {
            if (format === "MMM") {
                ii = indexOf.call(this._shortMonthsParse, llc);
                if (ii !== -1) {
                    return ii
                }
                ii = indexOf.call(this._longMonthsParse, llc);
                return ii !== -1 ? ii : null
            } else {
                ii = indexOf.call(this._longMonthsParse, llc);
                if (ii !== -1) {
                    return ii
                }
                ii = indexOf.call(this._shortMonthsParse, llc);
                return ii !== -1 ? ii : null
            }
        }
    }
    function localeMonthsParse(monthName, format, strict) {
        var i, mom, regex;
        if (this._monthsParseExact) {
            return handleStrictParse.call(this, monthName, format, strict)
        }
        if (!this._monthsParse) {
            this._monthsParse = [];
            this._longMonthsParse = [];
            this._shortMonthsParse = []
        }
        for (i = 0; i < 12; i++) {
            mom = createUTC([2e3, i]);
            if (strict && !this._longMonthsParse[i]) {
                this._longMonthsParse[i] = new RegExp("^" + this.months(mom, "").replace(".", "") + "$","i");
                this._shortMonthsParse[i] = new RegExp("^" + this.monthsShort(mom, "").replace(".", "") + "$","i")
            }
            if (!strict && !this._monthsParse[i]) {
                regex = "^" + this.months(mom, "") + "|^" + this.monthsShort(mom, "");
                this._monthsParse[i] = new RegExp(regex.replace(".", ""),"i")
            }
            if (strict && format === "MMMM" && this._longMonthsParse[i].test(monthName)) {
                return i
            } else if (strict && format === "MMM" && this._shortMonthsParse[i].test(monthName)) {
                return i
            } else if (!strict && this._monthsParse[i].test(monthName)) {
                return i
            }
        }
    }
    function setMonth(mom, value) {
        var dayOfMonth;
        if (!mom.isValid()) {
            return mom
        }
        if (typeof value === "string") {
            if (/^\d+$/.test(value)) {
                value = toInt(value)
            } else {
                value = mom.localeData().monthsParse(value);
                if (!isNumber(value)) {
                    return mom
                }
            }
        }
        dayOfMonth = Math.min(mom.date(), daysInMonth(mom.year(), value));
        mom._d["set" + (mom._isUTC ? "UTC" : "") + "Month"](value, dayOfMonth);
        return mom
    }
    function getSetMonth(value) {
        if (value != null) {
            setMonth(this, value);
            hooks.updateOffset(this, true);
            return this
        } else {
            return get(this, "Month")
        }
    }
    function getDaysInMonth() {
        return daysInMonth(this.year(), this.month())
    }
    var defaultMonthsShortRegex = matchWord;
    function monthsShortRegex(isStrict) {
        if (this._monthsParseExact) {
            if (!hasOwnProp(this, "_monthsRegex")) {
                computeMonthsParse.call(this)
            }
            if (isStrict) {
                return this._monthsShortStrictRegex
            } else {
                return this._monthsShortRegex
            }
        } else {
            if (!hasOwnProp(this, "_monthsShortRegex")) {
                this._monthsShortRegex = defaultMonthsShortRegex
            }
            return this._monthsShortStrictRegex && isStrict ? this._monthsShortStrictRegex : this._monthsShortRegex
        }
    }
    var defaultMonthsRegex = matchWord;
    function monthsRegex(isStrict) {
        if (this._monthsParseExact) {
            if (!hasOwnProp(this, "_monthsRegex")) {
                computeMonthsParse.call(this)
            }
            if (isStrict) {
                return this._monthsStrictRegex
            } else {
                return this._monthsRegex
            }
        } else {
            if (!hasOwnProp(this, "_monthsRegex")) {
                this._monthsRegex = defaultMonthsRegex
            }
            return this._monthsStrictRegex && isStrict ? this._monthsStrictRegex : this._monthsRegex
        }
    }
    function computeMonthsParse() {
        function cmpLenRev(a, b) {
            return b.length - a.length
        }
        var shortPieces = [], longPieces = [], mixedPieces = [], i, mom;
        for (i = 0; i < 12; i++) {
            mom = createUTC([2e3, i]);
            shortPieces.push(this.monthsShort(mom, ""));
            longPieces.push(this.months(mom, ""));
            mixedPieces.push(this.months(mom, ""));
            mixedPieces.push(this.monthsShort(mom, ""))
        }
        shortPieces.sort(cmpLenRev);
        longPieces.sort(cmpLenRev);
        mixedPieces.sort(cmpLenRev);
        for (i = 0; i < 12; i++) {
            shortPieces[i] = regexEscape(shortPieces[i]);
            longPieces[i] = regexEscape(longPieces[i])
        }
        for (i = 0; i < 24; i++) {
            mixedPieces[i] = regexEscape(mixedPieces[i])
        }
        this._monthsRegex = new RegExp("^(" + mixedPieces.join("|") + ")","i");
        this._monthsShortRegex = this._monthsRegex;
        this._monthsStrictRegex = new RegExp("^(" + longPieces.join("|") + ")","i");
        this._monthsShortStrictRegex = new RegExp("^(" + shortPieces.join("|") + ")","i")
    }
    function createDate(y, m, d, h, M, s, ms) {
        var date = new Date(y,m,d,h,M,s,ms);
        if (y < 100 && y >= 0 && isFinite(date.getFullYear())) {
            date.setFullYear(y)
        }
        return date
    }
    function createUTCDate(y) {
        var date = new Date(Date.UTC.apply(null, arguments));
        if (y < 100 && y >= 0 && isFinite(date.getUTCFullYear())) {
            date.setUTCFullYear(y)
        }
        return date
    }
    function firstWeekOffset(year, dow, doy) {
        var fwd = 7 + dow - doy
          , fwdlw = (7 + createUTCDate(year, 0, fwd).getUTCDay() - dow) % 7;
        return -fwdlw + fwd - 1
    }
    function dayOfYearFromWeeks(year, week, weekday, dow, doy) {
        var localWeekday = (7 + weekday - dow) % 7, weekOffset = firstWeekOffset(year, dow, doy), dayOfYear = 1 + 7 * (week - 1) + localWeekday + weekOffset, resYear, resDayOfYear;
        if (dayOfYear <= 0) {
            resYear = year - 1;
            resDayOfYear = daysInYear(resYear) + dayOfYear
        } else if (dayOfYear > daysInYear(year)) {
            resYear = year + 1;
            resDayOfYear = dayOfYear - daysInYear(year)
        } else {
            resYear = year;
            resDayOfYear = dayOfYear
        }
        return {
            year: resYear,
            dayOfYear: resDayOfYear
        }
    }
    function weekOfYear(mom, dow, doy) {
        var weekOffset = firstWeekOffset(mom.year(), dow, doy), week = Math.floor((mom.dayOfYear() - weekOffset - 1) / 7) + 1, resWeek, resYear;
        if (week < 1) {
            resYear = mom.year() - 1;
            resWeek = week + weeksInYear(resYear, dow, doy)
        } else if (week > weeksInYear(mom.year(), dow, doy)) {
            resWeek = week - weeksInYear(mom.year(), dow, doy);
            resYear = mom.year() + 1
        } else {
            resYear = mom.year();
            resWeek = week
        }
        return {
            week: resWeek,
            year: resYear
        }
    }
    function weeksInYear(year, dow, doy) {
        var weekOffset = firstWeekOffset(year, dow, doy)
          , weekOffsetNext = firstWeekOffset(year + 1, dow, doy);
        return (daysInYear(year) - weekOffset + weekOffsetNext) / 7
    }
    addFormatToken("w", ["ww", 2], "wo", "week");
    addFormatToken("W", ["WW", 2], "Wo", "isoWeek");
    addUnitAlias("week", "w");
    addUnitAlias("isoWeek", "W");
    addUnitPriority("week", 5);
    addUnitPriority("isoWeek", 5);
    addRegexToken("w", match1to2);
    addRegexToken("ww", match1to2, match2);
    addRegexToken("W", match1to2);
    addRegexToken("WW", match1to2, match2);
    addWeekParseToken(["w", "ww", "W", "WW"], function(input, week, config, token) {
        week[token.substr(0, 1)] = toInt(input)
    });
    function localeWeek(mom) {
        return weekOfYear(mom, this._week.dow, this._week.doy).week
    }
    var defaultLocaleWeek = {
        dow: 0,
        doy: 6
    };
    function localeFirstDayOfWeek() {
        return this._week.dow
    }
    function localeFirstDayOfYear() {
        return this._week.doy
    }
    function getSetWeek(input) {
        var week = this.localeData().week(this);
        return input == null ? week : this.add((input - week) * 7, "d")
    }
    function getSetISOWeek(input) {
        var week = weekOfYear(this, 1, 4).week;
        return input == null ? week : this.add((input - week) * 7, "d")
    }
    addFormatToken("d", 0, "do", "day");
    addFormatToken("dd", 0, 0, function(format) {
        return this.localeData().weekdaysMin(this, format)
    });
    addFormatToken("ddd", 0, 0, function(format) {
        return this.localeData().weekdaysShort(this, format)
    });
    addFormatToken("dddd", 0, 0, function(format) {
        return this.localeData().weekdays(this, format)
    });
    addFormatToken("e", 0, 0, "weekday");
    addFormatToken("E", 0, 0, "isoWeekday");
    addUnitAlias("day", "d");
    addUnitAlias("weekday", "e");
    addUnitAlias("isoWeekday", "E");
    addUnitPriority("day", 11);
    addUnitPriority("weekday", 11);
    addUnitPriority("isoWeekday", 11);
    addRegexToken("d", match1to2);
    addRegexToken("e", match1to2);
    addRegexToken("E", match1to2);
    addRegexToken("dd", function(isStrict, locale) {
        return locale.weekdaysMinRegex(isStrict)
    });
    addRegexToken("ddd", function(isStrict, locale) {
        return locale.weekdaysShortRegex(isStrict)
    });
    addRegexToken("dddd", function(isStrict, locale) {
        return locale.weekdaysRegex(isStrict)
    });
    addWeekParseToken(["dd", "ddd", "dddd"], function(input, week, config, token) {
        var weekday = config._locale.weekdaysParse(input, token, config._strict);
        if (weekday != null) {
            week.d = weekday
        } else {
            getParsingFlags(config).invalidWeekday = input
        }
    });
    addWeekParseToken(["d", "e", "E"], function(input, week, config, token) {
        week[token] = toInt(input)
    });
    function parseWeekday(input, locale) {
        if (typeof input !== "string") {
            return input
        }
        if (!isNaN(input)) {
            return parseInt(input, 10)
        }
        input = locale.weekdaysParse(input);
        if (typeof input === "number") {
            return input
        }
        return null
    }
    function parseIsoWeekday(input, locale) {
        if (typeof input === "string") {
            return locale.weekdaysParse(input) % 7 || 7
        }
        return isNaN(input) ? null : input
    }
    var defaultLocaleWeekdays = "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");
    function localeWeekdays(m, format) {
        if (!m) {
            return isArray(this._weekdays) ? this._weekdays : this._weekdays["standalone"]
        }
        return isArray(this._weekdays) ? this._weekdays[m.day()] : this._weekdays[this._weekdays.isFormat.test(format) ? "format" : "standalone"][m.day()]
    }
    var defaultLocaleWeekdaysShort = "Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");
    function localeWeekdaysShort(m) {
        return m ? this._weekdaysShort[m.day()] : this._weekdaysShort
    }
    var defaultLocaleWeekdaysMin = "Su_Mo_Tu_We_Th_Fr_Sa".split("_");
    function localeWeekdaysMin(m) {
        return m ? this._weekdaysMin[m.day()] : this._weekdaysMin
    }
    function handleStrictParse$1(weekdayName, format, strict) {
        var i, ii, mom, llc = weekdayName.toLocaleLowerCase();
        if (!this._weekdaysParse) {
            this._weekdaysParse = [];
            this._shortWeekdaysParse = [];
            this._minWeekdaysParse = [];
            for (i = 0; i < 7; ++i) {
                mom = createUTC([2e3, 1]).day(i);
                this._minWeekdaysParse[i] = this.weekdaysMin(mom, "").toLocaleLowerCase();
                this._shortWeekdaysParse[i] = this.weekdaysShort(mom, "").toLocaleLowerCase();
                this._weekdaysParse[i] = this.weekdays(mom, "").toLocaleLowerCase()
            }
        }
        if (strict) {
            if (format === "dddd") {
                ii = indexOf.call(this._weekdaysParse, llc);
                return ii !== -1 ? ii : null
            } else if (format === "ddd") {
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                return ii !== -1 ? ii : null
            } else {
                ii = indexOf.call(this._minWeekdaysParse, llc);
                return ii !== -1 ? ii : null
            }
        } else {
            if (format === "dddd") {
                ii = indexOf.call(this._weekdaysParse, llc);
                if (ii !== -1) {
                    return ii
                }
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                if (ii !== -1) {
                    return ii
                }
                ii = indexOf.call(this._minWeekdaysParse, llc);
                return ii !== -1 ? ii : null
            } else if (format === "ddd") {
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                if (ii !== -1) {
                    return ii
                }
                ii = indexOf.call(this._weekdaysParse, llc);
                if (ii !== -1) {
                    return ii
                }
                ii = indexOf.call(this._minWeekdaysParse, llc);
                return ii !== -1 ? ii : null
            } else {
                ii = indexOf.call(this._minWeekdaysParse, llc);
                if (ii !== -1) {
                    return ii
                }
                ii = indexOf.call(this._weekdaysParse, llc);
                if (ii !== -1) {
                    return ii
                }
                ii = indexOf.call(this._shortWeekdaysParse, llc);
                return ii !== -1 ? ii : null
            }
        }
    }
    function localeWeekdaysParse(weekdayName, format, strict) {
        var i, mom, regex;
        if (this._weekdaysParseExact) {
            return handleStrictParse$1.call(this, weekdayName, format, strict)
        }
        if (!this._weekdaysParse) {
            this._weekdaysParse = [];
            this._minWeekdaysParse = [];
            this._shortWeekdaysParse = [];
            this._fullWeekdaysParse = []
        }
        for (i = 0; i < 7; i++) {
            mom = createUTC([2e3, 1]).day(i);
            if (strict && !this._fullWeekdaysParse[i]) {
                this._fullWeekdaysParse[i] = new RegExp("^" + this.weekdays(mom, "").replace(".", "\\.?") + "$","i");
                this._shortWeekdaysParse[i] = new RegExp("^" + this.weekdaysShort(mom, "").replace(".", "\\.?") + "$","i");
                this._minWeekdaysParse[i] = new RegExp("^" + this.weekdaysMin(mom, "").replace(".", "\\.?") + "$","i")
            }
            if (!this._weekdaysParse[i]) {
                regex = "^" + this.weekdays(mom, "") + "|^" + this.weekdaysShort(mom, "") + "|^" + this.weekdaysMin(mom, "");
                this._weekdaysParse[i] = new RegExp(regex.replace(".", ""),"i")
            }
            if (strict && format === "dddd" && this._fullWeekdaysParse[i].test(weekdayName)) {
                return i
            } else if (strict && format === "ddd" && this._shortWeekdaysParse[i].test(weekdayName)) {
                return i
            } else if (strict && format === "dd" && this._minWeekdaysParse[i].test(weekdayName)) {
                return i
            } else if (!strict && this._weekdaysParse[i].test(weekdayName)) {
                return i
            }
        }
    }
    function getSetDayOfWeek(input) {
        if (!this.isValid()) {
            return input != null ? this : NaN
        }
        var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
        if (input != null) {
            input = parseWeekday(input, this.localeData());
            return this.add(input - day, "d")
        } else {
            return day
        }
    }
    function getSetLocaleDayOfWeek(input) {
        if (!this.isValid()) {
            return input != null ? this : NaN
        }
        var weekday = (this.day() + 7 - this.localeData()._week.dow) % 7;
        return input == null ? weekday : this.add(input - weekday, "d")
    }
    function getSetISODayOfWeek(input) {
        if (!this.isValid()) {
            return input != null ? this : NaN
        }
        if (input != null) {
            var weekday = parseIsoWeekday(input, this.localeData());
            return this.day(this.day() % 7 ? weekday : weekday - 7)
        } else {
            return this.day() || 7
        }
    }
    var defaultWeekdaysRegex = matchWord;
    function weekdaysRegex(isStrict) {
        if (this._weekdaysParseExact) {
            if (!hasOwnProp(this, "_weekdaysRegex")) {
                computeWeekdaysParse.call(this)
            }
            if (isStrict) {
                return this._weekdaysStrictRegex
            } else {
                return this._weekdaysRegex
            }
        } else {
            if (!hasOwnProp(this, "_weekdaysRegex")) {
                this._weekdaysRegex = defaultWeekdaysRegex
            }
            return this._weekdaysStrictRegex && isStrict ? this._weekdaysStrictRegex : this._weekdaysRegex
        }
    }
    var defaultWeekdaysShortRegex = matchWord;
    function weekdaysShortRegex(isStrict) {
        if (this._weekdaysParseExact) {
            if (!hasOwnProp(this, "_weekdaysRegex")) {
                computeWeekdaysParse.call(this)
            }
            if (isStrict) {
                return this._weekdaysShortStrictRegex
            } else {
                return this._weekdaysShortRegex
            }
        } else {
            if (!hasOwnProp(this, "_weekdaysShortRegex")) {
                this._weekdaysShortRegex = defaultWeekdaysShortRegex
            }
            return this._weekdaysShortStrictRegex && isStrict ? this._weekdaysShortStrictRegex : this._weekdaysShortRegex
        }
    }
    var defaultWeekdaysMinRegex = matchWord;
    function weekdaysMinRegex(isStrict) {
        if (this._weekdaysParseExact) {
            if (!hasOwnProp(this, "_weekdaysRegex")) {
                computeWeekdaysParse.call(this)
            }
            if (isStrict) {
                return this._weekdaysMinStrictRegex
            } else {
                return this._weekdaysMinRegex
            }
        } else {
            if (!hasOwnProp(this, "_weekdaysMinRegex")) {
                this._weekdaysMinRegex = defaultWeekdaysMinRegex
            }
            return this._weekdaysMinStrictRegex && isStrict ? this._weekdaysMinStrictRegex : this._weekdaysMinRegex
        }
    }
    function computeWeekdaysParse() {
        function cmpLenRev(a, b) {
            return b.length - a.length
        }
        var minPieces = [], shortPieces = [], longPieces = [], mixedPieces = [], i, mom, minp, shortp, longp;
        for (i = 0; i < 7; i++) {
            mom = createUTC([2e3, 1]).day(i);
            minp = this.weekdaysMin(mom, "");
            shortp = this.weekdaysShort(mom, "");
            longp = this.weekdays(mom, "");
            minPieces.push(minp);
            shortPieces.push(shortp);
            longPieces.push(longp);
            mixedPieces.push(minp);
            mixedPieces.push(shortp);
            mixedPieces.push(longp)
        }
        minPieces.sort(cmpLenRev);
        shortPieces.sort(cmpLenRev);
        longPieces.sort(cmpLenRev);
        mixedPieces.sort(cmpLenRev);
        for (i = 0; i < 7; i++) {
            shortPieces[i] = regexEscape(shortPieces[i]);
            longPieces[i] = regexEscape(longPieces[i]);
            mixedPieces[i] = regexEscape(mixedPieces[i])
        }
        this._weekdaysRegex = new RegExp("^(" + mixedPieces.join("|") + ")","i");
        this._weekdaysShortRegex = this._weekdaysRegex;
        this._weekdaysMinRegex = this._weekdaysRegex;
        this._weekdaysStrictRegex = new RegExp("^(" + longPieces.join("|") + ")","i");
        this._weekdaysShortStrictRegex = new RegExp("^(" + shortPieces.join("|") + ")","i");
        this._weekdaysMinStrictRegex = new RegExp("^(" + minPieces.join("|") + ")","i")
    }
    function hFormat() {
        return this.hours() % 12 || 12
    }
    function kFormat() {
        return this.hours() || 24
    }
    addFormatToken("H", ["HH", 2], 0, "hour");
    addFormatToken("h", ["hh", 2], 0, hFormat);
    addFormatToken("k", ["kk", 2], 0, kFormat);
    addFormatToken("hmm", 0, 0, function() {
        return "" + hFormat.apply(this) + zeroFill(this.minutes(), 2)
    });
    addFormatToken("hmmss", 0, 0, function() {
        return "" + hFormat.apply(this) + zeroFill(this.minutes(), 2) + zeroFill(this.seconds(), 2)
    });
    addFormatToken("Hmm", 0, 0, function() {
        return "" + this.hours() + zeroFill(this.minutes(), 2)
    });
    addFormatToken("Hmmss", 0, 0, function() {
        return "" + this.hours() + zeroFill(this.minutes(), 2) + zeroFill(this.seconds(), 2)
    });
    function meridiem(token, lowercase) {
        addFormatToken(token, 0, 0, function() {
            return this.localeData().meridiem(this.hours(), this.minutes(), lowercase)
        })
    }
    meridiem("a", true);
    meridiem("A", false);
    addUnitAlias("hour", "h");
    addUnitPriority("hour", 13);
    function matchMeridiem(isStrict, locale) {
        return locale._meridiemParse
    }
    addRegexToken("a", matchMeridiem);
    addRegexToken("A", matchMeridiem);
    addRegexToken("H", match1to2);
    addRegexToken("h", match1to2);
    addRegexToken("k", match1to2);
    addRegexToken("HH", match1to2, match2);
    addRegexToken("hh", match1to2, match2);
    addRegexToken("kk", match1to2, match2);
    addRegexToken("hmm", match3to4);
    addRegexToken("hmmss", match5to6);
    addRegexToken("Hmm", match3to4);
    addRegexToken("Hmmss", match5to6);
    addParseToken(["H", "HH"], HOUR);
    addParseToken(["k", "kk"], function(input, array, config) {
        var kInput = toInt(input);
        array[HOUR] = kInput === 24 ? 0 : kInput
    });
    addParseToken(["a", "A"], function(input, array, config) {
        config._isPm = config._locale.isPM(input);
        config._meridiem = input
    });
    addParseToken(["h", "hh"], function(input, array, config) {
        array[HOUR] = toInt(input);
        getParsingFlags(config).bigHour = true
    });
    addParseToken("hmm", function(input, array, config) {
        var pos = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos));
        array[MINUTE] = toInt(input.substr(pos));
        getParsingFlags(config).bigHour = true
    });
    addParseToken("hmmss", function(input, array, config) {
        var pos1 = input.length - 4;
        var pos2 = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos1));
        array[MINUTE] = toInt(input.substr(pos1, 2));
        array[SECOND] = toInt(input.substr(pos2));
        getParsingFlags(config).bigHour = true
    });
    addParseToken("Hmm", function(input, array, config) {
        var pos = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos));
        array[MINUTE] = toInt(input.substr(pos))
    });
    addParseToken("Hmmss", function(input, array, config) {
        var pos1 = input.length - 4;
        var pos2 = input.length - 2;
        array[HOUR] = toInt(input.substr(0, pos1));
        array[MINUTE] = toInt(input.substr(pos1, 2));
        array[SECOND] = toInt(input.substr(pos2))
    });
    function localeIsPM(input) {
        return (input + "").toLowerCase().charAt(0) === "p"
    }
    var defaultLocaleMeridiemParse = /[ap]\.?m?\.?/i;
    function localeMeridiem(hours, minutes, isLower) {
        if (hours > 11) {
            return isLower ? "pm" : "PM"
        } else {
            return isLower ? "am" : "AM"
        }
    }
    var getSetHour = makeGetSet("Hours", true);
    var baseConfig = {
        calendar: defaultCalendar,
        longDateFormat: defaultLongDateFormat,
        invalidDate: defaultInvalidDate,
        ordinal: defaultOrdinal,
        dayOfMonthOrdinalParse: defaultDayOfMonthOrdinalParse,
        relativeTime: defaultRelativeTime,
        months: defaultLocaleMonths,
        monthsShort: defaultLocaleMonthsShort,
        week: defaultLocaleWeek,
        weekdays: defaultLocaleWeekdays,
        weekdaysMin: defaultLocaleWeekdaysMin,
        weekdaysShort: defaultLocaleWeekdaysShort,
        meridiemParse: defaultLocaleMeridiemParse
    };
    var locales = {};
    var localeFamilies = {};
    var globalLocale;
    function normalizeLocale(key) {
        return key ? key.toLowerCase().replace("_", "-") : key
    }
    function chooseLocale(names) {
        var i = 0, j, next, locale, split;
        while (i < names.length) {
            split = normalizeLocale(names[i]).split("-");
            j = split.length;
            next = normalizeLocale(names[i + 1]);
            next = next ? next.split("-") : null;
            while (j > 0) {
                locale = loadLocale(split.slice(0, j).join("-"));
                if (locale) {
                    return locale
                }
                if (next && next.length >= j && compareArrays(split, next, true) >= j - 1) {
                    break
                }
                j--
            }
            i++
        }
        return globalLocale
    }
    function loadLocale(name) {
        var oldLocale = null;
        if (!locales[name] && typeof module !== "undefined" && module && module.exports) {
            try {
                oldLocale = globalLocale._abbr;
                var aliasedRequire = require;
                aliasedRequire("./locale/" + name);
                getSetGlobalLocale(oldLocale)
            } catch (e) {}
        }
        return locales[name]
    }
    function getSetGlobalLocale(key, values) {
        var data;
        if (key) {
            if (isUndefined(values)) {
                data = getLocale(key)
            } else {
                data = defineLocale(key, values)
            }
            if (data) {
                globalLocale = data
            } else {
                if (typeof console !== "undefined" && console.warn) {
                    console.warn("Locale " + key + " not found. Did you forget to load it?")
                }
            }
        }
        return globalLocale._abbr
    }
    function defineLocale(name, config) {
        if (config !== null) {
            var locale, parentConfig = baseConfig;
            config.abbr = name;
            if (locales[name] != null) {
                deprecateSimple("defineLocaleOverride", "use moment.updateLocale(localeName, config) to change " + "an existing locale. moment.defineLocale(localeName, " + "config) should only be used for creating a new locale " + "See http://momentjs.com/guides/#/warnings/define-locale/ for more info.");
                parentConfig = locales[name]._config
            } else if (config.parentLocale != null) {
                if (locales[config.parentLocale] != null) {
                    parentConfig = locales[config.parentLocale]._config
                } else {
                    locale = loadLocale(config.parentLocale);
                    if (locale != null) {
                        parentConfig = locale._config
                    } else {
                        if (!localeFamilies[config.parentLocale]) {
                            localeFamilies[config.parentLocale] = []
                        }
                        localeFamilies[config.parentLocale].push({
                            name: name,
                            config: config
                        });
                        return null
                    }
                }
            }
            locales[name] = new Locale(mergeConfigs(parentConfig, config));
            if (localeFamilies[name]) {
                localeFamilies[name].forEach(function(x) {
                    defineLocale(x.name, x.config)
                })
            }
            getSetGlobalLocale(name);
            return locales[name]
        } else {
            delete locales[name];
            return null
        }
    }
    function updateLocale(name, config) {
        if (config != null) {
            var locale, tmpLocale, parentConfig = baseConfig;
            tmpLocale = loadLocale(name);
            if (tmpLocale != null) {
                parentConfig = tmpLocale._config
            }
            config = mergeConfigs(parentConfig, config);
            locale = new Locale(config);
            locale.parentLocale = locales[name];
            locales[name] = locale;
            getSetGlobalLocale(name)
        } else {
            if (locales[name] != null) {
                if (locales[name].parentLocale != null) {
                    locales[name] = locales[name].parentLocale
                } else if (locales[name] != null) {
                    delete locales[name]
                }
            }
        }
        return locales[name]
    }
    function getLocale(key) {
        var locale;
        if (key && key._locale && key._locale._abbr) {
            key = key._locale._abbr
        }
        if (!key) {
            return globalLocale
        }
        if (!isArray(key)) {
            locale = loadLocale(key);
            if (locale) {
                return locale
            }
            key = [key]
        }
        return chooseLocale(key)
    }
    function listLocales() {
        return keys(locales)
    }
    function checkOverflow(m) {
        var overflow;
        var a = m._a;
        if (a && getParsingFlags(m).overflow === -2) {
            overflow = a[MONTH] < 0 || a[MONTH] > 11 ? MONTH : a[DATE] < 1 || a[DATE] > daysInMonth(a[YEAR], a[MONTH]) ? DATE : a[HOUR] < 0 || a[HOUR] > 24 || a[HOUR] === 24 && (a[MINUTE] !== 0 || a[SECOND] !== 0 || a[MILLISECOND] !== 0) ? HOUR : a[MINUTE] < 0 || a[MINUTE] > 59 ? MINUTE : a[SECOND] < 0 || a[SECOND] > 59 ? SECOND : a[MILLISECOND] < 0 || a[MILLISECOND] > 999 ? MILLISECOND : -1;
            if (getParsingFlags(m)._overflowDayOfYear && (overflow < YEAR || overflow > DATE)) {
                overflow = DATE
            }
            if (getParsingFlags(m)._overflowWeeks && overflow === -1) {
                overflow = WEEK
            }
            if (getParsingFlags(m)._overflowWeekday && overflow === -1) {
                overflow = WEEKDAY
            }
            getParsingFlags(m).overflow = overflow
        }
        return m
    }
    function defaults(a, b, c) {
        if (a != null) {
            return a
        }
        if (b != null) {
            return b
        }
        return c
    }
    function currentDateArray(config) {
        var nowValue = new Date(hooks.now());
        if (config._useUTC) {
            return [nowValue.getUTCFullYear(), nowValue.getUTCMonth(), nowValue.getUTCDate()]
        }
        return [nowValue.getFullYear(), nowValue.getMonth(), nowValue.getDate()]
    }
    function configFromArray(config) {
        var i, date, input = [], currentDate, expectedWeekday, yearToUse;
        if (config._d) {
            return
        }
        currentDate = currentDateArray(config);
        if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {
            dayOfYearFromWeekInfo(config)
        }
        if (config._dayOfYear != null) {
            yearToUse = defaults(config._a[YEAR], currentDate[YEAR]);
            if (config._dayOfYear > daysInYear(yearToUse) || config._dayOfYear === 0) {
                getParsingFlags(config)._overflowDayOfYear = true
            }
            date = createUTCDate(yearToUse, 0, config._dayOfYear);
            config._a[MONTH] = date.getUTCMonth();
            config._a[DATE] = date.getUTCDate()
        }
        for (i = 0; i < 3 && config._a[i] == null; ++i) {
            config._a[i] = input[i] = currentDate[i]
        }
        for (; i < 7; i++) {
            config._a[i] = input[i] = config._a[i] == null ? i === 2 ? 1 : 0 : config._a[i]
        }
        if (config._a[HOUR] === 24 && config._a[MINUTE] === 0 && config._a[SECOND] === 0 && config._a[MILLISECOND] === 0) {
            config._nextDay = true;
            config._a[HOUR] = 0
        }
        config._d = (config._useUTC ? createUTCDate : createDate).apply(null, input);
        expectedWeekday = config._useUTC ? config._d.getUTCDay() : config._d.getDay();
        if (config._tzm != null) {
            config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm)
        }
        if (config._nextDay) {
            config._a[HOUR] = 24
        }
        if (config._w && typeof config._w.d !== "undefined" && config._w.d !== expectedWeekday) {
            getParsingFlags(config).weekdayMismatch = true
        }
    }
    function dayOfYearFromWeekInfo(config) {
        var w, weekYear, week, weekday, dow, doy, temp, weekdayOverflow;
        w = config._w;
        if (w.GG != null || w.W != null || w.E != null) {
            dow = 1;
            doy = 4;
            weekYear = defaults(w.GG, config._a[YEAR], weekOfYear(createLocal(), 1, 4).year);
            week = defaults(w.W, 1);
            weekday = defaults(w.E, 1);
            if (weekday < 1 || weekday > 7) {
                weekdayOverflow = true
            }
        } else {
            dow = config._locale._week.dow;
            doy = config._locale._week.doy;
            var curWeek = weekOfYear(createLocal(), dow, doy);
            weekYear = defaults(w.gg, config._a[YEAR], curWeek.year);
            week = defaults(w.w, curWeek.week);
            if (w.d != null) {
                weekday = w.d;
                if (weekday < 0 || weekday > 6) {
                    weekdayOverflow = true
                }
            } else if (w.e != null) {
                weekday = w.e + dow;
                if (w.e < 0 || w.e > 6) {
                    weekdayOverflow = true
                }
            } else {
                weekday = dow
            }
        }
        if (week < 1 || week > weeksInYear(weekYear, dow, doy)) {
            getParsingFlags(config)._overflowWeeks = true
        } else if (weekdayOverflow != null) {
            getParsingFlags(config)._overflowWeekday = true
        } else {
            temp = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy);
            config._a[YEAR] = temp.year;
            config._dayOfYear = temp.dayOfYear
        }
    }
    var extendedIsoRegex = /^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;
    var basicIsoRegex = /^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;
    var tzRegex = /Z|[+-]\d\d(?::?\d\d)?/;
    var isoDates = [["YYYYYY-MM-DD", /[+-]\d{6}-\d\d-\d\d/], ["YYYY-MM-DD", /\d{4}-\d\d-\d\d/], ["GGGG-[W]WW-E", /\d{4}-W\d\d-\d/], ["GGGG-[W]WW", /\d{4}-W\d\d/, false], ["YYYY-DDD", /\d{4}-\d{3}/], ["YYYY-MM", /\d{4}-\d\d/, false], ["YYYYYYMMDD", /[+-]\d{10}/], ["YYYYMMDD", /\d{8}/], ["GGGG[W]WWE", /\d{4}W\d{3}/], ["GGGG[W]WW", /\d{4}W\d{2}/, false], ["YYYYDDD", /\d{7}/]];
    var isoTimes = [["HH:mm:ss.SSSS", /\d\d:\d\d:\d\d\.\d+/], ["HH:mm:ss,SSSS", /\d\d:\d\d:\d\d,\d+/], ["HH:mm:ss", /\d\d:\d\d:\d\d/], ["HH:mm", /\d\d:\d\d/], ["HHmmss.SSSS", /\d\d\d\d\d\d\.\d+/], ["HHmmss,SSSS", /\d\d\d\d\d\d,\d+/], ["HHmmss", /\d\d\d\d\d\d/], ["HHmm", /\d\d\d\d/], ["HH", /\d\d/]];
    var aspNetJsonRegex = /^\/?Date\((\-?\d+)/i;
    function configFromISO(config) {
        var i, l, string = config._i, match = extendedIsoRegex.exec(string) || basicIsoRegex.exec(string), allowTime, dateFormat, timeFormat, tzFormat;
        if (match) {
            getParsingFlags(config).iso = true;
            for (i = 0,
            l = isoDates.length; i < l; i++) {
                if (isoDates[i][1].exec(match[1])) {
                    dateFormat = isoDates[i][0];
                    allowTime = isoDates[i][2] !== false;
                    break
                }
            }
            if (dateFormat == null) {
                config._isValid = false;
                return
            }
            if (match[3]) {
                for (i = 0,
                l = isoTimes.length; i < l; i++) {
                    if (isoTimes[i][1].exec(match[3])) {
                        timeFormat = (match[2] || " ") + isoTimes[i][0];
                        break
                    }
                }
                if (timeFormat == null) {
                    config._isValid = false;
                    return
                }
            }
            if (!allowTime && timeFormat != null) {
                config._isValid = false;
                return
            }
            if (match[4]) {
                if (tzRegex.exec(match[4])) {
                    tzFormat = "Z"
                } else {
                    config._isValid = false;
                    return
                }
            }
            config._f = dateFormat + (timeFormat || "") + (tzFormat || "");
            configFromStringAndFormat(config)
        } else {
            config._isValid = false
        }
    }
    var rfc2822 = /^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;
    function extractFromRFC2822Strings(yearStr, monthStr, dayStr, hourStr, minuteStr, secondStr) {
        var result = [untruncateYear(yearStr), defaultLocaleMonthsShort.indexOf(monthStr), parseInt(dayStr, 10), parseInt(hourStr, 10), parseInt(minuteStr, 10)];
        if (secondStr) {
            result.push(parseInt(secondStr, 10))
        }
        return result
    }
    function untruncateYear(yearStr) {
        var year = parseInt(yearStr, 10);
        if (year <= 49) {
            return 2e3 + year
        } else if (year <= 999) {
            return 1900 + year
        }
        return year
    }
    function preprocessRFC2822(s) {
        return s.replace(/\([^)]*\)|[\n\t]/g, " ").replace(/(\s\s+)/g, " ").replace(/^\s\s*/, "").replace(/\s\s*$/, "")
    }
    function checkWeekday(weekdayStr, parsedInput, config) {
        if (weekdayStr) {
            var weekdayProvided = defaultLocaleWeekdaysShort.indexOf(weekdayStr)
              , weekdayActual = new Date(parsedInput[0],parsedInput[1],parsedInput[2]).getDay();
            if (weekdayProvided !== weekdayActual) {
                getParsingFlags(config).weekdayMismatch = true;
                config._isValid = false;
                return false
            }
        }
        return true
    }
    var obsOffsets = {
        UT: 0,
        GMT: 0,
        EDT: -4 * 60,
        EST: -5 * 60,
        CDT: -5 * 60,
        CST: -6 * 60,
        MDT: -6 * 60,
        MST: -7 * 60,
        PDT: -7 * 60,
        PST: -8 * 60
    };
    function calculateOffset(obsOffset, militaryOffset, numOffset) {
        if (obsOffset) {
            return obsOffsets[obsOffset]
        } else if (militaryOffset) {
            return 0
        } else {
            var hm = parseInt(numOffset, 10);
            var m = hm % 100
              , h = (hm - m) / 100;
            return h * 60 + m
        }
    }
    function configFromRFC2822(config) {
        var match = rfc2822.exec(preprocessRFC2822(config._i));
        if (match) {
            var parsedArray = extractFromRFC2822Strings(match[4], match[3], match[2], match[5], match[6], match[7]);
            if (!checkWeekday(match[1], parsedArray, config)) {
                return
            }
            config._a = parsedArray;
            config._tzm = calculateOffset(match[8], match[9], match[10]);
            config._d = createUTCDate.apply(null, config._a);
            config._d.setUTCMinutes(config._d.getUTCMinutes() - config._tzm);
            getParsingFlags(config).rfc2822 = true
        } else {
            config._isValid = false
        }
    }
    function configFromString(config) {
        var matched = aspNetJsonRegex.exec(config._i);
        if (matched !== null) {
            config._d = new Date(+matched[1]);
            return
        }
        configFromISO(config);
        if (config._isValid === false) {
            delete config._isValid
        } else {
            return
        }
        configFromRFC2822(config);
        if (config._isValid === false) {
            delete config._isValid
        } else {
            return
        }
        hooks.createFromInputFallback(config)
    }
    hooks.createFromInputFallback = deprecate("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), " + "which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are " + "discouraged and will be removed in an upcoming major release. Please refer to " + "http://momentjs.com/guides/#/warnings/js-date/ for more info.", function(config) {
        config._d = new Date(config._i + (config._useUTC ? " UTC" : ""))
    });
    hooks.ISO_8601 = function() {}
    ;
    hooks.RFC_2822 = function() {}
    ;
    function configFromStringAndFormat(config) {
        if (config._f === hooks.ISO_8601) {
            configFromISO(config);
            return
        }
        if (config._f === hooks.RFC_2822) {
            configFromRFC2822(config);
            return
        }
        config._a = [];
        getParsingFlags(config).empty = true;
        var string = "" + config._i, i, parsedInput, tokens, token, skipped, stringLength = string.length, totalParsedInputLength = 0;
        tokens = expandFormat(config._f, config._locale).match(formattingTokens) || [];
        for (i = 0; i < tokens.length; i++) {
            token = tokens[i];
            parsedInput = (string.match(getParseRegexForToken(token, config)) || [])[0];
            if (parsedInput) {
                skipped = string.substr(0, string.indexOf(parsedInput));
                if (skipped.length > 0) {
                    getParsingFlags(config).unusedInput.push(skipped)
                }
                string = string.slice(string.indexOf(parsedInput) + parsedInput.length);
                totalParsedInputLength += parsedInput.length
            }
            if (formatTokenFunctions[token]) {
                if (parsedInput) {
                    getParsingFlags(config).empty = false
                } else {
                    getParsingFlags(config).unusedTokens.push(token)
                }
                addTimeToArrayFromToken(token, parsedInput, config)
            } else if (config._strict && !parsedInput) {
                getParsingFlags(config).unusedTokens.push(token)
            }
        }
        getParsingFlags(config).charsLeftOver = stringLength - totalParsedInputLength;
        if (string.length > 0) {
            getParsingFlags(config).unusedInput.push(string)
        }
        if (config._a[HOUR] <= 12 && getParsingFlags(config).bigHour === true && config._a[HOUR] > 0) {
            getParsingFlags(config).bigHour = undefined
        }
        getParsingFlags(config).parsedDateParts = config._a.slice(0);
        getParsingFlags(config).meridiem = config._meridiem;
        config._a[HOUR] = meridiemFixWrap(config._locale, config._a[HOUR], config._meridiem);
        configFromArray(config);
        checkOverflow(config)
    }
    function meridiemFixWrap(locale, hour, meridiem) {
        var isPm;
        if (meridiem == null) {
            return hour
        }
        if (locale.meridiemHour != null) {
            return locale.meridiemHour(hour, meridiem)
        } else if (locale.isPM != null) {
            isPm = locale.isPM(meridiem);
            if (isPm && hour < 12) {
                hour += 12
            }
            if (!isPm && hour === 12) {
                hour = 0
            }
            return hour
        } else {
            return hour
        }
    }
    function configFromStringAndArray(config) {
        var tempConfig, bestMoment, scoreToBeat, i, currentScore;
        if (config._f.length === 0) {
            getParsingFlags(config).invalidFormat = true;
            config._d = new Date(NaN);
            return
        }
        for (i = 0; i < config._f.length; i++) {
            currentScore = 0;
            tempConfig = copyConfig({}, config);
            if (config._useUTC != null) {
                tempConfig._useUTC = config._useUTC
            }
            tempConfig._f = config._f[i];
            configFromStringAndFormat(tempConfig);
            if (!isValid(tempConfig)) {
                continue
            }
            currentScore += getParsingFlags(tempConfig).charsLeftOver;
            currentScore += getParsingFlags(tempConfig).unusedTokens.length * 10;
            getParsingFlags(tempConfig).score = currentScore;
            if (scoreToBeat == null || currentScore < scoreToBeat) {
                scoreToBeat = currentScore;
                bestMoment = tempConfig
            }
        }
        extend(config, bestMoment || tempConfig)
    }
    function configFromObject(config) {
        if (config._d) {
            return
        }
        var i = normalizeObjectUnits(config._i);
        config._a = map([i.year, i.month, i.day || i.date, i.hour, i.minute, i.second, i.millisecond], function(obj) {
            return obj && parseInt(obj, 10)
        });
        configFromArray(config)
    }
    function createFromConfig(config) {
        var res = new Moment(checkOverflow(prepareConfig(config)));
        if (res._nextDay) {
            res.add(1, "d");
            res._nextDay = undefined
        }
        return res
    }
    function prepareConfig(config) {
        var input = config._i
          , format = config._f;
        config._locale = config._locale || getLocale(config._l);
        if (input === null || format === undefined && input === "") {
            return createInvalid({
                nullInput: true
            })
        }
        if (typeof input === "string") {
            config._i = input = config._locale.preparse(input)
        }
        if (isMoment(input)) {
            return new Moment(checkOverflow(input))
        } else if (isDate(input)) {
            config._d = input
        } else if (isArray(format)) {
            configFromStringAndArray(config)
        } else if (format) {
            configFromStringAndFormat(config)
        } else {
            configFromInput(config)
        }
        if (!isValid(config)) {
            config._d = null
        }
        return config
    }
    function configFromInput(config) {
        var input = config._i;
        if (isUndefined(input)) {
            config._d = new Date(hooks.now())
        } else if (isDate(input)) {
            config._d = new Date(input.valueOf())
        } else if (typeof input === "string") {
            configFromString(config)
        } else if (isArray(input)) {
            config._a = map(input.slice(0), function(obj) {
                return parseInt(obj, 10)
            });
            configFromArray(config)
        } else if (isObject(input)) {
            configFromObject(config)
        } else if (isNumber(input)) {
            config._d = new Date(input)
        } else {
            hooks.createFromInputFallback(config)
        }
    }
    function createLocalOrUTC(input, format, locale, strict, isUTC) {
        var c = {};
        if (locale === true || locale === false) {
            strict = locale;
            locale = undefined
        }
        if (isObject(input) && isObjectEmpty(input) || isArray(input) && input.length === 0) {
            input = undefined
        }
        c._isAMomentObject = true;
        c._useUTC = c._isUTC = isUTC;
        c._l = locale;
        c._i = input;
        c._f = format;
        c._strict = strict;
        return createFromConfig(c)
    }
    function createLocal(input, format, locale, strict) {
        return createLocalOrUTC(input, format, locale, strict, false)
    }
    var prototypeMin = deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/", function() {
        var other = createLocal.apply(null, arguments);
        if (this.isValid() && other.isValid()) {
            return other < this ? this : other
        } else {
            return createInvalid()
        }
    });
    var prototypeMax = deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/", function() {
        var other = createLocal.apply(null, arguments);
        if (this.isValid() && other.isValid()) {
            return other > this ? this : other
        } else {
            return createInvalid()
        }
    });
    function pickBy(fn, moments) {
        var res, i;
        if (moments.length === 1 && isArray(moments[0])) {
            moments = moments[0]
        }
        if (!moments.length) {
            return createLocal()
        }
        res = moments[0];
        for (i = 1; i < moments.length; ++i) {
            if (!moments[i].isValid() || moments[i][fn](res)) {
                res = moments[i]
            }
        }
        return res
    }
    function min() {
        var args = [].slice.call(arguments, 0);
        return pickBy("isBefore", args)
    }
    function max() {
        var args = [].slice.call(arguments, 0);
        return pickBy("isAfter", args)
    }
    var now = function() {
        return Date.now ? Date.now() : +new Date
    };
    var ordering = ["year", "quarter", "month", "week", "day", "hour", "minute", "second", "millisecond"];
    function isDurationValid(m) {
        for (var key in m) {
            if (!(indexOf.call(ordering, key) !== -1 && (m[key] == null || !isNaN(m[key])))) {
                return false
            }
        }
        var unitHasDecimal = false;
        for (var i = 0; i < ordering.length; ++i) {
            if (m[ordering[i]]) {
                if (unitHasDecimal) {
                    return false
                }
                if (parseFloat(m[ordering[i]]) !== toInt(m[ordering[i]])) {
                    unitHasDecimal = true
                }
            }
        }
        return true
    }
    function isValid$1() {
        return this._isValid
    }
    function createInvalid$1() {
        return createDuration(NaN)
    }
    function Duration(duration) {
        var normalizedInput = normalizeObjectUnits(duration)
          , years = normalizedInput.year || 0
          , quarters = normalizedInput.quarter || 0
          , months = normalizedInput.month || 0
          , weeks = normalizedInput.week || 0
          , days = normalizedInput.day || 0
          , hours = normalizedInput.hour || 0
          , minutes = normalizedInput.minute || 0
          , seconds = normalizedInput.second || 0
          , milliseconds = normalizedInput.millisecond || 0;
        this._isValid = isDurationValid(normalizedInput);
        this._milliseconds = +milliseconds + seconds * 1e3 + minutes * 6e4 + hours * 1e3 * 60 * 60;
        this._days = +days + weeks * 7;
        this._months = +months + quarters * 3 + years * 12;
        this._data = {};
        this._locale = getLocale();
        this._bubble()
    }
    function isDuration(obj) {
        return obj instanceof Duration
    }
    function absRound(number) {
        if (number < 0) {
            return Math.round(-1 * number) * -1
        } else {
            return Math.round(number)
        }
    }
    function offset(token, separator) {
        addFormatToken(token, 0, 0, function() {
            var offset = this.utcOffset();
            var sign = "+";
            if (offset < 0) {
                offset = -offset;
                sign = "-"
            }
            return sign + zeroFill(~~(offset / 60), 2) + separator + zeroFill(~~offset % 60, 2)
        })
    }
    offset("Z", ":");
    offset("ZZ", "");
    addRegexToken("Z", matchShortOffset);
    addRegexToken("ZZ", matchShortOffset);
    addParseToken(["Z", "ZZ"], function(input, array, config) {
        config._useUTC = true;
        config._tzm = offsetFromString(matchShortOffset, input)
    });
    var chunkOffset = /([\+\-]|\d\d)/gi;
    function offsetFromString(matcher, string) {
        var matches = (string || "").match(matcher);
        if (matches === null) {
            return null
        }
        var chunk = matches[matches.length - 1] || [];
        var parts = (chunk + "").match(chunkOffset) || ["-", 0, 0];
        var minutes = +(parts[1] * 60) + toInt(parts[2]);
        return minutes === 0 ? 0 : parts[0] === "+" ? minutes : -minutes
    }
    function cloneWithOffset(input, model) {
        var res, diff;
        if (model._isUTC) {
            res = model.clone();
            diff = (isMoment(input) || isDate(input) ? input.valueOf() : createLocal(input).valueOf()) - res.valueOf();
            res._d.setTime(res._d.valueOf() + diff);
            hooks.updateOffset(res, false);
            return res
        } else {
            return createLocal(input).local()
        }
    }
    function getDateOffset(m) {
        return -Math.round(m._d.getTimezoneOffset() / 15) * 15
    }
    hooks.updateOffset = function() {}
    ;
    function getSetOffset(input, keepLocalTime, keepMinutes) {
        var offset = this._offset || 0, localAdjust;
        if (!this.isValid()) {
            return input != null ? this : NaN
        }
        if (input != null) {
            if (typeof input === "string") {
                input = offsetFromString(matchShortOffset, input);
                if (input === null) {
                    return this
                }
            } else if (Math.abs(input) < 16 && !keepMinutes) {
                input = input * 60
            }
            if (!this._isUTC && keepLocalTime) {
                localAdjust = getDateOffset(this)
            }
            this._offset = input;
            this._isUTC = true;
            if (localAdjust != null) {
                this.add(localAdjust, "m")
            }
            if (offset !== input) {
                if (!keepLocalTime || this._changeInProgress) {
                    addSubtract(this, createDuration(input - offset, "m"), 1, false)
                } else if (!this._changeInProgress) {
                    this._changeInProgress = true;
                    hooks.updateOffset(this, true);
                    this._changeInProgress = null
                }
            }
            return this
        } else {
            return this._isUTC ? offset : getDateOffset(this)
        }
    }
    function getSetZone(input, keepLocalTime) {
        if (input != null) {
            if (typeof input !== "string") {
                input = -input
            }
            this.utcOffset(input, keepLocalTime);
            return this
        } else {
            return -this.utcOffset()
        }
    }
    function setOffsetToUTC(keepLocalTime) {
        return this.utcOffset(0, keepLocalTime)
    }
    function setOffsetToLocal(keepLocalTime) {
        if (this._isUTC) {
            this.utcOffset(0, keepLocalTime);
            this._isUTC = false;
            if (keepLocalTime) {
                this.subtract(getDateOffset(this), "m")
            }
        }
        return this
    }
    function setOffsetToParsedOffset() {
        if (this._tzm != null) {
            this.utcOffset(this._tzm, false, true)
        } else if (typeof this._i === "string") {
            var tZone = offsetFromString(matchOffset, this._i);
            if (tZone != null) {
                this.utcOffset(tZone)
            } else {
                this.utcOffset(0, true)
            }
        }
        return this
    }
    function hasAlignedHourOffset(input) {
        if (!this.isValid()) {
            return false
        }
        input = input ? createLocal(input).utcOffset() : 0;
        return (this.utcOffset() - input) % 60 === 0
    }
    function isDaylightSavingTime() {
        return this.utcOffset() > this.clone().month(0).utcOffset() || this.utcOffset() > this.clone().month(5).utcOffset()
    }
    function isDaylightSavingTimeShifted() {
        if (!isUndefined(this._isDSTShifted)) {
            return this._isDSTShifted
        }
        var c = {};
        copyConfig(c, this);
        c = prepareConfig(c);
        if (c._a) {
            var other = c._isUTC ? createUTC(c._a) : createLocal(c._a);
            this._isDSTShifted = this.isValid() && compareArrays(c._a, other.toArray()) > 0
        } else {
            this._isDSTShifted = false
        }
        return this._isDSTShifted
    }
    function isLocal() {
        return this.isValid() ? !this._isUTC : false
    }
    function isUtcOffset() {
        return this.isValid() ? this._isUTC : false
    }
    function isUtc() {
        return this.isValid() ? this._isUTC && this._offset === 0 : false
    }
    var aspNetRegex = /^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/;
    var isoRegex = /^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;
    function createDuration(input, key) {
        var duration = input, match = null, sign, ret, diffRes;
        if (isDuration(input)) {
            duration = {
                ms: input._milliseconds,
                d: input._days,
                M: input._months
            }
        } else if (isNumber(input)) {
            duration = {};
            if (key) {
                duration[key] = input
            } else {
                duration.milliseconds = input
            }
        } else if (!!(match = aspNetRegex.exec(input))) {
            sign = match[1] === "-" ? -1 : 1;
            duration = {
                y: 0,
                d: toInt(match[DATE]) * sign,
                h: toInt(match[HOUR]) * sign,
                m: toInt(match[MINUTE]) * sign,
                s: toInt(match[SECOND]) * sign,
                ms: toInt(absRound(match[MILLISECOND] * 1e3)) * sign
            }
        } else if (!!(match = isoRegex.exec(input))) {
            sign = match[1] === "-" ? -1 : match[1] === "+" ? 1 : 1;
            duration = {
                y: parseIso(match[2], sign),
                M: parseIso(match[3], sign),
                w: parseIso(match[4], sign),
                d: parseIso(match[5], sign),
                h: parseIso(match[6], sign),
                m: parseIso(match[7], sign),
                s: parseIso(match[8], sign)
            }
        } else if (duration == null) {
            duration = {}
        } else if (typeof duration === "object" && ("from"in duration || "to"in duration)) {
            diffRes = momentsDifference(createLocal(duration.from), createLocal(duration.to));
            duration = {};
            duration.ms = diffRes.milliseconds;
            duration.M = diffRes.months
        }
        ret = new Duration(duration);
        if (isDuration(input) && hasOwnProp(input, "_locale")) {
            ret._locale = input._locale
        }
        return ret
    }
    createDuration.fn = Duration.prototype;
    createDuration.invalid = createInvalid$1;
    function parseIso(inp, sign) {
        var res = inp && parseFloat(inp.replace(",", "."));
        return (isNaN(res) ? 0 : res) * sign
    }
    function positiveMomentsDifference(base, other) {
        var res = {
            milliseconds: 0,
            months: 0
        };
        res.months = other.month() - base.month() + (other.year() - base.year()) * 12;
        if (base.clone().add(res.months, "M").isAfter(other)) {
            --res.months
        }
        res.milliseconds = +other - +base.clone().add(res.months, "M");
        return res
    }
    function momentsDifference(base, other) {
        var res;
        if (!(base.isValid() && other.isValid())) {
            return {
                milliseconds: 0,
                months: 0
            }
        }
        other = cloneWithOffset(other, base);
        if (base.isBefore(other)) {
            res = positiveMomentsDifference(base, other)
        } else {
            res = positiveMomentsDifference(other, base);
            res.milliseconds = -res.milliseconds;
            res.months = -res.months
        }
        return res
    }
    function createAdder(direction, name) {
        return function(val, period) {
            var dur, tmp;
            if (period !== null && !isNaN(+period)) {
                deprecateSimple(name, "moment()." + name + "(period, number) is deprecated. Please use moment()." + name + "(number, period). " + "See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");
                tmp = val;
                val = period;
                period = tmp
            }
            val = typeof val === "string" ? +val : val;
            dur = createDuration(val, period);
            addSubtract(this, dur, direction);
            return this
        }
    }
    function addSubtract(mom, duration, isAdding, updateOffset) {
        var milliseconds = duration._milliseconds
          , days = absRound(duration._days)
          , months = absRound(duration._months);
        if (!mom.isValid()) {
            return
        }
        updateOffset = updateOffset == null ? true : updateOffset;
        if (months) {
            setMonth(mom, get(mom, "Month") + months * isAdding)
        }
        if (days) {
            set$1(mom, "Date", get(mom, "Date") + days * isAdding)
        }
        if (milliseconds) {
            mom._d.setTime(mom._d.valueOf() + milliseconds * isAdding)
        }
        if (updateOffset) {
            hooks.updateOffset(mom, days || months)
        }
    }
    var add = createAdder(1, "add");
    var subtract = createAdder(-1, "subtract");
    function getCalendarFormat(myMoment, now) {
        var diff = myMoment.diff(now, "days", true);
        return diff < -6 ? "sameElse" : diff < -1 ? "lastWeek" : diff < 0 ? "lastDay" : diff < 1 ? "sameDay" : diff < 2 ? "nextDay" : diff < 7 ? "nextWeek" : "sameElse"
    }
    function calendar$1(time, formats) {
        var now = time || createLocal()
          , sod = cloneWithOffset(now, this).startOf("day")
          , format = hooks.calendarFormat(this, sod) || "sameElse";
        var output = formats && (isFunction(formats[format]) ? formats[format].call(this, now) : formats[format]);
        return this.format(output || this.localeData().calendar(format, this, createLocal(now)))
    }
    function clone() {
        return new Moment(this)
    }
    function isAfter(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input);
        if (!(this.isValid() && localInput.isValid())) {
            return false
        }
        units = normalizeUnits(!isUndefined(units) ? units : "millisecond");
        if (units === "millisecond") {
            return this.valueOf() > localInput.valueOf()
        } else {
            return localInput.valueOf() < this.clone().startOf(units).valueOf()
        }
    }
    function isBefore(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input);
        if (!(this.isValid() && localInput.isValid())) {
            return false
        }
        units = normalizeUnits(!isUndefined(units) ? units : "millisecond");
        if (units === "millisecond") {
            return this.valueOf() < localInput.valueOf()
        } else {
            return this.clone().endOf(units).valueOf() < localInput.valueOf()
        }
    }
    function isBetween(from, to, units, inclusivity) {
        inclusivity = inclusivity || "()";
        return (inclusivity[0] === "(" ? this.isAfter(from, units) : !this.isBefore(from, units)) && (inclusivity[1] === ")" ? this.isBefore(to, units) : !this.isAfter(to, units))
    }
    function isSame(input, units) {
        var localInput = isMoment(input) ? input : createLocal(input), inputMs;
        if (!(this.isValid() && localInput.isValid())) {
            return false
        }
        units = normalizeUnits(units || "millisecond");
        if (units === "millisecond") {
            return this.valueOf() === localInput.valueOf()
        } else {
            inputMs = localInput.valueOf();
            return this.clone().startOf(units).valueOf() <= inputMs && inputMs <= this.clone().endOf(units).valueOf()
        }
    }
    function isSameOrAfter(input, units) {
        return this.isSame(input, units) || this.isAfter(input, units)
    }
    function isSameOrBefore(input, units) {
        return this.isSame(input, units) || this.isBefore(input, units)
    }
    function diff(input, units, asFloat) {
        var that, zoneDelta, output;
        if (!this.isValid()) {
            return NaN
        }
        that = cloneWithOffset(input, this);
        if (!that.isValid()) {
            return NaN
        }
        zoneDelta = (that.utcOffset() - this.utcOffset()) * 6e4;
        units = normalizeUnits(units);
        switch (units) {
        case "year":
            output = monthDiff(this, that) / 12;
            break;
        case "month":
            output = monthDiff(this, that);
            break;
        case "quarter":
            output = monthDiff(this, that) / 3;
            break;
        case "second":
            output = (this - that) / 1e3;
            break;
        case "minute":
            output = (this - that) / 6e4;
            break;
        case "hour":
            output = (this - that) / 36e5;
            break;
        case "day":
            output = (this - that - zoneDelta) / 864e5;
            break;
        case "week":
            output = (this - that - zoneDelta) / 6048e5;
            break;
        default:
            output = this - that
        }
        return asFloat ? output : absFloor(output)
    }
    function monthDiff(a, b) {
        var wholeMonthDiff = (b.year() - a.year()) * 12 + (b.month() - a.month()), anchor = a.clone().add(wholeMonthDiff, "months"), anchor2, adjust;
        if (b - anchor < 0) {
            anchor2 = a.clone().add(wholeMonthDiff - 1, "months");
            adjust = (b - anchor) / (anchor - anchor2)
        } else {
            anchor2 = a.clone().add(wholeMonthDiff + 1, "months");
            adjust = (b - anchor) / (anchor2 - anchor)
        }
        return -(wholeMonthDiff + adjust) || 0
    }
    hooks.defaultFormat = "YYYY-MM-DDTHH:mm:ssZ";
    hooks.defaultFormatUtc = "YYYY-MM-DDTHH:mm:ss[Z]";
    function toString() {
        return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")
    }
    function toISOString(keepOffset) {
        if (!this.isValid()) {
            return null
        }
        var utc = keepOffset !== true;
        var m = utc ? this.clone().utc() : this;
        if (m.year() < 0 || m.year() > 9999) {
            return formatMoment(m, utc ? "YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]" : "YYYYYY-MM-DD[T]HH:mm:ss.SSSZ")
        }
        if (isFunction(Date.prototype.toISOString)) {
            if (utc) {
                return this.toDate().toISOString()
            } else {
                return new Date(this.valueOf() + this.utcOffset() * 60 * 1e3).toISOString().replace("Z", formatMoment(m, "Z"))
            }
        }
        return formatMoment(m, utc ? "YYYY-MM-DD[T]HH:mm:ss.SSS[Z]" : "YYYY-MM-DD[T]HH:mm:ss.SSSZ")
    }
    function inspect() {
        if (!this.isValid()) {
            return "moment.invalid(/* " + this._i + " */)"
        }
        var func = "moment";
        var zone = "";
        if (!this.isLocal()) {
            func = this.utcOffset() === 0 ? "moment.utc" : "moment.parseZone";
            zone = "Z"
        }
        var prefix = "[" + func + '("]';
        var year = 0 <= this.year() && this.year() <= 9999 ? "YYYY" : "YYYYYY";
        var datetime = "-MM-DD[T]HH:mm:ss.SSS";
        var suffix = zone + '[")]';
        return this.format(prefix + year + datetime + suffix)
    }
    function format(inputString) {
        if (!inputString) {
            inputString = this.isUtc() ? hooks.defaultFormatUtc : hooks.defaultFormat
        }
        var output = formatMoment(this, inputString);
        return this.localeData().postformat(output)
    }
    function from(time, withoutSuffix) {
        if (this.isValid() && (isMoment(time) && time.isValid() || createLocal(time).isValid())) {
            return createDuration({
                to: this,
                from: time
            }).locale(this.locale()).humanize(!withoutSuffix)
        } else {
            return this.localeData().invalidDate()
        }
    }
    function fromNow(withoutSuffix) {
        return this.from(createLocal(), withoutSuffix)
    }
    function to(time, withoutSuffix) {
        if (this.isValid() && (isMoment(time) && time.isValid() || createLocal(time).isValid())) {
            return createDuration({
                from: this,
                to: time
            }).locale(this.locale()).humanize(!withoutSuffix)
        } else {
            return this.localeData().invalidDate()
        }
    }
    function toNow(withoutSuffix) {
        return this.to(createLocal(), withoutSuffix)
    }
    function locale(key) {
        var newLocaleData;
        if (key === undefined) {
            return this._locale._abbr
        } else {
            newLocaleData = getLocale(key);
            if (newLocaleData != null) {
                this._locale = newLocaleData
            }
            return this
        }
    }
    var lang = deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.", function(key) {
        if (key === undefined) {
            return this.localeData()
        } else {
            return this.locale(key)
        }
    });
    function localeData() {
        return this._locale
    }
    function startOf(units) {
        units = normalizeUnits(units);
        switch (units) {
        case "year":
            this.month(0);
        case "quarter":
        case "month":
            this.date(1);
        case "week":
        case "isoWeek":
        case "day":
        case "date":
            this.hours(0);
        case "hour":
            this.minutes(0);
        case "minute":
            this.seconds(0);
        case "second":
            this.milliseconds(0)
        }
        if (units === "week") {
            this.weekday(0)
        }
        if (units === "isoWeek") {
            this.isoWeekday(1)
        }
        if (units === "quarter") {
            this.month(Math.floor(this.month() / 3) * 3)
        }
        return this
    }
    function endOf(units) {
        units = normalizeUnits(units);
        if (units === undefined || units === "millisecond") {
            return this
        }
        if (units === "date") {
            units = "day"
        }
        return this.startOf(units).add(1, units === "isoWeek" ? "week" : units).subtract(1, "ms")
    }
    function valueOf() {
        return this._d.valueOf() - (this._offset || 0) * 6e4
    }
    function unix() {
        return Math.floor(this.valueOf() / 1e3)
    }
    function toDate() {
        return new Date(this.valueOf())
    }
    function toArray() {
        var m = this;
        return [m.year(), m.month(), m.date(), m.hour(), m.minute(), m.second(), m.millisecond()]
    }
    function toObject() {
        var m = this;
        return {
            years: m.year(),
            months: m.month(),
            date: m.date(),
            hours: m.hours(),
            minutes: m.minutes(),
            seconds: m.seconds(),
            milliseconds: m.milliseconds()
        }
    }
    function toJSON() {
        return this.isValid() ? this.toISOString() : null
    }
    function isValid$2() {
        return isValid(this)
    }
    function parsingFlags() {
        return extend({}, getParsingFlags(this))
    }
    function invalidAt() {
        return getParsingFlags(this).overflow
    }
    function creationData() {
        return {
            input: this._i,
            format: this._f,
            locale: this._locale,
            isUTC: this._isUTC,
            strict: this._strict
        }
    }
    addFormatToken(0, ["gg", 2], 0, function() {
        return this.weekYear() % 100
    });
    addFormatToken(0, ["GG", 2], 0, function() {
        return this.isoWeekYear() % 100
    });
    function addWeekYearFormatToken(token, getter) {
        addFormatToken(0, [token, token.length], 0, getter)
    }
    addWeekYearFormatToken("gggg", "weekYear");
    addWeekYearFormatToken("ggggg", "weekYear");
    addWeekYearFormatToken("GGGG", "isoWeekYear");
    addWeekYearFormatToken("GGGGG", "isoWeekYear");
    addUnitAlias("weekYear", "gg");
    addUnitAlias("isoWeekYear", "GG");
    addUnitPriority("weekYear", 1);
    addUnitPriority("isoWeekYear", 1);
    addRegexToken("G", matchSigned);
    addRegexToken("g", matchSigned);
    addRegexToken("GG", match1to2, match2);
    addRegexToken("gg", match1to2, match2);
    addRegexToken("GGGG", match1to4, match4);
    addRegexToken("gggg", match1to4, match4);
    addRegexToken("GGGGG", match1to6, match6);
    addRegexToken("ggggg", match1to6, match6);
    addWeekParseToken(["gggg", "ggggg", "GGGG", "GGGGG"], function(input, week, config, token) {
        week[token.substr(0, 2)] = toInt(input)
    });
    addWeekParseToken(["gg", "GG"], function(input, week, config, token) {
        week[token] = hooks.parseTwoDigitYear(input)
    });
    function getSetWeekYear(input) {
        return getSetWeekYearHelper.call(this, input, this.week(), this.weekday(), this.localeData()._week.dow, this.localeData()._week.doy)
    }
    function getSetISOWeekYear(input) {
        return getSetWeekYearHelper.call(this, input, this.isoWeek(), this.isoWeekday(), 1, 4)
    }
    function getISOWeeksInYear() {
        return weeksInYear(this.year(), 1, 4)
    }
    function getWeeksInYear() {
        var weekInfo = this.localeData()._week;
        return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy)
    }
    function getSetWeekYearHelper(input, week, weekday, dow, doy) {
        var weeksTarget;
        if (input == null) {
            return weekOfYear(this, dow, doy).year
        } else {
            weeksTarget = weeksInYear(input, dow, doy);
            if (week > weeksTarget) {
                week = weeksTarget
            }
            return setWeekAll.call(this, input, week, weekday, dow, doy)
        }
    }
    function setWeekAll(weekYear, week, weekday, dow, doy) {
        var dayOfYearData = dayOfYearFromWeeks(weekYear, week, weekday, dow, doy)
          , date = createUTCDate(dayOfYearData.year, 0, dayOfYearData.dayOfYear);
        this.year(date.getUTCFullYear());
        this.month(date.getUTCMonth());
        this.date(date.getUTCDate());
        return this
    }
    addFormatToken("Q", 0, "Qo", "quarter");
    addUnitAlias("quarter", "Q");
    addUnitPriority("quarter", 7);
    addRegexToken("Q", match1);
    addParseToken("Q", function(input, array) {
        array[MONTH] = (toInt(input) - 1) * 3
    });
    function getSetQuarter(input) {
        return input == null ? Math.ceil((this.month() + 1) / 3) : this.month((input - 1) * 3 + this.month() % 3)
    }
    addFormatToken("D", ["DD", 2], "Do", "date");
    addUnitAlias("date", "D");
    addUnitPriority("date", 9);
    addRegexToken("D", match1to2);
    addRegexToken("DD", match1to2, match2);
    addRegexToken("Do", function(isStrict, locale) {
        return isStrict ? locale._dayOfMonthOrdinalParse || locale._ordinalParse : locale._dayOfMonthOrdinalParseLenient
    });
    addParseToken(["D", "DD"], DATE);
    addParseToken("Do", function(input, array) {
        array[DATE] = toInt(input.match(match1to2)[0])
    });
    var getSetDayOfMonth = makeGetSet("Date", true);
    addFormatToken("DDD", ["DDDD", 3], "DDDo", "dayOfYear");
    addUnitAlias("dayOfYear", "DDD");
    addUnitPriority("dayOfYear", 4);
    addRegexToken("DDD", match1to3);
    addRegexToken("DDDD", match3);
    addParseToken(["DDD", "DDDD"], function(input, array, config) {
        config._dayOfYear = toInt(input)
    });
    function getSetDayOfYear(input) {
        var dayOfYear = Math.round((this.clone().startOf("day") - this.clone().startOf("year")) / 864e5) + 1;
        return input == null ? dayOfYear : this.add(input - dayOfYear, "d")
    }
    addFormatToken("m", ["mm", 2], 0, "minute");
    addUnitAlias("minute", "m");
    addUnitPriority("minute", 14);
    addRegexToken("m", match1to2);
    addRegexToken("mm", match1to2, match2);
    addParseToken(["m", "mm"], MINUTE);
    var getSetMinute = makeGetSet("Minutes", false);
    addFormatToken("s", ["ss", 2], 0, "second");
    addUnitAlias("second", "s");
    addUnitPriority("second", 15);
    addRegexToken("s", match1to2);
    addRegexToken("ss", match1to2, match2);
    addParseToken(["s", "ss"], SECOND);
    var getSetSecond = makeGetSet("Seconds", false);
    addFormatToken("S", 0, 0, function() {
        return ~~(this.millisecond() / 100)
    });
    addFormatToken(0, ["SS", 2], 0, function() {
        return ~~(this.millisecond() / 10)
    });
    addFormatToken(0, ["SSS", 3], 0, "millisecond");
    addFormatToken(0, ["SSSS", 4], 0, function() {
        return this.millisecond() * 10
    });
    addFormatToken(0, ["SSSSS", 5], 0, function() {
        return this.millisecond() * 100
    });
    addFormatToken(0, ["SSSSSS", 6], 0, function() {
        return this.millisecond() * 1e3
    });
    addFormatToken(0, ["SSSSSSS", 7], 0, function() {
        return this.millisecond() * 1e4
    });
    addFormatToken(0, ["SSSSSSSS", 8], 0, function() {
        return this.millisecond() * 1e5
    });
    addFormatToken(0, ["SSSSSSSSS", 9], 0, function() {
        return this.millisecond() * 1e6
    });
    addUnitAlias("millisecond", "ms");
    addUnitPriority("millisecond", 16);
    addRegexToken("S", match1to3, match1);
    addRegexToken("SS", match1to3, match2);
    addRegexToken("SSS", match1to3, match3);
    var token;
    for (token = "SSSS"; token.length <= 9; token += "S") {
        addRegexToken(token, matchUnsigned)
    }
    function parseMs(input, array) {
        array[MILLISECOND] = toInt(("0." + input) * 1e3)
    }
    for (token = "S"; token.length <= 9; token += "S") {
        addParseToken(token, parseMs)
    }
    var getSetMillisecond = makeGetSet("Milliseconds", false);
    addFormatToken("z", 0, 0, "zoneAbbr");
    addFormatToken("zz", 0, 0, "zoneName");
    function getZoneAbbr() {
        return this._isUTC ? "UTC" : ""
    }
    function getZoneName() {
        return this._isUTC ? "Coordinated Universal Time" : ""
    }
    var proto = Moment.prototype;
    proto.add = add;
    proto.calendar = calendar$1;
    proto.clone = clone;
    proto.diff = diff;
    proto.endOf = endOf;
    proto.format = format;
    proto.from = from;
    proto.fromNow = fromNow;
    proto.to = to;
    proto.toNow = toNow;
    proto.get = stringGet;
    proto.invalidAt = invalidAt;
    proto.isAfter = isAfter;
    proto.isBefore = isBefore;
    proto.isBetween = isBetween;
    proto.isSame = isSame;
    proto.isSameOrAfter = isSameOrAfter;
    proto.isSameOrBefore = isSameOrBefore;
    proto.isValid = isValid$2;
    proto.lang = lang;
    proto.locale = locale;
    proto.localeData = localeData;
    proto.max = prototypeMax;
    proto.min = prototypeMin;
    proto.parsingFlags = parsingFlags;
    proto.set = stringSet;
    proto.startOf = startOf;
    proto.subtract = subtract;
    proto.toArray = toArray;
    proto.toObject = toObject;
    proto.toDate = toDate;
    proto.toISOString = toISOString;
    proto.inspect = inspect;
    proto.toJSON = toJSON;
    proto.toString = toString;
    proto.unix = unix;
    proto.valueOf = valueOf;
    proto.creationData = creationData;
    proto.year = getSetYear;
    proto.isLeapYear = getIsLeapYear;
    proto.weekYear = getSetWeekYear;
    proto.isoWeekYear = getSetISOWeekYear;
    proto.quarter = proto.quarters = getSetQuarter;
    proto.month = getSetMonth;
    proto.daysInMonth = getDaysInMonth;
    proto.week = proto.weeks = getSetWeek;
    proto.isoWeek = proto.isoWeeks = getSetISOWeek;
    proto.weeksInYear = getWeeksInYear;
    proto.isoWeeksInYear = getISOWeeksInYear;
    proto.date = getSetDayOfMonth;
    proto.day = proto.days = getSetDayOfWeek;
    proto.weekday = getSetLocaleDayOfWeek;
    proto.isoWeekday = getSetISODayOfWeek;
    proto.dayOfYear = getSetDayOfYear;
    proto.hour = proto.hours = getSetHour;
    proto.minute = proto.minutes = getSetMinute;
    proto.second = proto.seconds = getSetSecond;
    proto.millisecond = proto.milliseconds = getSetMillisecond;
    proto.utcOffset = getSetOffset;
    proto.utc = setOffsetToUTC;
    proto.local = setOffsetToLocal;
    proto.parseZone = setOffsetToParsedOffset;
    proto.hasAlignedHourOffset = hasAlignedHourOffset;
    proto.isDST = isDaylightSavingTime;
    proto.isLocal = isLocal;
    proto.isUtcOffset = isUtcOffset;
    proto.isUtc = isUtc;
    proto.isUTC = isUtc;
    proto.zoneAbbr = getZoneAbbr;
    proto.zoneName = getZoneName;
    proto.dates = deprecate("dates accessor is deprecated. Use date instead.", getSetDayOfMonth);
    proto.months = deprecate("months accessor is deprecated. Use month instead", getSetMonth);
    proto.years = deprecate("years accessor is deprecated. Use year instead", getSetYear);
    proto.zone = deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/", getSetZone);
    proto.isDSTShifted = deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information", isDaylightSavingTimeShifted);
    function createUnix(input) {
        return createLocal(input * 1e3)
    }
    function createInZone() {
        return createLocal.apply(null, arguments).parseZone()
    }
    function preParsePostFormat(string) {
        return string
    }
    var proto$1 = Locale.prototype;
    proto$1.calendar = calendar;
    proto$1.longDateFormat = longDateFormat;
    proto$1.invalidDate = invalidDate;
    proto$1.ordinal = ordinal;
    proto$1.preparse = preParsePostFormat;
    proto$1.postformat = preParsePostFormat;
    proto$1.relativeTime = relativeTime;
    proto$1.pastFuture = pastFuture;
    proto$1.set = set;
    proto$1.months = localeMonths;
    proto$1.monthsShort = localeMonthsShort;
    proto$1.monthsParse = localeMonthsParse;
    proto$1.monthsRegex = monthsRegex;
    proto$1.monthsShortRegex = monthsShortRegex;
    proto$1.week = localeWeek;
    proto$1.firstDayOfYear = localeFirstDayOfYear;
    proto$1.firstDayOfWeek = localeFirstDayOfWeek;
    proto$1.weekdays = localeWeekdays;
    proto$1.weekdaysMin = localeWeekdaysMin;
    proto$1.weekdaysShort = localeWeekdaysShort;
    proto$1.weekdaysParse = localeWeekdaysParse;
    proto$1.weekdaysRegex = weekdaysRegex;
    proto$1.weekdaysShortRegex = weekdaysShortRegex;
    proto$1.weekdaysMinRegex = weekdaysMinRegex;
    proto$1.isPM = localeIsPM;
    proto$1.meridiem = localeMeridiem;
    function get$1(format, index, field, setter) {
        var locale = getLocale();
        var utc = createUTC().set(setter, index);
        return locale[field](utc, format)
    }
    function listMonthsImpl(format, index, field) {
        if (isNumber(format)) {
            index = format;
            format = undefined
        }
        format = format || "";
        if (index != null) {
            return get$1(format, index, field, "month")
        }
        var i;
        var out = [];
        for (i = 0; i < 12; i++) {
            out[i] = get$1(format, i, field, "month")
        }
        return out
    }
    function listWeekdaysImpl(localeSorted, format, index, field) {
        if (typeof localeSorted === "boolean") {
            if (isNumber(format)) {
                index = format;
                format = undefined
            }
            format = format || ""
        } else {
            format = localeSorted;
            index = format;
            localeSorted = false;
            if (isNumber(format)) {
                index = format;
                format = undefined
            }
            format = format || ""
        }
        var locale = getLocale()
          , shift = localeSorted ? locale._week.dow : 0;
        if (index != null) {
            return get$1(format, (index + shift) % 7, field, "day")
        }
        var i;
        var out = [];
        for (i = 0; i < 7; i++) {
            out[i] = get$1(format, (i + shift) % 7, field, "day")
        }
        return out
    }
    function listMonths(format, index) {
        return listMonthsImpl(format, index, "months")
    }
    function listMonthsShort(format, index) {
        return listMonthsImpl(format, index, "monthsShort")
    }
    function listWeekdays(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, "weekdays")
    }
    function listWeekdaysShort(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, "weekdaysShort")
    }
    function listWeekdaysMin(localeSorted, format, index) {
        return listWeekdaysImpl(localeSorted, format, index, "weekdaysMin")
    }
    getSetGlobalLocale("en", {
        dayOfMonthOrdinalParse: /\d{1,2}(th|st|nd|rd)/,
        ordinal: function(number) {
            var b = number % 10
              , output = toInt(number % 100 / 10) === 1 ? "th" : b === 1 ? "st" : b === 2 ? "nd" : b === 3 ? "rd" : "th";
            return number + output
        }
    });
    hooks.lang = deprecate("moment.lang is deprecated. Use moment.locale instead.", getSetGlobalLocale);
    hooks.langData = deprecate("moment.langData is deprecated. Use moment.localeData instead.", getLocale);
    var mathAbs = Math.abs;
    function abs() {
        var data = this._data;
        this._milliseconds = mathAbs(this._milliseconds);
        this._days = mathAbs(this._days);
        this._months = mathAbs(this._months);
        data.milliseconds = mathAbs(data.milliseconds);
        data.seconds = mathAbs(data.seconds);
        data.minutes = mathAbs(data.minutes);
        data.hours = mathAbs(data.hours);
        data.months = mathAbs(data.months);
        data.years = mathAbs(data.years);
        return this
    }
    function addSubtract$1(duration, input, value, direction) {
        var other = createDuration(input, value);
        duration._milliseconds += direction * other._milliseconds;
        duration._days += direction * other._days;
        duration._months += direction * other._months;
        return duration._bubble()
    }
    function add$1(input, value) {
        return addSubtract$1(this, input, value, 1)
    }
    function subtract$1(input, value) {
        return addSubtract$1(this, input, value, -1)
    }
    function absCeil(number) {
        if (number < 0) {
            return Math.floor(number)
        } else {
            return Math.ceil(number)
        }
    }
    function bubble() {
        var milliseconds = this._milliseconds;
        var days = this._days;
        var months = this._months;
        var data = this._data;
        var seconds, minutes, hours, years, monthsFromDays;
        if (!(milliseconds >= 0 && days >= 0 && months >= 0 || milliseconds <= 0 && days <= 0 && months <= 0)) {
            milliseconds += absCeil(monthsToDays(months) + days) * 864e5;
            days = 0;
            months = 0
        }
        data.milliseconds = milliseconds % 1e3;
        seconds = absFloor(milliseconds / 1e3);
        data.seconds = seconds % 60;
        minutes = absFloor(seconds / 60);
        data.minutes = minutes % 60;
        hours = absFloor(minutes / 60);
        data.hours = hours % 24;
        days += absFloor(hours / 24);
        monthsFromDays = absFloor(daysToMonths(days));
        months += monthsFromDays;
        days -= absCeil(monthsToDays(monthsFromDays));
        years = absFloor(months / 12);
        months %= 12;
        data.days = days;
        data.months = months;
        data.years = years;
        return this
    }
    function daysToMonths(days) {
        return days * 4800 / 146097
    }
    function monthsToDays(months) {
        return months * 146097 / 4800
    }
    function as(units) {
        if (!this.isValid()) {
            return NaN
        }
        var days;
        var months;
        var milliseconds = this._milliseconds;
        units = normalizeUnits(units);
        if (units === "month" || units === "year") {
            days = this._days + milliseconds / 864e5;
            months = this._months + daysToMonths(days);
            return units === "month" ? months : months / 12
        } else {
            days = this._days + Math.round(monthsToDays(this._months));
            switch (units) {
            case "week":
                return days / 7 + milliseconds / 6048e5;
            case "day":
                return days + milliseconds / 864e5;
            case "hour":
                return days * 24 + milliseconds / 36e5;
            case "minute":
                return days * 1440 + milliseconds / 6e4;
            case "second":
                return days * 86400 + milliseconds / 1e3;
            case "millisecond":
                return Math.floor(days * 864e5) + milliseconds;
            default:
                throw new Error("Unknown unit " + units)
            }
        }
    }
    function valueOf$1() {
        if (!this.isValid()) {
            return NaN
        }
        return this._milliseconds + this._days * 864e5 + this._months % 12 * 2592e6 + toInt(this._months / 12) * 31536e6
    }
    function makeAs(alias) {
        return function() {
            return this.as(alias)
        }
    }
    var asMilliseconds = makeAs("ms");
    var asSeconds = makeAs("s");
    var asMinutes = makeAs("m");
    var asHours = makeAs("h");
    var asDays = makeAs("d");
    var asWeeks = makeAs("w");
    var asMonths = makeAs("M");
    var asYears = makeAs("y");
    function clone$1() {
        return createDuration(this)
    }
    function get$2(units) {
        units = normalizeUnits(units);
        return this.isValid() ? this[units + "s"]() : NaN
    }
    function makeGetter(name) {
        return function() {
            return this.isValid() ? this._data[name] : NaN
        }
    }
    var milliseconds = makeGetter("milliseconds");
    var seconds = makeGetter("seconds");
    var minutes = makeGetter("minutes");
    var hours = makeGetter("hours");
    var days = makeGetter("days");
    var months = makeGetter("months");
    var years = makeGetter("years");
    function weeks() {
        return absFloor(this.days() / 7)
    }
    var round = Math.round;
    var thresholds = {
        ss: 44,
        s: 45,
        m: 45,
        h: 22,
        d: 26,
        M: 11
    };
    function substituteTimeAgo(string, number, withoutSuffix, isFuture, locale) {
        return locale.relativeTime(number || 1, !!withoutSuffix, string, isFuture)
    }
    function relativeTime$1(posNegDuration, withoutSuffix, locale) {
        var duration = createDuration(posNegDuration).abs();
        var seconds = round(duration.as("s"));
        var minutes = round(duration.as("m"));
        var hours = round(duration.as("h"));
        var days = round(duration.as("d"));
        var months = round(duration.as("M"));
        var years = round(duration.as("y"));
        var a = seconds <= thresholds.ss && ["s", seconds] || seconds < thresholds.s && ["ss", seconds] || minutes <= 1 && ["m"] || minutes < thresholds.m && ["mm", minutes] || hours <= 1 && ["h"] || hours < thresholds.h && ["hh", hours] || days <= 1 && ["d"] || days < thresholds.d && ["dd", days] || months <= 1 && ["M"] || months < thresholds.M && ["MM", months] || years <= 1 && ["y"] || ["yy", years];
        a[2] = withoutSuffix;
        a[3] = +posNegDuration > 0;
        a[4] = locale;
        return substituteTimeAgo.apply(null, a)
    }
    function getSetRelativeTimeRounding(roundingFunction) {
        if (roundingFunction === undefined) {
            return round
        }
        if (typeof roundingFunction === "function") {
            round = roundingFunction;
            return true
        }
        return false
    }
    function getSetRelativeTimeThreshold(threshold, limit) {
        if (thresholds[threshold] === undefined) {
            return false
        }
        if (limit === undefined) {
            return thresholds[threshold]
        }
        thresholds[threshold] = limit;
        if (threshold === "s") {
            thresholds.ss = limit - 1
        }
        return true
    }
    function humanize(withSuffix) {
        if (!this.isValid()) {
            return this.localeData().invalidDate()
        }
        var locale = this.localeData();
        var output = relativeTime$1(this, !withSuffix, locale);
        if (withSuffix) {
            output = locale.pastFuture(+this, output)
        }
        return locale.postformat(output)
    }
    var abs$1 = Math.abs;
    function sign(x) {
        return (x > 0) - (x < 0) || +x
    }
    function toISOString$1() {
        if (!this.isValid()) {
            return this.localeData().invalidDate()
        }
        var seconds = abs$1(this._milliseconds) / 1e3;
        var days = abs$1(this._days);
        var months = abs$1(this._months);
        var minutes, hours, years;
        minutes = absFloor(seconds / 60);
        hours = absFloor(minutes / 60);
        seconds %= 60;
        minutes %= 60;
        years = absFloor(months / 12);
        months %= 12;
        var Y = years;
        var M = months;
        var D = days;
        var h = hours;
        var m = minutes;
        var s = seconds ? seconds.toFixed(3).replace(/\.?0+$/, "") : "";
        var total = this.asSeconds();
        if (!total) {
            return "P0D"
        }
        var totalSign = total < 0 ? "-" : "";
        var ymSign = sign(this._months) !== sign(total) ? "-" : "";
        var daysSign = sign(this._days) !== sign(total) ? "-" : "";
        var hmsSign = sign(this._milliseconds) !== sign(total) ? "-" : "";
        return totalSign + "P" + (Y ? ymSign + Y + "Y" : "") + (M ? ymSign + M + "M" : "") + (D ? daysSign + D + "D" : "") + (h || m || s ? "T" : "") + (h ? hmsSign + h + "H" : "") + (m ? hmsSign + m + "M" : "") + (s ? hmsSign + s + "S" : "")
    }
    var proto$2 = Duration.prototype;
    proto$2.isValid = isValid$1;
    proto$2.abs = abs;
    proto$2.add = add$1;
    proto$2.subtract = subtract$1;
    proto$2.as = as;
    proto$2.asMilliseconds = asMilliseconds;
    proto$2.asSeconds = asSeconds;
    proto$2.asMinutes = asMinutes;
    proto$2.asHours = asHours;
    proto$2.asDays = asDays;
    proto$2.asWeeks = asWeeks;
    proto$2.asMonths = asMonths;
    proto$2.asYears = asYears;
    proto$2.valueOf = valueOf$1;
    proto$2._bubble = bubble;
    proto$2.clone = clone$1;
    proto$2.get = get$2;
    proto$2.milliseconds = milliseconds;
    proto$2.seconds = seconds;
    proto$2.minutes = minutes;
    proto$2.hours = hours;
    proto$2.days = days;
    proto$2.weeks = weeks;
    proto$2.months = months;
    proto$2.years = years;
    proto$2.humanize = humanize;
    proto$2.toISOString = toISOString$1;
    proto$2.toString = toISOString$1;
    proto$2.toJSON = toISOString$1;
    proto$2.locale = locale;
    proto$2.localeData = localeData;
    proto$2.toIsoString = deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)", toISOString$1);
    proto$2.lang = lang;
    addFormatToken("X", 0, 0, "unix");
    addFormatToken("x", 0, 0, "valueOf");
    addRegexToken("x", matchSigned);
    addRegexToken("X", matchTimestamp);
    addParseToken("X", function(input, array, config) {
        config._d = new Date(parseFloat(input, 10) * 1e3)
    });
    addParseToken("x", function(input, array, config) {
        config._d = new Date(toInt(input))
    });
    hooks.version = "2.22.2";
    setHookCallback(createLocal);
    hooks.fn = proto;
    hooks.min = min;
    hooks.max = max;
    hooks.now = now;
    hooks.utc = createUTC;
    hooks.unix = createUnix;
    hooks.months = listMonths;
    hooks.isDate = isDate;
    hooks.locale = getSetGlobalLocale;
    hooks.invalid = createInvalid;
    hooks.duration = createDuration;
    hooks.isMoment = isMoment;
    hooks.weekdays = listWeekdays;
    hooks.parseZone = createInZone;
    hooks.localeData = getLocale;
    hooks.isDuration = isDuration;
    hooks.monthsShort = listMonthsShort;
    hooks.weekdaysMin = listWeekdaysMin;
    hooks.defineLocale = defineLocale;
    hooks.updateLocale = updateLocale;
    hooks.locales = listLocales;
    hooks.weekdaysShort = listWeekdaysShort;
    hooks.normalizeUnits = normalizeUnits;
    hooks.relativeTimeRounding = getSetRelativeTimeRounding;
    hooks.relativeTimeThreshold = getSetRelativeTimeThreshold;
    hooks.calendarFormat = getCalendarFormat;
    hooks.prototype = proto;
    hooks.HTML5_FMT = {
        DATETIME_LOCAL: "YYYY-MM-DDTHH:mm",
        DATETIME_LOCAL_SECONDS: "YYYY-MM-DDTHH:mm:ss",
        DATETIME_LOCAL_MS: "YYYY-MM-DDTHH:mm:ss.SSS",
        DATE: "YYYY-MM-DD",
        TIME: "HH:mm",
        TIME_SECONDS: "HH:mm:ss",
        TIME_MS: "HH:mm:ss.SSS",
        WEEK: "YYYY-[W]WW",
        MONTH: "YYYY-MM"
    };
    return hooks
});
$(function($) {
    "use strict";
    var $window = $(window)
      , windowHeight = $window.height()
      , getLowestOffset = function($hightchartsRequesters) {
        var lowestOffset = windowHeight;
        $hightchartsRequesters.each(function() {
            var $this = $(this);
            if ($this.offset() && $this.offset().top < lowestOffset) {
                lowestOffset = $this.offset().top
            }
        });
        return lowestOffset
    }
      , injectScript = {
        highchartJS: function() {
            var options = {
                dataType: "script",
                url: guruApp.highchartsJsUrl,
                cache: true
            };
            $.ajax(options).done(function() {
                if (window.Highcharts) {
                    $window.trigger("highcharts.loaded")
                }
            })
        }
    };
    $(function() {
        var $hightchartsRequesters = $("[data-load-highcharts]")
          , $forceLoad = $("[data-force-load]");
        if ($forceLoad.length) {
            injectScript.highchartJS()
        }
        var lazyLoad = function() {
            var scrollTop = $(document).scrollTop()
              , lowestTop = getLowestOffset($hightchartsRequesters);
            if (scrollTop + windowHeight >= lowestTop) {
                injectScript.highchartJS();
                $window.off("scroll.highcharts")
            }
        };
        if ($hightchartsRequesters.length) {
            $window.on("scroll.highcharts", lazyLoad)
        }
    })
});
(function($) {
    "use strict";
    if (!guruApp.fn) {
        guruApp.fn = {}
    }
    guruApp.fn.getCurrentDevice = function() {
        if (window.matchMedia("(min-width: 990px)").matches) {
            return "desktop"
        }
        if (window.matchMedia("(min-width: 768px)").matches) {
            return "tablet"
        }
        return "mobile"
    }
}
)(jQuery);
(function(window, $) {
    "use strict";
    var RESPONSIVE_WIDTH = 768;
    var $window = $(window);
    var Collapse = $.fn.collapse.Constructor;
    function responsiveCall() {
        var width = $window.width();
        var isResponsive = width < RESPONSIVE_WIDTH;
        $("[data-toggle=responsiveCollapse]").each(function() {
            ResponsiveCollapse.init(this, isResponsive ? "simpleHide" : "simpleShow");
            isResponsive ? disableHeaderLink(this) : enableHeaderLink(this)
        })
    }
    function disableHeaderLink(el) {
        var $links = $(el).find("a");
        if ($links.length) {
            $links.on("click", function(e) {
                e.preventDefault()
            })
        }
    }
    function enableHeaderLink(el) {
        var $links = $(el).find("a");
        if ($links.length) {
            $links.off("click")
        }
    }
    function ResponsiveCollapse(element, options) {
        Collapse.call(this, element, options)
    }
    ResponsiveCollapse.prototype = Object.create(Collapse.prototype);
    ResponsiveCollapse.prototype.toggle = function() {
        if ($(window).width() < 768) {
            Collapse.prototype.toggle.call(this)
        }
    }
    ;
    ResponsiveCollapse.prototype.simpleShow = function() {
        if (this.$element.hasClass("in")) {
            return
        }
        var startEvent = $.Event("show.bs.collapse");
        this.$element.trigger(startEvent);
        if (startEvent.isDefaultPrevented()) {
            return
        }
        var dimension = this.dimension();
        this.$element.removeClass("collapse").addClass("collapsing")[dimension](0);
        this.transitioning = 1;
        var complete = function() {
            this.$element.removeClass("collapsing").addClass("in")[dimension]("auto");
            this.transitioning = 0;
            this.$element.trigger("shown.bs.collapse")
        };
        if (!$.support.transition) {
            return complete.call(this)
        }
        var scrollSize = $.camelCase(["scroll", dimension].join("-"));
        this.$element.one($.support.transition.end, $.proxy(complete, this)).emulateTransitionEnd(350)[dimension](this.$element[0][scrollSize])
    }
    ;
    ResponsiveCollapse.prototype.simpleHide = function() {
        if (!this.$element.hasClass("in")) {
            return
        }
        var startEvent = $.Event("hide.bs.collapse");
        this.$element.trigger(startEvent);
        if (startEvent.isDefaultPrevented()) {
            return
        }
        var dimension = this.dimension();
        this.$element[dimension](this.$element[dimension]())[0].offsetHeight;
        this.$element.addClass("collapsing").removeClass("collapse").removeClass("in");
        this.transitioning = 1;
        var complete = function() {
            this.transitioning = 0;
            this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")
        };
        if (!$.support.transition) {
            return complete.call(this)
        }
        this.$element[dimension](0).one($.support.transition.end, $.proxy(complete, this)).emulateTransitionEnd(350)
    }
    ;
    ResponsiveCollapse.getTarget = function(element) {
        var $elt = $(element);
        var href;
        return $elt.attr("data-target") || (href = $elt.attr("href")) && href.replace(/.*(?=#[^\s]+$)/, "")
    }
    ;
    ResponsiveCollapse.init = function(element, defaultOption) {
        var $elt = $(element);
        var target = ResponsiveCollapse.getTarget(element);
        var $target = $(target);
        var data = $target.data("bs.collapse");
        var option = data ? defaultOption : $elt.data();
        var parent = $elt.attr("data-parent");
        var $parent = parent && $(parent);
        if (!data || !data.transitioning) {
            if ($parent) {
                $parent.find('[data-toggle=responsiveCollapse][data-parent="' + parent + '"]').not($elt).addClass("collapsed")
            }
            $elt[$target.hasClass("in") ? "addClass" : "removeClass"]("collapsed")
        }
        $target.responsiveCollapse(option)
    }
    ;
    ResponsiveCollapse.DEFAULTS = $.extend(Collapse.DEFAULTS, {});
    $.fn.responsiveCollapse = function(option) {
        return this.each(function() {
            var $this = $(this);
            var data = $this.data("bs.collapse");
            var options = $.extend({}, ResponsiveCollapse.DEFAULTS, $this.data(), typeof option == "object" && option);
            if (!data && options.toggle && option == "show") {
                option = !option
            }
            if (!data) {
                $this.data("bs.collapse", data = new ResponsiveCollapse(this,options))
            }
            if (typeof option == "string") {
                data[option]()
            }
        })
    }
    ;
    $.fn.responsiveCollapse.Constructor = ResponsiveCollapse;
    $(document).on("click.bs.collapse.data-api", "[data-toggle=responsiveCollapse]", function(e) {
        if (!$(this).attr("data-target")) {
            e.preventDefault()
        }
        ResponsiveCollapse.init(this, "toggle")
    });
    $window.on("resize.bs.collapse", responsiveCall);
    $(responsiveCall)
}
)(window, window.jQuery);
(function($) {
    "use strict";
    if (!guruApp.fn) {
        guruApp.fn = {}
    }
    if (guruApp.fn.dropdownVisibility) {
        throw "guruApp.fn.dropdownVisibility already defined!"
    }
    guruApp.fn.dropdownVisibility = function($elm) {
        var $w = $(window);
        $elm.on("show.bs.dropdown.dropdownVisibility", function(e) {
            var relatedTarget = e.relatedTarget;
            if (relatedTarget) {
                var $dropdownBtn = $(relatedTarget)
                  , $dropdown = $dropdownBtn.siblings(".dropdown-menu")
                  , scrollTop = $w.scrollTop()
                  , lastWindowVisibleY = scrollTop + $w.height()
                  , dropdownGroupHeight = $dropdownBtn.height() + $dropdown.height() + 5
                  , dropdownBtnTop = Math.round($dropdownBtn.offset().top)
                  , lastDropdownVisibleY = dropdownBtnTop + dropdownGroupHeight
                  , doDropUp = lastDropdownVisibleY > lastWindowVisibleY;
                if (doDropUp) {
                    doDropUp = dropdownBtnTop - dropdownGroupHeight >= 0
                }
                $dropdownBtn.closest(".btn-group").toggleClass("dropup", doDropUp)
            }
        })
    }
}
)(jQuery);
(function($) {
    "use strict";
    $.fn.carouselSliced = function(options) {
        var settings = {};
        $.extend(settings, options);
        this.each(function() {
            var $carousel = $(this)
              , nVisibleElements = $carousel.data("visible-items")
              , slidePercentage = 100 / nVisibleElements
              , $carouselInner = $carousel.find(".carousel-inner")
              , item = $carouselInner.children(".item").length;
            if (nVisibleElements >= item) {
                $carousel.find(".carousel-control").addClass("hide")
            }
            $carousel.find(".carousel-control").data("slide-percentage", slidePercentage)
        }).on("click", ".carousel-control", function(e) {
            e.preventDefault();
            $(window).scroll();
            var $ctrl = $(this)
              , $carouselInner = $ctrl.siblings(".carousel-inner")
              , $items = $carouselInner.children()
              , slidePercentage = $ctrl.data("slide-percentage");
            if ($ctrl.data("slide") == "prev") {
                $items.last().css({
                    marginLeft: "-" + slidePercentage + "%"
                }).prependTo($carouselInner).animate({
                    marginLeft: "0%"
                })
            } else {
                $items.first().animate({
                    marginLeft: -1 * slidePercentage + "%"
                }, function() {
                    $(this).addClass("hide").css({
                        marginLeft: "0%"
                    }).appendTo($carouselInner).removeClass("hide")
                })
            }
            $("carousel-sliced").on("slid.bs.carousel", function() {
                var $this = $(this);
                if ($(".carousel-inner .item:last-child").hasClass("active")) {
                    $this.children(".right.carousel-control").hide();
                    $this.children(".left.carousel-control").show()
                } else if ($(".carousel-inner .item:first-child").hasClass("active")) {
                    $this.children(".left.carousel-control").hide();
                    $this.children(".right.carousel-control").show()
                } else {
                    $this.children(".left.carousel-control").show();
                    $this.children(".right.carousel-control").show()
                }
            })
        })
    }
}
)(jQuery);
(function($, searchConfig, Log) {
    "use strict";
    if (!searchConfig) {
        Log.log("searchConfig not available");
        return false
    }
    if (window.XDomainRequest && (window.XMLHttpRequest && (new XMLHttpRequest).responseType === undefined) && window.location.protocol === "http:") {
        searchConfig.api["default"] = searchConfig.api["default"] ? searchConfig.api["default"].replace(/^https/, "http") : "#";
        searchConfig.api.residential = searchConfig.api.residential ? searchConfig.api.residential.replace(/^https/, "http") : "#";
        searchConfig.api.commercial = searchConfig.api.commercial ? searchConfig.api.commercial.replace(/^https/, "http") : "#"
    }
    var $searchBoxes = jQuery()
      , MultiStepDropdown = {
        chkboxTitles: {
            trimLength: 0,
            seperator: ", "
        },
        maxInputLength: {
            sg: {
                minprice: 9,
                maxprice: 9,
                minsize: 6,
                maxsize: 6,
                minsize_land: 6,
                maxsize_land: 6,
                minPricePerArea: 5,
                maxPricePerArea: 5,
                minbath: 2,
                mintop: 4,
                maxtop: 4
            },
            my: {
                minprice: 10,
                maxprice: 10,
                minsize: 6,
                maxsize: 6,
                minsize_land: 6,
                maxsize_land: 6,
                minPricePerArea: 6,
                maxPricePerArea: 6,
                minbath: 2,
                mintop: 4,
                maxtop: 4
            },
            id: {
                minprice: 18,
                maxprice: 18,
                minsize: 6,
                maxsize: 6,
                minsize_land: 6,
                maxsize_land: 6,
                minPricePerArea: 14,
                maxPricePerArea: 14,
                minbath: 2,
                mintop: 4,
                maxtop: 4
            },
            th: {
                minprice: 12,
                maxprice: 12,
                minsize: 6,
                maxsize: 6,
                minsize_land: 6,
                maxsize_land: 6,
                minPricePerArea: 10,
                maxPricePerArea: 10,
                minbath: 2,
                mintop: 4,
                maxtop: 4
            }
        },
        bootUp: function($dropdownMultiStep) {
            var $firstPane = $dropdownMultiStep.children(".step-pane").first()
              , $selectedLi = $firstPane.find("li.active a")
              , $selectedCheck = $firstPane.find("input[type=checkbox]:checked:not(.select-all-input)")
              , $freetext = $()
              , checkboxesTitle = ""
              , $autocomplete = $dropdownMultiStep.closest("form").find("input[name=autocomplete]")
              , isMultistepLocation = false;
            if ($selectedLi.length) {
                if ($dropdownMultiStep.parent().is(".form-group-location")) {
                    if ($autocomplete.length) {
                        try {
                            var autoCompleteOption = jQuery.parseJSON($autocomplete.val())
                              , type = autoCompleteOption.objectType;
                            isMultistepLocation = !($.inArray(type, ["DISTRICT", "AREA", "REGION"]) === -1)
                        } catch (e) {
                            isMultistepLocation = true
                        }
                    } else {
                        isMultistepLocation = true
                    }
                    if (isMultistepLocation) {
                        $selectedLi.trigger("click.searchWidget", {
                            mimic: false,
                            firstRun: true
                        })
                    } else {
                        MultiStepDropdown.unsetAllOptions($dropdownMultiStep)
                    }
                }
            } else if ($firstPane.is(".step-pane-last") && $selectedCheck.length) {
                if (!$autocomplete.length) {
                    checkboxesTitle = getTitleFromCheckbox($selectedCheck, MultiStepDropdown.chkboxTitles);
                    $firstPane.data("title-checkboxes", checkboxesTitle);
                    MultiStepDropdown.buildFullTitle($dropdownMultiStep)
                }
            } else {
                $dropdownMultiStep.data("showing-pane", 0)
            }
            $dropdownMultiStep.parent().on("shown.bs.dropdown", function() {
                MultiStepDropdown.goToCurrentPane($dropdownMultiStep)
            });
            $freetext = $dropdownMultiStep.closest("form").find(".form-control.freetext-input");
            if ($freetext.length > 1) {
                $freetext = $freetext.filter(".tt-input").first()
            }
            if ($freetext.length) {
                $freetext.on("typeahead:change", function() {
                    if ($freetext.val() && $freetext.val() != $freetext.data("location-title")) {
                        MultiStepDropdown.unsetAllOptions($dropdownMultiStep)
                    }
                });
                $freetext.on("focus", function() {
                    if ($freetext.is(".tt-input") && $freetext.typeahead("val") !== $freetext.val()) {
                        $freetext.typeahead("val", $freetext.val())
                    }
                });
                $dropdownMultiStep.parent().on("show.bs.dropdown", function() {
                    var width = 0;
                    if ($freetext.is(".tt-input")) {
                        width = $freetext.closest(".twitter-typeahead").width()
                    } else {
                        width = $freetext.width()
                    }
                    if ($(window).width() >= 768) {
                        width += $dropdownMultiStep.closest(".form-group-location").width()
                    }
                    width += 1;
                    $dropdownMultiStep.css("width", width + "px");
                    $dropdownMultiStep.children(".step-pane").each(function() {
                        $(this).css("width", width + "px")
                    })
                })
            }
        },
        unsetAllOptions: function($dropdownMultiStep) {
            this.goToPaneIndex($dropdownMultiStep, 0);
            $dropdownMultiStep.children(".step-pane").each(function() {
                var $stepPane = $(this);
                $stepPane.data("title-checkboxes", "");
                MultiStepDropdown.setStepValue($stepPane, "", "")
            });
            $dropdownMultiStep.closest(".form-group-multi-step").removeClass("js-has-value");
            $dropdownMultiStep.data("showing-pane", 0)
        },
        clickOption: function(e, stopPropagation) {
            e.preventDefault();
            var $a = $(this)
              , $stepPane = $a.closest(".step-pane")
              , $subDropdown = $a.siblings(".sub-dropdown-menu")
              , value = this.hash.replace(/^#/, "")
              , title = $a.text();
            $a.closest(".step-options").find(".active").removeClass("active");
            if (!$a.is(".dropdown-reset > a")) {
                $a.closest("li").addClass("active");
                if ($subDropdown.length) {
                    MultiStepDropdown.showSubDropdown($a.closest(".step-options"), $a)
                }
                e.stopPropagation()
            } else {
                title = "";
                if (stopPropagation) {
                    e.stopPropagation()
                }
            }
            $stepPane.data("title-checkboxes", "");
            MultiStepDropdown.setStepValue($stepPane, value, title);
            MultiStepDropdown.buildFullTitle($stepPane.closest(".dropdown-multi-step"));
            CurrentLocationDatum.destroy()
        },
        getPaneIndex: function($stepPane) {
            var $dropdownMultiStep = $stepPane.closest(".dropdown-multi-step")
              , index = $dropdownMultiStep.children(".step-pane").index($stepPane);
            return index
        },
        goToPaneIndex: function($dropdownMultiStep, index) {
            var width = $dropdownMultiStep.children(".step-pane").first().width();
            $dropdownMultiStep.stop().animate({
                scrollLeft: width * index
            }, {
                always: function() {
                    $dropdownMultiStep.data("showing-pane", index).scrollLeft(width * index)
                }
            })
        },
        goToCurrentPane: function($dropdownMultiStep) {
            var index = $dropdownMultiStep.data("showing-pane");
            if (!index) {
                index = 0
            }
            this.goToPaneIndex($dropdownMultiStep, index)
        },
        setStepValue: function($stepPane, value, title) {
            var width = $stepPane.width()
              , $dropdownMultiStep = $stepPane.closest(".dropdown-multi-step")
              , index = this.getPaneIndex($stepPane);
            $stepPane.children("input").val(value);
            $stepPane.data("title", title);
            $stepPane.toggleClass("js-has-value", !!value);
            if (value && !$stepPane.is(".step-pane-last")) {
                this.goToPaneIndex($dropdownMultiStep, index + 1)
            } else if (!value) {
                $stepPane.find(".sub-dropdown-menu").slideUp();
                $stepPane.find("input[type=checkbox]").prop("checked", false).closest("li.active").removeClass("active");
                $stepPane.find(".step-options > .active").removeClass("active")
            }
        },
        clickGoBack: function(e) {
            e.preventDefault();
            e.stopPropagation();
            var $stepPane = $(this).closest(".step-pane")
              , $dropdownMultiStep = $stepPane.closest(".dropdown-multi-step")
              , index = MultiStepDropdown.getPaneIndex($stepPane);
            $stepPane.find(".step-options > .dropdown-reset > a").trigger("click", true);
            if (index > 0) {
                index--
            }
            MultiStepDropdown.goToPaneIndex($dropdownMultiStep, index)
        },
        clickDropdownCheckbox: function(e) {
            e.stopPropagation();
            var $label = $(this)
              , isChecked = $label.children("input[type=checkbox]").prop("checked")
              , $allCheckboxes = $label.closest("ul").find("input[type=checkbox]:not(.select-all-input)")
              , $checkedCheckboxes = $allCheckboxes.filter(":checked")
              , title = ""
              , $a = null
              , $stepPane = $label.closest(".step-pane");
            $label.closest("li").toggleClass("active", isChecked);
            if ($checkedCheckboxes.length) {
                title = getTitleFromCheckbox($allCheckboxes.filter(":checked"), MultiStepDropdown.chkboxTitles);
                $stepPane.data("title-checkboxes", title)
            } else if ($checkedCheckboxes.length === 0) {
                $stepPane.data("title-checkboxes", "")
            }
            MultiStepDropdown.buildFullTitle($stepPane.closest(".dropdown-multi-step"));
            CurrentLocationDatum.destroy()
        },
        showSubDropdown: function($dropdown, $a) {
            var $subOptions = $a.siblings(".sub-dropdown-menu")
              , $checkboxes = null;
            $dropdown.find(".sub-dropdown-menu").not($subOptions).slideUp(function() {
                $(this).find("input[type=checkbox]").prop("checked", false).closest("li.active").removeClass("active")
            }).closest("li.active").removeClass("active");
            $checkboxes = $subOptions.closest("li").addClass("active").find("input[type=checkbox]");
            $checkboxes.prop("checked", false).closest("li").removeClass("active");
            if ($checkboxes.length > 1) {
                $subOptions.slideDown()
            }
        },
        buildFullTitle: function($dropdownMultiStep) {
            var parts = []
              , $btn = $()
              , title = ""
              , $freetext = $dropdownMultiStep.data("freetext");
            $dropdownMultiStep.children(".step-pane").each(function() {
                var $stepPane = $(this)
                  , title = $stepPane.data("title");
                if (title) {
                    parts.push(title)
                }
                if ($stepPane.is(".step-pane-last")) {
                    title = $stepPane.data("title-checkboxes");
                    if (title) {
                        parts.push(title)
                    }
                }
            });
            title = parts.join(", ");
            $btn = $dropdownMultiStep.siblings("button");
            if ($btn.length) {
                $btn.attr("title", title)
            }
            if (typeof $freetext === "undefined") {
                $freetext = $dropdownMultiStep.closest("form").find(".form-control.freetext-input");
                $dropdownMultiStep.data("freetext", $freetext)
            }
            if ($freetext.length) {
                if ($freetext.is(".twitter-typeahead > input")) {
                    $freetext.typeahead("val", "")
                }
                $freetext.val(title).data("location-title", title)
            }
            $dropdownMultiStep.closest(".form-group-multi-step").toggleClass("js-has-value", title.length > 0)
        }
    }
      , CurrentLocationDatum = {
        value: null,
        objectId: null,
        inputData: null,
        objectType: null,
        lastUnselectedObjectMatch: null,
        save: function(d) {
            this.destroy();
            var $inputs = this.extractLocationParameters(d)
              , autocompleteSuggestionData = {
                objectId: d.objectId,
                objectType: d.objectType,
                properties: d.properties
            };
            $searchBoxes.each(function() {
                var $form = $(this).closest("form")
                  , $input = $("<input />").attr("type", "hidden").attr("name", "autocomplete").val(JSON.stringify(autocompleteSuggestionData));
                $(this).addClass("isObjectSearch").prepend($inputs.clone());
                $form.append($input)
            });
            this.value = d.value;
            this.objectId = d.objectId;
            this.inputData = d.inputData;
            this.objectType = d.objectType
        },
        destroy: function() {
            var $objectSearch = $searchBoxes.removeClass("isObjectSearch").find("input.objectSearch");
            $searchBoxes.find("input[name=autocomplete]").remove();
            if ($objectSearch.length) {
                $objectSearch.each(function() {
                    var $i = $(this)
                      , data = {
                        name: $i.attr("name"),
                        value: ""
                    };
                    $searchBoxes.trigger("searchWidget.tideTo", data)
                });
                $objectSearch.remove()
            }
            this.value = null;
            this.objectId = null;
            this.inputData = null;
            this.objectType = null
        },
        destroyByName: function(paramName) {
            paramName = paramName.replace("[]", "");
            $searchBoxes.find("input[name='" + paramName + "[]'].objectSearch").remove()
        },
        extractLocationParameters: function(d) {
            var $inputs = jQuery()
              , fBuildInput = function(name, value, additionalData, validObject) {
                validObject = validObject === false ? validObject : true;
                var $input = $("<input />").attr("type", "hidden").attr("name", name).addClass("objectSearch").val(value);
                if (additionalData) {
                    for (var key in additionalData) {
                        if (additionalData.hasOwnProperty(key)) {
                            $input.attr(key, additionalData[key])
                        }
                    }
                }
                if (validObject) {
                    $input.addClass("validObjectSearch")
                }
                return $input
            };
            $inputs = $inputs.add(fBuildInput(d.inputData.param, d.inputData.value, d.inputData.additionalData, d.inputData.validObject));
            if (d.properties) {
                if (d.properties.latitude && d.properties.longitude) {
                    $inputs = $inputs.add(fBuildInput("center_lat", d.properties.latitude, null, false));
                    $inputs = $inputs.add(fBuildInput("center_long", d.properties.longitude, null, false))
                } else {
                    if (d.properties.region && d.inputData.param != "region_code") {
                        $inputs = $inputs.add(fBuildInput("region_code", d.properties.region))
                    }
                    if (d.properties.district && d.inputData.param != "district_code") {
                        $inputs = $inputs.add(fBuildInput("district_code", d.properties.district))
                    }
                }
            }
            return $inputs
        }
    }
      , AsyncDropdownsHelper = {
        registerFirstRunValues: function($form, paramName) {
            var $inputValues = $form.find('input.objectSearch[name="' + paramName + '[]"]')
              , $dropdown = $form.find(".param-" + paramName)
              , values = [];
            $inputValues.each(function() {
                values.push($(this).val())
            });
            $dropdown.data("first-run-values", values)
        },
        renderFactory: function(paramName, objectDropdown) {
            return function(parentCode, $form, firstRun) {
                var $dropdown = $form.find(".param-" + paramName)
                  , $cloneDropdown = $()
                  , $liSelected = $()
                  , $liSubDropdown = $()
                  , mustacheTemplate = null
                  , data = objectDropdown.getData(parentCode)
                  , hasData = data !== null && data.items.length > 1
                  , render = "";
                if (objectDropdown.template === null) {
                    if ($dropdown.is(".mustache-template")) {
                        mustacheTemplate = $dropdown.html();
                        $dropdown.removeClass(".mustache-template")
                    } else {
                        mustacheTemplate = $dropdown.find(".mustache-template").html()
                    }
                    mustacheTemplate = mustacheTemplate.replace("\x3c!--[mustache]", "").replace("[mustache]--\x3e", "");
                    objectDropdown.template = Hogan.compile(mustacheTemplate)
                }
                if ($dropdown.is(".sub-dropdown-menu")) {
                    $liSelected = $dropdown.closest(".step-pane").find(".step-options > li.active");
                    $liSubDropdown = $liSelected.find(".sub-dropdown-menu");
                    if ($liSubDropdown.length === 0) {
                        render = objectDropdown.template.render(data);
                        $cloneDropdown = $dropdown.clone(false, false).removeClass("param-" + paramName).html(render).removeClass("hide");
                        $liSelected.append($cloneDropdown);
                        MultiStepDropdown.showSubDropdown($liSelected.closest(".step-options"), $liSelected.children("a"))
                    }
                } else {
                    render = objectDropdown.template.render(data);
                    $dropdown.find(".dropdown-menu, .step-options").first().html(render).removeClass("hide")
                }
                $dropdown.find("input[type=hidden], input[type=checkbox]").prop("disabled", false);
                if (hasData) {
                    $dropdown.removeClass("hide")
                }
                if (firstRun) {
                    var $checkboxes = $()
                      , paramPreSelected = $dropdown.data("first-run-values")
                      , title = "";
                    if ($dropdown.is(".sub-dropdown-menu.mustache-template")) {
                        $checkboxes = $dropdown.siblings(".step-options").find("input[type=checkbox]:not(.select-all-input)")
                    } else if (guruApp.widgetSearch.region == "my" && paramName == "district_code" && $form.find(".param-area_code").data("first-run-values") !== undefined && $form.find(".param-area_code").data("first-run-values").length != 0) {
                        $checkboxes = []
                    } else {
                        $checkboxes = $dropdown.find("input[type=checkbox]:not(.select-all-input)");
                        if (guruApp.widgetSearch.region == "my" && paramName == "district_code") {
                            $form.find('input[type="hidden"][name="' + paramName + '"]').val("")
                        }
                        if (guruApp.widgetSearch.region == "my" && $checkboxes.length) {
                            $checkboxes = $checkboxes.filter(function() {
                                return paramPreSelected.indexOf(this.value) != -1 ? true : false
                            })
                        }
                    }
                    if (paramPreSelected.length) {
                        if ($form.find('input[name="show-district"]').length) {
                            if ($form.find('input[name="show-district"]').val() !== "1") {
                                CurrentLocationDatum.destroy()
                            }
                        } else {
                            CurrentLocationDatum.destroy()
                        }
                        $form.removeClass("isObjectSearch")
                    }
                    if ($checkboxes.length) {
                        $checkboxes = $checkboxes.filter(function() {
                            var $checkbox = $(this);
                            if ($checkbox.prop("checked")) {
                                $checkbox.closest("li").addClass("active");
                                return true
                            } else if (paramPreSelected.indexOf(this.value) != -1) {
                                if ($dropdown.is(".sub-dropdown-menu")) {
                                    $checkbox.trigger("click")
                                } else if ($dropdown.is(".param-" + paramName) && guruApp.widgetSearch.region == "my" && paramName == "district_code") {
                                    $checkbox.trigger("click")
                                } else {
                                    $checkbox.prop("checked", true).closest("li").addClass("active")
                                }
                                return true
                            } else {
                                return false
                            }
                        });
                        title = getTitleFromCheckbox($checkboxes);
                        if (guruApp.widgetSearch.region != "my" || paramName != "district_code") {
                            setValueDropdown($dropdown, $checkboxes.length, title)
                        }
                    } else {
                        if (paramPreSelected.length) {
                            paramPreSelected = paramPreSelected[0];
                            $dropdown.find(".dropdown-menu a, .step-options a").each(function() {
                                var $a = $(this)
                                  , value = $a.attr("href").replace("#", "");
                                if (value === paramPreSelected) {
                                    $a.trigger("click.searchWidget", {
                                        mimic: false,
                                        firstRun: true
                                    });
                                    return false
                                }
                                return true
                            })
                        }
                    }
                } else {
                    setValueDropdown($dropdown, "", "")
                }
            }
        },
        onClickFactory: function(paramName, objectDropdown) {
            return function(e, params) {
                e.preventDefault();
                params = $.extend({
                    mimic: true,
                    firstRun: false
                }, params);
                var $a = $(this)
                  , parentCode = $a.attr("href").replace("#", "")
                  , $hiddenInput = $()
                  , $form = $a.closest("form");
                if ($a.is(".dropdown-menu > li > a")) {
                    $hiddenInput = $a.closest(".btn-group").children("input[type=hidden]")
                } else {
                    $hiddenInput = $a.closest(".step-pane").children("input[type=hidden]")
                }
                if (parentCode !== "") {
                    if ($searchBoxes.is("input.isObjectSearch")) {
                        $searchBoxes.removeClass("isObjectSearch").find("input[name=freetext]").val("")
                    }
                    if (!params.firstRun) {
                        CurrentLocationDatum.destroy()
                    }
                } else {
                    CurrentLocationDatum.destroyByName(paramName);
                    if ($hiddenInput.length) {
                        CurrentLocationDatum.destroyByName($hiddenInput.attr("name"))
                    }
                }
                var $dropdownMenu = $searchBoxes.find(".param-" + paramName);
                if ($dropdownMenu.length) {
                    if ($dropdownMenu.is(".js-form-group")) {
                        $dropdownMenu.addClass("hide")
                    }
                    if (parentCode && objectDropdown.getData(parentCode) === null) {
                        $a.addClass("loading-ajax");
                        objectDropdown.loadData(function() {
                            $a.removeClass("loading-ajax");
                            objectDropdown.render(parentCode, $form, params.firstRun)
                        }, parentCode)
                    } else {
                        objectDropdown.render(parentCode, $form, params.firstRun);
                        if (!parentCode && !params.firstRun) {
                            $dropdownMenu.find(".dropdown-reset a").trigger("click")
                        }
                    }
                }
            }
        },
        loadLocalStorageData: function(key) {
            return window.localStorage ? JSON.parse(window.localStorage.getItem(key)) : null
        },
        setLocalStorageData: function(key, value) {
            if (!window.localStorage) {
                return false
            }
            window.localStorage.setItem(key, JSON.stringify(value));
            return true
        },
        unsetLocalStorageData: function(key) {
            if (!window.localStorage) {
                return false
            }
            window.localStorage.removeItem(key);
            return true
        }
    }
      , Districts = {
        template: null,
        parent: null,
        data: AsyncDropdownsHelper.loadLocalStorageData("hierarchy." + searchConfig.api_hierarchy_timestamp + "." + searchConfig.locale),
        url: searchConfig.jsonRefData.hierarchy,
        getData: function(parentCode) {
            var data = null;
            if (parentCode && Districts.data !== null && Districts.data[parentCode] !== "undefined") {
                data = {
                    items: Districts.data[parentCode].districts
                };
                this.parent = parentCode
            }
            return data
        },
        loadData: function(callback, parentCode) {
            if (Districts.data !== null) {
                callback()
            } else {
                $.getJSON(Districts.url, function(d) {
                    Districts.data = d;
                    if (window.localStorage) {
                        Object.keys(localStorage).forEach(function(key) {
                            if (/^hierarchy|^districts|^areas/.test(key)) {
                                localStorage.removeItem(key)
                            }
                        })
                    }
                    window.localStorage.setItem("hierarchy." + searchConfig.api_hierarchy_timestamp + "." + searchConfig.locale, JSON.stringify(d));
                    if (typeof callback === "function") {
                        callback()
                    }
                })
            }
        },
        selectDistrict: function($form, districtCode) {
            var $districts = $form.find('input[name="district_code[]"]');
            if ($districts.length) {
                $districts.filter('[value="' + districtCode + '"]').trigger("click")
            }
        },
        render: function(parentCode, $form, firstRun) {
            Districts.render = AsyncDropdownsHelper.renderFactory("district_code", Districts);
            Districts.render(parentCode, $form, firstRun)
        },
        onParentClick: function(e, params) {
            Districts.onParentClick = AsyncDropdownsHelper.onClickFactory("district_code", Districts);
            Districts.onParentClick.call(this, e, params)
        }
    }
      , Areas = {
        template: null,
        data: AsyncDropdownsHelper.loadLocalStorageData("hierarchy." + searchConfig.api_hierarchy_timestamp + "." + searchConfig.locale),
        url: searchConfig.jsonRefData.areas,
        getData: function(parentCode) {
            var result = $.grep(Districts.data[Districts.parent].districts, function(e) {
                return e.k == parentCode
            });
            var data = null;
            if (parentCode && typeof result[0] !== "undefined" && typeof result[0].areas !== "undefined") {
                data = {
                    items: result[0].areas
                }
            }
            return data
        },
        loadData: function(callback, parentCode) {
            if (Areas.data !== null) {
                callback()
            } else {
                Districts.loadData(callback, Districts.parent)
            }
        },
        render: function(parentCode, $form, firstRun) {
            Areas.render = AsyncDropdownsHelper.renderFactory("area_code", Areas);
            Areas.render(parentCode, $form, firstRun)
        },
        onParentClick: function(e, params) {
            Areas.onParentClick = AsyncDropdownsHelper.onClickFactory("area_code", Areas);
            Areas.onParentClick.call(this, e, params)
        }
    }
      , InputBroker = {
        inputs: {},
        addDropdown: function($dropdown) {
            var $input = $dropdown.children("input[type=hidden]");
            if ($input.length) {
                var name = $input.attr("name");
                if (!this.inputs[name]) {
                    this.inputs[name] = jQuery()
                }
                this.inputs[name] = this.inputs[name].add($dropdown)
            }
        },
        addCheckbox: function($input) {
            var name = $input.attr("name")
              , value = $input.val()
              , key = name + ":" + value;
            if (!this.inputs[key]) {
                this.inputs[key] = jQuery()
            }
            this.inputs[key] = this.inputs[key].add($input)
        },
        changeInputs: function() {
            var $thisDropdown = $(this)
              , $a = $thisDropdown.find("a").filter(function() {
                return InputBroker.stash.value == this.hash.replace(/^#/, "")
            });
            setValueDropdown($thisDropdown, InputBroker.stash.value, InputBroker.stash.title);
            if ($a.siblings(".sub-dropdown-menu").length) {
                showSubDropdown($thisDropdown, $a)
            }
            if ($a.length) {
                $a.closest("li").addClass("active").siblings(".active").removeClass("active")
            }
        },
        mimicDropdown: function($originalDropdown) {
            var $input = $originalDropdown.children("input[type=hidden]")
              , name = $input.attr("name");
            if (!name) {
                return
            }
            InputBroker.stash = {
                value: $input.val(),
                title: $originalDropdown.children("button").attr("title")
            };
            if (this.inputs[name]) {
                this.inputs[name].not($originalDropdown).not(".hide, .tide-to.hide .btn-group").each(InputBroker.changeInputs)
            }
        },
        mimicCheckbox: function($input) {
            var name = $input.attr("name")
              , value = $input.val()
              , key = name + ":" + value
              , isChecked = $input.prop("checked");
            if (this.inputs[key]) {
                this.inputs[key].prop("checked", isChecked).closest("li").toggleClass("active", isChecked)
            }
            notifyInputValueChanged($input.closest(".btn-group"), name, value, isChecked)
        },
        tideToListener: function(event, params) {
            var $listeners = this;
            params.name = params.name.replace("[]", "");
            $listeners.filter(".tide-to-" + params.name).each(function() {
                InputBroker.updateTideToValue.apply(this, [params])
            });
            $listeners.parents(".js-form-group").find('.property-type-code-L input[type="checkbox"]').not(".select-all-input").off("click").on("click", function() {
                InputBroker.updateTideToValue.apply($(".param-newProject"), [{
                    name: ""
                }])
            });
            setTimeout(function() {
                $listeners.filter(".tide-to-focus").each(function() {
                    InputBroker.updateTideToFocus.apply(this, [params])
                })
            }, 0)
        },
        updateTideToFocus: function(params) {
            var $element = $(this)
              , tideToFocusName = $element.data("tidetofocus")
              , $input = $element.closest("form").find('input[name="' + tideToFocusName + '"]')
              , show = false;
            if ($input.hasClass("focus")) {
                $element.removeClass("hide")
            } else {
                $element.addClass("hide")
            }
        },
        updateTideToValue: function(params) {
            var $element = $(this), $block = null, tideToValues = $element.data("tidetowhen"), tideToElements = $element.data("tideto"), show = true, isRange;
            if ($element.is(".tide-to")) {
                $block = $element
            } else {
                $block = $element.closest(".tide-to")
            }
            isRange = $block.closest(".btn-group-range").length > 0;
            $.each(tideToElements, function(i) {
                var valueOfElement = ""
                  , $input = null
                  , arrayHasValue = false;
                if (this == params.name) {
                    valueOfElement = params.value
                } else {
                    if (this && this.indexOf("[]") != -1) {
                        var valueOfElement = $("form.searchbox").find('.tide-to-market.active input[name="property_type_code[]"]:checked').first().val()
                    } else {
                        $input = $("form.searchbox").find('input[name="' + this + '"]');
                        if ($input.is("[type=radio]")) {
                            $input = $input.filter(":checked")
                        }
                        valueOfElement = $input.val()
                    }
                }
                if (tideToValues[i] == "!EMPTY") {
                    show = show && valueOfElement !== ""
                } else if (tideToValues[i] == "HIDE") {
                    if (this === params.name) {
                        show = false
                    }
                } else {
                    arrayHasValue = $.inArray(valueOfElement, tideToValues[i]) != -1;
                    if ($.isArray(tideToValues[i]) && tideToValues[i].length === 1 && tideToValues[i][0].indexOf("!") === 0) {
                        arrayHasValue = !(tideToValues[i][0] === "!" + valueOfElement)
                    }
                    show = show && arrayHasValue
                }
            });
            if (show) {
                $block.removeClass("hide").find("input[type=hidden], input[type=checkbox]").prop("disabled", false)
            } else {
                $block.addClass("hide").find("input[type=hidden], input[type=checkbox]").prop("disabled", true);
                if ($block.hasClass("param-newProject")) {
                    $block.find("a").removeClass("checked");
                    $block.find("input").prop("checked", false);
                    $block.find('input[value="all"]').prop("checked", true)
                }
            }
            if (isRange) {
                if (show) {
                    $block.removeClass("hide").find("input[type=text]").prop("disabled", false)
                } else {
                    $block.addClass("hide").find("input[type=text]").prop("disabled", true)
                }
            }
            var events = [];
            if ($block.is(".btn-group")) {
                if ($block.find(".dropdown-menu input:checkbox").length) {
                    var name = "untitled"
                      , value = "";
                    $block.find(".dropdown-menu input:checkbox").each(function() {
                        if (name === "untitled") {
                            name = $(this).attr("name")
                        }
                        if ($(this).prop("checked")) {
                            value += $(this).val() + ","
                        }
                    });
                    events.push({
                        source: $block,
                        name: name,
                        value: value
                    })
                } else if ($block.find("input[type=hidden]").length) {
                    var $input = $block.find("input[type=hidden]");
                    events.push({
                        source: $block,
                        name: $input.attr("name"),
                        value: $input.val()
                    })
                } else {
                    var name = $block.attr("class").match(/param-([^ ]+)/)[1] + "[]";
                    events.push({
                        source: $block,
                        name: name,
                        value: ""
                    })
                }
            } else if ($block.is(".form-group-numeric")) {
                var $input = $block.find("input[type=text]")
                  , value = $input.val().replace(/[^0-9\-]+/g, "");
                events.push({
                    source: $block,
                    name: $input.attr("name"),
                    value: value
                })
            } else if ($block.is(".form-group-range")) {
                $block.find(".btn-group").each(function() {
                    var $input = $(this).find("input[type=hidden]");
                    events.push({
                        source: $(this),
                        name: $input.attr("name"),
                        value: $input.val()
                    })
                })
            }
            $.each(events, function(index, event) {
                notifyInputVisibilityChanged(event.source, event.name, event.value, show)
            })
        },
        tideToAdd: function($pool, $element) {
            if ($element.data("tideto")) {
                var tideToElements = $element.data("tideto").split("|")
                  , tideToValues = $element.data("tidetowhen").split("|");
                $element.data("tideto", tideToElements);
                $.each(tideToValues, function(i) {
                    tideToValues[i] = tideToValues[i].split(",")
                });
                $element.data("tidetowhen", tideToValues);
                $pool = $pool.add($element)
            }
            if ($element.data("tidetofocus")) {
                $element.data("tidetofocus", $element.data("tidetofocus").split("|"));
                $pool = $pool.add($element)
            }
            return $pool
        }
    }
      , TrackChanges = {
        iniValues: {},
        parameterNames: null,
        buildList: function($form, parameterNames, listContainer) {
            $.each(parameterNames, function(index, paramName) {
                $form.find('input[name="' + paramName + '"], input[name="' + paramName + '[]"]').each(function() {
                    var $i = $(this)
                      , testArrayParameter = /\[\]$/
                      , rawName = $i.attr("name")
                      , name = rawName.replace("[]", "")
                      , isArray = testArrayParameter.test(rawName);
                    if ($i.val() === "" || $i.val() === "{{k}}") {
                        return true
                    }
                    if ($i.is("[type=checkbox]:checked") || $i.is("[type=hidden]")) {
                        if (isArray) {
                            if (typeof listContainer[name] == "undefined") {
                                listContainer[name] = []
                            }
                            listContainer[name].push($i.val())
                        } else {
                            listContainer[name] = $i.val()
                        }
                    }
                    return true
                })
            })
        },
        track: function($form, parameterNames) {
            TrackChanges.parameterNames = parameterNames;
            TrackChanges.buildList($form, parameterNames, TrackChanges.iniValues)
        },
        hasChange: function($form) {
            var endValues = {};
            TrackChanges.buildList($form, TrackChanges.parameterNames, endValues);
            return $.param(endValues) !== $.param(TrackChanges.iniValues)
        }
    }
      , sprintf = function(string, replacement) {
        if (typeof replacement === "string") {
            replacement = [replacement]
        }
        return string.replace(/%\d+/g, function(match) {
            match = parseInt(match.replace("%", ""), 10);
            return replacement[match - 1] ? replacement[match - 1] : ""
        })
    }
      , sqft2sqm = function(sqft) {
        return Math.round(parseFloat(sqft) / 10.764).toString()
    }
      , presentTitle = function(param, value, transformation) {
        var replaceValues = []
          , title = value;
        switch (param) {
        case "mintop":
        case "maxtop":
            break;
        case "minsize":
        case "maxsize":
        case "minsize_land":
        case "maxsize_land":
            title = thousandsComma(value);
            replaceValues.push(title, thousandsComma(sqft2sqm(value)));
            break;
        case "beds":
        case "minbed":
        case "maxbed":
        case "minbath":
        case "maxbath":
            if (!value) {
                value = "0"
            }
        default:
            title = thousandsComma(value);
            replaceValues.push(title);
            break
        }
        if (transformation) {
            title = sprintf(transformation, replaceValues)
        }
        return title
    }
      , thousandsComma = function(number) {
        var groupingSeparatorSymbol = ","
          , decimalSeparatorSymbol = "."
          , regx = /(\d+)(\d{3})/;
        number = number.split(decimalSeparatorSymbol);
        if ($("body").is(".lang-ms")) {
            groupingSeparatorSymbol = ".";
            decimalSeparatorSymbol = ","
        }
        while (regx.test(number[0])) {
            number[0] = number[0].replace(regx, "$1" + groupingSeparatorSymbol + "$2")
        }
        return number.join(decimalSeparatorSymbol)
    }
      , showSubDropdown = function($dropdown, $a) {
        var $subOptions = $a.siblings(".sub-dropdown-menu")
          , $checkboxes = null;
        $dropdown.find(".sub-dropdown-menu").not($subOptions).slideUp(function() {
            $(this).find("input[type=checkbox]").prop("checked", false).closest("li.active").removeClass("active")
        }).closest("li.active").removeClass("active");
        $checkboxes = $subOptions.closest("li").addClass("active").find("input[type=checkbox]");
        $checkboxes.prop("checked", true).closest("li").addClass("active");
        if ($checkboxes.length > 1) {
            $subOptions.slideDown();
            return true
        }
        return false
    }
      , setHLPACriteria = function($value) {
        var dropdown = $(".btn-price-range");
        if ($value) {
            var minprice = guruApp.listingSearch.hlpaData.minLoanAmount + "";
            var maxprice = guruApp.listingSearch.hlpaData.maxLoanAmount + "";
            setValueDropdown(dropdown, minprice, "", "minprice", "");
            setValueDropdown(dropdown, maxprice, "", "maxprice", "")
        } else {
            setValueDropdown(dropdown, "", "minprice", "minprice", "");
            setValueDropdown(dropdown, "", "maxprice", "maxprice", "")
        }
    }
      , resetCheckbox = function() {
        if ($('input:checkbox[name="only_with_hlpa"]').is(":checked")) {
            var existingTitle = $(".btn-price-range").find("button")[1].title;
            var dropdown = $(".btn-price-range");
            var title = getDropdownRangeTitle(dropdown, "minprice", guruApp.listingSearch.hlpaData.minLoanAmount + "");
            title = getDropdownRangeTitle(dropdown, "maxprice", guruApp.listingSearch.hlpaData.maxLoanAmount + "");
            if (existingTitle !== title && existingTitle !== "Any Price") {
                $('input:checkbox[name="only_with_hlpa"]').click()
            }
        }
    }
      , setValueDropdown = function($dropdown, value, title, name, source) {
        value = decodeURIComponent(value);
        var $btnLabel = $dropdown.children(".dropdown-toggle").first()
          , children = null
          , maxRangeParam = null
          , minRangeParam = null;
        name = name || "";
        title = value || title ? title : $btnLabel.data("title");
        title = title == "" ? $btnLabel.data("title") : title;
        if (!$dropdown.is(".btn-group-range")) {
            if (value) {
                $dropdown.addClass("js-has-value")
            } else {
                $dropdown.removeClass("js-has-value")
            }
        }
        $btnLabel.attr("title", title).children(".btn-title").text(title);
        children = $dropdown.find(name ? 'input[name="' + name + '"]' : "input[type=hidden]");
        children.each(function(index, element) {
            $(element).val(value)
        });
        if (value === "") {
            $dropdown.find("input[type=checkbox]").prop("checked", false);
            if ($dropdown.children(".has-select-all").length > 0) {
                if (source === "checkbox") {
                    return
                }
                $dropdown.find(".sub-dropdown-menu").slideUp()
            } else {
                $dropdown.find(".sub-dropdown-menu").hide()
            }
            $dropdown.find("li.active").removeClass("active")
        }
    }
      , validateDropdownRange = function($dropdown, name) {
        if ($dropdown.hasClass("btn-group-range")) {
            var maxRangeParam = $dropdown.find("li.dropdown-input-range.range-min").attr("data-rangemaxparam")
              , minRangeParam = $dropdown.find("li.dropdown-input-range.range-max").attr("data-rangeminparam")
              , lastChangedParam = name || minRangeParam
              , minVal = $dropdown.find('input[name="' + minRangeParam + '"]').prop("value")
              , maxVal = $dropdown.find('input[name="' + maxRangeParam + '"]').prop("value")
              , reset = false
              , $targetDropdown = null;
            minVal = parseFloat(minVal.replace(/[^0-9]+/g, "").replace(/^0+/, "0")) || 0;
            maxVal = parseFloat(maxVal.replace(/[^0-9]+/g, "").replace(/^0+/, "0")) || 0;
            if (maxRangeParam || minRangeParam) {
                if (minVal <= maxVal || lastChangedParam == maxRangeParam) {
                    $targetDropdown = $dropdown.find(".option-range-min");
                    reset = enableDropDownOptionList($targetDropdown, minRangeParam, null, maxVal <= 0 ? NaN : maxVal, minVal)
                }
                if (reset) {
                    minVal = parseFloat($dropdown.find('input[name="' + minRangeParam + '"]').prop("value")) || 0;
                    maxVal = parseFloat($dropdown.find('input[name="' + maxRangeParam + '"]').prop("value")) || 0
                }
                if (reset || minVal <= maxVal || lastChangedParam == minRangeParam) {
                    $targetDropdown = $dropdown.find(".option-range-max");
                    enableDropDownOptionList($targetDropdown, null, maxRangeParam, minVal <= 0 ? NaN : minVal, maxVal)
                }
            }
        }
    }
      , enableDropDownOptionList = function($targetDropdown, minRangeParam, maxRangeParam, floatVal, selectedTargetValue) {
        var enableCount = 0;
        var disableCount = 0;
        var disabledActive = false;
        $targetDropdown.find("ul.dropdown-menu > li > a").each(function(index, element) {
            var $element = $(element);
            var othValue = parseFloat($element.attr("href").replace("#", ""));
            if (isNaN(othValue)) {
                return
            }
            if (isNaN(floatVal)) {
                enableDropDownOption($element);
                enableCount++
            } else {
                if (minRangeParam) {
                    if (othValue > floatVal) {
                        disabledActive = disableDropDownOption($element);
                        disableCount++
                    } else {
                        enableDropDownOption($element);
                        enableCount++
                    }
                } else {
                    if (othValue < floatVal) {
                        disabledActive = disableDropDownOption($element);
                        disableCount++
                    } else {
                        enableDropDownOption($element);
                        enableCount++
                    }
                }
            }
        });
        if (disabledActive || enableCount == 0 && selectedTargetValue == 0 || !isNaN(floatVal) && maxRangeParam && selectedTargetValue < floatVal || !isNaN(floatVal) && minRangeParam && selectedTargetValue > floatVal) {
            resetDropDown($targetDropdown);
            return true
        }
        return false
    }
      , resetDropDown = function($dropdown) {
        var isRange = $dropdown.closest(".btn-group-range").length > 0;
        if (isRange) {
            handleDropdownOptionClick($dropdown.find(".dropdown-reset a")[0])
        } else {
            $dropdown.find(".dropdown-reset a").trigger("click")
        }
    }
      , ignoreClicks = function(e) {
        e.preventDefault();
        return false
    }
      , disableDropDownOption = function($option) {
        $option.parent().addClass("disabled");
        $option.on("click", ignoreClicks);
        return $option.parent().hasClass("active")
    }
      , enableDropDownOption = function($option) {
        $option.parent().removeClass("disabled");
        $option.off("click", ignoreClicks)
    }
      , getTitleFromCheckbox = function($checkboxes, options) {
        var title = []
          , lastFullTitle = "";
        options = $.extend({
            trimLength: 4,
            seperator: " / "
        }, options);
        $checkboxes.each(function() {
            var text = "";
            lastFullTitle = $(this).closest("label").text();
            text = $.trim(lastFullTitle);
            if (options.trimLength > 0) {
                text = $.trim(text.substring(0, options.trimLength))
            }
            title.push(text)
        });
        if (title.length == 1) {
            title = lastFullTitle
        } else {
            title = title.join(options.seperator)
        }
        return title
    }
      , clickDropdownCheckbox = function(event) {
        if ($(this).closest(".dropdown-menu").is(".dropdown-multi-step")) {
            MultiStepDropdown.clickDropdownCheckbox.call(this, event);
            return
        }
        event.stopPropagation();
        var $label = $(this);
        $label.closest("ul").find("input[type=checkbox]").one("change", function(event) {
            event.stopImmediatePropagation();
            var $allCheckboxes = $(this).closest("ul").find("input[type=checkbox]:checked:not(.select-all-input)")
              , $dropdown = $label.closest(".btn-group")
              , title = getTitleFromCheckbox($allCheckboxes)
              , value = "";
            if ($label.is(".sub-dropdown-menu label")) {
                if ($allCheckboxes.length) {
                    var $a = $allCheckboxes.first().closest(".sub-dropdown-menu").siblings("a").first();
                    if ($a.length) {
                        value = $a.prop("hash").replace(/^#/, "")
                    }
                }
            } else {
                value = $allCheckboxes.length
            }
            setValueDropdown($dropdown, value, title, "", "checkbox")
        })
    }
      , clickDropdownRange = function(event, params) {
        var $inps = $(this).closest(".btn-group").find(".dropdown-input-range-default input");
        var $defaultInp;
        if ($inps.length > 0) {
            $defaultInp = $($inps[0])
        } else {
            $inps = $(this).closest(".btn-group").find(".dropdown-input-range input");
            if ($inps.length > 0) {
                $defaultInp = $($inps[0])
            }
        }
        if ($defaultInp) {
            setTimeout(function() {
                $defaultInp.trigger("input_focus.searchWidget")
            }, 0)
        }
    }
      , getDropdownRangeTitle = function($dropdown, name, value) {
        var valueRanges = {
            min: null,
            max: null
        };
        $dropdown.find(".dropdown-input-range input").each(function(index, element) {
            var setValue = element.name == name ? value : element.value
              , rangeLimit = index === 0 ? "min" : "max"
              , paramName = !name ? element.name : name;
            valueRanges[rangeLimit] = presentTitle(paramName, setValue)
        });
        return generateRangeTitle($dropdown, valueRanges)
    }
      , generateRangeTitle = function($dropdown, valueRanges) {
        var title = "";
        if (valueRanges["min"] || valueRanges["max"]) {
            var nrVals = 0;
            var values = [];
            if (valueRanges["min"]) {
                values.push(valueRanges["min"]);
                nrVals++
            }
            if (valueRanges["max"]) {
                values.push(valueRanges["max"]);
                nrVals++
            }
            if (nrVals == 1 || valueRanges["min"] === valueRanges["max"]) {
                if (valueRanges["min"]) {
                    title = sprintf($dropdown.data("gentitle-min"), valueRanges["min"])
                } else {
                    title = sprintf($dropdown.data("gentitle-max"), valueRanges["max"])
                }
            } else {
                title = sprintf($dropdown.data("gentitle-range"), values.join($dropdown.data("gentitle-range-separator")))
            }
            $dropdown.addClass("js-has-value")
        } else {
            $dropdown.removeClass("js-has-value");
            title = $dropdown.data("title")
        }
        return title
    }
      , handleDropdownOptionClick = function(element) {
        var $a = $(element)
          , $dropdown = $(element).closest(".btn-group")
          , value = element.hash.replace(/^#/, "")
          , name = getDropdownName(element);
        $dropdown.children(".dropdown-menu").children(".active").removeClass("active");
        $dropdown.find(".dropdown-menu .dropdown-menu").children(".active").removeClass("active");
        var $li = $a.closest("li");
        if (!$li.is(".dropdown-reset")) {
            $li.addClass("active")
        }
        var title = $a.text();
        if ($dropdown.hasClass("btn-group-range")) {
            title = getDropdownRangeTitle($dropdown, name, value)
        }
        setValueDropdown($dropdown, value, title, name)
    }
      , getDropdownName = function(element) {
        var $dropdown = $(element).closest(".btn-group")
          , name = $dropdown.children("input[type=hidden]").attr("name");
        if (!name) {
            name = $(element).closest("li.range-options").data("targetname") || ""
        }
        return name
    }
      , clickDropdownOption = function(event, params) {
        event.preventDefault();
        params = $.extend({
            mimic: true,
            firstRun: false
        }, params);
        var $a = $(this)
          , value = this.hash.replace(/^#/, "")
          , name = getDropdownName(this)
          , hidden = $a.closest(".js-form-group").hasClass("hide")
          , $dropdown = $a.closest(".btn-group");
        if ($dropdown.is(".form-group-multi-step")) {
            return
        }
        if ($dropdown.find(".has-select-all").length > 0) {
            var $li = $a.closest("li");
            if ($li.hasClass("active")) {
                var $subDropdown = $li.find(".sub-dropdown-menu");
                if ($subDropdown.find("input:checked").length === 0) {
                    $dropdown.find(".dropdown-reset a").trigger("click", true)
                } else if ($subDropdown.is(":visible")) {
                    $subDropdown.slideUp()
                } else {
                    $subDropdown.slideDown()
                }
                return
            }
        }
        handleDropdownOptionClick(this);
        validateDropdownRange($dropdown, getDropdownName(this));
        var $subDropdown = $a.siblings(".sub-dropdown-menu");
        if ($subDropdown.length) {
            var subDropdownShown = true;
            if (params.firstRun && $subDropdown.children().length > 1) {
                $subDropdown.slideDown()
            } else {
                subDropdownShown = showSubDropdown($dropdown, $a)
            }
            if (subDropdownShown) {
                event.stopPropagation()
            }
        }
        if ($("body").hasClass("app-sg") && name == "property_type" && event.screenX && event.screenY) {
            var $form = $(this).closest("form");
            if (value != "H") {
                var $hdbMultiStep = $form.find(".dropdown-multi-step .param-hdb_estate");
                if ($hdbMultiStep.find("input:checked").length) {
                    $hdbMultiStep.find(".dropdown-reset > a").trigger("click", true)
                }
            } else {
                var $districtCode = $form.find(".dropdown-multi-step .param-district_code");
                if ($districtCode.find("input:checked").length) {
                    $districtCode.find(".dropdown-reset > a").trigger("click", true)
                }
            }
        }
        if ($dropdown.hasClass("btn-group-range")) {
            var rangeType = $(this).closest("li.range-options").data("rangetype");
            var ranges = $dropdown.find(".dropdown-input-range");
            var checkNext = false;
            for (var i = 0; i < ranges.length; i++) {
                var $range = $(ranges[i]);
                if (checkNext) {
                    $range.find("input.form-control").each(function(index, element) {
                        $(element).trigger("input_focus.searchWidget")
                    });
                    checkNext = false;
                    break
                } else if ($range.hasClass("range-" + rangeType)) {
                    checkNext = true
                }
            }
            if (!checkNext) {
                event.stopPropagation()
            }
        }
        $(this).closest("form").trigger("searchWidget.tideTo", {
            name: name,
            value: value
        });
        if (params.mimic) {
            InputBroker.mimicDropdown($dropdown)
        }
        if (!name) {
            name = $dropdown.find("input:checkbox:first").attr("name")
        }
        notifyInputValueChanged($dropdown, name, value, !hidden)
    }
      , freetextDropdownOption = function($input) {
        var $dropdown = $input.closest(".btn-group"), isRange = $dropdown.hasClass("btn-group-range"), value = $input.val().replace(/[^0-9]+/g, "").replace(/^0+/, "0"), title = value, param;
        if (isRange) {
            param = $input.attr("name")
        } else {
            param = $dropdown.children("input[type=hidden]").attr("name");
            $input.val("")
        }
        var $a = $dropdown.find(".dropdown-menu a").filter(function() {
            return value == this.hash.replace(/^#/, "")
        }).last();
        title = "";
        if (isRange) {
            title = getDropdownRangeTitle($dropdown, param, value)
        } else {
            if ($a.length) {
                title = $a.text()
            } else {
                title = presentTitle(param, value, $dropdown.data("gentitle"))
            }
        }
        setValueDropdown($dropdown, value, title, param);
        InputBroker.mimicDropdown($dropdown);
        notifyInputValueChanged($dropdown, param, value)
    }
      , enterFreetextDropdownOption = function(event) {
        if (event.which == 13) {
            event.preventDefault();
            var $input = $(this);
            freetextDropdownOption($input);
            $input.closest(".dropdown-menu").click();
            return false
        }
    }
      , closedDropdown = function(event) {
        var $freetextInput = $(this).find(".dropdown-input-text input, .dropdown-input-range input");
        if ($freetextInput.length && $freetextInput.val() !== "") {
            freetextDropdownOption($freetextInput)
        }
    }
      , bootUpDropdown = function(i) {
        var $options = $(this)
          , $dropdown = $options.closest(".btn-group")
          , isRange = $dropdown.hasClass("btn-group-range")
          , $input = $options.siblings("input[type=hidden]").first()
          , param = $input.attr("name")
          , value = $input.val()
          , title = null
          , $nestedBtnGroup = null;
        if ($options.is(".dropdown-multi-step")) {
            MultiStepDropdown.bootUp($options);
            return true
        }
        if ($options.data("source-json-ref")) {
            return true
        }
        if (isRange) {
            title = getDropdownRangeTitle($dropdown);
            setValueDropdown($dropdown, "", title);
            var minRangeParam = $dropdown.find(".dropdown-menu > .range-max").data("rangeminparam");
            validateDropdownRange($dropdown, minRangeParam);
            return true
        }
        if (!$input.length) {
            title = getTitleFromCheckbox($dropdown.find("input[type=checkbox]:checked:not(.select-all-input)"));
            setValueDropdown($dropdown, title.length, title);
            return true
        }
        if ($dropdown.is(".hide.tide-to") && !$dropdown.is(".param-distance")) {
            if ($dropdown.find(".dropdown-reset").length) {
                $input.val("")
            }
            return true
        }
        if ($dropdown.is(".btn-group")) {
            if ($dropdown.is(".form-group.hide.tide-to .btn-group")) {
                $input.val("");
                return true
            }
            $nestedBtnGroup = $dropdown.find(".dropdown-menu .dropdown-input-toggle");
            if ($nestedBtnGroup.length > 0 && $dropdown.find(".sub-dropdown-menu input:checked").length === 0) {
                title = getTitleFromCheckbox($nestedBtnGroup.find("input:checked:not(.select-all-input)"));
                setValueDropdown($dropdown, "", title)
            }
        }
        if (value === "" && param !== "property_type") {
            return true
        }
        var $a = $options.find("a").filter(function() {
            return value == decodeURIComponent(this.hash).replace(/^#/, "")
        }).last();
        if ($a.length) {
            $a.trigger("click.searchWidget", {
                mimic: false,
                firstRun: true
            })
        } else if (title === null) {
            title = presentTitle(param, value, $dropdown.data("gentitle"));
            setValueDropdown($dropdown, value, title)
        }
        if ($dropdown.children(".has-select-all").length > 0) {
            $dropdown.find(".sub-dropdown-menu input:checked:not(.select-all-input)").first().trigger("change")
        }
        return true
    }
      , removeUnselectedObjectMatch = function($form) {
        $form.find("input[name=unselected]").remove();
        CurrentLocationDatum.lastUnselectedObjectMatch = null
    }
      , updateFreeTextSuggestion = function($freetext) {
        if (CurrentLocationDatum.value && CurrentLocationDatum.value != $freetext.val()) {
            CurrentLocationDatum.destroy();
            removeUnselectedObjectMatch($searchBoxes)
        } else if (null === CurrentLocationDatum.value) {
            CurrentLocationDatum.destroy()
        }
    }
      , changeFreeTextQuery = function() {
        var $i = $(this)
          , $thisSearchBox = $searchBoxes.has($i)
          , $otherSearchBoxes = $searchBoxes.not($thisSearchBox);
        updateFreeTextSuggestion($i);
        if ($otherSearchBoxes.length) {
            $otherSearchBoxes.find("input[name=freetext]").val($i.val())
        }
    }
      , clickSearchMarketType = function(event, params) {
        event.stopPropagation();
        $(this).addClass("active").siblings(".active").removeClass("active");
        params = $.extend({
            mimic: true,
            firstRun: false
        }, params);
        if (params.mimic) {
            var $l = $(this)
              , $thisSearchBox = $searchBoxes.has($l)
              , $otherSearchBoxes = $searchBoxes.not($thisSearchBox);
            if (typeof event.handleObj !== "undefined") {
                if (event.handleObj.namespace == "searchWidget") {
                    $thisSearchBox.trigger("ga.searchWidget.options", ["market", $l.children("input").val()])
                }
            }
            if ($otherSearchBoxes.length) {
                $otherSearchBoxes.find(".dropdown-input-toggle-market label").eq($l.index()).trigger("click", {
                    mimic: false
                })
            }
        }
    }
      , clickNumeric = function(event) {
        event.preventDefault();
        var $btn = $(this)
          , $input = $btn.siblings("input")
          , params = {
            action: $btn.text()
        };
        changeNumericField.apply($input, [event, params]);
        $btn.blur();
        return false
    }
      , changeNumericField = function(event, params) {
        params = $.extend({}, params);
        var $input = $(this)
          , valueNumeric = parseInt($input.val().replace(/[^0-9]+/g, ""), 10) || 0;
        if (params.action) {
            if (params.action == "+") {
                valueNumeric++
            } else {
                if (valueNumeric > 0) {
                    valueNumeric--
                }
            }
        }
        notifyInputValueChanged($input.closest(".js-form-group"), $input.attr("name"), valueNumeric);
        var value = valueNumeric == 0 ? "" : valueNumeric;
        value = presentTitle($input.attr("name"), value.toString(), $input.data("gentitle"));
        $input.val(value).trigger("input");
        var $group = $input.closest(".form-group-numeric");
        var $defaultValue = parseFloat($group.data("value-default")) || 0;
        if ($defaultValue == valueNumeric) {
            $group.removeClass("js-has-value")
        } else {
            $group.addClass("js-has-value")
        }
    }
      , checkRangeValues = function(event, params) {
        var $dropdown = $(this).closest(".btn-group");
        validateDropdownRange($dropdown, this.name)
    }
      , clickCheckbox = function() {
        var $input = $(this);
        if ($input.prop("checked")) {
            notifyInputValueChanged($input.closest(".js-form-group"), $input.attr("name"), $input.val())
        } else {
            notifyInputValueChanged($input.closest(".js-form-group"), $input.attr("name"), "")
        }
    }
      , radioButtonClickHandler = function() {
        var $input = $(this);
        notifyInputValueChanged($input.closest(".js-form-group"), $input.attr("name"), $input.val())
    }
      , toggleExpanded = function(event) {
        event.preventDefault();
        var $a = $(this)
          , $li = $a.closest("li")
          , $searchBox = $a.closest(".searchbox")
          , sliderEvents = {
            start: function() {
                $searchBox.addClass("searchbox-animating")
            },
            always: function() {
                $searchBox.removeClass("searchbox-animating")
            }
        };
        $searchBox.toggleClass("search-is-expanded");
        $searchBox.trigger("ga.searchWidget.expand", [$searchBox.is(".search-is-expanded") ? "Show" : "Hide"]);
        toggleExpandedTopOptions($a);
        var $bottomButton = $($a.closest("fieldset").find(".search-options")[1]);
        $bottomButton.find("li").slideToggle();
        $a.closest(".search-options").closest("fieldset").children(".search-expanded-wrapper").children(".search-expanded").slideToggle(sliderEvents)
    }
      , toggleExpandedTopOptions = function($a) {
        var $li = $a.closest("li");
        var $topButton = $($a.closest("fieldset").find(".search-options")[0]);
        $topButton.find("li." + $li.attr("class")).slideToggle().siblings("li").slideToggle()
    }
      , FormStatusTracker = {
        disabledStatusChanges: [],
        valueStatusChanges: [],
        changeDisableStatus: function($element, newStatus) {
            var originalStatus = $element.prop("disabled");
            if (newStatus !== originalStatus) {
                this.disabledStatusChanges.push({
                    element: $element,
                    originalStatus: originalStatus
                });
                $element.prop("disabled", newStatus)
            }
        },
        changeValueStatus: function($element, newValue) {
            var originalValue = $element.val();
            if (newValue !== originalValue) {
                this.valueStatusChanges.push({
                    element: $element,
                    originalValue: originalValue
                });
                $element.val(newValue)
            }
        },
        revertForm: function() {
            var o = null;
            if (this.disabledStatusChanges.length > 0) {
                while (o = this.disabledStatusChanges.pop()) {
                    o.element.prop("disabled", o.originalStatus)
                }
            }
            if (this.valueStatusChanges.length > 0) {
                while (o = this.valueStatusChanges.pop()) {
                    o.element.val(o.originalValue)
                }
            }
        }
    }
      , submitForm = function($form, options) {
        var $freeText = $form.find("input[name=freetext]")
          , freeTextValue = stripTags($freeText.val())
          , $locationSearch = $form.find("input.objectSearch.validObjectSearch")
          , listing_type = ""
          , action = ""
          , $mapSearch = $(".mapsearch")
          , $multiStepLocation = $form.find(".form-group-multi-step.form-group-location");
        TypeaheadHelper.hideSuggestion();
        if ($('input:checkbox[name="only_with_hlpa"]').is(":checked")) {
            $("body").trigger("ga.genericHlpaTracker", {
                category: "HomeLoanPreApproval-Engagement",
                action: "Apply",
                label: "location=SERP-MoreOptions",
                payload: {
                    content: "Show Pre-Approved homes only",
                    type: "checkbox"
                }
            })
        }
        $freeText.val(freeTextValue);
        updateFreeTextSuggestion($freeText);
        if (freeTextValue.toUpperCase() !== CurrentLocationDatum.lastUnselectedObjectMatch) {
            removeUnselectedObjectMatch($form)
        }
        if ($locationSearch.length && $locationSearch.attr("name") == "area_code") {
            FormStatusTracker.changeDisableStatus($freeText, true)
        } else if ($locationSearch.length && $locationSearch.attr("name") == "district_code") {
            FormStatusTracker.changeDisableStatus($freeText, true)
        } else if ($locationSearch.length && $locationSearch.attr("name") == "region_code") {
            FormStatusTracker.changeDisableStatus($freeText, true)
        } else if ($locationSearch.length && $locationSearch.attr("name") == "hdb_estate") {
            FormStatusTracker.changeDisableStatus($freeText, true)
        }
        if ($multiStepLocation.length && $multiStepLocation.find(".js-has-value").length) {
            FormStatusTracker.changeDisableStatus($freeText, true)
        }
        if ($("input[name=listing_type]", $form).length > 0) {
            var $listingType = $form.find("input[name=listing_type]");
            listing_type = $listingType.val();
            if (searchConfig.routes[listing_type]) {
                FormStatusTracker.changeDisableStatus($listingType, true);
                action = searchConfig.routes[listing_type];
                $form.attr("action", action)
            } else {
                FormStatusTracker.changeDisableStatus($listingType, false)
            }
            var customParameters = searchConfig.listingTypeCustom[listing_type];
            if (customParameters && customParameters.length > 0) {
                for (var i = 0; i < customParameters.length; i++) {
                    var fld = customParameters[i];
                    var $existing = $form.find("input[name=" + fld.param + "]");
                    if ($existing.length) {
                        $existing.attr("value", fld.value)
                    } else {
                        var $extraInput = $('<input type="hidden">').addClass("customParameters");
                        $extraInput.attr("name", fld.param).val(fld.value);
                        $form.append($extraInput)
                    }
                }
            } else {
                $form.find("input.customParameters").remove()
            }
        }
        var params = {}
          , numericRgx = /[^0-9\-]+/g
          , testArrayParameter = /\[\]$/
          , $validInputs = null;
        $validInputs = $form.find("input").not("input[type=submit], input[type=radio], input:disabled").each(function() {
            var $input = $(this);
            if ($input.is(".form-group-numeric input")) {
                var value = parseInt($input.val().replace(numericRgx, ""), 10) || "";
                FormStatusTracker.changeValueStatus($input, value)
            }
            if ($input.val() === "") {
                FormStatusTracker.changeDisableStatus($input, true)
            } else {
                var name = $input.attr("name");
                if (testArrayParameter.test(name)) {
                    name = name + ":" + $input.val()
                }
                if (!params[name]) {
                    params[name] = true
                } else {
                    FormStatusTracker.changeDisableStatus($input, true)
                }
            }
        });
        if (CurrentLocationDatum.value) {
            $form.trigger("ga.search.form.search.location." + getSearchFormTypeGA($form), ["Freetext"])
        } else if ($locationSearch.length) {
            $form.trigger("ga.search.form.search.location." + getSearchFormTypeGA($form), ["Repeat Previous"])
        } else if ($validInputs.not(":disabled").filter("[name=district_code], [name=region_code]").length) {
            if (TrackChanges.hasChange($form)) {
                $form.trigger("ga.search.form.search.location." + getSearchFormTypeGA($form), ["Dropdown"])
            } else {
                $form.trigger("ga.search.form.search.location." + getSearchFormTypeGA($form), ["Repeat Previous"])
            }
        }
        if ($mapSearch[0]) {
            showFilters()
        }
        PreviousSearches.processSubmition($form);
        var returnValue = preSubmitHook($form);
        if (returnValue === false) {
            FormStatusTracker.revertForm();
            PreviousSearches.buildPreviousSearchedDatums()
        }
        for (var i = 0; i < $locationSearch.length; i++) {
            if ($($locationSearch[i]).val() != "") {
                $freeText.val("");
                break
            }
        }
        return returnValue
    }
      , preSubmitHook = function($form) {
        return true
    }
      , previousSearchesEnabled = function($form) {
        return $form.hasClass("property-search")
    }
      , saveRecentSearch = function($form, formValues, fieldTitles) {
        removeInvalidSearchTitles(fieldTitles);
        var valuesHash = getFormValuesHash(fieldTitles)
          , recentSearches = []
          , currentDate = new Date
          , maxSearchAge = 30 * 24 * 3600 * 1e3;
        try {
            recentSearches = AsyncDropdownsHelper.loadLocalStorageData("recent_searches") || [];
            if (!(recentSearches instanceof Array)) {
                recentSearches = []
            }
            var i = 0;
            while (i < recentSearches.length) {
                if (recentSearches[i]["key"] == valuesHash) {
                    recentSearches.splice(i, 1);
                    continue
                }
                if (!recentSearches[i]["time"]) {
                    recentSearches.splice(i, 1);
                    continue
                }
                if (!recentSearches[i]["titles"]) {
                    recentSearches.splice(i, 1);
                    continue
                }
                if (currentDate.getTime() - recentSearches[i]["time"] > maxSearchAge) {
                    recentSearches.splice(i, 1);
                    continue
                }
                i++
            }
            recentSearches.unshift({
                key: valuesHash,
                values: formValues,
                titles: fieldTitles,
                time: (new Date).getTime()
            });
            if (recentSearches.length > 3) {
                recentSearches.pop()
            }
        } catch (e) {}
        AsyncDropdownsHelper.setLocalStorageData("recent_searches", recentSearches)
    }
      , removeInvalidSearchTitles = function(fieldTitles) {
        if ("property_id"in fieldTitles || "autocomplete"in fieldTitles) {
            delete fieldTitles["autocomplete"];
            delete fieldTitles["unselected"];
            delete fieldTitles["property_id"];
            delete fieldTitles["region_code"];
            delete fieldTitles["district_code"];
            delete fieldTitles["area_code"]
        }
        if ("limit"in fieldTitles) {
            delete fieldTitles["limit"]
        }
    }
      , getFormValuesHash = function(formValues) {
        var valueHash = ""
          , formKeys = [];
        for (var key in formValues) {
            if (Object.prototype[key]) {
                continue
            }
            formKeys.push(key)
        }
        formKeys.sort(function(a, b) {
            if (a == b) {
                return 0
            }
            return a > b ? 1 : -1
        });
        for (var i = 0; i < formKeys.length; i++) {
            var values;
            if (formValues[formKeys[i]]instanceof Object) {
                values = getCheckListSelectedOptions(formValues[formKeys[i]]).join(",")
            } else {
                values = formValues[formKeys[i]]
            }
            valueHash += formKeys[i] + "=" + values + "&"
        }
        return valueHash
    }
      , getCheckListSelectedOptions = function(checkListMap) {
        var selected = [];
        for (var key in checkListMap) {
            if (Object.prototype[key]) {
                continue
            }
            if (!checkListMap[key]) {
                continue
            }
            selected.push(key)
        }
        return selected
    }
      , PreviousSearches = {
        data: [],
        routes: {},
        $form: null,
        getStoredSearches: function() {
            return AsyncDropdownsHelper.loadLocalStorageData("recent_searches") || []
        },
        getData: function() {
            return this.data
        },
        getFormValuesURL: function(urlPath, formValues) {
            var queryString = []
              , url = "";
            for (var key in formValues) {
                if (key == "listing_type" && !this.useListingTypeAsParameter()) {
                    continue
                }
                if (Array.isArray(formValues[key])) {
                    for (var i in formValues[key]) {
                        queryString.push(key + "=" + encodeURIComponent(formValues[key][i]))
                    }
                } else if (formValues[key]instanceof Object) {
                    for (var subKey in formValues[key]) {
                        if (!formValues[key][subKey]) {
                            continue
                        }
                        queryString.push(key + "=" + encodeURIComponent(subKey))
                    }
                } else {
                    queryString.push(key + "=" + encodeURIComponent(formValues[key]))
                }
            }
            queryString.push("ps=1");
            url = urlPath;
            url += (url.indexOf("?") >= 0 ? "&" : "?") + queryString.join("&");
            return url
        },
        selectionCallback: function() {
            saveRecentSearch(PreviousSearches.$form, this.values, this.titles)
        },
        processSubmition: function($form) {
            if (!previousSearchesEnabled($form)) {
                return
            }
            var formValues = getFormValues($form);
            var fieldTitles = {};
            for (var key in formValues) {
                var saveKey = key.replace(/\[\]$/, "");
                var values;
                if (formValues[key]instanceof Object) {
                    values = getCheckListSelectedOptions(formValues[key])
                } else {
                    values = formValues[key]
                }
                var title = getFieldTitle($form, key, values);
                if (!title) {
                    continue
                }
                fieldTitles[saveKey] = title
            }
            saveRecentSearch($form, formValues, fieldTitles)
        },
        getUrlPath: function(parameters) {
            if (this.useListingTypeAsParameter()) {
                return document.location.pathname
            } else {
                if (parameters.listing_type && this.routes[parameters.listing_type]) {
                    return this.routes[parameters.listing_type]
                }
            }
            return ""
        },
        useListingTypeAsParameter: function() {
            return this.$form.is(".mapsearch form")
        },
        getMergedRangeText: function($form, minParam, maxParam, searchEntry) {
            var $minElement = getFormField($form, minParam)
              , valueRanges = {
                min: searchEntry["values"][minParam] || null,
                max: searchEntry["values"][maxParam] || null
            }
              , $dropdown = $minElement.closest(".btn-group");
            if ($dropdown.hasClass("btn-group-range")) {
                if (minParam === "minprice") {
                    if (valueRanges["min"] && valueRanges["min"] / 1e3 > 1) {
                        valueRanges["min"] = Math.floor(valueRanges["min"] / 1e3) + "K"
                    }
                    if (valueRanges["max"] && valueRanges["max"] / 1e3 > 1) {
                        valueRanges["max"] = Math.floor(valueRanges["max"] / 1e3) + "K"
                    }
                }
                var range = generateRangeTitle($dropdown, valueRanges);
                if (range) {
                    var $label = $dropdown.find(".btn-label");
                    if ($label.length) {
                        range = $label.first().text() + " " + range
                    }
                    return range
                }
            } else {
                if (valueRanges["min"]) {
                    return searchEntry["titles"][minParam] || null
                }
                if (valueRanges["max"] && valueRanges["min"] != valueRanges["max"]) {
                    return searchEntry["titles"][maxParam] || null
                }
            }
        },
        buildPreviousSearchedDatums: function() {
            var prevSearches = PreviousSearches.getStoredSearches()
              , fieldOrder = ["beds", "minbath", ["minsize", "maxsize"], ["minsize_land", "maxsize_land"], ["minPricePerArea", "maxPricePerArea"], ["mintop", "maxtop"], "tenure", "furnishing", "floor_level", "listing_posted", "with_photos", "with_stream"]
              , urlPath = null
              , $form = this.$form;
            this.data = [];
            for (var i = 0; i < prevSearches.length; i++) {
                urlPath = this.getUrlPath(prevSearches[i]["values"]);
                var fieldTitles = prevSearches[i]["titles"]
                  , suggestionData = {
                    lines: [],
                    displayText: "",
                    values: prevSearches[i]["values"],
                    titles: fieldTitles,
                    url: PreviousSearches.getFormValuesURL(urlPath, prevSearches[i]["values"]),
                    callback: this.selectionCallback
                }
                  , line = []
                  , actualFreetext = ""
                  , propertytName = "";
                if (fieldTitles["freetext"] && !prevSearches[i]["values"]["property_id"]) {
                    actualFreetext = fieldTitles["freetext"]
                } else if (fieldTitles["freetext"]) {
                    propertytName = fieldTitles["freetext"]
                }
                if (propertytName) {
                    suggestionData["lines"].push({
                        class: "tt-sug-text",
                        line: [{
                            text: propertytName
                        }]
                    })
                }
                if (actualFreetext || fieldTitles["region_code"] || fieldTitles["district_code"] || fieldTitles["area_code"]) {
                    line = [];
                    if (actualFreetext) {
                        line.push({
                            text: actualFreetext
                        })
                    }
                    var locationItems = [];
                    if (fieldTitles["region_code"]) {
                        locationItems.push(fieldTitles["region_code"])
                    }
                    if (fieldTitles["district_code"]) {
                        locationItems.push(fieldTitles["district_code"])
                    }
                    if (fieldTitles["area_code"]) {
                        locationItems.push(fieldTitles["area_code"])
                    }
                    if (locationItems.length) {
                        line.push({
                            text: locationItems.join(", ")
                        })
                    }
                    suggestionData["lines"].push({
                        class: "tt-sug-text tt-sug-text-location",
                        separator: " &bull; ",
                        line: line
                    })
                }
                if (fieldTitles["listing_type"] || fieldTitles["property_type"] || fieldTitles["minprice"] || fieldTitles["maxprice"]) {
                    line = [];
                    if (fieldTitles["listing_type"]) {
                        line.push({
                            text: fieldTitles["listing_type"]
                        })
                    }
                    if (fieldTitles["property_type_code"]) {
                        line.push({
                            text: fieldTitles["property_type_code"]
                        })
                    } else if (fieldTitles["property_type"]) {
                        line.push({
                            text: fieldTitles["property_type"]
                        })
                    } else if (fieldTitles["market"]) {
                        line.push({
                            text: fieldTitles["market"]
                        })
                    }
                    if (fieldTitles["minprice"] || fieldTitles["maxprice"]) {
                        line.push({
                            text: PreviousSearches.getMergedRangeText($form, "minprice", "maxprice", prevSearches[i])
                        })
                    }
                    suggestionData["lines"].push({
                        class: "tt-sug-text",
                        separator: " &bull; ",
                        line: line
                    })
                }
                var lastLine = [];
                for (var j = 0; j < fieldOrder.length; j++) {
                    var key = fieldOrder[j];
                    var firstFoundKey = null;
                    if (key instanceof Array) {
                        for (var k = 0; k < key.length; k++) {
                            if (key[k]in fieldTitles) {
                                firstFoundKey = key[k];
                                break
                            }
                        }
                        if (!firstFoundKey) {
                            continue
                        }
                    } else {
                        firstFoundKey = key
                    }
                    if (!(firstFoundKey in fieldTitles)) {
                        continue
                    }
                    var text = fieldTitles[firstFoundKey];
                    var fieldRange = getFieldRangeElements($form, firstFoundKey);
                    if (fieldRange && fieldRange.length) {
                        text = getFieldRangeTitle($form, fieldRange, {
                            min: prevSearches[i]["values"][fieldRange[0].prop("name")] || null,
                            max: prevSearches[i]["values"][fieldRange[1].prop("name")] || null
                        })
                    } else if (key instanceof Array && key.length === 2 && (fieldTitles[key[0]] || fieldTitles[key[1]])) {
                        text = PreviousSearches.getMergedRangeText($form, key[0], key[1], prevSearches[i], false)
                    }
                    lastLine.push({
                        text: text
                    })
                }
                if (lastLine.length > 0) {
                    suggestionData["lines"].push({
                        class: "tt-sug-desc",
                        separator: " &bull; ",
                        line: lastLine
                    })
                }
                if (suggestionData["lines"].length > 0) {
                    for (var j = 0; j < suggestionData["lines"].length; j++) {
                        if (suggestionData["lines"][j]["line"].length > 0) {
                            suggestionData["lines"][j]["line"][suggestionData["lines"][j]["line"].length - 1]["last"] = true
                        }
                    }
                }
                this.data.push(suggestionData)
            }
            guruApp.recentSearchesData = this.data;
            return this
        },
        init: function($form, routes) {
            this.$form = $form;
            this.routes = routes;
            this.data = [];
            this.buildPreviousSearchedDatums();
            return this
        }
    }
      , getFieldRangeTitle = function($form, rangeFields, rangeValues) {
        var $min = rangeFields[0]
          , $max = rangeFields[1]
          , $dropdown = $min.closest(".btn-group")
          , valueRanges = {
            min: rangeValues["min"] ? presentTitle($min.prop("name"), rangeValues["min"], $dropdown.data("gentitle") || "") : "",
            max: rangeValues["max"] ? presentTitle($max.prop("name"), rangeValues["max"], $dropdown.data("gentitle") || "") : ""
        };
        return generateRangeTitle($dropdown, valueRanges)
    }
      , getFieldRangeElements = function($form, name) {
        var $field = getFormField($form, name), $dropdown = $field.closest(".btn-group"), minKey, maxKey, minField, maxField;
        if (!$dropdown.length) {
            return null
        }
        minKey = $dropdown.data("rangeminparam");
        maxKey = $dropdown.data("rangemaxparam");
        if (minKey) {
            minField = getFormField($form, minKey);
            maxField = $field
        } else if (maxKey) {
            maxField = getFormField($form, maxKey);
            minField = $field
        } else {
            return null
        }
        return [minField, maxField]
    }
      , escapeFieldName = function(name) {
        return name.replace(/[\[]/g, "\\[").replace(/[\]]/g, "\\]")
    }
      , getFormField = function($form, name) {
        return $form.find("input[name=" + escapeFieldName(name) + "]")
    }
      , getFieldTitle = function($form, name, values) {
        var titleValue = []
          , fieldTitle = ""
          , escapedName = escapeFieldName(name)
          , allowDisabledInputs = {
            listing_type: 1,
            freetext: 1
        }
          , parentOptionValues = []
          , parentOptionTitle = ""
          , allCheckboxes = null
          , checkboxes = $([]);
        $form.find("input[name=" + escapedName + "]").each(function(idx, element) {
            var $element = $(element);
            if ($element.prop("disabled") && !(name in allowDisabledInputs)) {
                return
            }
            var type = $element.prop("type").toLowerCase();
            if (type == "radio") {
                allCheckboxes = false;
                var radioVal = values.length > 0 ? values[0] : null;
                if (radioVal == $element.val()) {
                    var siblings = $element.siblings("span");
                    if (!siblings.length) {
                        titleValue.push($element.parent().text().trim())
                    } else {
                        titleValue.push($(siblings[0]).text().trim())
                    }
                }
            } else if (type == "checkbox") {
                if (allCheckboxes === null) {
                    allCheckboxes = true
                }
                for (var i = 0; i < values.length; i++) {
                    if (values[i] == $element.val()) {
                        checkboxes.push($element);
                        titleValue.push($element.parent().text().trim());
                        if (!parentOptionValues.length) {
                            var $parentOption = $element.closest(".sub-dropdown-menu");
                            parentOptionTitle = $parentOption.siblings("a").text();
                            if ($parentOption.length > 0) {
                                $parentOption.find("input[name=" + escapedName + "]").not(":disabled").each(function(idx, element) {
                                    parentOptionValues.push($(element).val())
                                })
                            }
                        }
                    }
                }
            } else {
                allCheckboxes = false;
                var $dropdown = $(element).closest(".btn-group");
                if ($dropdown.length > 0) {
                    var $a = getDropdownOption($dropdown, values);
                    fieldTitle = $($a[0]).text()
                }
                if (!fieldTitle) {
                    fieldTitle = values
                }
                if ($dropdown.data("gentitle-full")) {
                    switch (name) {
                    case "listing_posted":
                        fieldTitle = fieldTitle.toLowerCase();
                        break
                    }
                    fieldTitle = sprintf($dropdown.data("gentitle-full"), [fieldTitle])
                }
            }
        });
        if (values instanceof Array && values.join(",") == parentOptionValues.join(",")) {
            return fieldTitle
        } else if (checkboxes.length > 0) {
            fieldTitle = getTitleFromCheckbox(checkboxes);
            if (name === "beds[]" && fieldTitle.length > 0 && fieldTitle.match(/\d+/g) !== null) {
                fieldTitle += " Bedrooms"
            }
            return fieldTitle
        } else if (titleValue.length > 0) {
            fieldTitle = titleValue.join(" / ")
        }
        return fieldTitle
    }
      , getDropdownOption = function($dropdown, value) {
        value = value.replace(".", "\\.");
        return $dropdown.find('a[href="#' + value + '"]')
    }
      , getFormValues = function($form) {
        var formValues = {};
        var allowDisabledInputs = {
            listing_type: 1,
            freetext: 1
        };
        $form.find("input").each(function(key, element) {
            var $element = $(element);
            var name = $element.prop("name");
            if (name == "") {
                return
            }
            if ($element.prop("disabled") && !(name in allowDisabledInputs)) {
                return
            }
            var $dropdown = $element.closest(".btn-group");
            var type = $element.prop("type").toLowerCase();
            if (type === "hidden") {
                if (name.substr(-2) === "[]") {
                    if (!formValues[name]) {
                        formValues[name] = []
                    }
                    formValues[name].push($element.val())
                } else {
                    formValues[name] = $element.val()
                }
            } else if (type == "checkbox" || type == "radio") {
                if (!formValues[name]) {
                    formValues[name] = {}
                }
                if ($element.prop("checked")) {
                    formValues[name][$element.val()] = $element.prop("checked")
                }
            } else if ($dropdown.length && $dropdown.attr("class")) {
                formValues[name] = $element.val()
            } else {
                formValues[name] = $element.val()
            }
        });
        return formValues
    }
      , resetForm = function($form) {
        var $marketDropDown = $form.find(".dropdown-input-toggle-market");
        var firstMarket = $marketDropDown.find(":radio:first");
        var $defaultNewProjectField = $('.param-newProject input[value="all"]');
        $(".param-newProject a").removeClass("checked");
        $(".param-newProject input").prop("checked", false);
        $defaultNewProjectField.prop("checked", true);
        notifyInputValueChanged($defaultNewProjectField.closest(".js-form-group"), $defaultNewProjectField.attr("name"), $defaultNewProjectField.val());
        $marketDropDown.closest(".dropdown-menu").find("input:checked").click();
        firstMarket.click();
        firstMarket.trigger("change");
        $form.find("input[name='freetext']").val("");
        $form.find("input[name='freetext']").typeahead("val", "");
        $form.find(".param-listing_type a:first").click();
        $form.find(".form-group-numeric :text").val("0").blur();
        $form.find(".form-group-checkbox :checkbox").each(function() {
            if ($(this).prop("checked")) {
                $(this).click()
            }
        });
        $form.find(".dropdown-menu > .dropdown-reset > a").click();
        $form.find(".dropdown-multi-step").each(function() {
            MultiStepDropdown.unsetAllOptions($(this))
        });
        CurrentLocationDatum.destroy();
        removeUnselectedObjectMatch($form)
    }
      , getSearchFormTypeGA = function($form) {
        if ($form.hasClass("property-search")) {
            return "listing"
        } else if ($form.hasClass("agent-search")) {
            return "agent"
        }
    }
      , stripTags = function(string) {
        if (string === null) {
            return ""
        }
        string = string.replace(/<[^>]*>/g, "");
        return $.trim(string)
    }
      , stripSmartPunctuations = function(string) {
        return string.replace(/[\u2018\u2019]/g, "'")
    }
      , stopPropagation = function(event) {
        event.stopPropagation()
    }
      , CriteriaTracker = {
        exclusions: null,
        keys: [],
        values: [],
        visibilities: [],
        criteriaCountChangedListeners: [],
        init: function($form) {
            var $expanded = $form.find(".search-expanded")
              , findstr = ""
              , count = 0;
            findstr += "input:checked:not([disabled]),";
            findstr += "input:text:not([disabled]),";
            findstr += "input[type='hidden']:not([disabled])";
            $expanded.find(findstr).filter(function() {
                if ($(this).is(".form-group-numeric input")) {
                    return $(this).val().replace(/[^0-9\-]+/g, "") > 0
                } else {
                    return $(this).val()
                }
            }).each(function() {
                var $input = $(this)
                  , $div = $input.closest(".js-form-group")
                  , name = CriteriaTracker.generateName($div, $input.attr("name"))
                  , value = $input.val()
                  , hidden = $div.hasClass("hide");
                CriteriaTracker.onInputValueChanged($input, name, value, !hidden)
            });
            count = this.count();
            if (count > 0) {
                CriteriaTracker.notifyCriteriaCountChanged(count)
            }
        },
        add: function(key, value, visible) {
            var index = this.keys.indexOf(key);
            if (typeof visible == "undefined") {
                visible = true
            }
            if (index < 0) {
                this.keys.push(key);
                this.values.push([value]);
                this.visibilities.push(visible);
                this.notifyCriteriaCountChanged(this.count())
            } else {
                this.values[index] = value;
                this.visibilities[index] = visible
            }
        },
        addValueToKey: function(key, value, visible) {
            var index = this.keys.indexOf(key);
            if (typeof visible == "undefined") {
                visible = true
            }
            if (index < 0) {
                this.add(key, value, visible)
            } else {
                if (this.values[index].indexOf(value) < 0) {
                    this.values[index].push(value)
                }
                this.visibilities[index] = visible
            }
        },
        removeByKey: function(key) {
            var index = this.keys.indexOf(key);
            if (index > -1) {
                if (this.values[index].length === 2) {
                    this.values[index].pop()
                } else {
                    this.keys.splice(index, 1);
                    this.values.splice(index, 1);
                    this.visibilities.splice(index, 1);
                    this.notifyCriteriaCountChanged(this.count())
                }
            }
        },
        removeValueFromKey: function(key, value) {
            var index = this.keys.indexOf(key);
            if (index > -1) {
                var values = this.values[index];
                if (values.length === 1 && values[0] === value) {
                    this.removeByKey(key)
                } else {
                    index = values.indexOf(value);
                    if (index > -1) {
                        values.splice(index, 1)
                    }
                }
            }
        },
        clear: function() {
            this.keys = [];
            this.values = [];
            this.visibilities = []
        },
        updateVisibility: function(key, value, visible) {
            var index = this.keys.indexOf(key);
            if (index > -1) {
                this.visibilities[index] = visible;
                this.notifyCriteriaCountChanged(this.count())
            }
        },
        count: function() {
            if (this.keys.length === this.values.length && this.values.length === this.visibilities.length) {
                var count = 0;
                for (var i = this.visibilities.length - 1; i >= 0; i--) {
                    if (this.visibilities[i]) {
                        count++
                    }
                }
                return count
            } else {
                throw "Internal size(s) is inconsistent!!"
            }
        },
        contents: function() {
            var contents = [];
            for (var i = this.keys.length - 1; i >= 0; i--) {
                var visible = this.visibilities[i] ? "(+)" : "(-)";
                contents.push(this.keys[i] + visible + ":" + this.values[i])
            }
            return contents
        },
        addCriteriaCountChangedListener: function(listener) {
            this.criteriaCountChangedListeners.push(listener)
        },
        notifyCriteriaCountChanged: function(count) {
            $.each(this.criteriaCountChangedListeners, function(index, func) {
                func(count)
            })
        },
        onInputValueChanged: function($source, name, value, isVisibleInExpandedOpts) {
            var tagName = $source.prop("tagName")
              , isInExpandedOpts = $source.is(".search-expanded " + tagName)
              , isSgMinBed = $source.closest(".js-form-group").is(".app-sg .param-minbed")
              , dataDefaultValue = $source.find("input[data-default]").addBack("input[data-default]").val();
            if (guruApp.user_id !== null && typeof guruApp.listingSearch !== "undefined" && typeof guruApp.listingSearch.hlpaData !== "undefined" && guruApp.listingSearch.hlpaData.hasUserDoneTheTool) {
                if (name === "only_with_hlpa") {
                    setHLPACriteria(value)
                }
            } else {
                $('input[name="only_with_hlpa"]').parent().hide()
            }
            if (name && name.indexOf(":") >= 0 && !(typeof name.split(":")[1] === "undefined") && name.split(":")[1] === "minprice-maxprice") {
                resetCheckbox()
            }
            if (isSgMinBed) {
                isVisibleInExpandedOpts = $source.closest(".searchbox").find(".input-group>.param-minbed:visible").length == 0
            } else if (!isInExpandedOpts) {
                return
            }
            if (!value || value === dataDefaultValue) {
                CriteriaTracker.removeByKey(name)
            } else {
                if (name.match(/.+\[\]/) || $source.is(".btn-group-range, .btn-group-range input")) {
                    CriteriaTracker.addValueToKey(name, value, isVisibleInExpandedOpts)
                } else {
                    CriteriaTracker.add(name, value, isVisibleInExpandedOpts)
                }
            }
        },
        onInputVisibilityChanged: function($source, name, value, visible) {
            CriteriaTracker.updateVisibility(name, value, visible)
        },
        generateName: function($div, name) {
            var dataTideTo = $div.data("tideto")
              , dataTideToWhen = $div.data("tidetowhen");
            if ($div.is(".btn-group-range")) {
                name = [];
                $div.find("input").each(function() {
                    var inputName = $(this).attr("name");
                    if (inputName.length) {
                        name.push(inputName)
                    }
                });
                name = name.join("-")
            }
            if (dataTideTo && dataTideToWhen) {
                var prefix = dataTideTo + ":" + dataTideToWhen
                  , hash = prefix.split("").reduce(function(a, b) {
                    a = (a << 5) - a + b.charCodeAt(0);
                    return a & a
                }, 0);
                return hash + ":" + name
            } else {
                return name
            }
        }
    }
      , notifyInputValueChanged = function($source, name, value, state) {
        var nameWithoutBrackets = name ? name.replace(/[\[\]]/g, "") : "";
        $("body").trigger("widget_search_value_changed_" + nameWithoutBrackets, value);
        $.each(inputValueChangedListeners, function(index, func) {
            var nameGenerated = CriteriaTracker.generateName($source, name);
            func($source, nameGenerated, value, state)
        })
    }
      , notifyInputVisibilityChanged = function($source, name, value, visible) {
        $.each(inputVisibilityChangedListeners, function(index, func) {
            var nameGenerated = CriteriaTracker.generateName($source, name);
            func($source, nameGenerated, value, visible)
        })
    }
      , inputValueChangedListeners = [CriteriaTracker.onInputValueChanged]
      , inputVisibilityChangedListeners = [CriteriaTracker.onInputVisibilityChanged]
      , TypeaheadHelper = {
        market: null,
        hideSuggestion: function() {
            if (!TypeaheadHelper.$twitterTypeahead || !TypeaheadHelper.$freetext) {
                return
            }
            TypeaheadHelper.$freetext.blur();
            TypeaheadHelper.$twitterTypeahead.removeClass("loading")
        },
        highlightMatch: function(match) {
            return "<u>" + match + "</u>"
        },
        parseAutoSuggestion: function(parsedResponse, query) {
            query = stripTags(query.toLowerCase()).split(" ");
            query = $.grep(query, function(v, k) {
                return $.inArray(v, query) === k && v !== ""
            });
            query = query.sort();
            $.each(parsedResponse, function(key, suggestion) {
                suggestion.value = suggestion.displayText;
                if (!suggestion.displayDescription) {
                    suggestion.displayDescription = false
                }
                suggestion.displayTextHighlighted = suggestion.displayText;
                suggestion.displayTypeHighlighted = suggestion.displayType;
                suggestion.iconClass = TypeaheadHelper.suggestionObjectMappingToIcon(suggestion);
                if (suggestion.displayDescription) {
                    suggestion.displayDescriptionHighlighted = suggestion.displayDescription
                }
                var escapedSearchedWords = [];
                $.each(query, function(index, q) {
                    escapedSearchedWords.push(q.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&"))
                });
                if (escapedSearchedWords.length) {
                    var searchedWordsRegex = new RegExp(escapedSearchedWords.join("|"),"ig");
                    suggestion.displayTextHighlighted = suggestion.displayTextHighlighted.replace(searchedWordsRegex, TypeaheadHelper.highlightMatch);
                    suggestion.displayTypeHighlighted = suggestion.displayTypeHighlighted.replace(searchedWordsRegex, TypeaheadHelper.highlightMatch);
                    if (suggestion.displayDescription) {
                        suggestion.displayDescriptionHighlighted = suggestion.displayDescriptionHighlighted.replace(searchedWordsRegex, TypeaheadHelper.highlightMatch)
                    }
                }
                parsedResponse[key] = suggestion
            });
            return parsedResponse
        },
        pickSuggestion: function(e, datum) {
            var $form = null;
            if (datum.url) {
                if (typeof datum.callback === "function") {
                    datum.callback()
                }
                if (datum.url[0] === "#") {
                    return
                }
                document.location = datum.url;
                return
            } else if (typeof datum.objectType === "undefined") {
                return
            }
            $form = TypeaheadHelper.$freetext.closest("form");
            datum.inputData = TypeaheadHelper.suggestionObjectMapping(datum);
            CurrentLocationDatum.save(datum);
            changeFreeTextQuery.call(this);
            TypeaheadHelper.suggestionResetField(datum.objectType);
            $form.find(".form-group-location > .dropdown-multi-step").each(function() {
                MultiStepDropdown.unsetAllOptions($(this))
            });
            if (!$form.is(".new-projects-search-single-line") && $form.is(".app-sg form") && datum.objectType === "DISTRICT") {
                setTimeout(function() {
                    $form.find(".tt-input").blur();
                    Districts.selectDistrict($form, datum.objectId)
                }, 20)
            }
            $form.trigger("searchWidget.tideTo", {
                name: datum.objectType,
                value: datum.objectId
            });
            return
        },
        suggestionObjectMapping: function(suggestion) {
            var input = {
                param: null,
                value: null,
                validObject: true,
                additionalData: {}
            };
            switch (suggestion.objectType) {
            case "DISTRICT":
                input.param = "district_code";
                break;
            case "PROPERTY":
                input.param = "property_id";
                break;
            case "REGION":
                input.param = "region_code";
                break;
            case "PROJECT":
                input.param = "dlid";
                break;
            case "AREA":
                input.param = "area_code";
                break;
            case "AGENT":
                input.param = "agent_id";
                break;
            case "HDB_ESTATE":
                input.param = "hdb_estate";
                break;
            case "TRANSPORTATION":
                input.param = "mrt_id";
                input.validObject = false;
                break;
            case "NEIGHBOURHOOD":
                input.param = "zone_ids";
                input.validObject = false;
                break;
            case "SUBNEIGHBOURHOOD":
                input.param = "sub_zone_ids";
                input.validObject = false;
                break;
            case "STREET":
            case "MRT_STATION":
            case "SCHOOL":
                input.param = suggestion.objectType;
                input.validObject = false;
                break;
            case "REVIEWS_ID":
            case "REVIEWS":
            case "REVIEWS_EN":
            case "REVIEWS_TH":
                input.param = "review_param";
                input.additionalData.displayText = suggestion.displayText;
                input.additionalData.displayType = suggestion.displayType;
                input.validObject = false;
                break;
            default:
                input.validObject = false;
                Log.error("Dont Know : " + suggestion.objectType);
                break
            }
            input.value = suggestion.objectId;
            if (searchConfig.one2one) {
                $.each(searchConfig.one2one, function(k, v) {
                    if (k === input.param) {
                        document.location = v.replace("{" + k + "}", input.value)
                    }
                })
            }
            return input
        },
        suggestionObjectMappingToIcon: function(suggestion) {
            var iconClass = "";
            switch (suggestion.objectType) {
            case "PROPERTY":
            case "PROJECT":
            case "HDB_ESTATE":
                iconClass = "pgicon pgicon-building";
                break;
            case "DISTRICT":
            case "REGION":
            case "AREA":
            case "NEIGHBOURHOOD":
            case "SUBNEIGHBOURHOOD":
            case "STREET":
                iconClass = "pgicon pgicon-location-o";
                break;
            case "AGENT":
                iconClass = "pgicon pgicon-user";
                break;
            case "TRANSPORTATION":
            case "MRT_STATION":
                iconClass = "pgicon pgicon-train";
                break;
            case "SCHOOL":
                iconClass = "pgicon pgicon-bank";
                break;
            default:
                Log.error("Dont Know : " + suggestion.objectType);
                break
            }
            return iconClass
        },
        suggestionResetField: function(objectType) {
            var $first = $searchBoxes.first();
            if ($first.length) {
                switch (objectType) {
                case "PROPERTY":
                    $first.find(".param-property_type .dropdown-menu > li.dropdown-reset a").click();
                    break;
                case "HDB_ESTATE":
                    if ($('input[name="property_type"]').val() != "H") {
                        $first.find(".param-property_type .dropdown-menu > li.dropdown-reset a").click()
                    }
                    break;
                default:
                    break
                }
                var $regionDropdown = $first.find(".param-region_code, .param-district_code, .param-area_code, .param-hdb_estate");
                if ($regionDropdown.length) {
                    $regionDropdown.find(".dropdown-menu > li.dropdown-reset a").click()
                }
            }
        },
        changeRequest: function(url, uriEncodedQuery) {
            if (TypeaheadHelper.market != "residential") {
                url = searchConfig.api.commercial
            }
            uriEncodedQuery = encodeURIComponent(uriEncodedQuery);
            return url + uriEncodedQuery
        },
        transform: function(R) {
            TypeaheadHelper.$freetext.trigger("autocompleteApiResponse.searchWidget", [R]);
            TypeaheadHelper.stopLoading();
            return TypeaheadHelper.parseAutoSuggestion(R, TypeaheadHelper.$freetext.val())
        },
        templates: {
            autocomplete: {
                suggestion: ["<div>", '<i class="{{iconClass}}"></i>', '<p class="tt-sug-text">{{{displayTextHighlighted}}}</p>', '<p class="tt-sug-desc"><span class="tt-sug-type">{{{displayTypeHighlighted}}}</span>{{#displayDescription}}{{{displayDescriptionHighlighted}}}{{/displayDescription}}</p>', "</div>"].join("")
            },
            defaultEmpty: {
                suggestion: ['<a href="{{url}}" class="{{optionClass}}">', '<i class="{{class}}"></i>', '<span class="tt-sug-text">{{text}}</span>', "</a>"].join("")
            },
            previousSearches: {
                suggestion: ['<a href="{{url}}" class="previous-search-suggestion">', '<i class="pgicon pgicon-clock"></i>', "{{#lines}}", '<span class="{{class}}">{{#line}}{{text}}{{^last}}{{{separator}}}{{/last}}{{/line}}</span>', "{{/lines}}", "</a>"].join("")
            }
        },
        bloodhound: null,
        $freetext: $(),
        $i: $("<i />"),
        $twitterTypeahead: $(),
        beforeSend: function(q) {
            return stripTags(q).length > 1 && TypeaheadHelper.startLoading()
        },
        startLoading: function() {
            TypeaheadHelper.$twitterTypeahead = TypeaheadHelper.$freetext.parent(".twitter-typeahead");
            var finalStartLoading = function() {
                TypeaheadHelper.$twitterTypeahead.addClass("loading");
                return true
            };
            TypeaheadHelper.$twitterTypeahead.prepend(TypeaheadHelper.$i);
            TypeaheadHelper.startLoading = finalStartLoading;
            return true
        },
        stopLoading: function() {
            TypeaheadHelper.$twitterTypeahead.removeClass("loading")
        },
        init: function($freetext, routes) {
            if (TypeaheadHelper.$freetext.length === 1) {
                return
            }
            var typeaheadArguments = [{
                highlight: true,
                hint: true,
                minLength: 0
            }]
              , $form = $freetext.closest("form")
              , $body = $("body");
            TypeaheadHelper.$freetext = $freetext;
            if ($form.is(".property-search")) {
                TypeaheadHelper.templates.previousSearches.suggestion = this.renderFactory(TypeaheadHelper.templates.previousSearches.suggestion);
                TypeaheadHelper.bloodhoundPreviousSearched = this.getEngineForPreviousSearches($form, routes);
                typeaheadArguments.push({
                    name: "previousSearches",
                    display: "displayText",
                    source: TypeaheadHelper.bloodhoundPreviousSearched,
                    templates: TypeaheadHelper.templates.previousSearches
                })
            }
            if (searchConfig.defaultAutocomplete) {
                TypeaheadHelper.templates.defaultEmpty.suggestion = this.renderFactory(TypeaheadHelper.templates.defaultEmpty.suggestion);
                TypeaheadHelper.bloodhoundDefaults = this.getEngineForDefault(searchConfig.defaultAutocomplete);
                typeaheadArguments.push({
                    name: "autocompletedefaults",
                    display: "displayText",
                    source: TypeaheadHelper.bloodhoundDefaults,
                    templates: TypeaheadHelper.templates.defaultEmpty
                })
            }
            TypeaheadHelper.templates.autocomplete.suggestion = this.renderFactory(TypeaheadHelper.templates.autocomplete.suggestion);
            TypeaheadHelper.bloodhound = this.getEngineForAutocomplete();
            typeaheadArguments.push({
                name: "autocomplete",
                display: "displayText",
                source: TypeaheadHelper.bloodhound,
                templates: TypeaheadHelper.templates.autocomplete,
                limit: 40
            });
            $freetext.typeahead.apply($freetext, typeaheadArguments).on("typeahead:selected typeahead:autocompleted", TypeaheadHelper.pickSuggestion).siblings(".tt-hint").addClass("form-control").end().siblings(".tt-menu").on("click", "a.js-suggestion-location", function(e) {
                TypeaheadHelper.showSelectLocation($form);
                e.preventDefault()
            }).on("click", ".tt-dataset-previousSearches a", function(e) {
                e.preventDefault()
            })
        },
        showSelectLocation: function($form) {
            var $btn = $form.find(".form-group-location > button:visible");
            if ($btn.length) {
                setTimeout(function() {
                    $btn.trigger("click")
                }, 0)
            }
        },
        renderFactory: function(template) {
            var compiled = Hogan.compile(template);
            return function(data) {
                return compiled.render(data)
            }
        },
        getEngineForAutocomplete: function() {
            var bloodhound = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace("val"),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: searchConfig.api.residential ? searchConfig.api.residential : searchConfig.api["default"],
                    replace: TypeaheadHelper.changeRequest,
                    transform: TypeaheadHelper.transform
                }
            });
            return function(q, sync, async) {
                if (TypeaheadHelper.beforeSend(q)) {
                    q = stripSmartPunctuations(q);
                    bloodhound.search(q, sync, async)
                }
            }
        },
        getEngineForDefault: function(defaults) {
            return function(q, sync) {
                if (q === "") {
                    sync(defaults)
                }
            }
        },
        getEngineForPreviousSearches: function($form, routes) {
            try {
                PreviousSearches.init($form, routes)
            } catch (e) {
                AsyncDropdownsHelper.unsetLocalStorageData("recent_searches");
                return function(q, sync) {
                    if (q === "") {
                        sync([])
                    }
                }
            }
            return function(q, sync) {
                if (q === "") {
                    sync(PreviousSearches.getData())
                }
            }
        }
    }
      , showFilters = function() {
        var hiddenClass = "searchbox-hidden-xs"
          , hiddenClassDisabled = "searchbox-hidden-xs-suppressed"
          , activeClass = "active"
          , $headerSearchIcon = $("li.nav-search")
          , $hidden = $searchBoxes.find("." + hiddenClass)
          , $showing = $searchBoxes.find("." + hiddenClassDisabled);
        $headerSearchIcon.toggleClass(activeClass);
        $hidden.removeClass(hiddenClass).addClass(hiddenClassDisabled);
        $showing.removeClass(hiddenClassDisabled).addClass(hiddenClass);
        $searchBoxes.each(function(i, f) {
            CriteriaTracker.init($(f))
        })
    }
      , clickShowFilters = function(e) {
        e.preventDefault();
        showFilters()
    }
      , userHasVisited = function($form) {
        var $body = $("body");
        if ($("html.localStorage")) {
            var userHasVisited = localStorage.getItem("userHasVisited")
              , $tooltips = $()
              , removeElem = function() {
                $tooltips.tooltip("hide")
            };
            if (!userHasVisited) {
                $form.find('.js-form-group[data-toggle="tooltip"]').each(function() {
                    var $elm = $(this)
                      , $tooltip = $elm.tooltip({
                        trigger: "manual",
                        placement: "bottom"
                    });
                    $tooltip.tooltip("show");
                    $tooltips = $tooltips.add($elm);
                    $(window).bind("resize", function() {
                        $tooltip.tooltip("show")
                    })
                });
                localStorage.setItem("userHasVisited", true);
                $body.on("click.userHasVisitedClick", function(e) {
                    if (document.contains(e.target) && !$(e.target).is(".google_dfp_ad_slot *")) {
                        removeElem();
                        $body.off("click.userHasVisitedClick")
                    }
                })
            }
        }
    }
      , toggleAutocompleteDefaults = function(dataChanged, $form) {
        if (dataChanged.name === "property_type") {
            $form.toggleClass("js-is-hdb", dataChanged.value === "H")
        }
    }
      , registerFormEvents = function(formParams) {
        var hideBoxTitle = function() {
            formParams.$form.find(".search-expanded > .expanded-col > fieldset").each(function() {
                var $f = $(this)
                  , $children = $f.children(":not(.box-title, .hide)");
                $f.children(".box-title").toggleClass("not-visible", $children.length === 0)
            })
        };
        var validateNumericField = function(value, oldValue, name, region) {
            var digitVal = value ? value.replace(/[^0-9]+/g, "") : "";
            var maxLength = MultiStepDropdown.maxInputLength[region][name];
            if (digitVal.length > maxLength) {
                return oldValue
            } else {
                return digitVal
            }
        };
        formParams.$form.on("searchWidget.tideTo", function() {
            InputBroker.tideToListener.apply(formParams.$listeners, arguments);
            hideBoxTitle();
            toggleAutocompleteDefaults(arguments[1], formParams.$form)
        }).on("focus.searchWidget", ".dropdown-menu input", function() {
            $(this).trigger("input_focus.searchWidget")
        }).on("input_focus.searchWidget", ".dropdown-menu input:not(.select-all-input)", function() {
            $(this).closest(".btn-group").find(".dropdown-input-range input").not($(this)).each(function(index, oth_element) {
                $(oth_element).trigger("input_blur.searchWidget")
            });
            $(this).addClass("focus");
            InputBroker.tideToListener.apply(formParams.$listeners, [arguments[1], {
                name: $(this).attr("name"),
                value: $(this).attr("value")
            }]);
            hideBoxTitle()
        }).on("input_blur.searchWidget", ".dropdown-menu input", function() {
            $(this).removeClass("focus")
        }).on("hide.bs.dropdown", ".btn-group", closedDropdown).on("click.searchWidget", ".dropdown-input-toggle-market label", clickSearchMarketType).on("click.searchWidget", ".search-box-market label", clickSearchMarketType).on("click.searchWidget", ".dropdown-menu a", clickDropdownOption).on("click.searchWidget", ".step-options > li > a", MultiStepDropdown.clickOption).on("click.searchWidget", ".step-back > a", MultiStepDropdown.clickGoBack).on("show.bs.dropdown", ".btn-group", clickDropdownRange).on("click.searchWidget", ".param-region_code .dropdown-menu a", Districts.onParentClick).on("click.searchWidget", ".param-district_code .dropdown-menu a", Areas.onParentClick).on("click.searchWidget", ".param-region_code .step-options a", Districts.onParentClick).on("click.searchWidget", ".param-district_code .step-options a", Areas.onParentClick).on("click.searchWidget", ".dropdown-menu input[type=text]", stopPropagation).on("click.searchWidget", ".dropdown-menu .sub-dropdown-menu", stopPropagation).on("click.searchWidget", ".dropdown-menu .dropdown-input-range", stopPropagation).on("click.searchWidget", ".dropdown-menu.has-select-all .select-all-input", stopPropagation).on("click.searchWidget", ".dropdown-menu label:has(input[type=checkbox])", clickDropdownCheckbox).on("click.searchWidget", ".dropdown-menu input[type=checkbox]", function(e) {
            InputBroker.mimicCheckbox($(this))
        }).on("click.searchWidget", ".param-district_code .dropdown-menu label, .param-area_code .dropdown-menu label", function(e) {
            var $label = $(this)
              , isChecked = $label.children("input[type=checkbox]").prop("checked");
            $label.closest("li").toggleClass("active", isChecked);
            if ($searchBoxes.is("input.isObjectSearch")) {
                $searchBoxes.removeClass("isObjectSearch").find("input[name=freetext]").val("")
            }
            CurrentLocationDatum.destroy()
        }).on("click.searchWidget", ".form-group-numeric button", clickNumeric).on("blur.searchWidget", ".form-group-numeric input", function() {
            $(this).trigger("input_blur.searchWidget")
        }).on("blur.searchWidget", ".form-group-numeric input", changeNumericField).on("input_blur.searchWidget", ".dropdown-input-range input", checkRangeValues).on("input_focus.searchWidget", ".dropdown-input-range input", checkRangeValues).on("click.searchWidget", ".form-group-checkbox input[type=checkbox]", clickCheckbox).on("click.searchWidget", ".form-group-radio input[type=radio]", radioButtonClickHandler).on("click.searchWidget", ".search-options a", toggleExpanded).on("keydown.searchWidget", ".dropdown-menu input[type=text]", enterFreetextDropdownOption).on("submit.searchWidget", function() {
            return submitForm(formParams.$form, formParams.options)
        }).on("click.searchWidget", ".btn-reset", function() {
            resetForm(formParams.$form)
        }).on("click.searchWidget", "input[type=submit], button[type=submit]", function() {
            var $submit = $(this);
            if ($submit.is(".expanded-submit")) {
                formParams.$form.trigger("ga.search.form.submit.expanded." + getSearchFormTypeGA(formParams.$form))
            } else {
                formParams.$form.trigger("ga.search.form.submit.main." + getSearchFormTypeGA(formParams.$form))
            }
        }).on("click.searchWidget", ".searchbox-show-filters", clickShowFilters).on("focus.searchWidget", ".dropdown-input-range input", function(event) {
            this.oldvalue = this.value
        }).on("input.searchWidget", ".form-group-numeric input", function(event) {
            var region = guruApp.widgetSearch.region;
            var $input = $(this);
            var digitVal = validateNumericField(this.value, this.oldvalue, $input.attr("name"), region);
            if (digitVal !== this.value) {
                event.target.value = presentTitle($input.attr("name"), digitVal.toString(), $input.data("gentitle"))
            }
            this.oldvalue = digitVal
        });
        $(window).on("resetSearchForm", function() {
            resetForm(formParams.$form)
        })
    }
      , initializeFormDropdownsAndToggles = function(formParams) {
        var dropdownsAndToggles = $.merge(formParams.$dropdowns, formParams.$toggle);
        dropdownsAndToggles.each(function(i, el) {
            if ($(el).parent().closest(".dropdown-menu, .toggle-menu").length) {
                return
            }
            var $options = $(this)
              , $dropdown = $options.closest(".btn-group");
            formParams.$listeners = InputBroker.tideToAdd(formParams.$listeners, $dropdown);
            InputBroker.addDropdown($dropdown);
            var $optionList = $(".tide-to", $dropdown);
            if ($optionList.length > 0) {
                $optionList.each(function(index, element) {
                    formParams.$listeners = InputBroker.tideToAdd(formParams.$listeners, $(element))
                })
            }
            $optionList = $(".tide-to-focus", $dropdown);
            if ($optionList.length > 0) {
                $optionList.each(function(index, element) {
                    formParams.$listeners = InputBroker.tideToAdd(formParams.$listeners, $(element))
                })
            }
        })
    }
      , initializeFormInputs = function(formParams) {
        formParams.$form.find(".form-group-numeric").each(function() {
            var $numericElement = $(this);
            formParams.$listeners = InputBroker.tideToAdd(formParams.$listeners, $numericElement)
        });
        formParams.$form.find(".form-group-numeric input").focus().blur();
        formParams.$form.find("input[type=checkbox]").each(function() {
            InputBroker.addCheckbox($(this))
        });
        var $freetext = formParams.$form.find("input[name=freetext]").on("keydown.searchWidget keyup.searchWidget blur.searchWidget", changeFreeTextQuery);
        TypeaheadHelper.init($freetext, searchConfig.routes);
        var $marketInput = formParams.$form.find("input[name=market]");
        if ($marketInput.length) {
            TypeaheadHelper.market = $marketInput.on("change", function() {
                formParams.$form.trigger("searchWidget.tideTo", {
                    name: this.name,
                    value: this.value
                });
                $(this).closest("label").addClass("active").siblings().removeClass("active");
                var $mainParent = $(this).closest("ul").closest(".btn-group");
                setValueDropdown($mainParent, "", $(this).closest("label").text());
                $mainParent.find("li").removeClass("active");
                TypeaheadHelper.market = this.value
            }).filter(":checked").each(function(index, element) {
                formParams.$form.trigger("searchWidget.tideTo", {
                    name: $(element).attr("name"),
                    value: $(element).attr("value")
                });
                if (!$(element).closest(".btn-group").parent().closest(".btn-group").find(".dropdown-menu li.active").length) {
                    setValueDropdown($(this).closest("ul").closest(".btn-group"), "", $(this).closest("label").text())
                }
            }).closest("label").click().end().val()
        } else {
            TypeaheadHelper.market = "residential"
        }
        if ($("body").is(".home, .mapsearch")) {
            var listingTypeDropdown = formParams.$form.find(".param-listing_type").first();
            if (listingTypeDropdown.length) {
                var previousSearches = PreviousSearches.getData();
                if (previousSearches.length > 0 && previousSearches[0].values.listing_type) {
                    var listingTypeLink = getDropdownOption(listingTypeDropdown, previousSearches[0].values.listing_type);
                    if (listingTypeLink) {
                        handleDropdownOptionClick(listingTypeLink[0])
                    }
                }
            }
        }
        formParams.$form.on("click.bs.dropdown.data-api", ".dropdown-menu.has-select-all", stopPropagation);
        formParams.$dropdowns.filter(".has-select-all").find(".sub-dropdown-menu input").on("change", function() {
            var $checkbox = $(this)
              , $subDropDown = $checkbox.closest(".sub-dropdown-menu")
              , $targetCheckboxes = $subDropDown.find("input:not(.select-all-input)")
              , $selAll = $subDropDown.find(".select-all")
              , handleAllSelected = function() {
                $selAll.addClass("active");
                $selAll.find("input").prop("checked", true);
                updateTitle(true)
            }
              , showSelAll = function() {
                $selAll.removeClass("active");
                $selAll.find("input").prop("checked", false)
            }
              , setTitle = function($dropdown, title) {
                $dropdown.children(".btn-default").first().attr("title", title).children(".btn-title").text(title)
            }
              , updateTitle = function(hasSelectedItems) {
                var $dropdown = $subDropDown.closest(".btn-group")
                  , $label = hasSelectedItems ? $dropdown.find(".tide-to.active>a") : $dropdown.find(".dropdown-reset a");
                setTitle($dropdown, $label.html())
            };
            if ($checkbox.is(".select-all-input")) {
                if ($checkbox.is(":checked")) {
                    $targetCheckboxes.prop("checked", true);
                    handleAllSelected()
                } else {
                    $targetCheckboxes.prop("checked", false);
                    showSelAll();
                    updateTitle(false)
                }
                if ($checkbox.parents(".property-type-code-L").length) {
                    InputBroker.updateTideToValue.apply($(".param-newProject"), [{
                        name: ""
                    }])
                }
            } else {
                var checkedBoxes = $targetCheckboxes.filter(":checked").length;
                if (checkedBoxes === 0) {
                    updateTitle(false)
                }
                if (checkedBoxes === $targetCheckboxes.length) {
                    handleAllSelected()
                } else {
                    showSelAll()
                }
            }
        });
        $(window).on("mousedown", function(e) {
            var $expandContainer = formParams.$form.find(".search-expanded-wrapper")
              , $searchOptions = formParams.$form.find(".search-options")
              , $searchBox = $expandContainer.closest(".searchbox")
              , width = $(window).width();
            if (!$searchBox.is(".search-is-expanded")) {
                return
            }
            if (formParams.$form.is(".ssf form") && (width < 768 || 990 <= width)) {
                return
            }
            if (!$expandContainer.is(e.target) && $expandContainer.has(e.target).length === 0 && !$searchOptions.is(e.target) && $searchOptions.has(e.target).length === 0) {
                formParams.$form.find(".search-options-aligned-top .search-options-lessoptions a").trigger("click")
            }
        });
        var $formContainer = formParams.$form.parent()
          , $window = $(window)
          , calculateFormPosition = function() {
            var fromTop = Math.round($formContainer.offset().top)
              , isSticked = $formContainer.is(".search-form-scroll-past")
              , stickyTime = $window.scrollTop() >= fromTop;
            if (stickyTime && !isSticked) {
                $formContainer.addClass("search-form-scroll-past")
            } else if (!stickyTime && isSticked) {
                $formContainer.removeClass("search-form-scroll-past")
            }
        };
        if (formParams.$form.hasClass("searchbox-sticky") && !formParams.$form.is(".ssf form")) {
            $window.on("scroll", calculateFormPosition);
            $window.on("resize", calculateFormPosition);
            calculateFormPosition()
        }
        var $districtCodeObjectSearch = formParams.$form.find('input[name="district_code[]"].objectSearch').first()
          , finalCall = function(formParams) {
            var $autocompleteObject = formParams.$form.find('input[name="autocomplete"]');
            TrackChanges.track(formParams.$form, ["region_code", "district_code", "area_code"]);
            formParams.$dropdowns.each(bootUpDropdown);
            if ($autocompleteObject.length === 1) {
                var obj = jQuery.parseJSON($autocompleteObject.val())
                  , data = {
                    name: obj.objectType,
                    value: obj.objectId
                };
                formParams.$form.trigger("searchWidget.tideTo", data)
            }
            if (!formParams.$form.hasClass("isDefaultState")) {
                CriteriaTracker.init(formParams.$form)
            }
        };
        AsyncDropdownsHelper.registerFirstRunValues(formParams.$form, "district_code");
        AsyncDropdownsHelper.registerFirstRunValues(formParams.$form, "area_code");
        if ($districtCodeObjectSearch.length > 0 && formParams.$form.find('input[name="property_id[]"].objectSearch').length <= 0) {
            $districtCodeObjectSearch.each(function() {
                var districtCode = $districtCodeObjectSearch.val();
                Districts.loadData(function() {
                    var $regionCode = formParams.$form.find("input[name=region_code]");
                    $.each(Districts.data, function(region_code, districtsArray) {
                        var pos = districtsArray.districts.map(function(e) {
                            return e.code
                        }).indexOf(districtCode);
                        if (pos > -1 && $regionCode.length) {
                            $regionCode.val(region_code);
                            return false
                        }
                    });
                    finalCall(formParams)
                })
            })
        } else {
            finalCall(formParams)
        }
        if ($("body.home")) {
            userHasVisited(formParams.$form)
        }
    }
      , initializeSearchForm = function(formParams) {
        CriteriaTracker.addCriteriaCountChangedListener(function(count) {
            if (count > 0) {
                formParams.$form.find(".search-options").addClass("has-criteria").find(".badge").text(count)
            } else {
                formParams.$form.find(".search-options").removeClass("has-criteria")
            }
        });
        registerFormEvents(formParams);
        var $showFilters = formParams.$form.find(".searchbox-show-filters");
        if ($showFilters.length) {
            var expectedShowHash = $showFilters.attr("id");
            if (expectedShowHash) {
                var hash = window.location.hash.substr(1);
                if (hash == expectedShowHash) {
                    window.scroll(0, formParams.$form.position().top);
                    showFilters()
                }
            }
        }
        formParams.$dropdowns = formParams.$form.find(".dropdown-menu");
        formParams.$toggle = $.merge(formParams.$form.find(".toggle-menu"), $(".listing-display-options .toggle-menu"));
        initializeFormDropdownsAndToggles(formParams);
        initializeFormInputs(formParams)
    }
      , initializeCurrentLocationDatum = function($firstForm) {
        if ($firstForm.length <= 0) {
            return
        }
        var $locationSearch = $firstForm.find("input.objectSearch");
        if ($locationSearch.length) {
            CurrentLocationDatum.value = $firstForm.find("input[name=freetext]").val();
            CurrentLocationDatum.objectId = $locationSearch.first().val();
            $firstForm.addClass("isObjectSearch")
        }
        initAutocompleteLocationObj($firstForm)
    }
      , initAutocompleteLocationObj = function($searchbox) {
        var $locationSearch = $searchbox.find("input.objectSearch").not('[name="center_lat[]"],[name="center_long[]"]')
          , $matchedLocation = null;
        if ($locationSearch.length > 0) {
            $matchedLocation = $locationSearch.first();
            CurrentLocationDatum.value = $searchbox.find("input[name=freetext]").val();
            CurrentLocationDatum.objectId = $matchedLocation.val();
            $searchbox.addClass("isObjectSearch");
            var name = $matchedLocation.attr("name").replace("[]", "");
            var $distanceParam = $searchbox.find(".search-expanded .param-distance");
            if ($distanceParam && $distanceParam.length > 0) {
                var tideToElements = $distanceParam.data("tideto");
                if (tideToElements.indexOf(name) !== -1) {
                    var $input = $distanceParam.find("input");
                    $distanceParam.removeClass("hide");
                    $input.prop("disabled", false);
                    notifyInputVisibilityChanged($distanceParam, $input.attr("name"), $input.val(), true)
                }
            }
        }
    };
    $.fn.widgetSearch = function(options) {
        options = $.extend({
            complete: null
        }, options);
        $searchBoxes = $searchBoxes.add(this);
        this.each(function() {
            var formParams = {
                $form: $(this),
                $listeners: jQuery(),
                options: options
            };
            initializeSearchForm(formParams)
        });
        initializeCurrentLocationDatum(this.first());
        if ($.isFunction(options.complete)) {
            options.complete.call(this)
        }
        return this
    }
    ;
    var WidgetSearchPublicMethods = {
        addPreSubmitHook: function(f) {
            preSubmitHook = f
        },
        getForms: function() {
            return $searchBoxes
        }
    };
    $.extend({
        widgetSearch: function(f) {
            return WidgetSearchPublicMethods
        }
    });
    $("form.searchbox.property-search input[name=freetext]").on("autocompleteApiResponse.searchWidget", function(e, results) {
        if (typeof results == "object" && results.length > 0) {
            var $form = $(this).closest("form")
              , keyword = e.target.value.toUpperCase();
            if (keyword && $.type(keyword) === "string") {
                keyword = keyword.trim()
            }
            var exactMatches = results.filter(function(suggestion) {
                return suggestion.displayText.toUpperCase() === keyword
            });
            if (results.length === 1 || exactMatches.length === 1) {
                var first = results.length === 1 ? results[0] : exactMatches[0]
                  , $input = $("<input />").attr("type", "hidden").attr("name", "unselected").val(first.objectType + "|" + first.objectId);
                $form.find("input[name=unselected]").remove();
                $form.append($input);
                CurrentLocationDatum.lastUnselectedObjectMatch = keyword
            } else {
                removeUnselectedObjectMatch($form)
            }
        }
    });
    return true
}
)(jQuery, guruApp.widgetSearch, guruApp.Logger);
(function($, Log) {
    "use strict";
    var Poll = {
        init: function() {
            var $poll = $(".box.poll");
            $poll.find("form").submit(function(e) {
                e.preventDefault();
                var $form = $(this)
                  , dataToPost = $form.serialize();
                Log.log("Poll vote button pressed!");
                $.ajax({
                    url: guruApp.widgetPoll.pollVoteUrl,
                    type: "POST",
                    data: dataToPost
                }).done(function(data) {
                    for (var i in data.options) {
                        $form.find(".poll-result-for-" + i).removeClass("hide").children(".progress-bar").html(Math.round(data.votes[i] * 100 / data.totalVotes) + "%").width(Math.round(data.votes[i] * 100 / data.totalVotes) + "%")
                    }
                    var $submitBtn = $form.find("input[type=submit]");
                    $submitBtn.addClass("disabled").addClass("btn-main").removeClass("btn-primary").val($submitBtn.data("thanks"));
                    $form.find("input[name=optionId]").attr("disabled", true);
                    guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent("Poll", "Vote", "Vote Button Click")
                });
                return false
            })
        }
    };
    Poll.init()
}
)(jQuery, guruApp.Logger);
var EventDispatcher = function($, Log) {
    "use strict";
    var eventBag = {}
      , publicMethods = {};
    publicMethods.addListener = function(eventName, listener) {
        if (!eventBag.hasOwnProperty(eventName)) {
            eventBag[eventName] = $.Callbacks()
        }
        eventBag[eventName].add(listener);
        Log.log("EventDispatcher: Adding new listener to the event : " + eventName)
    }
    ;
    publicMethods.dispatch = function(eventName, data) {
        if (eventBag.hasOwnProperty(eventName)) {
            data = typeof data !== "undefined" ? data : {};
            eventBag[eventName].fire(data);
            Log.log("EventDispatcher: Fire the event : " + eventName)
        } else {
            Log.log("EventDispatcher: There is no listener for the event : " + eventName)
        }
    }
    ;
    publicMethods.removeListener = function(eventName, listener) {
        if (eventBag.hasOwnProperty(eventName)) {
            eventBag[eventName].remove(listener)
        }
    }
    ;
    return publicMethods
}(jQuery, guruApp.Logger);
(function($, guruApp, Log) {
    "use strict";
    $.fn.guruMap = function(options) {
        if (typeof google === "undefined" || typeof google.maps === "undefined") {
            $.error("$.guruMap: google.maps is not loaded");
            return null
        }
        var M = {
            settings: $.extend(true, {}, $.fn.guruMap.defaults, options),
            isDraggableStrategy: function(mapOptions) {
                if (typeof mapOptions.draggable !== "undefined") {
                    return
                }
                var isWithoutTouch = $("html").is(".no-touch")
                  , isTabletOrBigger = $(window).width() >= 768
                  , isDraggable = isWithoutTouch || isTabletOrBigger || !this.settings.disableDragIfTouchDevice;
                mapOptions.draggable = isDraggable;
                mapOptions.panControl = !isDraggable
            },
            transitLayerStatus: function(mapOptions) {
                if (typeof mapOptions.transitLayer !== "undefined") {
                    return
                }
                mapOptions.transitLayer = true
            },
            mapConstructor: function($domElement) {
                var mapOptions = this.settings.mapOptions;
                this.isDraggableStrategy(mapOptions);
                this.transitLayerStatus(mapOptions);
                if (guruApp.listingDetail && guruApp.listingDetail.showGoogleMapsDiscovery) {
                    var discoveryMapView = new google.maps.discovery.DiscoveryMapView({
                        element: document.querySelector("#map"),
                        placeTypePreferences: [{
                            type: "primary_school",
                            weight: 12
                        }, {
                            type: "secondary_school",
                            weight: 11
                        }, {
                            type: "university",
                            weight: 10
                        }, {
                            type: "restaurant",
                            weight: 9
                        }, {
                            type: "shopping_mall",
                            weight: 8
                        }, {
                            type: "department_store",
                            weight: 7
                        }, {
                            type: "convenience_store",
                            weight: 6
                        }, {
                            type: "atm",
                            weight: 5
                        }, {
                            type: "bank",
                            weight: 4
                        }, {
                            type: "pharmacy",
                            weight: 3
                        }],
                        directionsOptions: {
                            origin: {
                                lat: mapOptions.center.lat(),
                                lng: mapOptions.center.lng()
                            }
                        },
                        maxPlaceCount: 12
                    });
                    var map = discoveryMapView.map;
                    map.setOptions(mapOptions);
                    window.mytestDiscoveryMapView = discoveryMapView;
                    window.mytestMap = map
                } else {
                    var map = new google.maps.Map($domElement[0],mapOptions)
                }
                if (mapOptions.transitLayer !== false) {
                    var transitLayer = new google.maps.TransitLayer;
                    transitLayer.setMap(map)
                }
                return map
            }
        };
        if (this.length != 1) {
            $.error("$.guruMap: Expects 1 DOM element, " + this.length + " given", this);
            return null
        }
        return M.mapConstructor(this)
    }
    ;
    $.fn.guruMap.defaults = {
        disableDragIfTouchDevice: true,
        mapStyles: {
            media: {
                extension: "png",
                spritePath: "/sf2-search/bundles/guruweblayout/img/desktop/sprite-lang_en-app_my.png"
            },
            mapStyles: []
        },
        mapOptions: {
            zoom: 14,
            scrollwheel: false,
            mapTypeControl: false
        }
    };
    var _GuruMap = {
        pgIcons: null,
        IconMaker: {
            sprite: "/sf2-search/bundles/guruweblayout/img/desktop/sprite-lang_en-app_my.png",
            makeIcon: function(w, h, x, y, achorX, anchorY) {
                return {
                    icon: {
                        url: this.sprite,
                        size: new google.maps.Size(w,h),
                        origin: new google.maps.Point(x,y),
                        anchor: new google.maps.Point(achorX,anchorY)
                    }
                }
            },
            makePoi: function(iconIndex) {
                var w = 24
                  , h = 25
                  , xStart = 31
                  , padding = 10
                  , x = xStart + iconIndex * (w + padding)
                  , y = 83
                  , anchorX = Math.round(w / 2)
                  , anchorY = Math.round(h / 2);
                return [w, h, x, y, anchorX, anchorY]
            }
        },
        numberAbbreviation: function(number) {
            number = number.toString();
            if (number.length < 4) {
                return number
            }
            if (number.length > 6) {
                return number.substring(0, number.length - 6) + "M"
            }
            if (number.length > 3) {
                return number.substring(0, number.length - 3) + "K"
            }
        }
    };
    var GuruMapPublicMethods = {
        getDistanceFromLatLonInKm: function(lat1, lon1, lat2, lon2) {
            var R = 6371;
            var dLat = this.deg2rad(lat2 - lat1);
            var dLon = this.deg2rad(lon2 - lon1);
            var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(this.deg2rad(lat1)) * Math.cos(this.deg2rad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            var d = R * c;
            return d
        },
        deg2rad: function(deg) {
            return deg * (Math.PI / 180)
        },
        injectGoogleMapsScript: function(callbackFunction) {
            var identification = "key=AIzaSyAtnU1ztb6Yrgs1p8wqkEH5ufUirlqL828";
            if (guruApp.googleMaps && guruApp.googleMaps.key) {
                identification = "key=" + guruApp.googleMaps.key
            } else {
                Log.error("guruApp.googleMaps.key not available, using generic default one!!!")
            }
            if (!this.googleMapsIsLoaded()) {
                var script = document.createElement("script");
                script.type = "text/javascript";
                script.src = "https://maps.googleapis.com/maps/api/js?" + "key=AIzaSyAtnU1ztb6Yrgs1p8wqkEH5ufUirlqL828" + "&callback=" + callbackFunction + "&libraries=places,discovery&v=beta";
                document.body.appendChild(script)
            } else if (typeof window[callbackFunction] === "function") {
                Log.log("$.guruMap: Google Maps Script present already, calling the callback : " + callbackFunction);
                window[callbackFunction]()
            }
        },
        googleMapsIsLoaded: function() {
            return !(typeof google === "undefined" || typeof google.maps === "undefined")
        },
        getPgIcon: function(pgCategory) {
            var I = _GuruMap.IconMaker
              , hoverOffset = 110;
            if (!_GuruMap.pgIcons) {
                _GuruMap.pgIcons = {
                    FOOD: I.makeIcon.apply(I, I.makePoi(0)),
                    MEDICAL: I.makeIcon.apply(I, I.makePoi(1)),
                    SCHKDGINT: I.makeIcon.apply(I, I.makePoi(2)),
                    MALLSUPRETAI: I.makeIcon.apply(I, I.makePoi(3)),
                    MRTTRANSAIR: I.makeIcon.apply(I, I.makePoi(4)),
                    WORS: I.makeIcon.apply(I, I.makePoi(5)),
                    LISTING: I.makeIcon(20, 24, 0, 115, Math.round(20 / 2), 24),
                    PROPERTY: I.makeIcon(25, 30, 30, 115, Math.round(25 / 2), 30),
                    "LISTING-DETAIL-PROPERTY": I.makeIcon(32, 37, 219, 113, Math.round(32 / 2), 37),
                    CLUSTER: I.makeIcon(35, 35, 65, 115, Math.round(35 / 2), Math.round(35 / 2)),
                    LISTING_HOVER: I.makeIcon(20, 24, hoverOffset, 115, Math.round(20 / 2), 24),
                    PROPERTY_HOVER: I.makeIcon(25, 30, 30 + hoverOffset, 115, Math.round(25 / 2), 30),
                    CLUSTER_HOVER: I.makeIcon(35, 35, 65 + hoverOffset, 115, Math.round(35 / 2), Math.round(35 / 2)),
                    COMMUTE: I.makeIcon.apply(I, I.makePoi(4)),
                    FAMILY_LIVING: I.makeIcon.apply(I, I.makePoi(5)),
                    LIFESTYLE: I.makeIcon.apply(I, I.makePoi(2)),
                    OVERVIEW: I.makeIcon.apply(I, I.makePoi(2))
                }
            }
            return _GuruMap.pgIcons[pgCategory]
        },
        makeClusterMarker: function(markerOptions) {
            var marker = null;
            markerOptions = markerOptions || {};
            var ClusterMarker = function(overlayValues) {
                this.hasBeenAdd = false;
                this.options = overlayValues;
                if (typeof this.options.icon === "undefined") {
                    if (typeof this.options.cssClass === "string" && this.options.cssClass !== "") {
                        switch (this.options.cssClass) {
                        case "icon-listing":
                        case "icon-station":
                        case "icon-cluster":
                        case "icon-property":
                            delete this.options.icon;
                            break;
                        default:
                            this.options.icon = GuruMapPublicMethods.getPgIcon("CLUSTER").icon;
                            break
                        }
                    } else {
                        this.options.icon = GuruMapPublicMethods.getPgIcon("CLUSTER").icon
                    }
                }
                this.$markerElement = $("<div />").addClass("pgmap-marker");
                this.$markerIcon = $("<div />").addClass("pgmap-marker-icon");
                this.$labelElementContent = $("<span />");
                this.$labelElement = $("<span />").addClass("pgmap-marker-label hide").append(this.$labelElementContent);
                if (this.options.cssClass == "icon-station") {
                    this.$labelArrowElement = $("<span />").addClass("pgmap-marker-label-arrow-container").append($("<span />").addClass("pgmap-marker-label-arrow"));
                    this.$labelArrowElement.insertBefore(this.$labelElementContent)
                }
                this.$badgeElement = $("<span />").addClass("pgmap-marker-badge hide");
                this.$markerElement.append(this.$markerIcon).append(this.$labelElement).append($("<span />").addClass("pgmap-marker-badge-wrapper").append(this.$badgeElement));
                this.setValues(this.options)
            };
            ClusterMarker.prototype = $.extend(new google.maps.OverlayView, {
                onAdd: function() {
                    this.getPanes().overlayMouseTarget.appendChild(this.$markerElement.get(0));
                    this.hasBeenAdd = true
                },
                draw: function() {
                    var position = this.getProjection().fromLatLngToDivPixel(this.get("position"))
                      , left = position.x
                      , top = position.y;
                    this.$markerElement.css({
                        top: top + "px",
                        left: left + "px"
                    })
                },
                onRemove: function() {
                    this.$markerElement.remove()
                },
                over: function() {
                    this.$markerElement.addClass("over")
                },
                out: function() {
                    this.$markerElement.removeClass("over")
                },
                setPosition: function(latLng) {
                    var p = null;
                    if (typeof latLng.lat === "number") {
                        p = new google.maps.LatLng(latLng.lat,latLng.lng)
                    } else {
                        p = latLng
                    }
                    this.set("position", p);
                    if (this.hasBeenAdd) {
                        this.draw()
                    }
                },
                getPosition: function() {
                    return this.get("position")
                },
                setLabel: function(label) {
                    if (label) {
                        if (typeof label === "object") {
                            label = label.text
                        }
                        if (typeof label == "number") {
                            label = _GuruMap.numberAbbreviation(label)
                        }
                        this.$labelElementContent.html(label);
                        this.$labelElement.removeClass("hide")
                    } else {
                        this.$labelElement.addClass("hide");
                        this.$labelElementContent.html("")
                    }
                },
                getLabel: function() {
                    return this.$labelElementContent.text()
                },
                setCssClass: function(cssClass) {
                    if (cssClass) {
                        this.$markerElement.addClass(cssClass)
                    }
                },
                removeCssClass: function(cssClass) {
                    if (cssClass) {
                        this.$markerElement.removeClass(cssClass)
                    }
                },
                setIcon: function(icon) {
                    if (!icon) {
                        return
                    }
                    var css = {
                        width: icon.size.width,
                        height: icon.size.height,
                        backgroundPosition: icon.origin.x * -1 + "px " + icon.origin.y * -1 + "px",
                        left: icon.anchor.x * -1 + "px",
                        bottom: (icon.size.height - icon.anchor.y) * -1 + "px"
                    };
                    if (icon.url) {
                        css.backgroundImage = 'url("' + icon.url + '")'
                    }
                    this.$markerIcon.css(css);
                    this.set("icon", icon)
                },
                setOpacity: function(opacity) {
                    this.$markerElement.css({
                        opacity: opacity
                    })
                },
                addListener: function(event, callback) {
                    var self = this;
                    self.$markerElement.on(event, function(e) {
                        callback.call(self, e)
                    })
                },
                setZIndex: function(zIndex) {
                    this.$markerElement.css({
                        zIndex: zIndex
                    })
                },
                setBadge: function(text) {
                    if (text) {
                        this.$badgeElement.html(text).removeClass("hide")
                    } else {
                        this.$badgeElement.addClass("hide").html("")
                    }
                }
            });
            marker = new ClusterMarker(markerOptions);
            return marker
        }
    };
    $.extend({
        guruMap: function() {
            return GuruMapPublicMethods
        }
    })
}
)(jQuery, guruApp, guruApp.Logger);
!function(factory) {
    "function" == typeof define && define.amd && define.amd.jQuery ? define(["jquery"], factory) : factory("undefined" != typeof module && module.exports ? require("jquery") : jQuery)
}(function($) {
    "use strict";
    function init(options) {
        return !options || void 0 !== options.allowPageScroll || void 0 === options.swipe && void 0 === options.swipeStatus || (options.allowPageScroll = NONE),
        void 0 !== options.click && void 0 === options.tap && (options.tap = options.click),
        options || (options = {}),
        options = $.extend({}, $.fn.swipe.defaults, options),
        this.each(function() {
            var $this = $(this)
              , plugin = $this.data(PLUGIN_NS);
            plugin || (plugin = new TouchSwipe(this,options),
            $this.data(PLUGIN_NS, plugin))
        })
    }
    function TouchSwipe(element, options) {
        function touchStart(jqEvent) {
            if (!(getTouchInProgress() || $(jqEvent.target).closest(options.excludedElements, $element).length > 0)) {
                var event = jqEvent.originalEvent ? jqEvent.originalEvent : jqEvent;
                if (!event.pointerType || "mouse" != event.pointerType || 0 != options.fallbackToMouseEvents) {
                    var ret, touches = event.touches, evt = touches ? touches[0] : event;
                    return phase = PHASE_START,
                    touches ? fingerCount = touches.length : options.preventDefaultEvents !== !1 && jqEvent.preventDefault(),
                    distance = 0,
                    direction = null,
                    currentDirection = null,
                    pinchDirection = null,
                    duration = 0,
                    startTouchesDistance = 0,
                    endTouchesDistance = 0,
                    pinchZoom = 1,
                    pinchDistance = 0,
                    maximumsMap = createMaximumsData(),
                    cancelMultiFingerRelease(),
                    createFingerData(0, evt),
                    !touches || fingerCount === options.fingers || options.fingers === ALL_FINGERS || hasPinches() ? (startTime = getTimeStamp(),
                    2 == fingerCount && (createFingerData(1, touches[1]),
                    startTouchesDistance = endTouchesDistance = calculateTouchesDistance(fingerData[0].start, fingerData[1].start)),
                    (options.swipeStatus || options.pinchStatus) && (ret = triggerHandler(event, phase))) : ret = !1,
                    ret === !1 ? (phase = PHASE_CANCEL,
                    triggerHandler(event, phase),
                    ret) : (options.hold && (holdTimeout = setTimeout($.proxy(function() {
                        $element.trigger("hold", [event.target]),
                        options.hold && (ret = options.hold.call($element, event, event.target))
                    }, this), options.longTapThreshold)),
                    setTouchInProgress(!0),
                    null)
                }
            }
        }
        function touchMove(jqEvent) {
            var event = jqEvent.originalEvent ? jqEvent.originalEvent : jqEvent;
            if (phase !== PHASE_END && phase !== PHASE_CANCEL && !inMultiFingerRelease()) {
                var ret, touches = event.touches, evt = touches ? touches[0] : event, currentFinger = updateFingerData(evt);
                if (endTime = getTimeStamp(),
                touches && (fingerCount = touches.length),
                options.hold && clearTimeout(holdTimeout),
                phase = PHASE_MOVE,
                2 == fingerCount && (0 == startTouchesDistance ? (createFingerData(1, touches[1]),
                startTouchesDistance = endTouchesDistance = calculateTouchesDistance(fingerData[0].start, fingerData[1].start)) : (updateFingerData(touches[1]),
                endTouchesDistance = calculateTouchesDistance(fingerData[0].end, fingerData[1].end),
                pinchDirection = calculatePinchDirection(fingerData[0].end, fingerData[1].end)),
                pinchZoom = calculatePinchZoom(startTouchesDistance, endTouchesDistance),
                pinchDistance = Math.abs(startTouchesDistance - endTouchesDistance)),
                fingerCount === options.fingers || options.fingers === ALL_FINGERS || !touches || hasPinches()) {
                    if (direction = calculateDirection(currentFinger.start, currentFinger.end),
                    currentDirection = calculateDirection(currentFinger.last, currentFinger.end),
                    validateDefaultEvent(jqEvent, currentDirection),
                    distance = calculateDistance(currentFinger.start, currentFinger.end),
                    duration = calculateDuration(),
                    setMaxDistance(direction, distance),
                    ret = triggerHandler(event, phase),
                    !options.triggerOnTouchEnd || options.triggerOnTouchLeave) {
                        var inBounds = !0;
                        if (options.triggerOnTouchLeave) {
                            var bounds = getbounds(this);
                            inBounds = isInBounds(currentFinger.end, bounds)
                        }
                        !options.triggerOnTouchEnd && inBounds ? phase = getNextPhase(PHASE_MOVE) : options.triggerOnTouchLeave && !inBounds && (phase = getNextPhase(PHASE_END)),
                        phase != PHASE_CANCEL && phase != PHASE_END || triggerHandler(event, phase)
                    }
                } else
                    phase = PHASE_CANCEL,
                    triggerHandler(event, phase);
                ret === !1 && (phase = PHASE_CANCEL,
                triggerHandler(event, phase))
            }
        }
        function touchEnd(jqEvent) {
            var event = jqEvent.originalEvent ? jqEvent.originalEvent : jqEvent
              , touches = event.touches;
            if (touches) {
                if (touches.length && !inMultiFingerRelease())
                    return startMultiFingerRelease(event),
                    !0;
                if (touches.length && inMultiFingerRelease())
                    return !0
            }
            return inMultiFingerRelease() && (fingerCount = fingerCountAtRelease),
            endTime = getTimeStamp(),
            duration = calculateDuration(),
            didSwipeBackToCancel() || !validateSwipeDistance() ? (phase = PHASE_CANCEL,
            triggerHandler(event, phase)) : options.triggerOnTouchEnd || options.triggerOnTouchEnd === !1 && phase === PHASE_MOVE ? (options.preventDefaultEvents !== !1 && jqEvent.preventDefault(),
            phase = PHASE_END,
            triggerHandler(event, phase)) : !options.triggerOnTouchEnd && hasTap() ? (phase = PHASE_END,
            triggerHandlerForGesture(event, phase, TAP)) : phase === PHASE_MOVE && (phase = PHASE_CANCEL,
            triggerHandler(event, phase)),
            setTouchInProgress(!1),
            null
        }
        function touchCancel() {
            fingerCount = 0,
            endTime = 0,
            startTime = 0,
            startTouchesDistance = 0,
            endTouchesDistance = 0,
            pinchZoom = 1,
            cancelMultiFingerRelease(),
            setTouchInProgress(!1)
        }
        function touchLeave(jqEvent) {
            var event = jqEvent.originalEvent ? jqEvent.originalEvent : jqEvent;
            options.triggerOnTouchLeave && (phase = getNextPhase(PHASE_END),
            triggerHandler(event, phase))
        }
        function removeListeners() {
            $element.unbind(START_EV, touchStart),
            $element.unbind(CANCEL_EV, touchCancel),
            $element.unbind(MOVE_EV, touchMove),
            $element.unbind(END_EV, touchEnd),
            LEAVE_EV && $element.unbind(LEAVE_EV, touchLeave),
            setTouchInProgress(!1)
        }
        function getNextPhase(currentPhase) {
            var nextPhase = currentPhase
              , validTime = validateSwipeTime()
              , validDistance = validateSwipeDistance()
              , didCancel = didSwipeBackToCancel();
            return !validTime || didCancel ? nextPhase = PHASE_CANCEL : !validDistance || currentPhase != PHASE_MOVE || options.triggerOnTouchEnd && !options.triggerOnTouchLeave ? !validDistance && currentPhase == PHASE_END && options.triggerOnTouchLeave && (nextPhase = PHASE_CANCEL) : nextPhase = PHASE_END,
            nextPhase
        }
        function triggerHandler(event, phase) {
            var ret, touches = event.touches;
            return (didSwipe() || hasSwipes()) && (ret = triggerHandlerForGesture(event, phase, SWIPE)),
            (didPinch() || hasPinches()) && ret !== !1 && (ret = triggerHandlerForGesture(event, phase, PINCH)),
            didDoubleTap() && ret !== !1 ? ret = triggerHandlerForGesture(event, phase, DOUBLE_TAP) : didLongTap() && ret !== !1 ? ret = triggerHandlerForGesture(event, phase, LONG_TAP) : didTap() && ret !== !1 && (ret = triggerHandlerForGesture(event, phase, TAP)),
            phase === PHASE_CANCEL && touchCancel(event),
            phase === PHASE_END && (touches ? touches.length || touchCancel(event) : touchCancel(event)),
            ret
        }
        function triggerHandlerForGesture(event, phase, gesture) {
            var ret;
            if (gesture == SWIPE) {
                if ($element.trigger("swipeStatus", [phase, direction || null, distance || 0, duration || 0, fingerCount, fingerData, currentDirection]),
                options.swipeStatus && (ret = options.swipeStatus.call($element, event, phase, direction || null, distance || 0, duration || 0, fingerCount, fingerData, currentDirection),
                ret === !1))
                    return !1;
                if (phase == PHASE_END && validateSwipe()) {
                    if (clearTimeout(singleTapTimeout),
                    clearTimeout(holdTimeout),
                    $element.trigger("swipe", [direction, distance, duration, fingerCount, fingerData, currentDirection]),
                    options.swipe && (ret = options.swipe.call($element, event, direction, distance, duration, fingerCount, fingerData, currentDirection),
                    ret === !1))
                        return !1;
                    switch (direction) {
                    case LEFT:
                        $element.trigger("swipeLeft", [direction, distance, duration, fingerCount, fingerData, currentDirection]),
                        options.swipeLeft && (ret = options.swipeLeft.call($element, event, direction, distance, duration, fingerCount, fingerData, currentDirection));
                        break;
                    case RIGHT:
                        $element.trigger("swipeRight", [direction, distance, duration, fingerCount, fingerData, currentDirection]),
                        options.swipeRight && (ret = options.swipeRight.call($element, event, direction, distance, duration, fingerCount, fingerData, currentDirection));
                        break;
                    case UP:
                        $element.trigger("swipeUp", [direction, distance, duration, fingerCount, fingerData, currentDirection]),
                        options.swipeUp && (ret = options.swipeUp.call($element, event, direction, distance, duration, fingerCount, fingerData, currentDirection));
                        break;
                    case DOWN:
                        $element.trigger("swipeDown", [direction, distance, duration, fingerCount, fingerData, currentDirection]),
                        options.swipeDown && (ret = options.swipeDown.call($element, event, direction, distance, duration, fingerCount, fingerData, currentDirection))
                    }
                }
            }
            if (gesture == PINCH) {
                if ($element.trigger("pinchStatus", [phase, pinchDirection || null, pinchDistance || 0, duration || 0, fingerCount, pinchZoom, fingerData]),
                options.pinchStatus && (ret = options.pinchStatus.call($element, event, phase, pinchDirection || null, pinchDistance || 0, duration || 0, fingerCount, pinchZoom, fingerData),
                ret === !1))
                    return !1;
                if (phase == PHASE_END && validatePinch())
                    switch (pinchDirection) {
                    case IN:
                        $element.trigger("pinchIn", [pinchDirection || null, pinchDistance || 0, duration || 0, fingerCount, pinchZoom, fingerData]),
                        options.pinchIn && (ret = options.pinchIn.call($element, event, pinchDirection || null, pinchDistance || 0, duration || 0, fingerCount, pinchZoom, fingerData));
                        break;
                    case OUT:
                        $element.trigger("pinchOut", [pinchDirection || null, pinchDistance || 0, duration || 0, fingerCount, pinchZoom, fingerData]),
                        options.pinchOut && (ret = options.pinchOut.call($element, event, pinchDirection || null, pinchDistance || 0, duration || 0, fingerCount, pinchZoom, fingerData))
                    }
            }
            return gesture == TAP ? phase !== PHASE_CANCEL && phase !== PHASE_END || (clearTimeout(singleTapTimeout),
            clearTimeout(holdTimeout),
            hasDoubleTap() && !inDoubleTap() ? (doubleTapStartTime = getTimeStamp(),
            singleTapTimeout = setTimeout($.proxy(function() {
                doubleTapStartTime = null,
                $element.trigger("tap", [event.target]),
                options.tap && (ret = options.tap.call($element, event, event.target))
            }, this), options.doubleTapThreshold)) : (doubleTapStartTime = null,
            $element.trigger("tap", [event.target]),
            options.tap && (ret = options.tap.call($element, event, event.target)))) : gesture == DOUBLE_TAP ? phase !== PHASE_CANCEL && phase !== PHASE_END || (clearTimeout(singleTapTimeout),
            clearTimeout(holdTimeout),
            doubleTapStartTime = null,
            $element.trigger("doubletap", [event.target]),
            options.doubleTap && (ret = options.doubleTap.call($element, event, event.target))) : gesture == LONG_TAP && (phase !== PHASE_CANCEL && phase !== PHASE_END || (clearTimeout(singleTapTimeout),
            doubleTapStartTime = null,
            $element.trigger("longtap", [event.target]),
            options.longTap && (ret = options.longTap.call($element, event, event.target)))),
            ret
        }
        function validateSwipeDistance() {
            var valid = !0;
            return null !== options.threshold && (valid = distance >= options.threshold),
            valid
        }
        function didSwipeBackToCancel() {
            var cancelled = !1;
            return null !== options.cancelThreshold && null !== direction && (cancelled = getMaxDistance(direction) - distance >= options.cancelThreshold),
            cancelled
        }
        function validatePinchDistance() {
            return null === options.pinchThreshold || pinchDistance >= options.pinchThreshold
        }
        function validateSwipeTime() {
            var result;
            return result = !options.maxTimeThreshold || !(duration >= options.maxTimeThreshold)
        }
        function validateDefaultEvent(jqEvent, direction) {
            if (options.preventDefaultEvents !== !1)
                if (options.allowPageScroll === NONE)
                    jqEvent.preventDefault();
                else {
                    var auto = options.allowPageScroll === AUTO;
                    switch (direction) {
                    case LEFT:
                        (options.swipeLeft && auto || !auto && options.allowPageScroll != HORIZONTAL) && jqEvent.preventDefault();
                        break;
                    case RIGHT:
                        (options.swipeRight && auto || !auto && options.allowPageScroll != HORIZONTAL) && jqEvent.preventDefault();
                        break;
                    case UP:
                        (options.swipeUp && auto || !auto && options.allowPageScroll != VERTICAL) && jqEvent.preventDefault();
                        break;
                    case DOWN:
                        (options.swipeDown && auto || !auto && options.allowPageScroll != VERTICAL) && jqEvent.preventDefault();
                        break;
                    case NONE:
                    }
                }
        }
        function validatePinch() {
            var hasCorrectFingerCount = validateFingers()
              , hasEndPoint = validateEndPoint()
              , hasCorrectDistance = validatePinchDistance();
            return hasCorrectFingerCount && hasEndPoint && hasCorrectDistance
        }
        function hasPinches() {
            return !!(options.pinchStatus || options.pinchIn || options.pinchOut)
        }
        function didPinch() {
            return !(!validatePinch() || !hasPinches())
        }
        function validateSwipe() {
            var hasValidTime = validateSwipeTime()
              , hasValidDistance = validateSwipeDistance()
              , hasCorrectFingerCount = validateFingers()
              , hasEndPoint = validateEndPoint()
              , didCancel = didSwipeBackToCancel()
              , valid = !didCancel && hasEndPoint && hasCorrectFingerCount && hasValidDistance && hasValidTime;
            return valid
        }
        function hasSwipes() {
            return !!(options.swipe || options.swipeStatus || options.swipeLeft || options.swipeRight || options.swipeUp || options.swipeDown)
        }
        function didSwipe() {
            return !(!validateSwipe() || !hasSwipes())
        }
        function validateFingers() {
            return fingerCount === options.fingers || options.fingers === ALL_FINGERS || !SUPPORTS_TOUCH
        }
        function validateEndPoint() {
            return 0 !== fingerData[0].end.x
        }
        function hasTap() {
            return !!options.tap
        }
        function hasDoubleTap() {
            return !!options.doubleTap
        }
        function hasLongTap() {
            return !!options.longTap
        }
        function validateDoubleTap() {
            if (null == doubleTapStartTime)
                return !1;
            var now = getTimeStamp();
            return hasDoubleTap() && now - doubleTapStartTime <= options.doubleTapThreshold
        }
        function inDoubleTap() {
            return validateDoubleTap()
        }
        function validateTap() {
            return (1 === fingerCount || !SUPPORTS_TOUCH) && (isNaN(distance) || distance < options.threshold)
        }
        function validateLongTap() {
            return duration > options.longTapThreshold && distance < DOUBLE_TAP_THRESHOLD
        }
        function didTap() {
            return !(!validateTap() || !hasTap())
        }
        function didDoubleTap() {
            return !(!validateDoubleTap() || !hasDoubleTap())
        }
        function didLongTap() {
            return !(!validateLongTap() || !hasLongTap())
        }
        function startMultiFingerRelease(event) {
            previousTouchEndTime = getTimeStamp(),
            fingerCountAtRelease = event.touches.length + 1
        }
        function cancelMultiFingerRelease() {
            previousTouchEndTime = 0,
            fingerCountAtRelease = 0
        }
        function inMultiFingerRelease() {
            var withinThreshold = !1;
            if (previousTouchEndTime) {
                var diff = getTimeStamp() - previousTouchEndTime;
                diff <= options.fingerReleaseThreshold && (withinThreshold = !0)
            }
            return withinThreshold
        }
        function getTouchInProgress() {
            return !($element.data(PLUGIN_NS + "_intouch") !== !0)
        }
        function setTouchInProgress(val) {
            $element && (val === !0 ? ($element.bind(MOVE_EV, touchMove),
            $element.bind(END_EV, touchEnd),
            LEAVE_EV && $element.bind(LEAVE_EV, touchLeave)) : ($element.unbind(MOVE_EV, touchMove, !1),
            $element.unbind(END_EV, touchEnd, !1),
            LEAVE_EV && $element.unbind(LEAVE_EV, touchLeave, !1)),
            $element.data(PLUGIN_NS + "_intouch", val === !0))
        }
        function createFingerData(id, evt) {
            var f = {
                start: {
                    x: 0,
                    y: 0
                },
                last: {
                    x: 0,
                    y: 0
                },
                end: {
                    x: 0,
                    y: 0
                }
            };
            return f.start.x = f.last.x = f.end.x = evt.pageX || evt.clientX,
            f.start.y = f.last.y = f.end.y = evt.pageY || evt.clientY,
            fingerData[id] = f,
            f
        }
        function updateFingerData(evt) {
            var id = void 0 !== evt.identifier ? evt.identifier : 0
              , f = getFingerData(id);
            return null === f && (f = createFingerData(id, evt)),
            f.last.x = f.end.x,
            f.last.y = f.end.y,
            f.end.x = evt.pageX || evt.clientX,
            f.end.y = evt.pageY || evt.clientY,
            f
        }
        function getFingerData(id) {
            return fingerData[id] || null
        }
        function setMaxDistance(direction, distance) {
            direction != NONE && (distance = Math.max(distance, getMaxDistance(direction)),
            maximumsMap[direction].distance = distance)
        }
        function getMaxDistance(direction) {
            if (maximumsMap[direction])
                return maximumsMap[direction].distance
        }
        function createMaximumsData() {
            var maxData = {};
            return maxData[LEFT] = createMaximumVO(LEFT),
            maxData[RIGHT] = createMaximumVO(RIGHT),
            maxData[UP] = createMaximumVO(UP),
            maxData[DOWN] = createMaximumVO(DOWN),
            maxData
        }
        function createMaximumVO(dir) {
            return {
                direction: dir,
                distance: 0
            }
        }
        function calculateDuration() {
            return endTime - startTime
        }
        function calculateTouchesDistance(startPoint, endPoint) {
            var diffX = Math.abs(startPoint.x - endPoint.x)
              , diffY = Math.abs(startPoint.y - endPoint.y);
            return Math.round(Math.sqrt(diffX * diffX + diffY * diffY))
        }
        function calculatePinchZoom(startDistance, endDistance) {
            var percent = endDistance / startDistance * 1;
            return percent.toFixed(2)
        }
        function calculatePinchDirection() {
            return pinchZoom < 1 ? OUT : IN
        }
        function calculateDistance(startPoint, endPoint) {
            return Math.round(Math.sqrt(Math.pow(endPoint.x - startPoint.x, 2) + Math.pow(endPoint.y - startPoint.y, 2)))
        }
        function calculateAngle(startPoint, endPoint) {
            var x = startPoint.x - endPoint.x
              , y = endPoint.y - startPoint.y
              , r = Math.atan2(y, x)
              , angle = Math.round(180 * r / Math.PI);
            return angle < 0 && (angle = 360 - Math.abs(angle)),
            angle
        }
        function calculateDirection(startPoint, endPoint) {
            if (comparePoints(startPoint, endPoint))
                return NONE;
            var angle = calculateAngle(startPoint, endPoint);
            return angle <= 45 && angle >= 0 ? LEFT : angle <= 360 && angle >= 315 ? LEFT : angle >= 135 && angle <= 225 ? RIGHT : angle > 45 && angle < 135 ? DOWN : UP
        }
        function getTimeStamp() {
            var now = new Date;
            return now.getTime()
        }
        function getbounds(el) {
            el = $(el);
            var offset = el.offset()
              , bounds = {
                left: offset.left,
                right: offset.left + el.outerWidth(),
                top: offset.top,
                bottom: offset.top + el.outerHeight()
            };
            return bounds
        }
        function isInBounds(point, bounds) {
            return point.x > bounds.left && point.x < bounds.right && point.y > bounds.top && point.y < bounds.bottom
        }
        function comparePoints(pointA, pointB) {
            return pointA.x == pointB.x && pointA.y == pointB.y
        }
        var options = $.extend({}, options)
          , useTouchEvents = SUPPORTS_TOUCH || SUPPORTS_POINTER || !options.fallbackToMouseEvents
          , START_EV = useTouchEvents ? SUPPORTS_POINTER ? SUPPORTS_POINTER_IE10 ? "MSPointerDown" : "pointerdown" : "touchstart" : "mousedown"
          , MOVE_EV = useTouchEvents ? SUPPORTS_POINTER ? SUPPORTS_POINTER_IE10 ? "MSPointerMove" : "pointermove" : "touchmove" : "mousemove"
          , END_EV = useTouchEvents ? SUPPORTS_POINTER ? SUPPORTS_POINTER_IE10 ? "MSPointerUp" : "pointerup" : "touchend" : "mouseup"
          , LEAVE_EV = useTouchEvents ? SUPPORTS_POINTER ? "mouseleave" : null : "mouseleave"
          , CANCEL_EV = SUPPORTS_POINTER ? SUPPORTS_POINTER_IE10 ? "MSPointerCancel" : "pointercancel" : "touchcancel"
          , distance = 0
          , direction = null
          , currentDirection = null
          , duration = 0
          , startTouchesDistance = 0
          , endTouchesDistance = 0
          , pinchZoom = 1
          , pinchDistance = 0
          , pinchDirection = 0
          , maximumsMap = null
          , $element = $(element)
          , phase = "start"
          , fingerCount = 0
          , fingerData = {}
          , startTime = 0
          , endTime = 0
          , previousTouchEndTime = 0
          , fingerCountAtRelease = 0
          , doubleTapStartTime = 0
          , singleTapTimeout = null
          , holdTimeout = null;
        try {
            $element.bind(START_EV, touchStart),
            $element.bind(CANCEL_EV, touchCancel)
        } catch (e) {
            $.error("events not supported " + START_EV + "," + CANCEL_EV + " on jQuery.swipe")
        }
        this.enable = function() {
            return this.disable(),
            $element.bind(START_EV, touchStart),
            $element.bind(CANCEL_EV, touchCancel),
            $element
        }
        ,
        this.disable = function() {
            return removeListeners(),
            $element
        }
        ,
        this.destroy = function() {
            removeListeners(),
            $element.data(PLUGIN_NS, null),
            $element = null
        }
        ,
        this.option = function(property, value) {
            if ("object" == typeof property)
                options = $.extend(options, property);
            else if (void 0 !== options[property]) {
                if (void 0 === value)
                    return options[property];
                options[property] = value
            } else {
                if (!property)
                    return options;
                $.error("Option " + property + " does not exist on jQuery.swipe.options")
            }
            return null
        }
    }
    var VERSION = "1.6.18"
      , LEFT = "left"
      , RIGHT = "right"
      , UP = "up"
      , DOWN = "down"
      , IN = "in"
      , OUT = "out"
      , NONE = "none"
      , AUTO = "auto"
      , SWIPE = "swipe"
      , PINCH = "pinch"
      , TAP = "tap"
      , DOUBLE_TAP = "doubletap"
      , LONG_TAP = "longtap"
      , HORIZONTAL = "horizontal"
      , VERTICAL = "vertical"
      , ALL_FINGERS = "all"
      , DOUBLE_TAP_THRESHOLD = 10
      , PHASE_START = "start"
      , PHASE_MOVE = "move"
      , PHASE_END = "end"
      , PHASE_CANCEL = "cancel"
      , SUPPORTS_TOUCH = "ontouchstart"in window
      , SUPPORTS_POINTER_IE10 = window.navigator.msPointerEnabled && !window.PointerEvent && !SUPPORTS_TOUCH
      , SUPPORTS_POINTER = (window.PointerEvent || window.navigator.msPointerEnabled) && !SUPPORTS_TOUCH
      , PLUGIN_NS = "TouchSwipe"
      , defaults = {
        fingers: 1,
        threshold: 75,
        cancelThreshold: null,
        pinchThreshold: 20,
        maxTimeThreshold: null,
        fingerReleaseThreshold: 250,
        longTapThreshold: 500,
        doubleTapThreshold: 200,
        swipe: null,
        swipeLeft: null,
        swipeRight: null,
        swipeUp: null,
        swipeDown: null,
        swipeStatus: null,
        pinchIn: null,
        pinchOut: null,
        pinchStatus: null,
        click: null,
        tap: null,
        doubleTap: null,
        longTap: null,
        hold: null,
        triggerOnTouchEnd: !0,
        triggerOnTouchLeave: !1,
        allowPageScroll: "auto",
        fallbackToMouseEvents: !0,
        excludedElements: ".noSwipe",
        preventDefaultEvents: !0
    };
    $.fn.swipe = function(method) {
        var $this = $(this)
          , plugin = $this.data(PLUGIN_NS);
        if (plugin && "string" == typeof method) {
            if (plugin[method])
                return plugin[method].apply(plugin, Array.prototype.slice.call(arguments, 1));
            $.error("Method " + method + " does not exist on jQuery.swipe")
        } else if (plugin && "object" == typeof method)
            plugin.option.apply(plugin, arguments);
        else if (!(plugin || "object" != typeof method && method))
            return init.apply(this, arguments);
        return $this
    }
    ,
    $.fn.swipe.version = VERSION,
    $.fn.swipe.defaults = defaults,
    $.fn.swipe.phases = {
        PHASE_START: PHASE_START,
        PHASE_MOVE: PHASE_MOVE,
        PHASE_END: PHASE_END,
        PHASE_CANCEL: PHASE_CANCEL
    },
    $.fn.swipe.directions = {
        LEFT: LEFT,
        RIGHT: RIGHT,
        UP: UP,
        DOWN: DOWN,
        IN: IN,
        OUT: OUT
    },
    $.fn.swipe.pageScroll = {
        NONE: NONE,
        HORIZONTAL: HORIZONTAL,
        VERTICAL: VERTICAL,
        AUTO: AUTO
    },
    $.fn.swipe.fingers = {
        ONE: 1,
        TWO: 2,
        THREE: 3,
        FOUR: 4,
        FIVE: 5,
        ALL: ALL_FINGERS
    }
});
(function($, guruApp, Log) {
    $.fn.slider = function() {
        var _this = this
          , selector = {
            ul: "ul",
            prev: ".prev",
            next: ".next",
            container: ".gallery-container",
            wrapperClass: ".gallery-wrapper",
            mainContainer: $(_this),
            crouselNavigation: ".crousel-navigation",
            li: "li"
        };
        var bindEvents = function($parentCotainer) {
            $parentCotainer.find(selector.prev).click(function(e) {
                e.stopPropagation();
                _this.moveBack($(e.currentTarget).parents(selector.wrapperClass))
            });
            $parentCotainer.find(selector.next).click(function(e) {
                e.stopPropagation();
                _this.moveForward($(e.currentTarget).parents(selector.wrapperClass))
            });
            $parentCotainer.parents(".listing-card").find("a.nav-link").swipe({
                allowPageScroll: "auto",
                swipe: function(e, direction) {
                    if (direction === "left") {
                        _this.moveForward($parentCotainer)
                    } else if (direction === "right") {
                        _this.moveBack($parentCotainer)
                    }
                }
            })
        }
          , addClassToElements = function($parentContainer, sel, cls) {
            for (var i in sel) {
                $parentContainer.find(sel[i]).addClass(cls)
            }
        }
          , removeClassToElements = function($parentContainer, sel, cls) {
            for (var i in sel) {
                $parentContainer.find(sel[i]).removeClass(cls)
            }
        }
          , getGalleryItems = function($parentContainer) {
            var sliderJSON = [];
            try {
                sliderJSON = $parentContainer.data("gallery");
                if (!sliderJSON) {
                    sliderJSON = []
                }
            } catch (e) {
                sliderJSON = [];
                console.error("Invalid JSON data")
            }
            return sliderJSON
        }
          , updateGalleryJSON = function($parentContainer, data) {
            var dataToUpdate = data.slice(1);
            $parentContainer.data("gallery", dataToUpdate)
        }
          , stopVideo = function($parent, currentSliderImage) {
            try {
                var $video = $($parent.find("li")[currentSliderImage - 1]).find("video");
                if ($video && $video.length) {
                    $video[0].pause()
                }
            } catch (e) {}
        }
          , init = function() {
            _this.setSlider()
        };
        this.setSlider = function() {
            var parentUl, $parentContainer;
            for (var i = 0; i < selector.mainContainer.length; i++) {
                $parentContainer = $(selector.mainContainer[i]);
                (function($parentContainer) {
                    parentUl = $parentContainer.find(selector.ul);
                    var sliderJSON = getGalleryItems($parentContainer) || [], sliderLength;
                    sliderLength = Number($parentContainer.find(selector.li).length) + sliderJSON.length;
                    $parentContainer.data("current-tab", 1);
                    $parentContainer.data("items-len", sliderLength);
                    $parentContainer.find(selector.li).each(function(index, li) {
                        $(li).css({
                            left: index * 100 + "%"
                        })
                    });
                    bindEvents($parentContainer)
                }
                )($parentContainer)
            }
        }
        ;
        this.moveBack = function($parent) {
            var currentSliderImage = Number($parent.data("current-tab"));
            if (currentSliderImage > 1) {
                stopVideo($parent, currentSliderImage);
                removeClassToElements($parent, [selector.next, selector.prev], "disable-link");
                currentSliderImage--;
                $parent.data("current-tab", currentSliderImage);
                _this.moveSlider($parent, currentSliderImage)
            }
            if (currentSliderImage == 1) {
                addClassToElements($parent, [selector.prev], "disable-link")
            }
        }
        ;
        this.updateSlide = function($parent, data, currentSliderImage) {
            if (data && data.length) {
                var html = '<li style="left: ' + (currentSliderImage + 1) * 100 + '%;">';
                if (data[0].embed_html) {
                    html += data[0].embed_html
                } else if (data[0].videoMarkup) {
                    html += data[0].videoMarkup
                } else {
                    html += '<img src="' + data[0].media + '" />'
                }
                html += "</li>";
                $parent.find(selector.ul).append(html);
                $wrapper = $parent.find(".gallery-wrapper");
                updateGalleryJSON($parent, data)
            }
        }
        ;
        this.moveForward = function($parent) {
            var currentSliderImage = Number($parent.data("current-tab"))
              , sliderLength = Number($parent.data("items-len"));
            this.updateSlide($parent, getGalleryItems($parent), currentSliderImage);
            if (currentSliderImage < sliderLength) {
                stopVideo($parent, currentSliderImage);
                removeClassToElements($parent, [selector.next, selector.prev], "disable-link");
                currentSliderImage++;
                $parent.data("current-tab", currentSliderImage);
                _this.moveSlider($parent, currentSliderImage)
            }
            if (currentSliderImage == sliderLength) {
                addClassToElements($parent, [selector.next], "disable-link")
            }
        }
        ;
        this.moveSlider = function($parent, currentSliderImage) {
            var nextPosition = -((currentSliderImage - 1) * 100) + "%";
            if (Modernizr.csstransforms && Modernizr.csstransitions) {
                $parent.find(selector.ul).css({
                    transform: "translateX(" + nextPosition + ")"
                })
            } else {
                $parent.find(selector.ul).animate({
                    left: nextPosition
                }, 500, function() {})
            }
        }
        ;
        init()
    }
}
)(jQuery, guruApp, guruApp.Logger);
(function($, guruApp) {
    "use strict";
    if (!guruApp.marketing || !guruApp.marketing.loopaautomate) {
        return false
    }
    var Logger = guruApp.Logger;
    function log(data) {
        Logger.log("loopaConversionDataTracking: data:" + JSON.stringify(data))
    }
    function loopaConversionDataTracking(conversionType, listingId) {
        if (window.loopaAutomate) {
            var data = {
                event: "conversion",
                data: {
                    type: conversionType,
                    productId: listingId,
                    transactionId: getTransactionId()
                }
            };
            window.loopaAutomate.push(data);
            log(data)
        }
    }
    function getTransactionId() {
        var transactionId = "";
        try {
            transactionId = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getCurrentTransactionId()
        } catch (e) {}
        return transactionId
    }
    $(window).on("load", function() {
        var $pageContent = $("body")
          , listingId = guruApp.listingDetail ? guruApp.listingDetail.gaECData.id : null;
        function getListingId($ele) {
            return listingId || $ele.data("listing-id") || $ele.parents(".listing-card").data("listing-id")
        }
        $pageContent.find(".btn-shortlist").on("click", function() {
            if (!$(this).hasClass("shortlisted")) {
                loopaConversionDataTracking("Shortlist", getListingId($(this)))
            }
        });
        $pageContent.find("form.js-contact-form").on("submit", function() {
            loopaConversionDataTracking("ContactAgent", getListingId($(this)))
        });
        $pageContent.find(".btn-tools .phone-call-action-tracking, .js-agent-phone-number-call").not(".reveal-phone-number").on("click", function() {
            loopaConversionDataTracking("ClickCall", getListingId($(this)))
        });
        $pageContent.on("click", ".js-agent-phone-number-sms", function() {
            loopaConversionDataTracking("ClickSMS", getListingId($(this)))
        });
        $pageContent.find(".btn-tools .whatsapp-button, .btn-whatsapp, .js-agent-phone-number-whatsapp").on("click", function() {
            loopaConversionDataTracking("ClickWhatsapp", getListingId($(this)))
        });
        $pageContent.find(".btn-tools .reveal-phone-number, .agent-phone .js-agent-phone-number, .listing-values .js-agent-phone-number, .developer-phone-number, .developer-show-number").on("click", function() {
            loopaConversionDataTracking("PhoneReveal", getListingId($(this)))
        })
    })
}
)(jQuery, guruApp, guruApp.Logger);
function widgetMapNearbyCallbackV2() {
    "use strict";
    var mapWidgetTrans = guruApp.MapNearbyWidget || {};
    var Map = {
        map: null,
        autoAdjustBounds: true,
        googleCategoriesMapping: null,
        groupPlaceMapping: null,
        country: null,
        infoWindow: null,
        googlePlacesMarkers: [],
        specificLocationMarkers: [],
        specificLocaitonsDisplays: [],
        userSearchedLocations: [],
        $nearbyWidget: null,
        $mapV2: $(".map-v2"),
        $panels: null,
        itemTemplate: $("#nearbyPlaceCard").html(),
        noItemTemplate: $("#noNearByPlaceCard").html(),
        specificLocationTemplate: $("#specificLocationCard").html(),
        routeTemplate: $("#route-card").html(),
        categBoxTemplate: $("#category-box").html(),
        circle: null,
        radius: 1e3,
        maxRadius: 5e3,
        initialRadius: 1e3,
        boundPadding: 100,
        propertyMarker: null,
        propertyMarkers: {},
        overlay: null,
        masterPlan: false,
        infoWindowTemplate: $("#info-window").html(),
        iconCache: {},
        zoom: 16,
        zoomOnMobile: 14,
        placesService: null,
        infoWindowMaxHeight: 200,
        originMarkerPositionRightFromWidget: 300,
        mapFinishLoaded: false,
        defaultMapType: "roadmap",
        userSelectedMapType: null,
        numShowPoi: 4,
        isMultipleMarker: false,
        cachedNearbyLocations: {},
        googlePlacePgIconMapping: {
            default: "location",
            origin: "location",
            destination: "location",
            train_station: "train",
            subway_station: "train",
            transit_station: "bus",
            bus_station: "bus",
            school: "school",
            university: "school",
            hospital: "hospital",
            pharmacy: "hospital",
            doctor: "hospital",
            dentist: "hospital",
            store: "supermarket",
            bank: "bank",
            shopping_mall: "shopping",
            grocery_or_supermarket: "supermarket",
            department_store: "supermarket",
            atm: "atm",
            post_office: "post-office",
            cafe: "restaurant",
            casino: "restaurant",
            liquor_store: "restaurant",
            night_club: "restaurant",
            restaurant: "restaurant",
            park: "park",
            gym: "gym",
            movie_theater: "cinema",
            church: "worship",
            hindu_temple: "worship",
            museum: "location"
        },
        init: function() {
            function exists(records, val) {
                for (var i = 0; i < records.length; i++) {
                    if (records[i].userSearchedPlaceId === val) {
                        return true
                    }
                }
                return false
            }
            var $mapWidget = $(".map-nearby-widget")
              , $headerMap = $(".cover-img-box .gmap-noimage")
              , $mapCanvas = $(".map-canvas")
              , draggable = $("html").is(".no-touch") || $(window).width() >= 768;
            var markersData = $mapCanvas.data("markers");
            if (typeof markersData !== "undefined" && markersData != null && markersData.length != null && markersData.length > 0) {
                Map.isMultipleMarker = true
            }
            var mapWidgetTitleHtml = $(".map-widget-title:first").html();
            $(".map-widget-title:not(:first)").html(mapWidgetTitleHtml);
            if ($headerMap.length !== 0) {
                $(window).trigger("googlemaps.loaded")
            }
            Map.$nearbyWidget = $mapWidget.find(".map-nearby-location .nav-tabs");
            Map.$panels = $(".nearby-locations-").find(".place");
            if ($mapCanvas.length === 0) {
                return false
            }
            Map.propertyPosition = new google.maps.LatLng($mapCanvas.data("latitude"),$mapCanvas.data("longitude"));
            if ($mapCanvas.data("zoom")) {
                zoom = $mapCanvas.data("zoom");
                this.autoAdjustBounds = false
            }
            var customStyle = [{
                featureType: "poi",
                elementType: "labels",
                stylers: [{
                    visibility: "off"
                }]
            }];
            Map.map = $mapCanvas.guruMap({
                mapOptions: {
                    center: Map.propertyPosition,
                    zoom: guruApp.client && guruApp.client.is_mobile && guruApp.listingDetail && guruApp.listingDetail.showGoogleMapsDiscovery ? Map.zoomOnMobile : Map.zoom,
                    panControl: true,
                    fullscreenControl: false,
                    mapTypeControl: false,
                    draggable: true,
                    zoomControlOptions: {
                        position: google.maps.ControlPosition.RIGHT_BOTTOM
                    },
                    streetViewControlOptions: {
                        position: google.maps.ControlPosition.RIGHT_BOTTOM
                    },
                    styles: customStyle
                }
            });
            google.maps.event.addListenerOnce(Map.map, "tilesloaded", Map.eventOnFinishLoaded);
            Map.overlay = new google.maps.OverlayView;
            Map.overlay.draw = function() {}
            ;
            Map.overlay.setMap(Map.map);
            Map.country = $mapCanvas.data("region");
            Map.googleCategoriesMapping = Map.getGooglePlacesTypesMapping();
            Map.groupPlaceMapping = Map.getGroupAndPlaceTypeMapping();
            if (Map.country === "sg") {
                Map.restrictMapViewForSingaporeOnly()
            }
            Map.placesService = {
                _placesService: null,
                initGoogleMapPlaces: function() {
                    Map.placesService._placesService = new google.maps.places.PlacesService(Map.map)
                },
                getDetails: function(request, callback) {
                    var api = mapWidgetTrans.proxyApi + "/getDetails"
                      , proxyRequest = Map.placesService.buildProxyRequest(request);
                    $.get(api, proxyRequest).done(function(proxyResult) {
                        [proxyResult.result].map(Map.placesService.objectifyLocation);
                        callback(proxyResult.result, proxyResult.status)
                    }).fail(function() {
                        guruApp.Logger.error("Google Maps Proxy Call failed!");
                        Map.placesService._placesService.getDetails(request, callback)
                    })
                },
                nearbySearch: function(request, callback) {
                    var api = mapWidgetTrans.proxyApi + "/nearbySearch"
                      , proxyRequest = Map.placesService.buildProxyRequest(request);
                    $.get(api, proxyRequest).done(function(proxyResults) {
                        proxyResults.results.map(Map.placesService.objectifyLocation);
                        callback(proxyResults.results, proxyResults.status, {
                            hasNextPage: false
                        })
                    }).fail(function() {
                        guruApp.Logger.error("Google Maps Proxy Call failed!");
                        Map.placesService._placesService.nearbySearch(request, callback)
                    })
                },
                buildProxyRequest: function(request) {
                    var pgRequest = {
                        language: guruApp.language
                    };
                    $.extend(pgRequest, request);
                    if (pgRequest.location) {
                        pgRequest.location = pgRequest.location.lat() + "," + pgRequest.location.lng()
                    }
                    if (pgRequest.types) {
                        pgRequest.type = pgRequest.types[0]
                    }
                    if (Map.country === "th") {
                        if (pgRequest.type) {
                            switch (pgRequest.type) {
                            case "subway_station":
                            case "train_station":
                                break;
                            default:
                                pgRequest.language = "th";
                                break
                            }
                        }
                    }
                    delete pgRequest.types;
                    return pgRequest
                },
                objectifyLocation: function(result) {
                    result.geometry.location = new google.maps.LatLng(result.geometry.location.lat,result.geometry.location.lng)
                }
            };
            Map.placesService.initGoogleMapPlaces();
            Map.$mapV2.find(".explore-map-button").on("click", function(e) {
                Map.openDetailView(e, null)
            });
            Map.$mapV2.find(".close-btn").on("click", Map.closeDetailView);
            var input = $mapWidget.find("#searchForLocation")[0];
            var options = {
                componentRestrictions: {
                    country: $mapCanvas.data("region")
                }
            };
            var autocomplete = new google.maps.places.Autocomplete(input,options);
            autocomplete.bindTo("bounds", Map.map);
            Map.infoWindow = new google.maps.InfoWindow;
            google.maps.event.addListener(Map.infoWindow, "closeclick", function() {
                Map.handleInfoWindowClose()
            });
            var origInfowindowOpenFn = Map.infoWindow.open;
            Map.infoWindow.open = function() {
                var $mapCanvas = Map.$mapV2.find(".map-canvas");
                var eventDOMNodeInserted = "DOMNodeInserted.mapv2-info-window";
                var gmStyleIw = ".gm-style-iw";
                var mapTooSmall = false;
                $mapCanvas.on(eventDOMNodeInserted, function(event) {
                    var $iwOuter = $mapCanvas.find(gmStyleIw);
                    if ($iwOuter.length) {
                        $iwOuter.addClass("custom-gm-style-iw")
                    }
                });
                origInfowindowOpenFn.apply(this, arguments);
                $mapCanvas.off(eventDOMNodeInserted);
                var $iwOuter = $mapCanvas.find(gmStyleIw);
                var $iwBackground = $iwOuter.prev();
                var $iwCloseBtn = $iwOuter.next();
                $iwBackground.addClass("custom-gm-style-iw-bg");
                $iwCloseBtn.addClass("custom-gm-style-iw-btn");
                if (mapTooSmall) {
                    $iwBackground.addClass("hidden")
                }
            }
            ;
            var pgPropertyMarkerIcon = {
                url: Map.getGooglePlaceMarkerIconV2("origin", 40, false, true, function(ctx, arg) {
                    var size = arg[1];
                    ctx.fillStyle = "#FFFFFF";
                    ctx.beginPath();
                    ctx.arc(size / 2, size / 2 - 4, size / 4, 0, 2 * Math.PI);
                    ctx.fill()
                }),
                scaledSize: new google.maps.Size(40,40)
            };
            if (Map.isMultipleMarker) {
                var i = 0;
                markersData.forEach(function(data) {
                    var marker = new google.maps.Marker({
                        markerId: i,
                        map: Map.map,
                        position: new google.maps.LatLng(data.lat,data.lng),
                        icon: pgPropertyMarkerIcon,
                        zIndex: 9999999
                    });
                    Map.propertyMarkers[i] = {
                        data: data,
                        marker: marker
                    };
                    Map.addListenersToMarker(marker, data.name);
                    i += 1
                })
            } else {
                Map.propertyMarker = new google.maps.Marker({
                    map: Map.map,
                    position: Map.propertyPosition,
                    icon: pgPropertyMarkerIcon,
                    zIndex: 99999999
                });
                Map.centerOriginMarker();
                var propertyMarkerLabel = $mapCanvas.data("marker-label");
                Map.addListenersToMarker(Map.propertyMarker, propertyMarkerLabel)
            }
            $(window).trigger("developer-googlemaps.loaded", [Map.map, autocomplete]);
            autocomplete.addListener("place_changed", function() {
                Map.onUserSearchedLocation(autocomplete, input);
                var screen = Map.isFullScreen() ? "Detail" : "Overview";
                $("body").trigger("ga.listing.widgetMapNearbyV2.overview.addcommute", [screen, Map.userSearchedLocations])
            });
            if (!Map.isMultipleMarker) {
                var savedUserSearchedLocations = getCookieV2("userLocations");
                if (savedUserSearchedLocations != null && savedUserSearchedLocations.length > 0) {
                    savedUserSearchedLocations.forEach(function(userSearchedLocation, index) {
                        Map.placesService.getDetails({
                            placeId: userSearchedLocation.userSearchedPlaceId
                        }, function(place, status) {
                            if (status === google.maps.places.PlacesServiceStatus.OK) {
                                $(input).val(userSearchedLocation.locationName);
                                autocomplete.set("place", place)
                            }
                        })
                    })
                }
                $mapWidget.find(".map-nearby-location").show()
            }
            Map.itemTemplate = Hogan.compile(Map.itemTemplate);
            Map.noItemTemplate = Hogan.compile(Map.noItemTemplate);
            Map.specificLocationTemplate = Hogan.compile(Map.specificLocationTemplate);
            Map.routeTemplate = Hogan.compile(Map.routeTemplate);
            Map.infoWindowTemplate = Hogan.compile(Map.infoWindowTemplate);
            Map.categBoxTemplate = Hogan.compile(Map.categBoxTemplate);
            Map.registerCategoryClickListener();
            Map.registerMarkerLinksClickListener();
            Map.registerRadiusDropdownChange();
            Map.registerSettingsClickListener();
            if (Map.isMultipleMarker) {
                $("#map-top-bar").addClass("hide")
            } else {
                Map.showOverviewLocations();
                Map.registerTopBar()
            }
            Map.checkForUserSavedMapType();
            $(window).on("renderDirectionOnMap", function(event, data) {
                if (!exists(Map.userSearchedLocations, data.place_id)) {
                    Map.displayDirectionOnMap(data, $('<input value="' + data.commuteTimeAddress + '" />'))
                }
            });
            return true
        },
        eventOnFinishLoaded: function() {
            Map.mapFinishLoaded = true;
            if (Map.isMultipleMarker) {
                Map.adjustBounds()
            } else {
                $("#map-top-bar").removeClass("hide")
            }
            $(window).trigger("notifyMapIsReadyForCommunication")
        },
        displayDirectionOnMap: function(place, input) {
            var specificLocationMarker = new google.maps.Marker({
                map: Map.map,
                position: place.geometry.location,
                icon: {
                    url: Map.getGooglePlaceMarkerIconV2("destination", 40),
                    scaledSize: new google.maps.Size(40,40)
                }
            });
            Map.userSearchedLocations.push({
                locationName: $(input).val(),
                userSearchedPlaceId: place.place_id,
                locationAddress: place.formatted_address
            });
            Map.specificLocationMarkers.push({
                placeId: place.place_id,
                marker: specificLocationMarker
            });
            setCookieV2("userLocations", Map.userSearchedLocations, 100);
            Map.addListenersToMarker(specificLocationMarker, place.name);
            var placeType = "";
            if (Array.isArray(place.types) && place.types.length) {
                placeType = place.types[0]
            }
            var locationIcon = Map.mapGooglePlaceTypeWithPgIcon(placeType);
            var specificLocationCardData = {
                locationName: $(input).val(),
                placeId: place.place_id,
                locationIcon: locationIcon,
                locationPlaceType: placeType
            };
            var specificLocationCard = Map.specificLocationTemplate.render(specificLocationCardData);
            Map.$mapV2.find(".specific-nearby-locations").append(specificLocationCard);
            $(input).val("");
            var $searchedLocaitonCard = $(".specific-nearby-locations").find(".place-" + place.place_id);
            var $routes = $searchedLocaitonCard.find(".place-transport-type");
            var origin = Map.propertyMarker.position;
            var destination = place.destination || place.geometry.location.lat() + ", " + place.geometry.location.lng();
            var directionsService = new google.maps.DirectionsService;
            var request = {
                origin: origin,
                destination: destination,
                travelMode: google.maps.DirectionsTravelMode.TRANSIT
            };
            var directionsDisplay = new google.maps.DirectionsRenderer;
            var directionOptions = {
                suppressMarkers: true
            };
            if (!Map.mapFinishLoaded) {
                directionOptions.preserveViewport = true
            }
            directionsDisplay.setOptions(directionOptions);
            directionsDisplay.setMap(Map.map);
            Map.specificLocaitonsDisplays.push({
                placeId: place.place_id,
                display: directionsDisplay
            });
            Map.registerSpecificLocationRemoveListener($searchedLocaitonCard, directionsDisplay, place.place_id, specificLocationMarker);
            directionsService.route(request, function(response, status) {
                if (status === "OK") {
                    var route = {};
                    route.mode = "TRANSIT";
                    var leg = response.routes[0].legs[0];
                    var durationValue = leg.duration.value / 60;
                    var durationUnit = "mins";
                    if (durationValue > 60) {
                        durationValue = (durationValue / 60).toFixed();
                        durationUnit = "hrs"
                    }
                    route.time = Math.round(durationValue);
                    route.timeUnit = durationUnit;
                    var change = 0;
                    var step = null;
                    route.icons = [];
                    for (var i = 0; i < leg.steps.length; i++) {
                        step = leg.steps[i];
                        if (step.travel_mode == "TRANSIT") {
                            change++;
                            if (step.transit.line) {
                                route.icons.push("train")
                            } else {
                                route.icons.push("bus")
                            }
                        }
                    }
                    if (change >= 1) {
                        route.info = change - 1 + " change"
                    }
                    if (route.icons.length > 2) {
                        route.icons.length = 2
                    }
                    if (route.icons.length == 0) {
                        route.icons.push("walk")
                    }
                    var routeTemplate = Map.routeTemplate.render(route);
                    $routes.prepend(routeTemplate);
                    directionsDisplay.setDirections(response);
                    Map.registerRouteChangeListener($routes, route.mode, response, directionsDisplay);
                    $routes.find("." + route.mode).addClass("active")
                }
            });
            request = {
                origin: origin,
                destination: destination,
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            };
            directionsService.route(request, function(response, status) {
                if (status === "OK") {
                    var route = {};
                    route.mode = "DRIVING";
                    var leg = response.routes[0].legs[0];
                    var durationValue = leg.duration.value / 60;
                    var durationUnit = "mins";
                    if (durationValue > 60) {
                        durationValue = (durationValue / 60).toFixed();
                        durationUnit = "hrs"
                    }
                    route.time = Math.round(durationValue);
                    route.timeUnit = durationUnit;
                    route.info = leg.distance.text;
                    route.icons = ["car"];
                    var routeTemplate = Map.routeTemplate.render(route);
                    $routes.append(routeTemplate);
                    Map.registerRouteChangeListener($routes, route.mode, response, directionsDisplay)
                }
            })
        },
        onUserSearchedLocation: function(autocomplete, input) {
            var place = autocomplete.getPlace();
            if (!place.geometry) {
                return
            }
            Map.displayDirectionOnMap(place, input)
        },
        registerRouteChangeListener: function($routes, mode, response, directionsDisplay) {
            $routes.find("." + mode).on("click", function() {
                directionsDisplay.setDirections(response);
                $routes.find(".transport-item").removeClass("active");
                $(this).addClass("active")
            })
        },
        registerSpecificLocationRemoveListener: function($searchedLocaitonCard, directionsDisplay, placeId, specificLocationMarker) {
            $searchedLocaitonCard.find(".pgicon-cancel").on("click", function() {
                $searchedLocaitonCard.html("");
                Map.userSearchedLocations.forEach(function(location, index) {
                    if (location.userSearchedPlaceId == placeId) {
                        Map.userSearchedLocations.splice(index, 1)
                    }
                });
                Map.specificLocationMarkers.forEach(function(marker, index) {
                    if (marker.placeId == placeId) {
                        Map.specificLocationMarkers.splice(index, 1)
                    }
                });
                Map.specificLocaitonsDisplays.forEach(function(diplay, index) {
                    if (diplay.placeId == placeId) {
                        Map.specificLocaitonsDisplays.splice(index, 1)
                    }
                });
                setCookieV2("userLocations", Map.userSearchedLocations, 100);
                directionsDisplay.setOptions({
                    markerOptions: {
                        visible: false
                    }
                });
                directionsDisplay.setMap();
                specificLocationMarker.setMap();
                Map.adjustBounds();
                Map.map.panTo(Map.propertyPosition)
            })
        },
        registerRadiusDropdownChange: function() {
            $(".radius-setting .dropdown-menu li a").on("click", function() {
                var $thisElm = $(this);
                var $dropDownToggle = $thisElm.parents(".dropdown").find(".dropdown-toggle");
                var distance = $thisElm.data("distance");
                $dropDownToggle.text($thisElm.text());
                $dropDownToggle.val(distance);
                Map.radius = Number(distance);
                Map.lastSelectedRadius = Number(distance);
                Map.drawCircleOnMarker();
                if (Map.pgCategory) {
                    Map.changeListForCategory(Map.pgCategory)
                } else {
                    Map.adjustBounds()
                }
            })
        },
        registerSettingsClickListener: function() {
            var $mapSettingScreen = Map.$mapV2.find("#map-setting-screen");
            $mapSettingScreen.hide();
            Map.$mapV2.find(".map-settings").on("click", function() {
                $mapSettingScreen.toggle();
                Map.$mapV2.find("#map-data-screen").toggle()
            });
            $mapSettingScreen.find(".pgicon-cancel").on("click", function() {
                $mapSettingScreen.hide();
                Map.$mapV2.find("#map-data-screen").show()
            });
            $mapSettingScreen.find(".rectangle").on("click", function() {
                $mapSettingScreen.find(".rectangle").removeClass("active");
                $(this).addClass("active");
                var type = $(this).data("type");
                Map.changeMapType(type);
                Map.userSelectedMapType = type
            })
        },
        registerTopBar: function() {
            Map.map.controls[google.maps.ControlPosition.TOP_RIGHT].push($("#map-top-bar").get(0))
        },
        checkForUserSavedMapType: function() {
            var type = "roadmap";
            var mapTypeOption = Map.$mapV2.find("#map-setting-screen .map-type-option .rectangle[data-type=" + type + "]");
            mapTypeOption.addClass("active")
        },
        changeMapType: function(type) {
            if (type == "masterPlan") {
                if (!Map.masterPlan) {
                    Map.addMasterPlanLayer()
                }
            } else {
                Map.map.setMapTypeId(type);
                if (Map.masterPlan) {
                    Map.removeMasterPlanLayer()
                }
            }
        },
        openDetailView: function(event, pgCategory) {
            var $body = $("body");
            Map.$mapV2.addClass("fullscreen");
            Map.$mapV2.find(".map-canvas").addClass("fullscreen-canvas");
            Map.$mapV2.find(".map-nearby-location").addClass("fullscreen-near-by-location");
            Map.$mapV2.find(".nav-tabs").show();
            $body.addClass("map-fullscreen");
            document.body.scroll = "no";
            if (Map.lastSelectedRadius) {
                Map.radius = Map.lastSelectedRadius
            }
            var defaultLocationType = null;
            if (pgCategory) {
                defaultLocationType = Map.$nearbyWidget.find("li a[data-code=" + pgCategory + "]")
            } else {
                defaultLocationType = Map.$nearbyWidget.find("li a").filter(":first")
            }
            Map.preventBackgrounScrollOnMobile();
            defaultLocationType.prop("checked", true);
            defaultLocationType.click();
            google.maps.event.trigger(Map.map, "resize");
            if (Map.userSelectedMapType) {
                Map.changeMapType(Map.userSelectedMapType)
            }
            Map.drawCircleOnMarker();
            Map.adjustBounds();
            $(document).on("keyup", function(e) {
                if (e.keyCode == 27) {
                    Map.closeDetailView()
                }
            });
            var target = event.target || event.srcElement;
            var clickLocation = $(target).hasClass("explore-map-button") ? "See All" : "Card";
            var commuteProvided = Map.userSearchedLocations.length ? "Yes" : "No";
            var cardTypes = Map.getGooglePlacesTypesMapping().OVERVIEW[Map.country];
            $("body").trigger("ga.listing.widgetMapNearbyV2.overview.gofullscreen", [clickLocation, cardTypes.join(", "), commuteProvided])
        },
        preventBackgrounScrollOnMobile: function() {
            var $body = $("body")
              , $mapNearByLocation = Map.$mapV2.find(".nearby-locations-box")
              , xDown = null
              , yDown = null;
            $body.on("touchmove.map-v2-fullscreen", function(e) {
                if (!$mapNearByLocation.has($(e.target)).length) {
                    e.stopImmediatePropagation();
                    e.preventDefault()
                }
            });
            $mapNearByLocation.on("touchstart.map-v2-fullscreen", handleTouchStart);
            $mapNearByLocation.on("touchmove.map-v2-fullscreen", handleTouchMove);
            function handleTouchStart(e) {
                xDown = e.originalEvent.changedTouches[0].clientX;
                yDown = e.originalEvent.changedTouches[0].clientY
            }
            function handleTouchMove(e) {
                var $elm = $(this);
                if (!xDown || !yDown) {
                    return
                }
                var xUp = e.originalEvent.changedTouches[0].clientX;
                var yUp = e.originalEvent.changedTouches[0].clientY;
                var xDiff = xDown - xUp;
                var yDiff = yDown - yUp;
                if (Math.abs(xDiff) > Math.abs(yDiff)) {
                    if (xDiff > 0) {
                        e.preventDefault()
                    } else {
                        e.preventDefault()
                    }
                } else {
                    if (yDiff > 0) {
                        if ($elm.scrollTop() + $elm.innerHeight() >= $elm[0].scrollHeight) {
                            e.preventDefault()
                        }
                    } else {
                        if ($elm.scrollTop() <= 0) {
                            e.preventDefault()
                        }
                    }
                }
                xDown = null;
                yDown = null
            }
        },
        releasePreventBackgrounScrollOnMobile: function() {
            var $body = $("body")
              , $mapNearByLocation = Map.$mapV2.find(".nearby-locations-box");
            $body.off("touchmove.map-v2-fullscreen");
            $mapNearByLocation.off("touchstart.map-v2-fullscreen");
            $mapNearByLocation.off("touchmove.map-v2-fullscreen")
        },
        closeDetailView: function() {
            Map.$mapV2.removeClass("fullscreen");
            Map.$mapV2.find(".map-canvas").removeClass("fullscreen-canvas");
            Map.$mapV2.find(".map-nearby-location").removeClass("fullscreen-near-by-location");
            $("body").removeClass("map-fullscreen");
            document.body.scroll = "yes";
            Map.releasePreventBackgrounScrollOnMobile();
            google.maps.event.trigger(Map.map, "resize");
            Map.circle.setMap(null);
            Map.radius = 1e3;
            Map.showOverviewLocations();
            if (Map.userSelectedMapType) {
                Map.changeMapType(Map.defaultMapType)
            }
            Map.map.setZoom(Map.zoom);
            Map.map.panTo(Map.propertyPosition);
            $(document).off("keyup");
            Map.$mapV2.find("#map-setting-screen").hide();
            Map.$mapV2.find("#map-data-screen").show()
        },
        isFullScreen: function() {
            return $(".map-v2").hasClass("fullscreen")
        },
        isWidgetOverMap: function() {
            return parseInt($(".map-v2 .map-nearby-location").css("margin-top")) < -50
        },
        handleInfoWindowClose: function() {
            Map.clearPreviousSidebarSelections()
        },
        findPanelByCategory: function(pgCategory) {
            return Map.$panels.find(".panel-title[data-type=" + pgCategory + "]")
        },
        openCategory: function(pgCategory) {
            Map.findPanelByCategory(pgCategory).click()
        },
        markCategoryAsEmpty: function(pgCategory) {
            Map.findPanelByCategory(pgCategory).each(function() {
                var $panelTitle = $(this);
                $panelTitle.find(".emptyTitle").removeClass("hide");
                $panelTitle.find(".actualTitle").hide().closest("a").addClass("disabled")
            })
        },
        markCategoryAsSearched: function(pgCategory) {
            Map.findPanelByCategory(pgCategory).each(function() {
                var $actualTitle = $(this).find(".actualTitle");
                $actualTitle.html($actualTitle.attr("title"))
            })
        },
        registerCategoryClickListener: function() {
            Map.$nearbyWidget.on("touchend click", "li a", function(e) {
                var pgCategory = Map.pgCategory = $(this).data("code");
                var tabName = $(this).text().trim();
                Map.changeListForCategory(pgCategory);
                $("body").trigger("ga.listing.widgetMapNearbyV2.detail.tab.click", [tabName])
            })
        },
        showOverviewLocations: function() {
            Map.changeListForCategory("OVERVIEW");
            Map.$mapV2.find(".nav-tabs").hide()
        },
        changeListForCategory: function(pgCategory) {
            var searchedRadius = Map.maxRadius;
            if (Map.radius <= Map.initialRadius) {
                searchedRadius = Map.initialRadius
            }
            var mapAlreadySetLabel = "has-called-places-" + pgCategory + "-" + searchedRadius;
            var hasCalledPlaces = $(this).data("has-called-places-" + pgCategory + "-" + searchedRadius);
            var filterInitialResults = searchedRadius > Map.initialRadius && $(this).data("has-called-places-" + pgCategory + "-" + Map.initialRadius);
            var walkingMapRadius = Map.getWalkingDistanceFromArial(Map.radius);
            Map.$mapV2.find(".categ-box").not(".search-box").hide();
            Map.$mapV2.find(".categ-box." + pgCategory).show();
            Map.$mapV2.find(".nearby-locations .place").hide();
            Map.$mapV2.find(".nearby-locations .categ-title").hide();
            if (Map.isMultipleMarker) {
                hasCalledPlaces = false
            }
            if (!hasCalledPlaces) {
                $(this).data("has-called-places-" + pgCategory + "-" + searchedRadius, true);
                $(this).data("has-called-places-" + pgCategory + "-" + Map.initialRadius, true);
                var groupTypes = Map.getGooglePlacesGroupsForCategory(pgCategory);
                for (var i = 0; i < groupTypes.length; i++) {
                    var group = Map.googlePlacesTypeGroups[groupTypes[i]];
                    Map.nearbySearch(group, pgCategory, i, searchedRadius, filterInitialResults, groupTypes[i])
                }
            }
            Map.$mapV2.find(".nearby-locations .categ-title." + pgCategory).show();
            var $places = Map.$mapV2.find(".nearby-locations").find(".place." + pgCategory);
            $places.each(function() {
                var $elm = $(this);
                var placeRadius = Number($elm.data("radius"));
                if (walkingMapRadius >= placeRadius) {
                    $elm.show()
                }
            });
            Map.infoWindow.close();
            if (Map.propertyMarker) {
                Map.showMarkersForCategoryRelatedToMarkerId(Map.propertyMarker.markerId, pgCategory)
            } else {
                Map.showMarkersForCategory(pgCategory)
            }
            if (pgCategory === "OVERVIEW" || pgCategory === "COMMUTE") {
                $(".nearby-locations-box").find(".search-box").removeClass("hide");
                Map.showAllUserSearchedLocaitons()
            } else {
                $(".nearby-locations-box").find(".search-box").addClass("hide");
                Map.hideAllUserSearchedLocaitons()
            }
            Map.adjustBounds()
        },
        registerMarkerLinksClickListener: function() {
            $(".nearby-locations").on("click mouseover touchstart", ".place", function(e) {
                e.preventDefault();
                if (e.type == "click" && !$(".fullscreen-near-by-location").length) {
                    Map.openDetailView(e, null)
                }
                var marker = $(this).data("marker");
                if (marker != null) {
                    Map.openInfoWindow(marker)
                }
                return false
            });
            $(".nearby-locations").on("mouseout", ".place", function(e) {
                Map.infoWindow.close()
            });
            $(".view-more-link").on("click", function(e) {
                e.preventDefault();
                var $this = $(this);
                $this.parent(".categ-box").addClass("expanded");
                $this.addClass("hide")
            })
        },
        showMarkersForCategory: function(pgCategory) {
            for (var i = Map.googlePlacesMarkers.length - 1; i >= 0; i--) {
                var marker = Map.googlePlacesMarkers[i];
                marker.setVisible((typeof pgCategory === "undefined" || marker.pgCategory === pgCategory) && Map.getWalkingDistanceFromArial(Map.radius) >= marker.place.walkingDistance * 1e3)
            }
        },
        showMarkersForCategoryRelatedToMarkerId: function(markerId, pgCategory) {
            var marker;
            var markers;
            if (markerId in Map.cachedNearbyLocations && Array.isArray(Map.cachedNearbyLocations[markerId])) {
                markers = Map.cachedNearbyLocations[markerId];
                for (var i = 0; i < markers.length; i++) {
                    marker = markers[i];
                    marker.setVisible((typeof pgCategory === "undefined" || marker.pgCategory === pgCategory) && Map.getWalkingDistanceFromArial(Map.radius) >= marker.place.walkingDistance * 1e3)
                }
            }
        },
        hideAllGooglePlacesMarkers: function() {
            for (var i = Map.googlePlacesMarkers.length - 1; i >= 0; i--) {
                Map.googlePlacesMarkers[i].setVisible(false)
            }
        },
        centerOriginMarker: function() {
            if (!Map.isFullScreen() && Map.isWidgetOverMap()) {
                google.maps.event.addListenerOnce(Map.map, "idle", function() {
                    var $mapNearByLocation = Map.$mapV2.find(".map-nearby-location");
                    var widgetRightOffset = $(window).width() - $mapNearByLocation.offset().left - $mapNearByLocation.outerWidth();
                    var projection = Map.overlay.getProjection();
                    var pixel = projection.fromLatLngToContainerPixel(Map.propertyMarker.getPosition());
                    pixel.x = widgetRightOffset - Map.originMarkerPositionRightFromWidget;
                    var latLng = projection.fromContainerPixelToLatLng(pixel);
                    Map.map.setCenter(latLng)
                })
            }
        },
        adjustBounds: function() {
            if (!this.autoAdjustBounds || !Map.mapFinishLoaded) {
                return
            }
            if (Map.circle) {
                Map.map.fitBounds(Map.circle.getBounds(), 0);
                return
            }
            var bounds = [];
            $(window).trigger("developer-googlemaps.clear-counter");
            bounds.push(Map.propertyPosition);
            if (Map.specificLocationMarkers != null) {
                for (var i = 0; i < Map.specificLocationMarkers.length; i++) {
                    var marker = Map.specificLocationMarkers[i].marker;
                    if (marker.getVisible()) {
                        bounds.push(marker.position)
                    }
                }
            }
            for (var i = Map.googlePlacesMarkers.length - 1; i >= 0; i--) {
                if (Map.googlePlacesMarkers[i].getVisible()) {
                    bounds.push(Map.googlePlacesMarkers[i].position)
                }
            }
            if (Map.isMultipleMarker && Object.keys(Map.propertyMarkers).length > 0) {
                Object.keys(Map.propertyMarkers).map(function(key, index) {
                    var hasMarkerProperty = Object.prototype.hasOwnProperty.call(Map.propertyMarkers[key], "marker");
                    if (hasMarkerProperty) {
                        bounds.push(Map.propertyMarkers[key].marker.position)
                    }
                })
            }
            var googleBounds = new google.maps.LatLngBounds;
            bounds.map(function(position) {
                return googleBounds.extend(position)
            });
            if (Map.isMultipleMarker) {
                Map.map.fitBounds(googleBounds, Map.boundPadding)
            } else {
                Map.map.fitBounds(googleBounds)
            }
        },
        paddedBounds: function(npad, spad, epad, wpad) {
            if (Map.map.getBounds() == undefined) {
                return
            }
            var SW = Map.map.getBounds().getSouthWest();
            var NE = Map.map.getBounds().getNorthEast();
            var topRight = Map.map.getProjection().fromLatLngToPoint(NE);
            var bottomLeft = Map.map.getProjection().fromLatLngToPoint(SW);
            var scale = Math.pow(2, Map.map.getZoom());
            var SWtopoint = Map.map.getProjection().fromLatLngToPoint(SW);
            var SWpoint = new google.maps.Point((SWtopoint.x - bottomLeft.x) * scale + wpad,(SWtopoint.y - topRight.y) * scale - spad);
            var SWworld = new google.maps.Point(SWpoint.x / scale + bottomLeft.x,SWpoint.y / scale + topRight.y);
            var pt1 = Map.map.getProjection().fromPointToLatLng(SWworld);
            var NEtopoint = Map.map.getProjection().fromLatLngToPoint(NE);
            var NEpoint = new google.maps.Point((NEtopoint.x - bottomLeft.x) * scale - epad,(NEtopoint.y - topRight.y) * scale + npad);
            var NEworld = new google.maps.Point(NEpoint.x / scale + bottomLeft.x,NEpoint.y / scale + topRight.y);
            var pt2 = Map.map.getProjection().fromPointToLatLng(NEworld);
            return new google.maps.LatLngBounds(pt1,pt2)
        },
        nearbySearch: function(group, pgCategory, priority, searchedRadius, filterInitialResults, groupType) {
            if (guruApp.listingDetail && guruApp.listingDetail.showGoogleMapsDiscovery) {
                return
            }
            var activePosition;
            if (Map.isMultipleMarker && Map.propertyMarker) {
                activePosition = Map.propertyMarker.position
            } else {
                activePosition = Map.propertyPosition
            }
            var nearbyPlacesRequest = {
                location: activePosition,
                radius: searchedRadius,
                types: group.placesTypes
            }
              , allResults = []
              , callback = function(results, status, pagination) {
                allResults = allResults.concat(results);
                if (searchedRadius > Map.initialRadius && group.name == "MRT" && pagination.hasNextPage) {
                    pagination.nextPage()
                } else {
                    Map.nearbySearchCallback(allResults, status, pgCategory, group, priority, filterInitialResults, groupType, searchedRadius)
                }
            };
            Map.placesService.nearbySearch(nearbyPlacesRequest, callback)
        },
        convertNearbySearchResults: function(results, pgCategorySearched, placesTypesAllowed) {
            var markerData = [];
            var place = null;
            if (typeof Map.existingMarkers === "undefined") {
                Map.existingMarkers = []
            }
            if (pgCategorySearched === "OVERVIEW" && results.length > 0) {
                place = results[0];
                place.count = results.length;
                results = [];
                results.push(place)
            }
            for (var i = 0; i < results.length; i++) {
                place = results[i];
                if (place == null) {
                    continue
                }
                $.each(place.types, function(index, googlePlacesType) {
                    if (placesTypesAllowed.indexOf(googlePlacesType) < 0) {
                        return
                    }
                    var marker;
                    var markerKey = Map.getMarkerKey(place.id, pgCategorySearched);
                    if (typeof Map.existingMarkers[markerKey] !== "undefined") {
                        marker = Map.existingMarkers[markerKey].marker;
                        if (!marker.getVisible()) {
                            marker.setVisible(true)
                        }
                    } else {
                        marker = Map.createGooglePlaceMarker(googlePlacesType, place, pgCategorySearched, typeof pgCategorySearched !== "undefined");
                        if (Map.propertyMarker.markerId in Map.cachedNearbyLocations) {
                            if (!Array.isArray(Map.cachedNearbyLocations[Map.propertyMarker.markerId])) {
                                Map.cachedNearbyLocations[Map.propertyMarker.markerId] = []
                            }
                            Map.cachedNearbyLocations[Map.propertyMarker.markerId].push(marker)
                        } else {
                            Map.cachedNearbyLocations[Map.propertyMarker.markerId] = [marker]
                        }
                    }
                    place.googlePlaceType = googlePlacesType;
                    var data = {
                        place: place,
                        marker: marker,
                        pgCategory: pgCategorySearched
                    };
                    markerData.push(data);
                    Map.existingMarkers[markerKey] = data
                })
            }
            return markerData
        },
        nearbySearchCallback: function(results, status, pgCategorySearched, group, priority, isFilterInitialResults, groupType, searchedRadius) {
            var groupName = group.name;
            var noResultsFound = google.maps.places.PlacesServiceStatus.ZERO_RESULTS == status;
            if (noResultsFound && pgCategorySearched == "OVERVIEW" && groupType == "MRT") {
                var types = Map.getGooglePlacesTypeGroups();
                Map.nearbySearch(types["BUS_STOP"], pgCategorySearched, priority, searchedRadius, isFilterInitialResults, "BUS_STOP");
                return
            }
            if (noResultsFound) {
                if (pgCategorySearched === "OVERVIEW" && groupType === "BUS_STOP") {
                    groupName = "Transportation"
                }
                var text = $(".map-nearby-location li a[data-code='" + pgCategorySearched + "']").data("empty");
                var $box = Map.createCategoryBox(pgCategorySearched, groupName, priority, 1, groupType);
                Map.createNotFoundSidebarlineItem(group, pgCategorySearched, priority, $box);
                return
            }
            if (status == google.maps.places.PlacesServiceStatus.OK) {
                var places = Map.sortAndFilterResultsForCategories(results, pgCategorySearched, isFilterInitialResults);
                var $box = Map.createCategoryBox(pgCategorySearched, groupName, priority, places.length, groupType);
                if (places == null || places.length == 0) {
                    Map.createNotFoundSidebarlineItem(group, pgCategorySearched, priority, $box)
                } else {
                    var markerData = Map.convertNearbySearchResults(places, pgCategorySearched, group.placesTypes);
                    var markerHided = 0;
                    for (var i = 0; i < markerData.length; i++) {
                        var $li;
                        var place = markerData[i].place;
                        var marker = markerData[i].marker;
                        var pgCategory = markerData[i].pgCategory;
                        if (!Map.isResultListItemExist(place.id)) {
                            $li = Map.createSidebarLineItem(place, pgCategory, groupName, priority, $box);
                            if (place.walkingDistance * 1e3 > Map.getWalkingDistanceFromArial(Map.radius)) {
                                marker.setVisible(false);
                                $li.hide();
                                markerHided += 1
                            }
                            if (marker != null) {
                                Map.googlePlacesMarkers.push(marker);
                                Map.bindMarkerAndLink(marker, $li)
                            }
                        }
                    }
                    if (markerHided === markerData.length) {
                        Map.createNotFoundSidebarlineItem(group, pgCategorySearched, priority, $box)
                    }
                }
                if (Map.propertyMarker) {
                    Map.map.panTo(Map.propertyMarker.position)
                } else {
                    Map.map.panTo(Map.propertyPosition)
                }
                Map.adjustBounds();
                if (pgCategorySearched) {
                    Map.markCategoryAsSearched(pgCategorySearched)
                }
            }
        },
        sortAndFilterResultsForCategories: function(results, pgCategorySearched, isFilterInitialResults) {
            var filteredResults = [];
            results.forEach(function(place, index) {
                var walkDisTime = Map.getWalkingDistanceAndTime(place, Map.propertyPosition, Map.country);
                place.walkingDistance = walkDisTime.walkingDistance;
                place.walkingTime = walkDisTime.walkingTime;
                if (pgCategorySearched == "OVERVIEW") {
                    if (place.walkingDistance * 1e3 <= Map.getWalkingDistanceFromArial(Map.radius)) {
                        filteredResults.push(place)
                    }
                } else if (!isFilterInitialResults || Map.radius <= Map.initialRadius || place.walkingDistance * 1e3 > Map.getWalkingDistanceFromArial(Map.initialRadius)) {
                    filteredResults.push(place)
                }
            });
            filteredResults.sort(function(place1, place2) {
                return place1.walkingDistance < place2.walkingDistance ? -1 : place1.walkingDistance > place2.walkingDistance ? 1 : 0
            });
            return filteredResults
        },
        createCategoryBox: function(pgCategory, groupName, priority, resultsLength, groupType) {
            var $list = Map.$mapV2.find(".nearby-locations-box");
            var data = {
                groupName: groupName,
                pgCategory: pgCategory,
                priority: priority,
                groupType: groupType,
                iconName: Map.googlePlacesTypeGroups[groupType].iconName,
                showMore: resultsLength > Map.numShowPoi ? true : false,
                numMore: resultsLength - Map.numShowPoi
            };
            var $box = $(Map.categBoxTemplate.render(data));
            Map.insertWithPriority($list, $box, priority);
            var moreInfoStr = guruApp.MapNearbyWidget.moreNearby.replace("%1", data.numMore).replace("%2", data.groupName);
            if (data.showMore) {
                $box.find(".view-more-link").on("click", function() {
                    $box.addClass("expanded")
                });
                $box.find(".view-more-label").html(moreInfoStr)
            }
            return $box.find(".nearby-locations")
        },
        createSidebarLineItem: function(place, pgCategory, groupName, priority, $list) {
            var distanceStr = place.walkingDistance < 1 ? place.walkingDistance * 1e3 + " m" : place.walkingDistance + " km"
              , moreInfoStr = place.count > 1 && groupName != null ? guruApp.MapNearbyWidget.moreNearby.replace("%1", place.count - 1).replace("%2", groupName) : ""
              , walkTimeStr = place.walkingTime + " mins"
              , placeType = ""
              , locationIcon = Map.mapGooglePlaceTypeWithPgIcon(place.googlePlaceType);
            var data = {
                placeId: place.id,
                locationName: place.name,
                locationIcon: locationIcon,
                locationPlaceType: place.googlePlaceType,
                locationInfo: "",
                walkDistance: distanceStr,
                walkTime: walkTimeStr,
                pgCategory: pgCategory,
                distance: place.walkingDistance * 1e3,
                moreInfo: moreInfoStr,
                priority: priority
            };
            var $li = $(Map.itemTemplate.render(data));
            Map.insertWithPriority($list, $li, priority);
            $li.find(".place-more a").on("click", function(e) {
                Map.openDetailView(e, Map.getCategoryForGroupName(groupName))
            });
            return $li
        },
        clearSidebarLineItems: function() {
            $(".nearby-locations-box .categ-box:not(.search-box)").slideUp().remove()
        },
        createNotFoundSidebarlineItem: function(group, pgCategory, priority, $list) {
            var locationIcon = Map.mapGooglePlaceTypeWithPgIcon(group.placesTypes[0]);
            var locationName = guruApp.MapNearbyWidget.noLocationNearby.replace("%1", group.name);
            if (group.placesTypes.indexOf("school") !== -1) {
                locationName = mapWidgetTrans.noSchoolsNearby
            } else if (group.placesTypes.indexOf("bus_station") !== -1 || group.placesTypes.indexOf("subway_station") !== -1 || group.placesTypes.indexOf("train_station") !== -1) {
                locationName = mapWidgetTrans.noPublicTransportNearby
            } else if (group.placesTypes.indexOf("grocery_or_supermarket") !== -1) {
                locationName = mapWidgetTrans.noSupermarketNearby
            } else if (group.placesTypes.indexOf("shopping_mall") !== -1) {
                locationName = mapWidgetTrans.noShoppingMallNearby
            }
            var data = {
                pgCategory: pgCategory,
                pgRadius: Map.radius,
                locationIcon: locationIcon,
                locationName: locationName,
                priority: priority
            };
            var $li = $(Map.noItemTemplate.render(data));
            Map.insertWithPriority($list, $li, priority);
            return $li
        },
        insertWithPriority: function($list, $li, priority) {
            var $highPriorityPlace = $list.find(".priority-" + (priority + 1));
            if ($highPriorityPlace != null && $highPriorityPlace.length > 0) {
                $li.insertBefore($highPriorityPlace[0])
            } else {
                $list.append($li)
            }
        },
        mapGooglePlaceTypeWithPgIcon: function(googlePlaceType) {
            var result;
            if (Map.googlePlacePgIconMapping.hasOwnProperty(googlePlaceType)) {
                result = Map.googlePlacePgIconMapping[googlePlaceType]
            } else {
                result = Map.googlePlacePgIconMapping["default"]
            }
            return result
        },
        bindMarkerAndLink: function(marker, $a) {
            marker.link = $a;
            $a.data("marker", marker);
            $a.on("click mouseover", function() {
                Map.openInfoWindow(marker)
            });
            $a.on("mouseout", function() {
                Map.infoWindow.close()
            })
        },
        createGooglePlaceMarker: function(googlePlacesType, place, pgCategory, visible) {
            var marker = new google.maps.Marker({
                map: Map.map,
                position: place.geometry.location,
                icon: {
                    url: Map.getGooglePlaceMarkerIconV2(googlePlacesType, 20, false),
                    scaledSize: new google.maps.Size(20,20)
                },
                visible: visible
            });
            marker.place = place;
            marker.pgCategory = pgCategory;
            marker.pgRadius = Map.radius;
            marker.link = null;
            marker.distance = place.walkingDistance;
            marker.time = place.walkingTime;
            marker.count = place.count;
            google.maps.event.addListener(marker, "click", Map.clickGooglePlaceMarker);
            google.maps.event.addListener(marker, "mouseover", Map.mouseOverGooglePlaceMarker);
            google.maps.event.addListener(marker, "mouseout", Map.mouseOutGooglePlaceMarker);
            return marker
        },
        getGooglePlaceMarkerIconByType: function(pgCategory) {
            return $.guruMap().getPgIcon(pgCategory)
        },
        getGooglePlaceMarkerIconV2: function(placeType, size, stroke, circle, extraDrawFunc) {
            var result;
            var pgIconType = Map.mapGooglePlaceTypeWithPgIcon(placeType);
            var isStroke = stroke ? 1 : 0;
            var isCircle = circle ? 0 : 1;
            var cacheKey = pgIconType + placeType + size + stroke + circle;
            if (!extraDrawFunc && Object.prototype.hasOwnProperty.call(Map.iconCache, cacheKey)) {
                return Map.iconCache[cacheKey]
            }
            var canvas = document.createElement("canvas");
            var ctx = canvas.getContext("2d");
            var devicePixelRatio = window.devicePixelRatio || 1;
            var backingStoreRatio = ctx.webkitBackingStorePixelRatio || ctx.mozBackingStorePixelRatio || ctx.msBackingStorePixelRatio || ctx.oBackingStorePixelRatio || ctx.backingStorePixelRatio || 1;
            var ratio = devicePixelRatio / backingStoreRatio;
            var tempElementClasses = "pgicon pgicon-" + pgIconType + " pgicon-bg pgicon-bg-" + placeType;
            var $tempElement = $("<i>").addClass(tempElementClasses).css({
                position: "fixed",
                top: "-0px"
            }).appendTo(Map.$mapV2);
            var glyph = window.getComputedStyle($tempElement[0], ":before").content.replace(/"/g, "");
            var color = $tempElement.css("background-color");
            $tempElement.remove();
            canvas.width = size * ratio;
            canvas.height = size * ratio;
            ctx.scale(ratio, ratio);
            if (extraDrawFunc) {
                extraDrawFunc(ctx, arguments)
            }
            if (isCircle) {
                ctx.fillStyle = color;
                ctx.strokeStyle = "#FFFFFF";
                ctx.beginPath();
                ctx.arc(size / 2, size / 2, size / 2, 0, 2 * Math.PI);
                ctx.fill();
                if (isStroke) {
                    ctx.stroke()
                }
                ctx.fillStyle = "#FFFFFF";
                ctx.font = Math.round(size * 11 / 20) + "px guru-icons";
                ctx.fillText(glyph, size * 4.5 / 20, size * 14 / 20)
            } else {
                ctx.fillStyle = color;
                ctx.font = size + "px guru-icons";
                if (pgIconType === "location") {
                    ctx.textAlign = "center";
                    ctx.textBaseline = "bottom";
                    ctx.fillText(glyph, size / 2, size, size)
                } else {
                    ctx.fillText(glyph, size / 20, size * 17 / 20)
                }
            }
            result = canvas.toDataURL();
            Map.iconCache[cacheKey] = result;
            return result
        },
        openInfoWindow: function(marker) {
            var distanceStr = marker.place.walkingDistance < 1 ? marker.place.walkingDistance * 1e3 + " m" : marker.place.walkingDistance + " km"
              , timeStr = marker.place.walkingTime + " mins";
            var info = Map.infoWindowTemplate.render({
                name: marker.place.name,
                distanceStr: distanceStr,
                timeStr: timeStr,
                locationInfo: marker.place.locationInfo
            });
            Map.infoWindow.setContent(info);
            Map.infoWindow.open(Map.map, marker)
        },
        addListenersToMarker: function(marker, content) {
            marker.addListener("click", function() {
                if (Map.isMultipleMarker) {
                    if (Map.propertyMarker && this.markerId === Map.propertyMarker.markerId) {
                        return
                    }
                    if (Map.googlePlacesMarkers.length) {
                        Map.hideAllGooglePlacesMarkers()
                    }
                    Map.propertyMarker = Map.propertyMarkers[this.markerId].marker;
                    Map.clearSidebarLineItems();
                    Map.showOverviewLocations();
                    $(".map-nearby-location").show()
                }
                Map.infoWindow.setContent(content);
                Map.infoWindow.open(Map.map, this)
            });
            marker.addListener("mouseover", function() {
                Map.infoWindow.setContent(content);
                Map.infoWindow.open(Map.map, this)
            });
            marker.addListener("mouseout", function() {
                Map.clearPreviousSidebarSelections();
                Map.infoWindow.close()
            })
        },
        drawCircleOnMarker: function() {
            if (!Map.propertyMarker) {
                return
            }
            if (Map.circle) {
                Map.circle.setMap(null)
            }
            Map.circle = new google.maps.Circle({
                strokeColor: "#ffbb00",
                strokeOpacity: .8,
                strokeWeight: 2,
                fillColor: "#ffbb00",
                fillOpacity: .1,
                map: Map.map,
                radius: Map.radius
            });
            Map.circle.bindTo("center", Map.propertyMarker, "position")
        },
        clickGooglePlaceMarker: function() {
            Map.commonClickMouseOverGooglePlaceMarker(this);
            Map.scrollToSideBarItem(this)
        },
        mouseOverGooglePlaceMarker: function() {
            Map.commonClickMouseOverGooglePlaceMarker(this)
        },
        commonClickMouseOverGooglePlaceMarker: function(marker) {
            Map.openInfoWindow(marker);
            Map.markSidebarItem(marker)
        },
        scrollToSideBarItem: function(marker) {
            var $nearbyLocBox = $(".nearby-locations-box");
            $nearbyLocBox.animate({
                scrollTop: marker.link.position().top - $nearbyLocBox.position().top + $nearbyLocBox.scrollTop()
            }, 200)
        },
        mouseOutGooglePlaceMarker: function() {
            Map.unmarkSidebarItem(this);
            Map.infoWindow.close()
        },
        clearPreviousSidebarSelections: function() {
            Map.$panels.find(".active").removeClass("active")
        },
        markSidebarItem: function(marker) {
            marker.link.addClass("active")
        },
        unmarkSidebarItem: function(marker) {
            marker.link.removeClass("active")
        },
        getCategoryByGooglePlacesType: function(googlePlacesType, pgCategorySearched) {
            var mappings = Map.getGooglePlacesTypesByCategoryV2(pgCategorySearched);
            if (mappings == null) {
                return null
            }
            if (mappings.indexOf(googlePlacesType) > -1) {
                return pgCategorySearched
            }
            return null
        },
        getGooglePlacesTypesMapping: function() {
            var googlePlacesTypesMapping = {};
            googlePlacesTypesMapping.OVERVIEW = {};
            googlePlacesTypesMapping.COMMUTE = {};
            googlePlacesTypesMapping.FAMILY_LIVING = {};
            googlePlacesTypesMapping.LIFESTYLE = {};
            if (guruApp.appName === "propertyguru-sg-cg") {
                googlePlacesTypesMapping.OVERVIEW.sg = ["MRT", "SUPERMARKET"]
            } else {
                googlePlacesTypesMapping.OVERVIEW.sg = ["MRT", "SUPERMARKET", "SCHOOL"]
            }
            googlePlacesTypesMapping.OVERVIEW.my = ["MRT", "SUPERMARKET", "MALL"];
            googlePlacesTypesMapping.OVERVIEW.th = ["MRT", "SUPERMARKET", "MALL"];
            googlePlacesTypesMapping.OVERVIEW.id = ["BUS_STOP", "SCHOOL", "MALL"];
            googlePlacesTypesMapping.OVERVIEW.default = ["MRT", "SUPERMARKET", "SCHOOL"];
            googlePlacesTypesMapping.COMMUTE.default = ["MRT", "BUS_STOP"];
            googlePlacesTypesMapping.FAMILY_LIVING.default = ["SCHOOL", "HOSPITAL", "SUPERMARKET", "ATM", "POST_BOXES"];
            googlePlacesTypesMapping.LIFESTYLE.default = ["PARKS_GYM", "RESTAURANTS_PUB", "MOVIES", "MALL", "PLACE_OF_WORSHIP"];
            return googlePlacesTypesMapping
        },
        getGooglePlacesTypeGroups: function() {
            var groups = {
                MRT: {
                    name: mapWidgetTrans.mrt,
                    iconName: "train",
                    placesTypes: ["subway_station", "train_station"]
                },
                BUS_STOP: {
                    name: mapWidgetTrans.busStop,
                    iconName: "bus",
                    placesTypes: ["transit_station"]
                },
                SCHOOL: {
                    name: mapWidgetTrans.school,
                    iconName: "school",
                    placesTypes: ["school", "university"]
                },
                HOSPITAL: {
                    name: mapWidgetTrans.clinicsHospital,
                    iconName: "hospital",
                    placesTypes: ["pharmacy", "doctor", "dentist", "hospital"]
                },
                SUPERMARKET: {
                    name: mapWidgetTrans.supermarket,
                    iconName: "supermarket",
                    placesTypes: ["grocery_or_supermarket"]
                },
                ATM: {
                    name: mapWidgetTrans.atm,
                    iconName: "atm",
                    placesTypes: ["atm"]
                },
                POST_BOXES: {
                    name: mapWidgetTrans.postbox,
                    iconName: "post-office",
                    placesTypes: ["post_office"]
                },
                PARKS_GYM: {
                    name: mapWidgetTrans.parkGym,
                    iconName: "park",
                    placesTypes: ["park", "gym"]
                },
                RESTAURANTS_PUB: {
                    name: mapWidgetTrans.restaurantsPubs,
                    iconName: "restaurant",
                    placesTypes: ["restaurant", "night_club", "cafe", "casino", "liquor_store"]
                },
                MOVIES: {
                    name: mapWidgetTrans.movieTheaters,
                    iconName: "cinema",
                    placesTypes: ["movie_theater"]
                },
                MALL: {
                    name: mapWidgetTrans.malls,
                    iconName: "shopping",
                    placesTypes: ["shopping_mall"]
                },
                PLACE_OF_WORSHIP: {
                    name: mapWidgetTrans.placeOfWorship,
                    iconName: "worship",
                    placesTypes: ["church", "hindu_temple"]
                }
            };
            return groups
        },
        getGooglePlacesGroupsForCategory: function(pgCategory) {
            var googlePlacesGroups = Map.googleCategoriesMapping[pgCategory][Map.country];
            if (googlePlacesGroups == null || googlePlacesGroups.length == 0) {
                googlePlacesGroups = Map.googleCategoriesMapping[pgCategory].default
            }
            return googlePlacesGroups
        },
        getGooglePlacesTypesByCategoryV2: function(pgCategory) {
            if (Map.googleCategoriesMapping == null || Map.googlePlacesTypeGroups == null) {
                Map.googleCategoriesMapping = Map.getGooglePlacesTypesMapping();
                Map.googlePlacesTypeGroups = Map.getGooglePlacesTypeGroups()
            }
            var googlePlacesGroups = Map.googleCategoriesMapping[pgCategory][Map.country];
            if (googlePlacesGroups == null || googlePlacesGroups.length == 0) {
                googlePlacesGroups = Map.googleCategoriesMapping[pgCategory].default
            }
            var googlePlacesTypes = [];
            for (var i = 0; i < googlePlacesGroups.length; i++) {
                var typesGroup = Map.googlePlacesTypeGroups[googlePlacesGroups[i]];
                googlePlacesTypes = googlePlacesTypes.concat(typesGroup.placesTypes)
            }
            return googlePlacesTypes
        },
        getMarkerKey: function(id, category) {
            return "m" + id + "-" + category
        },
        isResultListItemExist: function(id) {
            return $('#map-data-screen .place[data-place-id="' + id + '"]:visible').length > 0
        },
        getGroupNames: function(pgCategory) {
            var googlePlacesGroups = Map.googleCategoriesMapping[pgCategory][Map.country];
            if (googlePlacesGroups == null || googlePlacesGroups.length == 0) {
                googlePlacesGroups = Map.googleCategoriesMapping[pgCategory].default
            }
            var groupNames = [];
            for (var i = 0; i < googlePlacesGroups.length; i++) {
                var typesGroup = Map.googlePlacesTypeGroups[googlePlacesGroups[i]];
                groupNames.push(typesGroup.name)
            }
            return groupNames
        },
        getCategoryForGroupName: function(groupName) {
            var groupNameCategoryMapping = {
                MRT: "COMMUTE",
                School: "FAMILY_LIVING",
                Supermarket: "FAMILY_LIVING",
                Malls: "LIFESTYLE"
            };
            return groupNameCategoryMapping[groupName]
        },
        getGroupAndPlaceTypeMapping: function() {
            if (Map.googlePlacesTypeGroups == null || Map.googlePlacesTypeGroups.length == 0) {
                Map.googlePlacesTypeGroups = Map.getGooglePlacesTypeGroups()
            }
            var groupPlaceMapping = {};
            $.each(Map.googlePlacesTypeGroups, function(key, group) {
                group.placesTypes.forEach(function(value, index) {
                    groupPlaceMapping[value] = group.name
                })
            });
            return groupPlaceMapping
        },
        getWalkRatioAndSpeedByCountry: function(country) {
            var walkRatioAndSpeed = {};
            switch (country) {
            case "sg":
                walkRatioAndSpeed.walkingRatio = 1.2;
                walkRatioAndSpeed.walkingSpeed = 4.5;
                break;
            default:
                walkRatioAndSpeed.walkingRatio = 1.2;
                walkRatioAndSpeed.walkingSpeed = 4.5
            }
            return walkRatioAndSpeed
        },
        getDistance: function(object1, object2) {
            var location1 = object1
              , location2 = object2;
            if ("geometry"in object1 && "location"in object1.geometry) {
                location1 = object1.geometry.location
            }
            if ("geometry"in object2 && "location"in object2.geometry) {
                location2 = object2.geometry.location
            }
            return $.guruMap().getDistanceFromLatLonInKm(location1.lat(), location1.lng(), location2.lat(), location2.lng())
        },
        getWalkingDistanceAndTime: function(googlePlace1, googlePlace2, country) {
            var arialDis = Map.getDistance(googlePlace1, googlePlace2);
            var walkRatioAndSpeed = Map.getWalkRatioAndSpeedByCountry(country);
            var walkingDistance = (arialDis * walkRatioAndSpeed.walkingRatio).toFixed(2);
            var walkingTime = Math.round(walkingDistance / walkRatioAndSpeed.walkingSpeed * 60);
            return {
                walkingDistance: walkingDistance,
                walkingTime: walkingTime
            }
        },
        getWalkingDistanceFromArial: function(distance) {
            var walkingRatio = Map.getWalkRatioAndSpeedByCountry(Map.country).walkingRatio;
            if (!walkingRatio) {
                walkingRatio = 1
            }
            return distance * walkingRatio
        },
        hideAllUserSearchedLocaitons: function() {
            Map.specificLocationMarkers.forEach(function(locationMarker, index) {
                locationMarker.marker.setVisible(false)
            });
            Map.specificLocaitonsDisplays.forEach(function(directionsDisplay, index) {
                directionsDisplay.display.setMap()
            })
        },
        showAllUserSearchedLocaitons: function() {
            Map.specificLocationMarkers.forEach(function(locationMarker, index) {
                locationMarker.marker.setVisible(true)
            });
            Map.specificLocaitonsDisplays.forEach(function(directionsDisplay, index) {
                directionsDisplay.display.setMap(Map.map)
            })
        },
        restrictMapViewForSingaporeOnly: function() {
            var southWest = new google.maps.LatLng(1.1357899099912945,103.54820249369368)
              , northEast = new google.maps.LatLng(1.5277578621791577,104.318618758698)
              , minZoomLevel = 12
              , maxZoomLevel = 17
              , singporeBounds = new google.maps.LatLngBounds(southWest,northEast);
            var lastValidCenter = Map.map.getCenter();
            google.maps.event.addListener(Map.map, "dragend", function() {
                if (singporeBounds.contains(Map.map.getBounds().getSouthWest()) && singporeBounds.contains(Map.map.getBounds().getNorthEast())) {
                    lastValidCenter = Map.map.getCenter();
                    return
                }
                Map.map.panTo(lastValidCenter)
            });
            google.maps.event.addListener(Map.map, "zoom_changed", function() {
                if (Map.map.getZoom() < minZoomLevel) {
                    Map.map.setZoom(minZoomLevel);
                    Map.map.panTo(Map.propertyPosition)
                }
                if (Map.map.getZoom() > maxZoomLevel) {
                    Map.map.setZoom(maxZoomLevel)
                }
            })
        },
        addMasterPlanLayer: function() {
            Map.masterPlan = true;
            var masterPlanMapType = new google.maps.ImageMapType({
                getTileUrl: function(coord, zoom) {
                    return "https://www.ura.gov.sg/ArcGis/rest/services/maps2/Updated_Gaz_MP14_Land_Use_Maps/MapServer/tile" + "/" + zoom + "/" + coord.y + "/" + coord.x
                },
                tileSize: new google.maps.Size(256,256)
            });
            var $legendBtn = $("#masterPlanLegendButton").removeClass("hide");
            if (!$legendBtn.data("initialized")) {
                $legendBtn.data("initialized", true);
                Map.map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push($legendBtn.get(0));
                var $legendModal = $($legendBtn.data("target"));
                $legendModal.on("shown.bs.modal", function() {
                    var $modalBody = $("#masterPlanLegend").find(".modal-body");
                    if ($modalBody) {
                        $modalBody.load($modalBody.data("legend"))
                    }
                    Map.releasePreventBackgrounScrollOnMobile()
                });
                $legendModal.on("hidden.bs.modal", function() {
                    Map.preventBackgrounScrollOnMobile()
                });
                $("body").append($legendModal)
            }
            Map.map.overlayMapTypes.setAt(1, masterPlanMapType);
            google.maps.event.trigger(Map.map, "resize")
        },
        removeMasterPlanLayer: function() {
            Map.masterPlan = false;
            Map.map.overlayMapTypes.setAt(1, null);
            $("#masterPlanLegendButton").addClass("hide")
        }
    };
    Map.init()
}
function setCookieV2(cname, cvalue, exdays) {
    var d = new Date;
    d.setTime(d.getTime() + exdays * 24 * 60 * 60 * 1e3);
    var expires = "expires=" + d.toUTCString();
    document.cookie = cname + "=" + JSON.stringify(cvalue) + "; " + expires
}
function getCookieV2(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(";");
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        if (c.indexOf(name) > -1) {
            var reqCookie = c.split("=");
            if (reqCookie != null && reqCookie.length > 1) {
                return $.parseJSON(reqCookie[1])
            }
        }
    }
    return ""
}
function forceLoadCallback() {
    "use strict";
    var $w = $(window);
    $w.trigger("googlemaps.loaded")
}
(function($) {
    $(document).ready(function() {
        var $map = $(".map-v2 > #map-canvas")
          , $body = $("body")
          , $window = $(window)
          , forceLoad = $("[data-force-load-gmaps]").length !== 0;
        if (forceLoad) {
            $.guruMap().injectGoogleMapsScript("forceLoadCallback")
        }
        if ($map.length) {
            var $wrapperInner = $("#wrapper-inner");
            var onScroll = null;
            var isMobile = guruApp.fn.getCurrentDevice() === "mobile";
            var isBTOEstate = $(".bto-estate").length > 0;
            var showMap = function() {
                if (!$.guruMap().googleMapsIsLoaded()) {
                    $.guruMap().injectGoogleMapsScript("widgetMapNearbyCallbackV2")
                } else {
                    widgetMapNearbyCallbackV2()
                }
                $body.trigger("ga.listing.widgetMapNearby.show");
                if (isMobile && !isBTOEstate) {
                    $wrapperInner.off("scroll.widgetMapNearby", onScroll)
                } else {
                    $window.off("scroll.widgetMapNearby", onScroll)
                }
            };
            $window.on("widgetMapNearby.show", showMap);
            if (isMobile && !isBTOEstate) {
                onScroll = function() {
                    var showTime = Math.round($map.offset().top) < $window.height();
                    if (showTime) {
                        $window.trigger("widgetMapNearby.show")
                    }
                }
                ;
                $wrapperInner.on("scroll.widgetMapNearby", onScroll);
                onScroll()
            } else {
                onScroll = function() {
                    var showTime = $window.scrollTop() > Math.round($map.offset().top) - $window.height();
                    if (showTime) {
                        $window.trigger("widgetMapNearby.show")
                    }
                }
                ;
                $window.on("scroll.widgetMapNearby", onScroll);
                onScroll()
            }
        }
    })
}
)(jQuery);
(function($) {
    "use strict";
    var SimilarListings = {
        cache: {},
        getCacheKey: function(s) {
            return s.replace(/[^a-zA-z0-9]/g, "")
        },
        getCache: function(url) {
            var cacheKey = SimilarListings.getCacheKey(url);
            if (typeof SimilarListings.cache[cacheKey] === "undefined" || !SimilarListings.cache[cacheKey]) {
                return false
            }
            return SimilarListings.cache[cacheKey]
        },
        setCache: function(url, data) {
            var cacheKey = SimilarListings.getCacheKey(url);
            SimilarListings.cache[cacheKey] = data
        },
        get: function(url, onSuccess, onFail, overrideDefaultOnFail) {
            var data = SimilarListings.getCache(url)
              , self = this;
            if (data) {
                SimilarListings.onSuccess.apply(self, [data]);
                onSuccess.apply(self)
            } else {
                $.get(url, function(data) {
                    SimilarListings.setCache(url, data);
                    SimilarListings.onSuccess.apply(self, [data]);
                    onSuccess.apply(self)
                }).fail(function() {
                    if (!overrideDefaultOnFail) {
                        SimilarListings.onFail.apply(self, arguments)
                    }
                    onFail.apply(self)
                })
            }
        },
        post: function(url, reqData, onSuccess, onFail, overrideDefaultOnFail) {
            var data = SimilarListings.getCache(url)
              , self = this;
            if (data) {
                SimilarListings.onSuccess.apply(self, [data]);
                onSuccess.apply(self)
            } else {
                $.ajax({
                    type: "POST",
                    url: url,
                    data: JSON.stringify(reqData),
                    success: function(data) {
                        SimilarListings.setCache(url, data);
                        SimilarListings.onSuccess.apply(self, [data]);
                        onSuccess.apply(self)
                    },
                    contentType: "application/json"
                }).fail(function() {
                    if (!overrideDefaultOnFail) {
                        SimilarListings.onFail.apply(self, arguments)
                    }
                    onFail.apply(self)
                })
            }
        },
        onSuccess: function(data, context) {
            var self = context || this
              , $self = $(self);
            if (!data) {
                $self.addClass("no-data");
                return
            }
            $self.removeClass("hide");
            $self.closest(".pg-gray-container").removeClass("hide");
            var widgetTitle = $self.data("widget-title");
            var gaTitle = $self.data("ga-title") || "";
            if (widgetTitle) {
                var data = $.parseHTML(data);
                $(data).find(".similar-listings-title .section-title").text(widgetTitle)
            }
            var $injected = $self.removeClass("loading").html(data)
              , $lazyImgs = $injected.find("img.lazy")
              , $w = $(window)
              , y = 0
              , f = function() {
                var showTime = $w.scrollTop() > y;
                if (showTime) {
                    $injected.trigger("ga.listing.widgetSimilarListings.viewed", $self);
                    $w.off("scroll.widgetSimilarListings" + gaTitle);
                    if (guruApp.listingDetail && guruApp.listingDetail.hlpaData && guruApp.country === "MY") {
                        if ($(".home-loan-widget").is(":visible")) {
                            $injected.trigger("ga.genericHlpaTracker", {
                                category: "HomeLoanPreApproval-Acquisition",
                                action: "View",
                                label: "location=Post-EnquiryThankYouModal",
                                payload: {
                                    content: "Home Loan Pre-Approval",
                                    type: "banner"
                                }
                            })
                        } else if (guruApp.listingDetail.hlpaData.hasUserDoneTheTool && guruApp.listingDetail.hlpaData.canSubmitBankLead && $("#bank-lead-form").is(":visible")) {
                            var selectedBanks = [];
                            $("#bank-lead-form input:checked").each(function() {
                                selectedBanks.push($(this).attr("name"))
                            });
                            $injected.trigger("ga.genericHlpaTracker", {
                                category: "HomeLoanPreApproval-Engagement",
                                action: "View",
                                label: "location=Post-EnquiryThankYouModal",
                                payload: {
                                    content: selectedBanks,
                                    type: "bank-options"
                                }
                            })
                        }
                    }
                }
            };
            var $similarListingCards = $injected.find(".carousel-listing-cards");
            $similarListingCards.on("slid.bs.carousel", function() {
                var $this = $(this)
                  , $currentSlide = $this.find(".item.active");
                if ($currentSlide.is(":first-child")) {
                    $this.find(".left").addClass("disabled")
                } else {
                    $this.find(".left").removeClass("disabled")
                }
                if ($currentSlide.is(":last-child")) {
                    $this.find(".right").addClass("disabled")
                } else {
                    $this.find(".right").removeClass("disabled")
                }
            });
            $lazyImgs.lazyload({
                effect: "fadeIn",
                failure_limit: $lazyImgs.length,
                skip_invisible: false,
                load: function() {
                    var $img = $(this);
                    if ($img.is(".lazy-bg")) {
                        $img.closest(".lazy-bg-parent").css({
                            backgroundImage: 'url("' + this.src + '")'
                        })
                    }
                    $img.removeClass("lazy")
                }
            });
            $lazyImgs.trigger("appear");
            var $body = $("body");
            var listingCards = $injected.find(".listing-card");
            listingCards.each(function(index) {
                var $listItem = $(this);
                var ecImpression = $listItem.data("ec-impression");
                if (ecImpression) {
                    var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
                    if (!ecImpression.productData.list) {
                        ecImpression.productData.list = listName
                    }
                    $listItem.on("click", function(e) {
                        var clickedElementType = e.target.nodeName;
                        if ("A" == clickedElementType || "IMG" == clickedElementType) {
                            $body.trigger("ga.ec.listing.click", [ecImpression.currency, ecImpression.productData])
                        }
                    });
                    var options = {
                        commit: false
                    };
                    if (index === listingCards.length - 1) {
                        options.commit = true
                    }
                    $body.trigger("ga.ec.listing.impression", [ecImpression.currency, ecImpression.productData, listName, options])
                }
            });
            $injected.find("a.listing-card-link").each(function(index) {
                $(this).on("click", function(e) {
                    var position = Math.floor(index / 2) + 1
                      , $widget = $(this).closest(".similar-listings-block")
                      , listingId = $(this).data("id");
                    $self.trigger("ga.listing.widgetSimilarListings.click", {
                        listingId: listingId,
                        position: position,
                        widget: $widget
                    })
                })
            });
            if ($body.is(".home") && $injected.is(".collections-frame")) {
                var getCategory = function() {
                    var hash = $(".searchbox-singleline .search-box-parameters .param-listing_type .dropdown-menu li.active a").attr("href");
                    var listingType = hash.replace(/^#/, "");
                    return listingType === "sale" ? "Sale-Core" : "Rent-Core"
                };
                var onClickCardLink = function(event) {
                    var category = getCategory();
                    var url = $(event.currentTarget).attr("href");
                    var label = $(event.currentTarget).closest(".new-project-featured-card").find(".card-title a").attr("title");
                    var listingNumText = $(event.currentTarget).parent().find(".card-text").text();
                    var listingNum = parseInt(listingNumText.replace(/,/g, ""), 10);
                    $body.trigger("ga.homepage.collection.click", [category, "ClickedCollections", label, url, listingNum])
                };
                $injected.off("click", "a");
                $injected.on("click", "a", onClickCardLink)
            }
            $injected.find(".carousel-sliced").carouselSliced();
            $injected.on("click", "input[type=checkbox]", SimilarListings.onChecked);
            $self.trigger("ga.listing.widgetSimilarListings.show", $injected);
            y = Math.round($injected.offset().top) - $w.height();
            EventDispatcher.addListener("height.changed", function() {
                y = Math.round($injected.offset().top) - $w.height()
            });
            $w.on("scroll.widgetSimilarListings" + gaTitle, f);
            f()
        },
        onFail: function() {
            $(this).siblings(".similar-listings-no-resuls").removeClass("hide");
            $(this).closest(".similar-listings-widget").addClass("hide");
            $(this).closest(".pg-gray-container").addClass("hide")
        },
        onChecked: function() {
            var $input = $(this)
              , $listingCard = $input.closest(".listing-card");
            $listingCard.toggleClass("selected", $input.is(":checked"))
        }
    };
    $.fn.similarListings = function(options) {
        var settings = {
            dataUrl: "url",
            waitForEvent: null,
            onEvent: function(e) {},
            onSuccess: function() {},
            onError: function() {},
            overrideDefaultOnError: false
        }
          , $body = $("body");
        $.extend(settings, options);
        this.each(function() {
            var self = this
              , $self = $(self)
              , waitForEvent = $self.data(settings.dataWaitForEvent)
              , url = settings.url || $self.data(settings.dataUrl);
            if (!settings.reqData && $(this).data("url-include-extra")) {
                var recentViews = window.localStorage ? JSON.parse(window.localStorage.getItem("viewedListings")) : null;
                url += "&recent_views=" + (Array.isArray(recentViews) ? recentViews.join(",") : "");
                url += "&fingerprint=" + localStorage.getItem("fingerprint");
                url += "&client_id=" + guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getClientId()
            }
            if (settings.waitForEvent === null) {
                if (settings.reqData) {
                    SimilarListings.post.apply(self, [url, settings.reqData, settings.onSuccess, settings.onError, settings.overrideDefaultOnError])
                } else {
                    SimilarListings.get.apply(self, [url, settings.onSuccess, settings.onError, settings.overrideDefaultOnError])
                }
            } else {
                var onEventCallback = function() {
                    if (arguments[1]instanceof jQuery && arguments[1].data("placement") !== "GalleryForm") {
                        settings.onEvent.apply(self, arguments);
                        if (settings.reqData) {
                            SimilarListings.post.apply(self, [url, settings.reqData, settings.onSuccess, settings.onError, settings.overrideDefaultOnError])
                        } else {
                            SimilarListings.get.apply(self, [url, settings.onSuccess, settings.onError, settings.overrideDefaultOnError])
                        }
                    }
                };
                $body.on(settings.waitForEvent, onEventCallback)
            }
        })
    }
    ;
    $.recommendedListings = function($variant, $limit, $title) {
        var $body = $("body");
        $variant = $variant ? $variant : "";
        $limit = $limit ? $limit : 4;
        $title = $title ? $title : "Handpicked For You";
        if ($body.is(".home") && !$body.is(".app-sg-cg")) {
            var $similarListingsFrame = $(".similar-listings-frame")
              , $collectionsFrame = $(".collections-frame");
            if ($similarListingsFrame.length) {
                if ($variant === "RAAS") {
                    var data = {
                        user_id: guruApp.pgutid,
                        session_events: JSON.parse(sessionStorage.getItem("sessionEvents")),
                        n_results: $limit,
                        title: $title,
                        extra_args: {
                            popular_listing_type: guruApp.listingType
                        }
                    };
                    $similarListingsFrame.similarListings({
                        url: "/sf2-search/ajax/listings/raas/exp_1",
                        reqData: data
                    })
                } else {
                    $similarListingsFrame.similarListings({
                        url: $similarListingsFrame.data("url-" + guruApp.listingType)
                    })
                }
            }
            if ($collectionsFrame.length) {
                $.ajax({
                    url: $collectionsFrame.data("url-" + guruApp.listingType),
                    success: function(data) {
                        var collectionsDom = $.parseHTML(data)
                          , $carouselInner = $(collectionsDom).find(".carousel-container > .carousel-inner")
                          , collectionNodeList = $carouselInner.find(".item > div")
                          , nodeItems = Array.prototype.slice.call(collectionNodeList)
                          , collectionItems = nodeItems.sort(function() {
                            return .5 - Math.random()
                        })
                          , itemActive = $('<div class="item active"></div>');
                        collectionItems = collectionItems.slice(0, $limit);
                        itemActive.append(collectionItems);
                        $carouselInner.empty().append(itemActive);
                        SimilarListings.onSuccess($(collectionsDom).prop("outerHTML"), $collectionsFrame);
                        $collectionsFrame.find(".carousel-indicators, .carousel-control").addClass("hide")
                    },
                    error: function() {
                        $collectionsFrame.addClass("hide")
                    }
                })
            }
        } else if ($body.is(".listing_detail") || $body.is(".listing-condo-price-insights")) {
            $limit = 8;
            $title = "Similar Listings";
            var $similarListingsFrame = $("#similar-listing-ldpv").length ? $("#similar-listing-ldpv") : $(".similar-listings-block");
            var listingId = guruApp && guruApp.listingDetail && guruApp.listingDetail.gaECData ? guruApp.listingDetail.gaECData.id : undefined;
            if ($similarListingsFrame.length) {
                if ($variant === "RAAS" && listingId) {
                    var data = {
                        session_events: [{
                            catalog_id: listingId,
                            timestamp: Math.round(Date.now() / 1e3),
                            event_type: "VIEW"
                        }],
                        n_results: $limit,
                        title: $title
                    };
                    $similarListingsFrame.similarListings({
                        url: "/sf2-search/ajax/listings/raas/exp_1",
                        reqData: data
                    });
                    $("#same-property-listings .not-active-similar-listings-widget").similarListings()
                } else {
                    $(".not-active-similar-listings-widget").similarListings()
                }
            }
        }
    }
    ;
    var showListingsBasedOnExperiment = function(experimentId) {
        setTimeout(function() {
            if (!guruApp.country || "SG" !== guruApp.country || !window.ga || !window.ga.loaded) {
                $.recommendedListings("")
            } else {
                $.getScript("https://www.google-analytics.com/cx/api.js?experiment=" + experimentId, function() {
                    if (cxApi && cxApi.chooseVariation() === 1) {
                        $.recommendedListings("RAAS")
                    } else {
                        $.recommendedListings("")
                    }
                })
            }
        }, 500)
    };
    $(document).ready(function() {
        var $body = $("body");
        if ($body.is(".home")) {
            $(".not-active-similar-listings-widget").similarListings();
            $body.on("widget_search_value_changed_listing_type", function(event, listingType) {
                guruApp.listingType = "rent" == listingType ? "rent" : "sale";
                $.recommendedListings("")
            })
        }
        if ($body.is(".listing_detail") || $body.is(".listing-condo-price-insights")) {
            var $availableUnitsFrame = $(".available-units-frame");
            var defaultListingType = $availableUnitsFrame.data("default-option");
            $availableUnitsFrame.similarListings({
                url: $availableUnitsFrame.data("url-" + defaultListingType)
            });
            $availableUnitsFrame.on("click", ".btn-group button", function() {
                var button = $(this);
                button.addClass("loading");
                $availableUnitsFrame.similarListings({
                    url: $availableUnitsFrame.data("url-" + $(this).data("listing-type")),
                    overrideDefaultOnError: true,
                    onError: function() {
                        button.removeClass("loading")
                    },
                    onSuccess: function() {
                        button.removeClass("loading")
                    }
                })
            });
            $.recommendedListings("")
        }
        var similarListings = {
            $agentEnquireForm: null,
            $body: null,
            enquireForm: {
                $elem: null,
                firstRun: true,
                successView: function() {
                    similarListings.enquireForm.toggleSuccessView(true)
                },
                resetView: function() {
                    if (similarListings.enquireForm.firstRun) {
                        return
                    }
                    similarListings.enquireForm.toggleSuccessView(false)
                },
                toggleSuccessView: function(toggleFlag) {
                    var $form = similarListings.enquireForm.$elem;
                    similarListings.enableForm($form);
                    $form.find("h4").toggleClass("hide", toggleFlag);
                    $form.find(".alert-success").toggleClass("hide", !toggleFlag).siblings(":not(.similar-listings-widget-sponsor)").toggleClass("hide", toggleFlag);
                    if ($form.is(".modal-body form")) {
                        var $modal = $form.closest(".modal-content");
                        $modal.children(".modal-header").children(".alert").toggleClass("hide", toggleFlag)
                    }
                },
                onSubmit: function(e) {
                    e.preventDefault();
                    var $form = $(this)
                      , contactAgentData = similarListings.$agentEnquireForm.serializeArray()
                      , similarListingsData = $form.serializeArray();
                    similarListings.enquireForm.firstRun = false;
                    if ($form.is(".processing")) {
                        return false
                    }
                    contactAgentData = $.map(contactAgentData, function(param) {
                        if (param.name && param.name === "listingId") {
                            param.name = "originalListingId"
                        }
                        if (param.name && param.name === "message") {
                            param.name = "originalMessage"
                        }
                        return param
                    });
                    var listingsCount = 0;
                    similarListingsData = $.map(similarListingsData, function(param) {
                        if (param.name && param.name === "id[]") {
                            param.name = "listingId[]";
                            listingsCount++
                        }
                        return param
                    });
                    if (listingsCount === 0) {
                        alert($form.data("please-select"));
                        return false
                    }
                    $.merge(similarListingsData, contactAgentData);
                    similarListings.disableForm($form);
                    $.post($form.data("action"), $.param(similarListingsData), similarListings.enquireForm.onSuccess, "json").fail(similarListings.enquireForm.onFail);
                    return false
                },
                onSuccess: function(R) {
                    var $form = similarListings.enquireForm.$elem
                      , $checkboxes = $form.find('.listing-card input[name="id[]"]:checkbox:visible')
                      , checkedListingIds = []
                      , allListingIds = [];
                    var totalLength = $checkboxes.length;
                    $checkboxes.each(function() {
                        var val = $(this).val();
                        if (val) {
                            allListingIds.push(val);
                            if ($(this).prop("checked")) {
                                checkedListingIds.push(val);
                                $(this).closest("label").addClass("hide").closest(".listing-card").parent().addClass("hide")
                            }
                        }
                    });
                    if (checkedListingIds.length === totalLength) {
                        $("form.similar-listings-enquire fieldset").addClass("hide")
                    }
                    similarListings.enquireForm.successView();
                    $form.trigger("ga.listing.enquiresimilar.success", {
                        allListingIds: allListingIds,
                        checkedListingIds: checkedListingIds
                    })
                },
                onFail: function(R) {
                    if (R.responseJSON) {
                        alert(R.responseJSON.message)
                    } else if (R.responseText) {
                        alert(R.responseText)
                    } else {
                        alert("Unknown error!")
                    }
                    similarListings.disableForm(similarListings.enquireForm.$elem)
                }
            },
            listings: {
                $elem: null,
                url: null,
                listingsHtml: null,
                onSuccess: function() {
                    var $self = $(this);
                    if ($self.is(".no-data")) {
                        similarListings.removeSimilarListingsForm();
                        return
                    }
                    $self.trigger("ga.listing.widgetSimilarListings.showPostEnquire");
                    var $form = similarListings.enquireForm.$elem;
                    similarListings.enableForm($form);
                    $form.find(".hide").not(".alert").removeClass("hide")
                },
                onFail: function() {
                    similarListings.removeSimilarListingsForm()
                }
            },
            onAgentListingEnquireSuccess: function(e, $agentEnquireForm) {
                similarListings.$agentEnquireForm = $agentEnquireForm;
                similarListings.enquireForm.resetView()
            },
            init: function(id) {
                this.listings.$elem = $(id);
                this.listings.url = this.listings.$elem.data("url");
                this.enquireForm.$elem = this.listings.$elem.closest("form");
                this.$body = $("body");
                this.enquireForm.$elem.siblings().find(".similar-listings-widget-sponsor-no-result").replaceWith($(".similar-listings-widget-sponsor").clone());
                $(document).on("click.similar-listings-sponsor", ".similar-listings-widget-sponsor", function() {
                    $("body").trigger("ga.listing.widgetSimilarListings.sponsorClick")
                })
            },
            onEvent: function(e, $agentEnquireForm) {
                if (typeof similarListings.listings.url !== "undefined" && similarListings.listings.url !== "") {
                    if (similarListings.enquireForm.$elem.length === 1) {
                        similarListings.enquireForm.$elem.on("submit", similarListings.enquireForm.onSubmit)
                    }
                    similarListings.onAgentListingEnquireSuccess(e, $agentEnquireForm)
                }
            },
            removeSimilarListingsForm: function() {
                similarListings.enquireForm.$elem.remove()
            },
            disableForm: function($form) {
                similarListings.toggleForm($form, false)
            },
            enableForm: function($form) {
                similarListings.toggleForm($form, true)
            },
            toggleForm: function($form, enabled) {
                $form.toggleClass("processing", !enabled).find("input[type=submit]").prop("disabled", !enabled)
            }
        };
        similarListings.init("#similar-listings-widget");
        $("#similar-listings-widget").similarListings({
            waitForEvent: "ga.listing.enquire.success.similarListings",
            onEvent: similarListings.onEvent,
            onSuccess: similarListings.listings.onSuccess,
            onFail: similarListings.listings.onFail
        })
    })
}
)(jQuery);
(function($, guruApp) {
    $(document).ready(function() {
        "use strict";
        var $btnContacts = $(".featured-agents-horizontal .btn-contact, .agent-specialists .btn-contact");
        var $agentForm = $("form.js-contact-form");
        var $body = $("body");
        $btnContacts.on("click", function(e) {
            e.preventDefault();
            var $agentPhoto = $agentForm.find(".agent-photo");
            var $agentInfo = $agentForm.find(".agent-info");
            var $messageToAgent = $("#textareaMessage");
            var $fullName = $(this).data("fullname");
            var $modalHeader = $(".modal-header", "#contactAgentModal");
            var $alertSuccess = $modalHeader.find(".alert-success");
            $modalHeader.find("#contact-form-modal").removeClass("hidden");
            if (!$alertSuccess.hasClass("hide")) {
                $alertSuccess.addClass("hidden")
            }
            $agentForm.find("input[name=agentId]").val($(this).data("agentid"));
            $agentForm.find("input[name=agentUserId]").val($(this).data("agentuserid"));
            $agentPhoto.find(".img-circle").css("background-image", "url(" + $(this).data("photo") + ")");
            $agentPhoto.removeClass("hidden");
            $agentInfo.find(".agent-name").text($fullName);
            $agentInfo.find(".agent-job-title").text($(this).data("jobtitle"));
            $agentInfo.find(".agent-agency").text($(this).data("companyname"));
            $messageToAgent.val($messageToAgent.val().replace("Hi ", "Hi " + $fullName));
            $messageToAgent.val($messageToAgent.val().replace("Halo ", "Halo " + $fullName))
        });
        $agentForm.find("select[data-value]").each(function(index) {
            $(this).find("option[value='" + $(this).attr("data-value") + "']").attr("selected", "selected")
        });
        $agentForm.on("submit.contactAgentForm", function(e) {
            e.preventDefault();
            if ($body.is(".agent-home") || $body.is(".agent-search")) {
                var dimensions = []
                  , label = null;
                var $listingId = $("input[name=listingId]")
                  , listingId = 0;
                if ($listingId.length) {
                    listingId = $listingId.val()
                }
                var $agentId = $("input[name=agentId]")
                  , agentId = 0;
                if ($agentId.length) {
                    agentId = $agentId.val()
                }
                var refClickedForm = $("#ref-clicked-from").length ? $("#ref-clicked-from").val() : "";
                if ($body.is(".agent-home")) {
                    label = "Monthly featured agents (Home)";
                    if (refClickedForm == "link-agent-specialist") {
                        label = "Specialist featured agents (Home)"
                    }
                    $body.trigger("ga.agent.directory.enquire.intent", [listingId, agentId, null, null, label, dimensions])
                } else if ($body.is(".agent-search")) {
                    label = "Monthly featured agents (Search)";
                    if (refClickedForm == "link-agent-specialist") {
                        label = "Specialist featured agents (Search)"
                    }
                    $body.trigger("ga.agent.directory.enquire.intent", [listingId, agentId, null, null, label, dimensions])
                }
            }
            var $form = $(this)
              , action = $form.data("action")
              , valid = true
              , callbacks = {
                done: function(R) {
                    if ($body.is(".agent-home") || $body.is(".agent-search")) {
                        $body.trigger("ga.agent.directory.enquire.success", [listingId, agentId, null, null, label, dimensions])
                    }
                    $agentForm.trigger("submitDone");
                    $body.trigger("contact_agent_success", [$form]);
                    guruApp.fn.purchaseListingDetail("Message Agent (Property Detail)");
                    var $modalResponse = $("#contactAgentModal")
                      , $modalTitle = $modalResponse.find(".modal-title")
                      , $modalSubtitle = $modalResponse.find(".modal-sub-title");
                    $form.removeClass("processing").find("input[type=submit], button[type=submit]").prop("disabled", false);
                    if (R.errors !== undefined) {
                        modalError();
                        groupError($form, R.errors)
                    } else {
                        var listingId = $("input[name=listingId]").val();
                        modalSuccess();
                        $form.addClass("enquiry-submitted");
                        if (listingId && typeof listingId !== "undefined") {
                            trackingEvent($form, listingId)
                        } else if ($modalResponse.find(".contact-specialist").length > 0) {
                            $modalTitle.parent().removeClass("hidden");
                            $modalResponse.find(".modal-body").addClass("hidden");
                            $body.trigger("ga.new-condo.condo-details.condo-specialists-success", [R.sentCount])
                        }
                    }
                    $("#facebook-error").hide();
                    $("#inputMobile").closest('div[class^="form-group"]').removeClass("has-error");
                    if ($form.data("placement") !== "GalleryForm") {
                        $modalTitle.html(R.message);
                        $modalSubtitle.html(R.submessage);
                        $modalResponse.modal()
                    } else {
                        $(".gallery-form-inner").hide();
                        $(".gallery-form-inner--thankyou").show()
                    }
                },
                fail: function(R) {
                    $agentForm.trigger("submitFail");
                    if (R.responseJSON) {
                        alert(R.responseJSON.message)
                    } else if (R.responseText) {
                        alert(R.responseText)
                    } else {
                        alert("Unknown error!")
                    }
                    $form.removeClass("processing").find("input[type=submit], button[type=submit]").prop("disabled", false)
                }
            };
            if ($form.is(".processing")) {
                return false
            }
            valid = validateInput($form, valid);
            if (valid) {
                $form.addClass("processing").find("input[type=submit], button[type=submit]").prop("disabled", true);
                $.post(action, $form.serialize(), callbacks.done, "json").fail(callbacks.fail)
            }
            return false
        });
        var modalError = function() {
            $(".modal-header", "#contactAgentModal").find(".alert-success").removeClass("alert-success").addClass("alert-danger").end().find("p.modal-sub-title").addClass("hidden").end().siblings().addClass("hidden")
        };
        var modalSuccess = function() {
            var $modalHeader = $(".modal-header", "#contactAgentModal");
            $modalHeader.find(".alert-danger").removeClass("alert-danger").addClass("alert-success");
            $("#contactAgentModal").find(".hidden").removeClass("hidden");
            $modalHeader.find("#contact-form-modal").addClass("hidden")
        };
        var groupError = function(target, errors) {
            $.each(errors, function(index, value) {
                var error = value.error;
                var element = $(target).find(".form-control[name='" + error.field + "']");
                $(element).closest(".form-group").addClass("has-error");
                $(element).closest(".form-group").on("change", function() {
                    $(this).removeClass("has-error")
                })
            })
        };
        var trackingEvent = function(form, listingId) {
            if ($(form).hasClass("appointment-form")) {
                form.trigger("ga.dev-listing.appointment.success", [form, listingId])
            } else {
                var $section = $("section div");
                if ($section.hasClass("newprojects-page") || $section.hasClass("overseas-page")) {
                    form.trigger("ga.dev-listing.enquire.success", [form, listingId])
                } else {
                    form.trigger("ga.listing.enquire.success", [form, listingId])
                }
                form.trigger("fbPixel.listing_detail.enquire.success")
            }
        };
        var validateInput = function(form, valid) {
            var fields = $(".form-group input, select, textarea", form)
              , errors = [];
            $.each(fields, function(index, value) {
                if (value.required === true && value.value == "") {
                    errors.push({
                        error: {
                            field: value.name,
                            message: "Please enter your" + value.name
                        }
                    })
                }
            });
            if (errors.length > 0) {
                valid = false;
                groupError(form, errors)
            }
            return valid
        };
        $agentForm.find("#appointDateDropdown").each(function(index) {
            $(this).datepicker().on("changeDate", function(ev) {
                $("#appointDate").val(moment(ev.date).format("YYYY-MM-DD"));
                $("#appointDateDropdown").text(moment(ev.date).format("DD MMMM YYYY"))
            })
        });
        $agentForm.find(".appointTimeOption").each(function(index) {
            $(this).click(function() {
                $("#appointTime").val($(this).text());
                $("#appointTimeDropdown").text($(this).text())
            })
        });
        var modifyContactForm = function() {
            $agentForm = $agentForm || $("form.js-contact-form");
            $("#quick-contact-form-side").removeClass("hide");
            $("#contact-form-side").remove();
            var $contactFormSide = $("#quick-contact-form-side")
              , $bubbles = $contactFormSide.find(".quick-message-bubbles")
              , $userDetailForm = $contactFormSide.find(".user-detail-form")
              , $writeMessage = $contactFormSide.find(".write-message")
              , $quickUserInfo = $contactFormSide.find(".quick-user-info")
              , $closeView = $contactFormSide.find(".close-view")
              , $formSubmit = $contactFormSide.find(".submit-digest-group")
              , $buttonSubmit = $contactFormSide.find("button.submit")
              , $messageSent = $contactFormSide.find(".message-sent")
              , $saveUserInfo = $contactFormSide.find(".save-user-info");
            var userExists = userDetailsExists();
            var state = userExists ? 1 : 0;
            toggleStates(state);
            $contactFormSide.find(".agent-photo img").lazyload();
            var messages = guruApp.ContactWidgetData.messages;
            for (var message in messages) {
                var messageElement = '<a class="btn btn-main-inverted quick-message" title="' + messages[message] + '">' + message + "</a>";
                $bubbles.append(messageElement)
            }
            var userCustomMessage = localStorage.getItem("customMessage");
            if (userCustomMessage !== null) {
                $writeMessage.val(userCustomMessage);
                $bubbles.append('<a class="btn btn-main-inverted quick-message" title="' + userCustomMessage + '">' + ellipseMiddle(userCustomMessage, 20) + "</a>")
            }
            $bubbles.children().first().addClass("active");
            $messageSent.find(".agent-name").text(guruApp.ContactWidgetData.agentName);
            $bubbles.on("click", ".btn-main-inverted", function() {
                var $thisButton = $(this);
                if ($thisButton.hasClass("quick-message")) {
                    if (userExists) {
                        $agentForm.find('input[name="message"]').val(prepareUserMessage($thisButton.attr("title")));
                        $buttonSubmit.click();
                        $bubbles.find("a").addClass("disabled")
                    } else {
                        $buttonSubmit.text($thisButton.text());
                        $buttonSubmit.attr("title", $thisButton.attr("title"));
                        state = 2;
                        toggleStates(state)
                    }
                } else {
                    $buttonSubmit.text("Send Message");
                    if (userExists) {
                        state = 3;
                        toggleStates(state);
                        if (userCustomMessage) {
                            $writeMessage.find("#quickInputCustomMessage").val(userCustomMessage).focus().select()
                        }
                    } else {
                        state = 5;
                        toggleStates(state)
                    }
                }
            });
            $(".edit-user-info").on("click", function() {
                state = 2;
                toggleStates(state);
                if (userExists) {
                    $saveUserInfo.removeClass("hide");
                    $formSubmit.addClass("hide");
                    $agentForm.find("#quickInputName").focus().select()
                } else {
                    $saveUserInfo.addClass("hide");
                    $formSubmit.removeClass("hide")
                }
            });
            $saveUserInfo.on("click", function() {
                var $parent = $(this).parent()
                  , name = $parent.find("#quickInputName").val()
                  , phone = $parent.find("#quickInputMobile").val()
                  , email = $parent.find("#quickInputEmail").val();
                if (name !== "" && email !== "" && phone !== "") {
                    state = 1;
                    toggleStates(state);
                    $(this).addClass("hide");
                    $quickUserInfo.find("span").text(name + " / " + phone + " / " + email)
                }
            });
            $(".close-view a").on("click", function() {
                if (userExists) {
                    state = 1;
                    toggleStates(state)
                } else {
                    state = 0;
                    toggleStates(state)
                }
                $buttonSubmit.attr("title", "")
            });
            $buttonSubmit.on("click", function() {
                var customMessage = $agentForm.find("#quickInputCustomMessage").val();
                if (customMessage) {
                    localStorage.setItem("customMessage", customMessage);
                    $agentForm.find('input[name="message"]').val(prepareUserMessage(customMessage))
                } else {
                    $agentForm.find("#quickInputCustomMessage").val("N/A");
                    var messageToSend = $buttonSubmit.attr("title");
                    if (messageToSend) {
                        $agentForm.find('input[name="message"]').val(prepareUserMessage(messageToSend))
                    }
                }
                $(this).addClass("disabled")
            });
            $body.on("contact_agent_success", function(e) {
                state = 4;
                toggleStates(state)
            });
            function prepareUserMessage(message) {
                return message + " " + window.location.href.split("?")[0]
            }
            function userDetailsExists() {
                var name = $contactFormSide.find("#quickInputName").val()
                  , email = $contactFormSide.find("#quickInputEmail").val()
                  , phone = $contactFormSide.find("#quickInputPhone").val();
                return name !== "" && email !== "" && phone !== ""
            }
            function toggleStates(state) {
                $contactFormSide.find("form:first *:input[type!=hidden]:first").focus();
                switch (state) {
                case 1:
                    toggle([$bubbles, $quickUserInfo], [$userDetailForm, $writeMessage, $closeView, $formSubmit, $messageSent, $saveUserInfo]);
                    break;
                case 2:
                    toggle([$userDetailForm, $closeView, $formSubmit], [$bubbles, $writeMessage, $quickUserInfo, $messageSent, $saveUserInfo]);
                    break;
                case 3:
                    toggle([$writeMessage, $quickUserInfo, $closeView, $formSubmit], [$bubbles, $userDetailForm, $messageSent, $saveUserInfo]);
                    break;
                case 4:
                    toggle([$messageSent], [$writeMessage, $quickUserInfo, $closeView, $formSubmit, $bubbles, $userDetailForm, $saveUserInfo]);
                    break;
                case 5:
                    toggle([$userDetailForm, $writeMessage, $formSubmit, $closeView], [$quickUserInfo, $bubbles, $messageSent, $saveUserInfo]);
                    break;
                default:
                    toggle([$bubbles], [$userDetailForm, $writeMessage, $closeView, $formSubmit, $quickUserInfo, $messageSent]);
                    break
                }
                function toggle(show, hide) {
                    $.each(show, function(key, value) {
                        value.removeClass("hide")
                    });
                    $.each(hide, function(key, value) {
                        value.addClass("hide")
                    })
                }
            }
            function ellipseMiddle(str, length) {
                if (str.length > length) {
                    var toCut = str.length - length
                      , dotCharSize = 3
                      , mid = Math.floor(length / 2);
                    return str.substr(0, mid) + "..." + str.substr(mid + toCut + dotCharSize, str.length)
                }
                return str
            }
        };
        guruApp.modifyContactForm = modifyContactForm
    })
}
)(jQuery, guruApp);
(function($) {
    $(document).ready(function() {
        "use strict";
        function capitalizeFirstLetter(word) {
            return word.charAt(0).toUpperCase() + word.slice(1)
        }
        var $body = $("body");
        function modifyShareSMSWidget(id) {
            if (!id) {
                return
            }
            var $shareListingSMS = $("#shareListingSMS");
            if (!$shareListingSMS.data("original-url")) {
                $shareListingSMS.data("original-url", $shareListingSMS.find('input[name="url"]').val())
            }
            var url = $shareListingSMS.data("original-url");
            var newUrl = url + "#" + id;
            $shareListingSMS.find('input[name="url"]').val(newUrl);
            if (!$shareListingSMS.data("original-url")) {
                $shareListingSMS.data("original-url", $shareListingSMS.find('input[name="url"]').val())
            }
            var $message = $shareListingSMS.find(".break-word");
            if (!$message.data("original-message")) {
                $message.data("original-message", $message.text())
            }
            var message = $message.data("original-message");
            if (message) {
                $shareListingSMS.find(".break-word").text(message.replace(url, newUrl))
            }
        }
        $(window).on("modifyShareSMSWidget", function(event, id) {
            modifyShareSMSWidget(id)
        });
        $(".sharing-widget a, .listing-detail-header-bar .btns > .btn-facebook-share, .listing-detail-header-bar .btns > .btn-whatsapp").on("click", function() {
            var $a = $(this)
              , location = "SideBar"
              , shareThrough = ""
              , className = $a.attr("class");
            if ($a.is("#navbar-main a")) {
                location = "Sticky"
            } else if ($a.is(".listing-detail-header-bar a")) {
                location = "TitleHeader"
            } else if ($a.is("#sticky-right-col a")) {
                location = "SideBar"
            }
            if (className) {
                className = className.match(/pgicon-([^\s"]+)/);
                if (className == null) {
                    var $icon = $a.children(".pg-icon,.pgicon");
                    if ($icon.length) {
                        className = ($icon.attr("class") || "").match(/pgicon-([^\s"]+)/)
                    }
                }
                if (className && className.length == 2) {
                    className = className[1]
                } else {
                    className = "Unknown"
                }
            } else {
                className = "Unknown"
            }
            switch (className) {
            case "whatsapp":
            case "facebook":
            case "twitter":
                shareThrough = capitalizeFirstLetter(className);
                break;
            case "mail-alt":
                shareThrough = "Email";
                break;
            case "comment":
                shareThrough = "SMS";
                break;
            case "comment-o":
                shareThrough = "Messenger";
                break;
            case "link":
                shareThrough = "Copy";
                break;
            default:
                shareThrough = className;
                break
            }
            $body.trigger("ga.listing.share.intent", [location, shareThrough]);
            guruApp.fn.addListingDetailToCart("Share")
        });
        $("#shareListingEmail, #shareListingSMS, #shareArticleEmail").on("show.bs.modal", function(e) {
            var $form = $(this).find("form");
            $form.find(".modal-body.success").addClass("hidden").siblings(".modal-body").show().end().siblings(".modal-header").show()
        });
        $("#shareListingEmail, #shareListingSMS, #shareArticleEmail").on("submit.shareListing", "form", function(e) {
            e.preventDefault();
            var $form = $(this)
              , action = $form.attr("action")
              , callbacks = {
                done: function(data) {
                    $form.removeClass("processing").find("input[type=submit]").prop("disabled", false);
                    if (data.errors !== undefined) {
                        highlightFormGroupError($form, data.errors)
                    } else {
                        $form.find(".modal-body.success").removeClass("hidden").siblings(".modal-body").hide().end().siblings(".modal-header").hide()
                    }
                },
                fail: function(event) {
                    $form.removeClass("processing").find("input[type=submit]").prop("disabled", false);
                    if (event.responseJSON.errors !== undefined) {
                        highlightFormGroupError($form, event.responseJSON.errors)
                    }
                },
                always: function(event) {
                    if (event.responseJSON !== undefined && event.responseJSON.newCaptcha !== undefined) {
                        $("img#captcha").attr("src", event.responseJSON.newCaptcha)
                    }
                }
            };
            if ($form.is(".processing")) {
                return false
            }
            $form.addClass("processing").find("input[type=submit]").prop("disabled", true);
            $.post(action, $form.serialize(), callbacks.done, "json").fail(callbacks.fail).always(callbacks.always);
            return false
        });
        var highlightFormGroupError = function(target, errors) {
            $.each(errors, function(index, value) {
                var error = value.error
                  , element = $(target).find(".form-control[name='" + error.field + "']");
                $(element).closest(".form-group").addClass("has-error").on("change", function() {
                    $(this).removeClass("has-error")
                })
            })
        }
    })
}
)(jQuery);
function toggleOnScroll(className, $element, getHeight) {
    var $w = $(window)
      , dotClassname = "." + className
      , f = function() {
        var isSticked = $element.is(dotClassname)
          , stickyTime = $w.scrollTop() > getHeight();
        if (stickyTime && !isSticked) {
            $element.addClass(className)
        } else if (!stickyTime && isSticked) {
            $element.removeClass(className)
        }
    };
    f();
    $w.on("scroll.toggleOnScroll", f)
}
(function($, guruApp) {
    "use strict";
    if (!guruApp.fn) {
        guruApp.fn = {}
    }
    if (guruApp.fn.widgetMainNav) {
        throw "guruApp.fn.widgetMainNav already defined!"
    }
    guruApp.fn.widgetMainNav = function($navBarMain) {
        var $body = $("body")
          , $dropdowns = $navBarMain.find(".dropdown")
          , $topRow = $navBarMain.find("nav.header-nav")
          , $billboardBanner = $navBarMain.siblings(".container-dfp-billboard")
          , navBarMainHeight = $navBarMain.height();
        if ($("html").is(".touch")) {
            $body.on("touchstart", jQuery.noop)
        }
        var getScrollPastPosition = function() {
            return navBarMainHeight
        };
        if (($body.hasClass("news_landing_v2") || $body.hasClass("newsdetail-v2")) && $billboardBanner.length) {
            getScrollPastPosition = function() {
                return navBarMainHeight + $billboardBanner.height()
            }
        }
        toggleOnScroll("scroll-past-header", $body, getScrollPastPosition);
        $navBarMain.on("click", ".dropdown .accordion > a", function(e) {
            e.preventDefault()
        });
        $navBarMain.on("show.bs.collapse hide.bs.collapse", ".dropdown .accordion-menu", function() {
            $(this).closest(".dropdown").one("hidden.bs.dropdown", function() {
                $(this).addClass("open")
            })
        });
        $navBarMain.find("button.navbar-toggle").click(function(e) {
            e.preventDefault();
            $(this).blur();
            $body.add("html").toggleClass("nav-open")
        });
        $(window).on("scroll.widgetMainNav", function(e) {
            $dropdowns.each(function() {
                if ($(this).hasClass("open") && !$body.is(".nav-open")) {
                    $(this).click()
                }
            })
        })
    }
}
)(jQuery, guruApp);
(function($, guruApp) {
    "use strict";
    if (!guruApp.fn) {
        guruApp.fn = {}
    }
    if (guruApp.fn.userSessionInjector) {
        throw "guruApp.fn.userSessionInjector already defined!"
    }
    guruApp.fn.userSessionInjector = function($elm, userData) {
        if (userData.id) {
            $elm.addClass("is-authenticated");
            $(".showWhenAuthenticated").removeClass("hide");
            $.each(userData.roles, function(i, role) {
                role = role.toLowerCase();
                $(".show-when-" + role).removeClass("hide");
                $elm.addClass("is-" + role)
            })
        } else {
            $elm.addClass("not-authenticated");
            $(".showWhenNotAuthenticated").removeClass("hide")
        }
        var shortlistCount = 0;
        if (userData.shortlist) {
            shortlistCount = parseInt(userData.shortlist, 10)
        }
        if (shortlistCount > 0) {
            $(".js-session-saved-properties").addClass("hasCount").text(shortlistCount);
            $(".js-session-saved-properties").siblings('[href="/shortlist"] i').removeClass("pgicon-heart-o").addClass("pgicon-heart")
        }
    }
}
)(jQuery, guruApp);
(function(guruApp) {
    guruApp.shortlistItemStorage = {
        name: "shortlistItems",
        set: function(listingId) {
            this.setItem(this.get().concat(listingId))
        },
        remove: function() {
            window.localStorage.removeItem(this.name)
        },
        removeItem: function(listingId) {
            var shortlistedItem = this.get()
              , index = shortlistedItem.indexOf(listingId);
            if (index !== -1) {
                shortlistedItem.splice(index, 1);
                this.setItem(shortlistedItem)
            }
        },
        setItem: function(shortlistedItem) {
            window.localStorage.setItem(this.name, JSON.stringify(this.getUniqueArray(shortlistedItem)))
        },
        get: function() {
            return JSON.parse(this.keyExists()) || []
        },
        keyExists: function() {
            return window.localStorage.getItem(this.name)
        },
        getUniqueArray: function(arr) {
            return arr.filter(function(value, index, self) {
                return self.indexOf(value) === index
            })
        }
    }
}
)(guruApp);
(function($, guruApp, EventDispatcher) {
    "use strict";
    if (!guruApp.fn) {
        guruApp.fn = {}
    }
    if (guruApp.fn.shortlist) {
        throw "guruApp.fn.shortlist already defined!"
    }
    var $body = $("body");
    var AjaxQueue = {
        isQueueBeingProcessed: false,
        requestsQueue: [],
        queue: function(type, url, onSuccess) {
            this.requestsQueue.push({
                type: type,
                url: url,
                onSuccess: onSuccess
            });
            this.process()
        },
        process: function() {
            if (this.isQueueBeingProcessed) {
                return
            }
            this.isQueueBeingProcessed = true;
            this.next()
        },
        next: function() {
            var next = this.requestsQueue.shift();
            if (next !== undefined) {
                this.invoke(next)
            } else {
                this.isQueueBeingProcessed = false
            }
        },
        invoke: function(request) {
            var fn = request.type == "post" ? $.post : $.get;
            fn(request.url, function(R, status, jqXHR) {
                request.onSuccess(R, status, jqXHR);
                AjaxQueue.next()
            })
        }
    };
    function updateShortlistedItems(updateStorage) {
        if (updateStorage) {
            try {
                guruApp.shortlistItemStorage.remove();
                guruApp.shortlistItemStorage.set(guruApp.userSession.user.shortlistIds)
            } catch (e) {
                console.error(e)
            }
        }
        var items = guruApp.shortlistItemStorage.get();
        $(".btn-shortlist").each(function() {
            var listingId = $(this).data("listing-id");
            var index = items.indexOf(listingId);
            if (index === -1) {
                $(this).removeClass("shortlisted")
            } else {
                $(this).addClass("shortlisted")
            }
        });
        $(".js-session-saved-properties").text(items.length)
    }
    $(document).ready(function() {
        if (!guruApp.shortlistItemStorage.keyExists()) {
            var listingIds = [];
            $(".btn-shortlist.shortlisted").each(function() {
                listingIds.push($(this).data("listing-id"))
            });
            guruApp.shortlistItemStorage.set(listingIds)
        }
        window.onfocus = function() {
            updateShortlistedItems()
        }
        ;
        var isBackwardNavigation = window.performance && window.performance.getEntriesByType && window.performance.getEntriesByType("navigation") && window.performance.getEntriesByType("navigation").length && window.performance.getEntriesByType("navigation")[0].type === "back_forward";
        updateShortlistedItems(!isBackwardNavigation)
    });
    guruApp.fn.shortlist = {
        shortlistBadges: [],
        init: function() {
            this.shortlistBadges = $(".js-session-saved-properties");
            this.shortlistBadges.each(function() {
                var $badge = $(this);
                if (parseInt($badge.text(), 10)) {
                    $badge.siblings('[href="#shortlist"] i').removeClass("pgicon-heart-o").addClass("pgicon-heart")
                } else {
                    $badge.siblings('[href="#shortlist"] i').removeClass("pgicon-heart").addClass("pgicon-heart-o")
                }
            });
            this.attachShortlistBtnBehavior();
            var $shortlistButtons = $(".nav-tools .btn-shortlist, .listing-detail-tools .btn-shortlist, .listing-detail-header-bar .btn-shortlist, .gallery-form__thankyou__btn-shortlist, .media-gallery-widget .btn-shortlist, .contents-listing-detail .btn-shortlist");
            EventDispatcher.addListener("shortlisted.add", function($originalBtn) {
                $originalBtn.add($shortlistButtons).prop("disabled", false).addClass("shortlisted").removeClass("disabled");
                guruApp.fn.shortlist.update(1);
                var listingId = $originalBtn.data("listing-id");
                guruApp.shortlistItemStorage.set(listingId);
                if ($body.is(".listing_detail")) {
                    guruApp.fn.addListingDetailToCart("Listing Detail Shortlist")
                } else if ($body.is(".listing")) {
                    guruApp.fn.addListingItemToCart(listingId, "Listing Shortlist")
                }
            });
            EventDispatcher.addListener("shortlisted.del", function($originalBtn) {
                var listingId = $originalBtn.data("listing-id");
                guruApp.shortlistItemStorage.removeItem(listingId);
                var $relevantBtns = $shortlistButtons.filter(function(index, btn) {
                    return $(btn).data("listing-id") == listingId
                });
                $originalBtn.add($relevantBtns).prop("disabled", false).removeClass("shortlisted disabled");
                guruApp.fn.shortlist.update(-1)
            });
            EventDispatcher.addListener("shortlisted.requested", function($originalBtn) {
                $originalBtn.add($shortlistButtons).prop("disabled", true).addClass("disabled")
            })
        },
        attachShortlistBtnBehavior: function() {
            var $btnShortlist = $(".btn-shortlist");
            $btnShortlist.on("click", function(e) {
                e.preventDefault();
                var $btn = $(this)
                  , url = "";
                if ($btn.is(".shortlisted")) {
                    url = $btn.data("action-del")
                } else {
                    url = $btn.data("action-add")
                }
                if (!$btn.is(".disabled") && !$btn.prop("disabled") && url !== "") {
                    EventDispatcher.dispatch("shortlisted.requested", $btn);
                    AjaxQueue.queue("post", url, function(R, status, jqXHR) {
                        if ($.isPlainObject(R) && R.success) {
                            var action = jqXHR.status == 201 ? "add" : "del";
                            EventDispatcher.dispatch("shortlisted." + action, $btn)
                        } else {
                            alert("Something went wrong! Sorry!")
                        }
                    })
                }
            })
        },
        update: function(n) {
            this.shortlistBadges.each(function() {
                var $badge = $(this)
                  , newCount = parseInt($badge.text(), 10) + n;
                $badge.text(newCount);
                if (newCount > 0) {
                    $badge.addClass("hasCount").text(newCount);
                    $badge.siblings('[href="#shortlist"] i').removeClass("pgicon-heart-o").addClass("pgicon-heart")
                } else {
                    $badge.removeClass("hasCount").text(0);
                    $badge.siblings('[href="#shortlist"] i').removeClass("pgicon-heart").addClass("pgicon-heart-o")
                }
            })
        },
        fetchShortlist: function(url, onSuccess) {
            AjaxQueue.queue("get", url, onSuccess)
        },
        removeShortListItem: function(url, onSuccess) {
            AjaxQueue.queue("post", url, onSuccess)
        }
    }
}
)(jQuery, guruApp, EventDispatcher);
(function($) {
    "use strict";
    if (!guruApp.fn) {
        guruApp.fn = {}
    }
    if (guruApp.fn.alertCreateAlert) {
        throw "guruApp.fn.alertCreateAlert already defined!"
    }
    guruApp.fn.alertCreateAlert = function(timeout) {
        var $body = $("body");
        timeout = parseInt(timeout, 10) || 1e3;
        $("#modal-alert-create-alert-button, #modal-alert-save-search-button").click(function() {
            saveSearch($(this), $(this).parents("#alert-create-alert, #alert-save-search"))
        });
        $("a#alert-save-search-button, button#alert-save-search-button").on("click.ga.savesearch.intent", function() {
            $body.trigger("ga.savesearch.intent")
        });
        $("a#alert-create-alert-button, button#alert-create-alert-button").on("click.ga.createalert.intent", function() {
            $body.trigger("ga.createalert.intent")
        });
        function saveSearch(ui, $alert_box) {
            ui.button("loading");
            $("div#alert-create-alert.modal div.modal-body").remove("div.alert");
            var title = $alert_box.find("input[name=alert-name]").val()
              , url = $("#alert-ajax-action-url").val() + "&alertName=" + encodeURIComponent(title)
              , isCreateAlert = $alert_box.find("input[type=checkbox]").is(":checked");
            if (isCreateAlert) {
                url = url + "&alert=1"
            }
            $.get(url, function(data) {
                displayAlertMessage(data, $alert_box);
                window.setTimeout(function() {
                    $alert_box.modal("hide")
                }, timeout);
                if (isCreateAlert) {
                    $body.trigger("ga.createalert.success")
                } else {
                    $body.trigger("ga.savesearch.success")
                }
            }, "json").fail(function(jqXHR) {
                var data = jQuery.parseJSON(jqXHR.responseText);
                displayAlertMessage(data, $alert_box)
            }).always(function() {
                ui.button("reset")
            })
        }
        function displayAlertMessage(data, $alert_box) {
            var box_style = data.success === false ? ".alert-danger" : ".alert-success";
            $alert_box.find(box_style).html(data.message).show()
        }
        $("#alert-create-alert, #alert-save-search").on("show.bs.modal", function(e) {
            $(this).find(".alert").hide()
        })
    }
    ;
    $(document).ready(function() {
        var header = $("#searchbox-n1");
        var saveAlert = $("#save-alert-toggle-component");
        var saveAlertWrapper = $(".save-alert-wrapper");
        function showStickSaveAlertToggle() {
            var headerPosition = header.position().top;
            var saveAlertTogglePosition = saveAlert.position().top;
            if (headerPosition + 70 > saveAlertTogglePosition) {
                saveAlertWrapper.show()
            } else {
                saveAlertWrapper.hide()
            }
        }
        var isMobile = guruApp.fn && guruApp.fn.getCurrentDevice && guruApp.fn.getCurrentDevice() === "mobile";
        var filterExists = $(".filter-count").first().text() >= 1;
        var displayAlert = header.length && saveAlert.length && filterExists;
        if (!displayAlert && isMobile && !$("#areainsider-entry-point-bottom").length) {
            $(".listing-display-options.visible-xs .container-project").addClass("mb-20")
        }
        if (displayAlert) {
            saveAlert.removeClass("hide");
            if (!isMobile) {
                $(window).scroll(showStickSaveAlertToggle)
            }
        }
    })
}
)(jQuery);
(function(guruApp) {
    "use strict";
    if (!guruApp.libs) {
        guruApp.libs = {}
    }
    function isExists(url, fileType) {
        var attribute = fileType === "css" ? "href" : "src";
        return document.querySelector("[" + attribute + '="' + url + '"]')
    }
    guruApp.libs.injectAssets = function(options) {
        if (!options.url) {
            console.error("injectAssets: url is undefined");
            return false
        }
        if (isExists(options.url, options.fileType)) {
            console.error("injectAssets: Already exists");
            return false
        }
        var asset = null;
        if (options.fileType === "css") {
            asset = document.createElement("link");
            asset.rel = "stylesheet";
            asset.type = "text/css";
            asset.href = options.url
        } else {
            asset = document.createElement("script");
            asset.type = "text/javascript";
            asset.src = options.url;
            if (options.onLoad) {
                asset.onload = options.onLoad
            }
            if (options.async) {
                asset.async = true
            }
        }
        if (asset) {
            document.getElementsByTagName("head")[0].appendChild(asset)
        }
    }
}
)(guruApp);
(function($, guruApp) {
    "use strict";
    if (!guruApp.libs) {
        guruApp.libs = {}
    }
    function generateKey(origin, destination, travelMode) {
        return origin.split(",").join("-") + "-" + destination.split(",").join("-") + "-" + travelMode
    }
    var distanceStorage;
    if (guruApp.libs.localStorage && typeof guruApp.libs.localStorage.get === "function") {
        var mapsDistance = guruApp.libs.localStorage.get("mapsDistance");
        distanceStorage = mapsDistance || {}
    }
    guruApp.libs.mapsDistance = function(options) {
        var travelMode = options.travelMode || "TRANSIT";
        var key = generateKey(options.origin, options.destination, travelMode);
        if (distanceStorage && Array.isArray(distanceStorage[key]) && options.onSuccess) {
            distanceStorage[key].push(options.onSuccess)
        } else if (distanceStorage && distanceStorage[key]) {
            if (options.onSuccess) {
                options.onSuccess(distanceStorage[key])
            }
        } else {
            distanceStorage[key] = [];
            if (options.onSuccess) {
                distanceStorage[key].push(options.onSuccess)
            }
            var request = {
                origins: options.origin,
                destinations: options.destination,
                mode: travelMode.toLowerCase()
            };
            $.get(guruApp.MapNearbyWidget.proxyApi + "/distanceMatrix", request).done(function(response) {
                if (response.status === "OK") {
                    var route = {};
                    route.mode = options.travelMode;
                    var leg = response.rows[0].elements[0];
                    var durationValue = leg.duration.value / 60;
                    var durationUnit = "mins";
                    if (durationValue > 60) {
                        durationValue = (durationValue / 60).toFixed();
                        durationUnit = "hrs"
                    }
                    route.time = Math.round(durationValue);
                    route.timeUnit = durationUnit;
                    route.info = leg.distance.text;
                    for (var i in distanceStorage[key]) {
                        distanceStorage[key][i](route)
                    }
                    distanceStorage[key] = route;
                    if (guruApp.libs.localStorage && typeof guruApp.libs.localStorage.set === "function") {
                        guruApp.libs.localStorage.set("mapsDistance", distanceStorage)
                    }
                } else if (options.onError) {
                    options.onError();
                    distanceStorage[key] = null
                }
            }).fail(function() {
                guruApp.Logger.error("Google Maps Proxy Call failed!");
                options.onError()
            })
        }
    }
}
)(jQuery, guruApp);
(function(guruApp, $) {
    "use strict";
    $.fn.googleAutoComplete = function(options) {
        var defaultOptions = {
            value: "description",
            dataFieldSave: "suggestion"
        };
        options = $.extend(defaultOptions, options);
        function render() {
            var compiled = Hogan.compile("<div>{{structured_formatting.main_text}} <span>{{structured_formatting.secondary_text}}</span></div>");
            return function(data) {
                return compiled.render(data)
            }
        }
        var $element = $(this);
        var encodedComponents = encodeURIComponent("country:" + guruApp.country);
        var url = "/placesAutoComplete?input=%QUERY&sessiontoken=commuteSearch&components=" + encodedComponents;
        var suggestions = new Bloodhound({
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            datumTokenizer: Bloodhound.tokenizers.whitespace,
            remote: {
                url: guruApp.MapNearbyWidget.proxyApi + url,
                wildcard: "%QUERY",
                transform: function(response) {
                    return response.predictions
                }
            }
        });
        function pickSuggestion(e, data) {
            e.preventDefault();
            var address = encodeURIComponent(data.description);
            $.get(guruApp.MapNearbyWidget.proxyApi + "/geocode?address=" + address).done(function(response) {
                if (response.results && response.results.length) {
                    $element.data(options.dataFieldSave, JSON.stringify(response.results[0]));
                    if (options.cb) {
                        options.cb()
                    }
                }
            })
        }
        $element.typeahead({
            highlight: true,
            minLength: 3
        }, {
            name: options.dataFieldSave,
            display: options.value,
            source: suggestions,
            limit: 10,
            templates: {
                suggestion: render()
            }
        });
        $element.off("typeahead:selected").on("typeahead:selected", pickSuggestion)
    }
}
)(guruApp, jQuery);
(function(guruApp) {
    "use strict";
    if (!guruApp.libs) {
        guruApp.libs = {}
    }
    guruApp.libs.queue = function() {
        this.data = [];
        this.add = function(item) {
            this.data.unshift(item)
        }
        ;
        this.remove = function() {
            return this.data.pop()
        }
        ;
        this.size = function() {
            return this.data.length
        }
    }
}
)(guruApp);
(function() {
    if (window.sessionStorage) {
        try {
            var pageCount = (parseInt(window.sessionStorage.getItem("pageViewCount"), 10) || 0) + 1;
            window.sessionStorage.setItem("pageViewCount", pageCount)
        } catch (e) {}
    }
}
)();
function windowOpen(url, width, height) {
    var left = screen.width / 2 - width / 2
      , top = screen.height / 2 - height / 2;
    window.open(url, "_blank", "toolbar=yes, scrollbars=true, resizable=false, width=" + width + ", height=" + height + ", top=" + top + ", left=" + left)
}
function isInFullScreen() {
    return !(!document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement)
}
function getFullScreenElement() {
    return document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement || null
}
function toggleMobileFullScreen($carouselPhotos) {
    $carouselPhotos = $($carouselPhotos);
    if ($carouselPhotos.length) {
        if ($carouselPhotos.hasClass("not-in-fullscreen")) {
            $photosvideos = $carouselPhotos.parents(".photosvideos-gallery");
            $(window).trigger("enterFullScreenMediaGalleryView", [$photosvideos]);
            $("body").on("keyup.mediaGalleryView", function(e) {
                if (e.keyCode === 27) {
                    toggleMobileFullScreen($carouselPhotos)
                }
            })
        } else {
            $("body").off("keyup.mediaGalleryView");
            $(window).trigger("exitFullScreenMediaGalleryView", [$photosvideos])
        }
    }
}
function toggleFullScreen(e) {
    if (!document.fullscreenEnabled) {
        toggleMobileFullScreen(e)
    } else {
        if (!isInFullScreen()) {
            if (e.requestFullscreen) {
                e.requestFullscreen()
            } else if (e.msRequestFullscreen) {
                e.msRequestFullscreen()
            } else if (e.mozRequestFullScreen) {
                e.mozRequestFullScreen()
            } else if (e.webkitRequestFullscreen) {
                e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)
            }
            addListingDetailToCart("Photo Gallery Full Screen")
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen()
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen()
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen()
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen()
            }
        }
    }
}
function addBeforePrintEvent(handler) {
    if ("matchMedia"in window && "addListener"in window.matchMedia("print")) {
        window.matchMedia("print").addListener(function(media) {
            if (media.matches) {
                handler()
            }
        })
    } else {
        $(window).on("beforeprint", handler)
    }
}
String.prototype.ucfirst = function() {
    return this.charAt(0).toUpperCase() + this.substr(1)
}
;
var manageAcceptCookies = {
    init: function() {
        $(".accept-cookies").removeClass("hidden");
        $("body").addClass("accept-cookies-opened");
        this.applyCloseBinding()
    },
    applyCloseBinding: function() {
        $(".accept-cookies .accept-cookies-close").on("click", function(event) {
            event.preventDefault();
            localStorage.setItem("accept-cookies", true);
            $(this).closest(".accept-cookies").addClass("hidden");
            $("body").removeClass("accept-cookies-opened")
        })
    }
};
var handleEuropeGDPR = function() {
    var offsetHr = (new Date).getTimezoneOffset() / 60;
    var euTimezoneOffsets = [0, -1, -2, -3, -4];
    if (euTimezoneOffsets.indexOf(offsetHr) >= 0) {
        var toggleElement = function(element, show) {
            if (element) {
                if (show) {
                    element.show()
                } else {
                    element.hide()
                }
            }
        };
        var disableWelcomeBackModal = function() {
            var date = new Date(864e13);
            guruApp.libs.cookie.set("welcomeBackModalVisited", "true", date, "/")
        };
        disableWelcomeBackModal();
        var login = $(".login")
          , myAccount = $(".my-account")
          , contactFormBottom = $("#contact-agent")
          , contactAdvertiserSection = $("#contact-advertiser-section")
          , contactAdvertiser = $("#contact-advertiser")
          , contactFormSide = $(".contact-form-side")
          , gdprAlert = $("#gdpr-alert")
          , saveAlert = $("#save-alert-toggle-component")
          , loginToSave = $("#multiple-enquire").find(".mltp-btns")
          , btnContact = $(".btn-contact")
          , feedbackFooter = $("#footer-guru-info").find('a[href$="feedback"]');
        toggleElement(login);
        toggleElement(myAccount);
        toggleElement(contactFormBottom);
        toggleElement(contactFormSide);
        toggleElement(contactAdvertiserSection);
        toggleElement(contactAdvertiser);
        toggleElement(saveAlert);
        toggleElement(loginToSave);
        toggleElement(btnContact);
        toggleElement(feedbackFooter);
        toggleElement(gdprAlert, true)
    }
};
handleEuropeGDPR();
var addListingDetailToCart = function(addToCartEventName) {
    if (guruApp.listingDetail) {
        $("body").trigger("ga.ec.addToCart", {
            currency: guruApp.listingDetail.gaECCurrency,
            productData: Object.assign({}, guruApp.listingDetail.gaECData, {
                quantity: 1
            }),
            addToCartEventName: addToCartEventName
        })
    }
};
var openedPgPopovers = [];
var handlePopoverOpen = function(popoverSelector) {
    if (openedPgPopovers.length == 0) {
        $(window).on("touchmove", hidePGPopovers);
        $(window).scroll(hidePGPopovers)
    }
    if (openedPgPopovers.indexOf(popoverSelector) == -1) {
        openedPgPopovers.push(popoverSelector)
    }
    return true
};
var handlePopoverClose = function(popoverSelector) {
    openedPgPopovers = openedPgPopovers.filter(function(popover) {
        return popover != popoverSelector
    });
    if (openedPgPopovers.length == 0) {
        $(window).off("scroll", hidePGPopovers);
        $(window).off("touchmove", hidePGPopovers)
    }
    return true
};
var initPGPopovers = function() {
    var DEFAULT_BOOTSTRAP_OFFSET = .5;
    var getCalculatedOffsetVertical = function(offsetX, offsetY) {
        var offsetXMultiplier = offsetX ? offsetX / 100 : DEFAULT_BOOTSTRAP_OFFSET;
        var offsetYMultiplier = offsetY ? offsetY / 100 : DEFAULT_BOOTSTRAP_OFFSET;
        return function(placement, pos, actualWidth, actualHeight) {
            switch (placement) {
            case "bottom":
                {
                    return {
                        top: pos.top + pos.height,
                        left: pos.left + pos.width / 2 - actualWidth * offsetXMultiplier
                    }
                }
            case "top":
                {
                    return {
                        top: pos.top - actualHeight,
                        left: pos.left + pos.width / 2 - actualWidth * offsetXMultiplier
                    }
                }
            case "left":
                {
                    return {
                        top: pos.top + pos.height / 2 - actualHeight * offsetYMultiplier,
                        left: pos.left - actualWidth
                    }
                }
            default:
                {
                    return {
                        top: pos.top + pos.height / 2 - actualHeight * offsetYMultiplier,
                        left: pos.left + pos.width
                    }
                }
            }
        }
    };
    var getReplaceArrow = function(offset) {
        return function(delta, dimension, isVertical) {
            this.arrow().css(isVertical ? "left" : "top", offset * (1 - delta / dimension) + "%").css(isVertical ? "top" : "left", "")
        }
    };
    var ARROW_VERTICAL_OFFSET = 25;
    var ARROW_TOP_OFFSET = 10;
    var popoverPlacement = function(placement, className, verticalAdjustment) {
        verticalAdjustment = verticalAdjustment === undefined ? 0 : verticalAdjustment;
        return function(popoverNode, triggeredNode) {
            $(popoverNode).addClass(className);
            $(popoverNode).find(".popover-dismiss").click(function() {
                $(triggeredNode).popover("hide")
            });
            $(popoverNode).find(".login-in-popover").click(function() {
                $("#modal-login").modal("show");
                $("body").trigger("ga.login.tooltip.click")
            });
            switch (placement) {
            case "bottom-left":
                {
                    this.replaceArrow = getReplaceArrow(ARROW_VERTICAL_OFFSET + verticalAdjustment).bind(this);
                    this.getCalculatedOffset = getCalculatedOffsetVertical(ARROW_VERTICAL_OFFSET + verticalAdjustment).bind(this);
                    return "bottom"
                }
            case "bottom":
                {
                    return "bottom"
                }
            case "top":
                {
                    return "top"
                }
            case "bottom-right":
                {
                    this.replaceArrow = getReplaceArrow(100 - ARROW_VERTICAL_OFFSET + verticalAdjustment).bind(this);
                    this.getCalculatedOffset = getCalculatedOffsetVertical(100 - ARROW_VERTICAL_OFFSET + verticalAdjustment).bind(this);
                    return "bottom"
                }
            case "right":
                {
                    this.getCalculatedOffset = getCalculatedOffsetVertical(null, ARROW_TOP_OFFSET).bind(this);
                    return "right"
                }
            case "left":
                {
                    this.getCalculatedOffset = getCalculatedOffsetVertical(null, ARROW_TOP_OFFSET).bind(this);
                    return "left"
                }
            default:
                {
                    return placement
                }
            }
        }
    };
    var AVAILABLE_PLACEMENTS = ["bottom", "bottom-left", "bottom-right", "left", "right", "top"];
    $('.pg-popover[data-toggle="popover"]').each(function(_, popoverTrigger) {
        var popoverTriggerElement = $(popoverTrigger);
        var placement = popoverTriggerElement.data("placement");
        var isOpen = !!popoverTriggerElement.data("open");
        var themeClass = popoverTriggerElement.data("theme-classname");
        var verticalAdjustment = popoverTriggerElement.data("theme-vertical-adjustment");
        if (AVAILABLE_PLACEMENTS.indexOf(placement) === -1) {
            throw new Error("Wrong data-placement value, possible values:" + AVAILABLE_PLACEMENTS.join(" | "))
        }
        var popoverOptions = {
            container: "body",
            placement: popoverPlacement(placement, themeClass, verticalAdjustment)
        };
        popoverTriggerElement.popover(popoverOptions);
        popoverTriggerElement.on("show.bs.popover", handlePopoverOpen.bind(null, popoverTriggerElement));
        popoverTriggerElement.on("hide.bs.popover", handlePopoverClose.bind(null, popoverTriggerElement));
        if (isOpen) {
            popoverTriggerElement.popover("show")
        }
    })
};
var hidePGPopovers = function() {
    if (openedPgPopovers.length > 0) {
        $('.pg-popover[data-toggle="popover"]').each(function(_, popoverTrigger) {
            $(popoverTrigger).popover("hide")
        })
    }
};
var getECDataByListingId = function(listingId) {
    if (!guruApp.listingResultsWidget || !guruApp.listingResultsWidget.gaECListings) {
        return null
    }
    for (var i = 0; i < guruApp.listingResultsWidget.gaECListings.length; ++i) {
        var listItem = guruApp.listingResultsWidget.gaECListings[i];
        if (listItem.productData.id === listingId) {
            var product = {
                id: listItem.productData.id,
                name: listItem.productData.name,
                price: listItem.productData.price,
                category: listItem.productData.category,
                brand: listItem.productData.brand,
                variant: listItem.productData.variant,
                quantity: 1,
                dimension23: listItem.productData.dimension23,
                dimension24: listItem.productData.dimension24,
                dimension25: listItem.productData.dimension25
            };
            if (listItem.productData.dimension40) {
                product.dimension40 = listItem.productData.dimension40
            }
            return {
                currency: listItem.currency,
                productData: product
            }
        }
    }
    return null
};
var addListingItemToCart = function(listingId, addToCartEventName) {
    var ecData = getECDataByListingId(listingId);
    if (ecData) {
        $("body").trigger("ga.ec.addToCart", {
            currency: ecData.currency,
            productData: ecData.productData,
            addToCartEventName: addToCartEventName
        })
    }
};
var purchaseListingItem = function(listingId, purchaseType) {
    var ecData = getECDataByListingId(listingId);
    if (ecData) {
        $("body").trigger("ga.ec.purchase", {
            currency: ecData.currency,
            productData: ecData.productData,
            purchaseType: purchaseType
        })
    }
};
var purchaseListingDetail = function(purchaseType) {
    if (guruApp.listingDetail) {
        $("body").trigger("ga.ec.purchase", {
            currency: guruApp.listingDetail.gaECCurrency,
            productData: Object.assign({}, guruApp.listingDetail.gaECData, {
                quantity: 1
            }),
            purchaseType: purchaseType
        })
    }
};
var COUNTRY_LOCALE = {
    SG: "en-SG",
    MY: "ms-MY",
    TH: "th-TH",
    ID: "id-ID"
};
var prettyPrice = function(price, minimumFractionDigits) {
    var blockName = "M";
    var currencySymbolSeparator = " ";
    if (guruApp.country === "ID") {
        blockName = "jt"
    }
    if (guruApp.country === "TH") {
        currencySymbolSeparator = ""
    }
    var locale = COUNTRY_LOCALE[guruApp.country];
    var options = {
        minimumFractionDigits: minimumFractionDigits || 0,
        maximumFractionDigits: 2
    };
    var formatNumber = function(value, locale, options) {
        if (value % 1 === 0) {
            options.minimumFractionDigits = 0
        }
        return value.toLocaleString(locale, options)
    };
    if (price >= 1e6) {
        var result = price / 1e6;
        return guruApp.currencySymbol + currencySymbolSeparator + formatNumber(result, locale, options) + " " + blockName
    } else {
        return guruApp.currencySymbol + currencySymbolSeparator + formatNumber(price, locale, options)
    }
};
$(document).ready(function() {
    "use strict";
    var $body = $("body");
    if (guruApp.listingDetail && guruApp.listingDetail.showGoogleMapsDiscovery) {
        $("#map").addClass("google-discovery-map")
    }
    guruApp.fn.addListingDetailToCart = addListingDetailToCart;
    guruApp.fn.addListingItemToCart = addListingItemToCart;
    guruApp.fn.purchaseListingDetail = purchaseListingDetail;
    guruApp.fn.purchaseListingItem = purchaseListingItem;
    guruApp.fn.prettyPrice = prettyPrice;
    guruApp.fn.dropdownVisibility($body);
    guruApp.fn.userSessionInjector($body, guruApp.userSession.user);
    guruApp.fn.widgetMainNav($("#navbar-main"));
    guruApp.fn.alertCreateAlert();
    guruApp.fn.shortlist.init();
    var $mortgageEnquire = $("#mortgageEnquire");
    if ($mortgageEnquire.length) {
        $mortgageEnquire.mortgageEnquire()
    }
    if (typeof $.fn.sortableTable !== "undefined" && $.isFunction($.fn.sortableTable)) {
        $(".table.sortable").sortableTable({
            getSearchQuery: function() {
                return window.location.search
            },
            setNewUrl: function(url) {
                window.location.href = url
            }
        })
    }
    if ($.fn.lazyload) {
        (function() {
            var $lazyImgs = $("img.lazy")
              , threshold = Math.round($(window).height() / 4)
              , loadFunction = function() {
                var $img = $(this);
                if ($img.is(".lazy-bg")) {
                    $img.closest(".lazy-bg-parent").css({
                        backgroundImage: 'url("' + this.src + '")'
                    })
                }
                $img.trigger("lazyLoad");
                $img.removeClass("lazy").css("display", "")
            }
              , lazyConfig = {
                effect: "fadeIn",
                failure_limit: $lazyImgs.length,
                skip_invisible: true,
                threshold: threshold,
                load: loadFunction
            };
            if ($body.is(".listing_detail") || $body.is(".lazy-container") && guruApp.fn.getCurrentDevice() === "mobile") {
                lazyConfig.container = $("#wrapper-inner").get(0)
            }
            $lazyImgs.lazyload(lazyConfig);
            $('a[data-toggle="tab"]').on("shown.bs.tab", function(e) {
                EventDispatcher.dispatch("height.changed");
                $(e.target.hash).find(".media-thumbs img.lazy").trigger("appear")
            });
            $(".carousel-sliced img.lazy, .featured-agents-horizontal img.lazy").trigger("appear");
            $(window).load(function() {
                $("html,body").trigger("scroll")
            })
        }
        )()
    }
    var $modalPrint = $("#printModal");
    if ($modalPrint) {
        (function() {
            var lazyLoadCount = 0;
            var printAfterLoad = false;
            var initiatedLoading = false;
            function decreaseLazyLoadCount() {
                lazyLoadCount--;
                printAfterLoad = true;
                if (printAfterLoad && lazyLoadCount === 0) {
                    $modalPrint.modal("hide");
                    window.print();
                    printAfterLoad = false
                }
            }
            function removeDOMImage() {
                this.parentNode.removeChild(this)
            }
            window.windowLoaded = false;
            $(window).on("load", function() {
                window.windowLoaded = true
            });
            window.mapLoaded = false;
            if ($("#map")) {
                $(window).on("widgetMapNearby.show", function() {
                    window.mapLoaded = true
                })
            }
            $modalPrint.on("hidden.bs.modal", function() {
                printAfterLoad = false
            });
            function showPrintModal() {
                var foundLazy = false;
                if (initiatedLoading) {
                    if (lazyLoadCount > 0) {
                        foundLazy = true
                    }
                } else {
                    if (!window.windowLoaded) {
                        lazyLoadCount++;
                        foundLazy = true;
                        $(window).on("load", decreaseLazyLoadCount)
                    }
                    if ($("#map") && !window.mapLoaded) {
                        lazyLoadCount++;
                        foundLazy = true;
                        $(window).trigger("widgetMapNearby.show");
                        setTimeout(decreaseLazyLoadCount, 500)
                    }
                    $("img.lazy").each(function(index, element) {
                        foundLazy = true;
                        var $img = $(element);
                        lazyLoadCount++;
                        if ($img.is(".lazy-bg")) {
                            $img.closest(".lazy-bg-parent").css({
                                backgroundImage: 'url("' + element.src + '")'
                            });
                            var fakeImg = $("<img />").css({
                                display: "none"
                            });
                            fakeImg.on("load", decreaseLazyLoadCount);
                            fakeImg.on("load", removeDOMImage);
                            fakeImg.on("error", decreaseLazyLoadCount);
                            fakeImg.on("error", removeDOMImage);
                            $body.append(fakeImg);
                            fakeImg.attr("src", element.src)
                        } else {
                            $img.on("load", decreaseLazyLoadCount);
                            $img.on("error", decreaseLazyLoadCount);
                            $img.attr("src", $img.attr("data-original"))
                        }
                        $img.removeClass("lazy").css("display", "");
                        element.loaded = true
                    })
                }
                if (!foundLazy) {
                    $modalPrint.modal("hide");
                    window.print()
                } else {
                    $modalPrint.modal();
                    printAfterLoad = true;
                    initiatedLoading = true
                }
            }
            $body.on("printButton.click", showPrintModal)
        }
        )()
    }
    if ($.fn.widgetSearch && !$("#mapsearch").length) {
        $("form.searchbox").widgetSearch({
            cache: false,
            complete: function() {}
        })
    }
    if ($body.is(".listing,.agent-details,.agent-search,.listing-overseas")) {
        $(".sort-dropdown").one("show.bs.dropdown", function(event) {
            $(event.target).find("ul li a").each(function(index, element) {
                $(element).attr("href", $(element).data("href")).removeAttr("data-href")
            })
        })
    }
    (function() {
        if ($body.hasClass("listing")) {
            var $navSearch = $("li.nav-search");
            if ($navSearch.is(":visible")) {
                $navSearch.find("a.pgicon-search").on("click", function() {
                    var $this = $(this)
                      , $searchBoxes = $("form.searchbox")
                      , hiddenClass = "searchbox-hidden-xs"
                      , hiddenClassDisabled = "searchbox-hidden-xs-suppressed"
                      , activeClass = "active"
                      , $hidden = $searchBoxes.find("." + hiddenClass)
                      , $showFilterButton = $searchBoxes.find(".searchbox-filters");
                    $this.parent().addClass(activeClass);
                    $hidden.removeClass(hiddenClass).addClass(hiddenClassDisabled);
                    $showFilterButton.removeClass(hiddenClassDisabled).addClass(hiddenClass)
                })
            }
        }
    }
    )();
    if ($.fn.carouselSliced) {
        $(".carousel-sliced").carouselSliced()
    }
    $(".agent-website a").on("click", function(e) {
        $body.trigger("ga.agent.visit.website")
    });
    $(".show_more_area_js").on("click", function(e) {
        $(".propular-area-hidden-mobile").show();
        $(".show_more_area_js").hide()
    });
    $(".sharing-widget a.pgicon-twitter.listing").on("click", function(e) {
        var currentUrl = $(this).data("raw-url");
        e.preventDefault();
        if (currentUrl) {
            var text = escape("Here's a property you have to check out! " + currentUrl + ". #RealEstate #Homes #PropertyGuru")
              , url = "https://twitter.com/intent/tweet?text=" + text;
            windowOpen(url, 600, 400)
        }
        return false
    });
    $(".sharing-widget a.pgicon-twitter.property-reviews").on("click", function(e) {
        e.preventDefault();
        var hash = " #RealEstate #Homes #PropertyGuru";
        switch (guruApp.sharingData.localize) {
        case "th_th":
            hash = " # #DDproperty";
            break;
        case "th_en":
            hash = " #PropertyReviews #DDproperty";
            break
        }
        var text = encodeURIComponent("Here's a review you have to check this out! " + guruApp.sharingData.link + "." + hash)
          , url = "https://twitter.com/intent/tweet?text=" + text;
        windowOpen(url, 600, 400);
        return false
    });
    $(".listings-page-results .listing-item, .listing-widget-new .listing-card a.nav-link").on("click", function(e) {
        var $listing = $(this).closest(".listing-item, .listing-card"), classList = $listing.attr("class"), listingIdObj, listingId;
        if (typeof classList != "undefined") {
            listingIdObj = classList.match(/listing-id-.*/);
            if (typeof listingIdObj[0] != "undefined") {
                listingId = listingIdObj[0].replace(/^\D+/g, "");
                if ($(".listing-id-" + listingId.split(" ")[0] + " .pull-left.hlpa").length > 0) {
                    $("body").trigger("ga.genericHlpaTracker", {
                        category: "HomeLoanPreApproval-Engagement",
                        action: "Click",
                        label: "location=SERP-ListingCard",
                        payload: {
                            content: "Listing card with Home Loan Pre-Approval",
                            type: "tag"
                        }
                    })
                }
            }
        }
        $body.trigger("ga.listing.search.clicked", [listingId])
    });
    $(".listing-widget-new .js-agent-phone-number-call").on("click", function(e) {
        e.preventDefault();
        $(this).addClass("active");
        $(this).find(".listing-agent-phone-number").removeClass("hide").show();
        $(this).find("i, .phone-label").hide();
        var dimensions = [];
        var listingId = 0;
        if ($body.is(".listing")) {
            var dataListingId = $(this).context.getAttribute("data-listing-id");
            if (dataListingId) {
                var createGaDimension = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.createGaDimension;
                dimensions.push(createGaDimension("dimension7", dataListingId))
            }
        }
        $body.trigger("ga.phone.show", [listingId, null, null, null, null, dimensions]);
        guruApp.fn.purchaseListingDetail("View Phone (Property Detail)")
    });
    function getData(options) {
        $.ajax({
            type: options.type || "GET",
            url: options.url,
            data: options.data,
            success: options.success,
            dataType: "json"
        })
    }
    $(".gallery-wrapper").slider();
    function facebookShare(params) {
        var url = "https://www.facebook.com/v2.4/dialog/share?";
        params = params || {};
        params.app_id = guruApp.facebook ? guruApp.facebook.appId || "" : "";
        params.display = "popup";
        params.e2e = "{}";
        params.locale = "en_US";
        params.sdk = "joey";
        params.version = "v2.4";
        var paramList = [];
        for (var key in params) {
            if (!Object.prototype[key]) {
                paramList.push(escape(key) + "=" + escape(params[key]))
            }
        }
        return windowOpen(url + paramList.join("&"), 500, 500)
    }
    $(".btn-facebook-share").on("click", function(e) {
        e.preventDefault();
        var data = guruApp.sharingData || {}
          , propertyType = ""
          , url = $(this).data("raw-url")
          , thumb = ""
          , $btn = $(this);
        if (data.propertyType) {
            propertyType = data.propertyType + ", "
        }
        if ($btn.is(".btn-facebook-messenger-js")) {
            if (!window.FB) {
                windowOpen($btn.attr("href") + "&redirect_uri=" + encodeURI(url), 600, 400)
            } else {
                FB.ui({
                    method: "send",
                    link: url
                })
            }
        } else if (data.listingType === "listing") {
            facebookShare({
                quote: propertyType + data.area + data.bedBath,
                href: url
            })
        } else if (data.sharingType === "project-review") {
            facebookShare({
                quote: data.description,
                href: data.link
            })
        } else if (data.sharingType === "property-detail") {
            facebookShare({
                quote: data.propertyType,
                href: data.link
            })
        } else if (data.title) {
            facebookShare({
                quote: propertyType + data.developmentName + ", " + data.developerName + " - " + data.address,
                href: url
            })
        } else {
            return true
        }
        return false
    });
    $(".dropdown-menu > .sharing-widget").each(function() {
        var $sharingWidget = $(this);
        if (guruApp && guruApp.listingDetail) {
            $sharingWidget.find(".sharing-widget-js-link.listing").each(function() {
                if ($(this)[0].innerText === "Copy Link") {
                    var $copyBtn = $(this);
                    $copyBtn.addClass("disabled");
                    var $copyText = $copyBtn.first().data("raw-url");
                    $.ajax({
                        url: $sharingWidget.data("clipboard"),
                        dataType: "script",
                        success: function() {
                            new ClipboardJS(".sharing-widget .sharing-widget-js-link",{
                                text: function() {
                                    return $copyText.indexOf("utm_source") > -1 ? $copyText : $copyText.indexOf("?") > -1 ? $copyText + "&utm_source=share&utm_medium=ldp&utm_campaign=copy_url" : $copyText + "? utm_source=share&utm_medium=ldp&utm_campaign=copy_url"
                                }
                            });
                            $copyBtn.removeClass("disabled")
                        },
                        cache: true
                    })
                }
            })
        }
        $sharingWidget.parent().parent().one("show.bs.dropdown", function() {
            var $copyBtn = $sharingWidget.find(".sharing-widget-js-link");
            if (typeof ClipboardJS === "undefined") {
                var url = $sharingWidget.data("clipboard");
                $copyBtn.addClass("disabled");
                $.ajax({
                    url: url,
                    dataType: "script",
                    success: function() {
                        new ClipboardJS(".sharing-widget .sharing-widget-js-link",{
                            text: function() {
                                return $sharingWidget.find(".sharing-widget-js-link").first().data("raw-url")
                            }
                        });
                        $copyBtn.removeClass("disabled")
                    },
                    cache: true
                })
            }
        })
    });
    $('.sharing-widget a.pgicon:not([data-toggle="modal"])').not(".listing, .property-detail, .property-reviews, .sharing-widget-js-link").on("click", function(e) {
        windowOpen($(this).attr("href"), 600, 400);
        return false
    });
    $(".btn-print").on("click", function() {
        $body.trigger("printButton.click");
        $body.trigger("ga.print.button")
    });
    $("#myTab").on("click", "a", function() {
        guruApp.fn.addListingDetailToCart("Recent Transactions Widget")
    });
    function maskPhoneNumber(number) {
        if (number.length < 6) {
            number = number.slice(0, -2) + ".."
        } else {
            number = number.slice(0, -4) + "...."
        }
        var hiddenNumberStr = number.replace(/[^\+0-9]+([0-9]+)$/g, function(match, contents, offset, s) {
            return match.replace(/[0-9]/g, ".")
        });
        var sp = hiddenNumberStr.split(/^([0-9\+]+\s+)?([.\ ]+)$/g);
        var base = "";
        var xNumber = "";
        if (sp.length == 4) {
            if (sp[1]) {
                base = sp[1]
            }
            if (sp[2]) {
                xNumber = sp[2].replace(/\s+/g, "");
                if (xNumber.length >= 8) {
                    xNumber = xNumber.replace(/[.]{8,}/, ".... ....")
                } else {
                    xNumber = sp[2]
                }
            }
            hiddenNumberStr = base + xNumber
        }
        return hiddenNumberStr
    }
    (function() {
        function getCurrentPageListingId() {
            var $listingId = $("input[name=listingId]")
              , listingId = 0;
            if ($listingId.length) {
                listingId = $listingId.val()
            }
            return listingId
        }
        function getCurrentPageAgentId() {
            var $agentId = $("input[name=agentId]")
              , agentId = 0;
            if ($agentId.length) {
                agentId = $agentId.val()
            }
            return agentId
        }
        $(".agent-phone-number, .developer-phone-number").each(function() {
            var $number = $(this), originalNumberStr = $number.text(), hiddenNumberStr, $agentShowNumber = null, href = "", $a = $number;
            if (guruApp.client.is_mobile) {
                if ($number.hasClass("agent-blackberry-pin")) {
                    href = "PIN:" + originalNumberStr
                } else {
                    href = "tel:" + originalNumberStr.replace(/[^0-9\+]+/g, "")
                }
                if (!$number.is("a")) {
                    $a = $number.parent()
                }
                $a.data("call-protocol", href).addClass("js-agent-phone-number")
            }
            if ($number.hasClass("agent-blackberry-pin")) {
                hiddenNumberStr = originalNumberStr.replace(/./g, "x")
            } else {
                hiddenNumberStr = maskPhoneNumber(originalNumberStr)
            }
            if ($a.is(".listing-items *")) {
                $number.addClass("hide")
            }
            $number.parent().append($number.clone(true).addClass("agent-phone-number-original visible-print"));
            $number.data("mobile", originalNumberStr).addClass("masked no-print").text(hiddenNumberStr)
        });
        $(".listing-values .btn-tools a[data-toggle=tooltip]").tooltip();
        $(".right-content, .agent-details-top").on("click.ga", ".js-agent-details-phone-number-call", function() {
            var listingId = getCurrentPageListingId();
            var agentId = getCurrentPageAgentId();
            if ($(this).parents(".agent-contact-form").length) {
                $body.trigger("ga.phone.click", ["Sticky Bar - Bottom", listingId, agentId])
            } else if ($(this).parents(".agent-details-top").length) {
                $body.trigger("ga.phone.click", ["Agent Profile", listingId, agentId])
            } else {
                $body.trigger("ga.phone.click", ["Side", listingId, agentId])
            }
            $(this).off("click.ga")
        });
        var fPhoneClick = function(label) {
            var listingId = getCurrentPageListingId();
            var agentId = getCurrentPageAgentId();
            $body.trigger("ga.phone.click", [label, listingId, agentId]);
            guruApp.fn.purchaseListingDetail("Call Agent(Mobile Web)");
            $(this).off("click.ga")
        };
        $("#contact-agent").on("click.ga", ".js-agent-phone-number-call", function() {
            fPhoneClick("Bottom")
        });
        $(".contact-agent-phone-btns").on("click.ga", ".js-agent-phone-number-call", function() {
            fPhoneClick("Under Gallery")
        });
        $(".btn-agent-contact-phone").on("click.ga", function() {
            var $listingId = $("input[name=listingId]")
              , listingId = 0;
            if ($listingId.length) {
                listingId = $listingId.val()
            }
            $body.trigger("ga.phone.show", [listingId]);
            $(this).off("click.ga")
        }).on("click", function() {
            var $btn = $(this);
            $btn.removeClass("pgicon pgicon-phone").children(".btn-title").text($btn.data("mobile"))
        });
        var showPhoneNumber = function(elm) {
            var $elm = $(elm);
            var $numbers = $elm.children(".agent-phone-number").not(".visible-print");
            $numbers.each(function(index, element) {
                var $n = $(this);
                $n.text($n.data("mobile")).removeClass("masked hide");
                if (!guruApp.client.is_mobile && !$body.is(".listing")) {
                    $n.unwrap()
                } else if (guruApp.client.is_mobile) {
                    if (!$n.is("a")) {
                        $n = $n.parent()
                    }
                    $n.attr("href", $n.data("call-protocol")).addClass("js-agent-phone-number-call")
                }
                if ($n.is(".listing-items *")) {
                    $n.removeClass("hide")
                }
            })
        };
        $(".agent-contact .btn-contact").on("click", function() {
            var agentId = $(this).data("agentid");
            $("#ref-clicked-from").val("");
            if ($body.is(".agent-home")) {
                var label = "Monthly featured agents (Home)";
                if ($(this).hasClass("link-agent-specialist")) {
                    $("#ref-clicked-from").val("link-agent-specialist");
                    label = "Specialist featured agents (Home)"
                }
                $body.trigger("fbpixel.enquiry.form.open", [null, agentId, null, null, label])
            } else if ($body.is(".agent-search")) {
                var label = "Monthly featured agents (Search)";
                if ($(this).hasClass("link-agent-specialist")) {
                    $("#ref-clicked-from").val("link-agent-specialist");
                    label = "Specialist featured agents (Search)"
                }
                $body.trigger("fbpixel.enquiry.form.open", [null, agentId, null, null, label])
            }
        });
        $(".js-agent-call").on("click", function() {
            var $this = $(this)
              , dimensions = []
              , label = null;
            var $listingId = $("input[name=listingId]")
              , listingId = 0;
            if ($listingId.length) {
                listingId = $listingId.val()
            }
            var $agentId = $("input[name=agentId]")
              , agentId = 0;
            if ($agentId.length) {
                agentId = $agentId.val()
            }
            if (agentId === "") {
                agentId = $this.data("agentid")
            } else {
                agentId = 0
            }
            if ($body.is(".agent-home")) {
                label = "Monthly featured agents (Home)";
                if ($this.hasClass("link-agent-specialist")) {
                    label = "Specialist featured agents (Home)"
                }
                $body.trigger("ga.phone.call", [listingId, agentId, null, null, label, dimensions])
            } else if ($body.is(".agent-search")) {
                label = "Monthly featured agents (Search)";
                if ($this.hasClass("link-agent-specialist")) {
                    label = "Specialist featured agents (Search)"
                }
                $body.trigger("ga.phone.call", [listingId, agentId, null, null, label, dimensions])
            } else if ($body.is(".listing_detail")) {
                if ($("#page-type-code").length) {
                    label = "Condo featured agents";
                    var pageTypeCode = $("#page-type-code").val();
                    if (pageTypeCode === "HDB") {
                        label = "HDB featured agents"
                    }
                    $body.trigger("ga.phone.call", [listingId, agentId, null, null, label, dimensions])
                }
            } else if ($body.is(".agent-details")) {
                var label = "Agent Profile";
                $body.trigger("ga.phone.call", [listingId, agentId, null, null, label, dimensions])
            }
        });
        $body.on("click.ga-agent-show-number", ".js-agent-phone-number", function(e) {
            e.preventDefault();
            var createGaDimension = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.createGaDimension;
            var dimension2 = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
            var $this = $(this)
              , dimensions = []
              , dataListingId = 0
              , widgetPlacement = null
              , label = null;
            var $listingId = $("input[name=listingId]")
              , listingId = 0;
            if ($listingId.length) {
                listingId = $listingId.val()
            }
            var $agentId = $("input[name=agentId]")
              , agentId = 0;
            if ($agentId.length) {
                agentId = $agentId.val()
            }
            if (agentId == "") {
                agentId = $this.data("agentid")
            } else {
                agentId = 0
            }
            if (listingId) {
                widgetPlacement = $this.context.getAttribute("data-placement");
                if (widgetPlacement) {
                    dimensions.push(createGaDimension("dimension20", '{"Loc":"' + widgetPlacement + '","Type":"ViewPhone"}'))
                }
            } else if ($body.is(".listing")) {
                dataListingId = $this.context.getAttribute("data-listing-id");
                if (dataListingId) {
                    dimensions.push(createGaDimension("dimension7", dataListingId))
                }
            } else if ($body.is(".agent-home")) {
                label = "Monthly featured agents (Home)";
                if ($this.hasClass("agent-btn")) {
                    label = "Specialist featured agents (Home)"
                }
            } else if ($body.is(".agent-search")) {
                label = "Monthly featured agents (Search)";
                if ($this.hasClass("agent-btn")) {
                    label = "Specialist featured agents (Search)"
                }
            } else if ($body.is(".listing_detail")) {
                if ($("#page-type-code").length) {
                    label = "Condo featured agents";
                    var pageTypeCode = $("#page-type-code").val();
                    if (pageTypeCode === "HDB") {
                        label = "HDB featured agents"
                    }
                }
            } else if ($body.is(".landing-condo")) {
                label = "Condo Directory Landing";
                var ecImpression = $this.closest(".specialist-agent-box").data("ec-impression");
                agentId = ecImpression.productData.dimension25.toString()
            } else if ($body.is(".listing-condo")) {
                label = "Condo Directory Search";
                var ecImpression = $this.closest(".specialist-agent-box").data("ec-impression");
                agentId = ecImpression.productData.dimension25.toString()
            }
            $body.trigger("ga.phone.show", [listingId, agentId, null, null, label, dimensions]);
            if ($body.is(".listing_detail")) {
                guruApp.fn.purchaseListingDetail("View Phone (Property Detail)")
            } else {
                var ecImpression = [];
                if ($body.is(".agent-home") || $body.is(".agent-search") || $body.is(".listing_detail")) {
                    var ecImpression = $this.closest("div.featured-agent").data("ec-impression");
                    if (ecImpression) {
                        ecImpression.productData.dimension25 = ecImpression.productData.dimension25.toString();
                        $("body").trigger("ga.ec.purchase", {
                            currency: ecImpression.currency,
                            productData: ecImpression.productData,
                            purchaseType: "View Phone"
                        })
                    }
                    if ($this.hasClass("agent-btn")) {
                        var ecImpression = $this.closest("div.specialist-agent-box").data("ec-impression");
                        if (ecImpression) {
                            ecImpression.productData.dimension25 = ecImpression.productData.dimension25.toString();
                            $("body").trigger("ga.ec.purchase", {
                                currency: ecImpression.currency,
                                productData: ecImpression.productData,
                                purchaseType: "View Phone"
                            })
                        }
                    }
                } else if ($body.is(".landing-condo") || $body.is(".listing-condo")) {
                    var ecImpression = $this.closest("div.specialist-agent-box").data("ec-impression");
                    if (ecImpression) {
                        ecImpression.productData.dimension25 = ecImpression.productData.dimension25.toString();
                        $("body").trigger("ga.ec.purchase", {
                            currency: ecImpression.currency,
                            productData: ecImpression.productData,
                            purchaseType: "View Phone"
                        })
                    }
                }
            }
            var isFeaturedAgentPhone = $this.is(".featured-agent .js-agent-phone-number");
            var isFeaturedAgentSpecialistPhone = $this.is(".agent-specialists .js-agent-phone-number");
            if (!$body.is(".landing-condo") && !$body.is(".listing-condo") && !$body.is(".listing") && !isFeaturedAgentPhone && !isFeaturedAgentSpecialistPhone) {
                $body.off("click.ga-agent-show-number");
                $body.find(".js-agent-phone-number").each(function() {
                    showPhoneNumber(this)
                })
            } else if (isFeaturedAgentPhone || isFeaturedAgentSpecialistPhone) {
                $(this).addClass("active");
                $(this).find(".agent-mobile-number").removeClass("hide").show();
                $(this).find("i, .phone-label").hide()
            }
        }).on("click", ".js-agent-phone-number", function() {
            showPhoneNumber(this)
        }).on("click", ".js-agent-phone-number-sms", function() {
            guruApp.fn.purchaseListingDetail("Send SMS (Property Detail)")
        }).on("click", ".js-agent-phone-number-whatsapp", function() {
            guruApp.fn.purchaseListingDetail("WhatsApp")
        })
    }
    )();
    (function() {
        if (!$body.is(".listing_detail")) {
            return
        }
        var toggleElementExpansion = function() {
            var $expansibleElement = $(this).closest(".expansible");
            $expansibleElement.toggleClass("compacted")
        };
        var $facilities = $("#facilities");
        $facilities.on("click", ".title", toggleElementExpansion);
        $facilities.on("click", ".tab", function() {
            var tabNumber = $(this).data("tab-number");
            var $cards = $facilities.find(".card");
            var $tabs = $facilities.find(".tabs .tab");
            $tabs.removeClass("active");
            $(this).addClass("active");
            $cards.removeClass("active");
            $cards.eq(tabNumber).addClass("active")
        });
        guruApp.fn.activatePriceEstimation = function() {
            var $priceEstimate = $("#price-estimate");
            $.ajax({
                url: $priceEstimate.data("url"),
                success: function(response) {
                    var lowFloorEstimate = response.lowFloor && response.lowFloor.prediction;
                    var highFloorEstimate = response.highFloor && response.highFloor.prediction;
                    if (!lowFloorEstimate && !highFloorEstimate) {
                        return
                    }
                    var estimation = {
                        currency: guruApp.currencySymbol,
                        lowEstimate: null,
                        highEstimate: null
                    };
                    var locale = COUNTRY_LOCALE[guruApp.country];
                    var options = {
                        maximumFractionDigits: 0
                    };
                    if (lowFloorEstimate > highFloorEstimate) {
                        estimation.lowEstimate = highFloorEstimate.toLocaleString(locale, options);
                        estimation.highEstimate = lowFloorEstimate.toLocaleString(locale, options)
                    } else if (lowFloorEstimate < highFloorEstimate) {
                        estimation.lowEstimate = lowFloorEstimate.toLocaleString(locale, options);
                        estimation.highEstimate = highFloorEstimate.toLocaleString(locale, options)
                    } else {
                        estimation.lowEstimate = lowFloorEstimate.toLocaleString(locale, options)
                    }
                    var template = Hogan.compile($priceEstimate.html());
                    $priceEstimate.replaceWith(template.render(estimation));
                    var $priceEstimateFeedback = $(".price-estimate-feedback");
                    var $priceEstimateHelper = $(".price-estimate-helper");
                    var $feedbackCollection = $priceEstimateFeedback.find(".feedback-collection");
                    var $ratingBox = $priceEstimateFeedback.find(".rating");
                    var $ratingStars = $ratingBox.find("i");
                    $priceEstimateHelper.on("click", ".helper-button", function() {
                        $priceEstimateHelper.toggleClass("open");
                        $priceEstimateFeedback.removeClass("hidden");
                        if ($priceEstimateHelper.is(".open")) {
                            $body.trigger("ga.listing.details.property-estimate.helper-opened")
                        }
                    });
                    $ratingBox.on("click", "i", function() {
                        var rating = $(this).index() + 1;
                        $ratingStars.slice(0, rating).addClass("pgicon-star").removeClass("pgicon-star-o");
                        $ratingStars.slice(rating).addClass("pgicon-star-o").removeClass("pgicon-star");
                        $feedbackCollection.removeClass("hidden");
                        $body.trigger("ga.listing.details.property-estimate.feedback-submitted", [rating, null])
                    });
                    $feedbackCollection.on("click", "button", function() {
                        $priceEstimateFeedback.outerHeight($priceEstimateFeedback.outerHeight());
                        $priceEstimateFeedback.children().addClass("hidden");
                        $priceEstimateFeedback.find(".feedback-acknowledgment").removeClass("hidden");
                        var rating = $ratingBox.find(".pgicon-star").length;
                        var feedback = $feedbackCollection.find(".feedback-text").val();
                        setTimeout(function() {
                            $priceEstimateFeedback.slideUp("slow")
                        }, 3e3);
                        $body.trigger("ga.listing.details.property-estimate.feedback-submitted", [rating, feedback])
                    })
                }
            })
        }
        ;
        if (guruApp.fn.getCurrentDevice() === "mobile") {
            $("#contact-agent").find(".agent-contact-details img").trigger("appear")
        }
        var openInAppDismissed = window.sessionStorage && window.sessionStorage.getItem("openInAppDismissed");
        var isAndroid = navigator.userAgent.match(/Android/i) !== null;
        if (guruApp.dynamicLinks && isAndroid && !openInAppDismissed) {
            var requestContent = {
                suffix: {
                    option: "SHORT"
                },
                dynamicLinkInfo: {
                    domainUriPrefix: guruApp.dynamicLinks.domainUriPrefix,
                    link: guruApp.dynamicLinks.url,
                    androidInfo: {
                        androidPackageName: guruApp.dynamicLinks.packageName
                    },
                    analyticsInfo: {
                        googlePlayAnalytics: guruApp.dynamicLinks.googlePlayAnalytics
                    },
                    navigationInfo: {
                        enableForcedRedirect: true
                    },
                    socialMetaTagInfo: guruApp.dynamicLinks.socialMetaInfo
                }
            };
            $.ajax({
                url: guruApp.dynamicLinks.shortlinkApi,
                type: "POST",
                data: JSON.stringify(requestContent),
                contentType: "application/json",
                dataType: "json",
                success: function(response) {
                    if (response.shortLink) {
                        var queryParams = response.shortLink.indexOf("?") < 0 ? "?" : "&";
                        queryParams += "utm_source=" + guruApp.dynamicLinks.googlePlayAnalytics["utmSource"];
                        queryParams += "&utm_medium=" + guruApp.dynamicLinks.googlePlayAnalytics["utmMedium"];
                        queryParams += "&utm_campaign=" + guruApp.dynamicLinks.googlePlayAnalytics["utmCampaign"];
                        var $dynamicLinksScriptElement = $("#dynamic-links");
                        var template = Hogan.compile($dynamicLinksScriptElement.html());
                        var $dynamicLinks = $(template.render({
                            url: response.shortLink + queryParams
                        }));
                        $dynamicLinksScriptElement.replaceWith($dynamicLinks);
                        $dynamicLinks.fadeIn();
                        $dynamicLinks.on("click", ".close-app-button", function() {
                            $(this).parent().fadeOut();
                            if (window.sessionStorage) {
                                window.sessionStorage.setItem("openInAppDismissed", "true")
                            }
                        })
                    }
                }
            })
        }
        var listingId = guruApp.listingDetail && guruApp.listingDetail.gaECData && guruApp.listingDetail.gaECData.id;
        if (window.localStorage && listingId) {
            var viewedListings = JSON.parse(window.localStorage.getItem("viewedListings"));
            if (Array.isArray(viewedListings)) {
                viewedListings = viewedListings.filter(function(viewedlistingId) {
                    return listingId !== viewedlistingId && viewedlistingId
                });
                if (viewedListings.length >= 15) {
                    viewedListings.shift()
                }
                viewedListings.push(listingId)
            } else {
                viewedListings = [listingId]
            }
            window.localStorage.setItem("viewedListings", JSON.stringify(viewedListings))
        }
        var openMortgageEnquiry = function(e) {
            if ($(this).prop("hash") == "#mortgage") {
                e.preventDefault();
                $("#mortgageEnquire").modal("show");
                var linkText = $.trim($(this).text());
                $body.trigger("ga.mortgageBank.openFlow", [linkText, "Price"])
            }
        };
        var storeEnquiryInLocalStorageIfNotPresent = function() {
            if (!localStorage.getItem("user-leads")) {
                var listing = {
                    type: guruApp.listingDetail.gaECData.category,
                    variant: guruApp.listingDetail.gaECData.variant,
                    name: guruApp.listingDetail.gaECData.name,
                    address: guruApp.sharingData.address,
                    price: guruApp.sharingData.price,
                    bathroomCount: guruApp.marketing.loopaautomate.Baths,
                    bedroomCount: guruApp.marketing.loopaautomate.Beds,
                    psf: guruApp.sharingData.area,
                    agentName: guruApp.ContactWidgetData.agentName,
                    id: guruApp.marketing.adwords.params.listing_id,
                    time: (new Date).getTime(),
                    image: $("#photos .carousel-inner.infinite .item:first-child img").attr("src"),
                    agentImage: $(".agent-photo-container .agent-photo img").attr("data-original"),
                    userId: guruApp.pgutid,
                    url: window.location.pathname
                };
                localStorage.setItem("user-leads", JSON.stringify([listing]))
            }
        };
        $body.find(".listing-detail-summary-bar-price").on("click", ".listing-mortgage a", openMortgageEnquiry);
        $('#price-insights-widget [data-type="mortgage"]').on("click", ".calculator-link", openMortgageEnquiry);
        $body.find(".js-agent-phone-number-whatsapp").on("click", storeEnquiryInLocalStorageIfNotPresent);
        if (document.location.hash == "#mortgage") {
            $("#mortgageEnquire").modal("show")
        }
        var $listingDetailText = $(".listing-details-text");
        if ($listingDetailText.height() > 200) {
            $listingDetailText.addClass("compacted").find(".show-more").on("click", function(e) {
                e.preventDefault();
                $listingDetailText.toggleClass("compacted");
                EventDispatcher.dispatch("height.changed");
                $listingDetailText.trigger("ga.listing.details.show-click");
                guruApp.fn.addListingDetailToCart("ReadMore on listing description");
                return false
            });
            $listingDetailText.trigger("ga.listing.details.show");
            EventDispatcher.dispatch("height.changed")
        }
    }
    )();
    (function() {
        if (!$body.is(".agent-home") && !$body.is(".landing-condo") && !$body.is(".listing-condo")) {
            return
        }
        var $maxHeight = 0;
        var $bodyWidth = $("body").width();
        if ($bodyWidth == 768) {
            $maxHeight = 176
        } else if ($bodyWidth == 320 || $bodyWidth == 375) {
            $maxHeight = 230
        }
        if ($(".geographic-area").length > 0) {
            var $areaBox = $(".geographic-area");
            var $areaBrowseBox = $(".geographic-area-browse");
            if ($maxHeight > 0) {
                if ($areaBrowseBox.height() > $maxHeight) {
                    $areaBrowseBox.css("height", $maxHeight);
                    $areaBox.addClass("compacted").children(".show-more").on("click", function(e) {
                        e.preventDefault();
                        $areaBox.toggleClass("compacted");
                        $areaBrowseBox.css("height", "");
                        if ($("a.a-show-more").length) {
                            $("a.a-show-more").click();
                            $(".geographic-area img.lazy-bg").trigger("appear")
                        }
                        return false
                    })
                }
            }
        }
        if ($("a.a-show-more").length > 0) {
            $("a.a-show-more").on("click", function(e) {
                e.preventDefault();
                $(".more-regions").show();
                $(".right-geographic .a-show-more").replaceWith($(".more-regions a.browse-img-box").eq(0));
                $(".more-regions .right-col-geographic-area").eq(0).remove();
                $(".more-regions img.lazy-bg").trigger("appear")
            })
        }
        if ($("a.show-more-area").length > 0) {
            var show_more_toggle = 0;
            var icon_html = "";
            $("a.show-more-area").on("click", function(e) {
                e.preventDefault();
                if (show_more_toggle == 0) {
                    icon_html = '<span class="pgpicon pgicon-arrow-up"></span> '
                } else {
                    icon_html = '<span class="pgpicon pgicon-arrow-down"></span> '
                }
                var showMoreText = icon_html + $(this).data("showmore");
                var showLessText = icon_html + $(this).data("showless");
                if (show_more_toggle == 0) {
                    show_more_toggle = 1;
                    $(".more-regions").show();
                    $(".more-regions img.lazy-bg").trigger("appear");
                    $(this).html(showLessText)
                } else {
                    show_more_toggle = 0;
                    $(".more-regions").hide();
                    $(this).html(showMoreText)
                }
            })
        }
        if ($(".question-answer").length > 0) {
            $(".question-answer").each(function(index) {
                var $box = $(this);
                var $height = $box.height();
                if ($height > 70) {
                    $box.addClass("compacted").children(".show-more").on("click", function(e) {
                        e.preventDefault();
                        $box.toggleClass("compacted");
                        return false
                    })
                }
            })
        }
    }
    )();
    $body.on("shown.bs.collapse hidden.bs.collapse", ".collapse-xs", function(e) {
        EventDispatcher.dispatch("height.changed");
        $(window).trigger("scroll")
    });
    $(".iframe_embed_top_bar a.js-back").on("click", function(e) {
        if (window.history.length > 0) {
            window.history.go(-1);
            e.stopPropagation();
            return false
        }
    });
    (function() {
        if (!$body.is(".agent-details")) {
            return
        }
        var $agentProfileDescription = $(".agent-details-description");
        if ($agentProfileDescription.height() > 200) {
            $agentProfileDescription.addClass("compacted").children(".show-more-description").on("click", function(e) {
                e.preventDefault();
                $agentProfileDescription.toggleClass("compacted");
                EventDispatcher.dispatch("height.changed");
                return false
            });
            EventDispatcher.dispatch("height.changed")
        }
        var $agentServices = $(".agent-services-block").children(".list-checked");
        if ($agentServices.height() > 150) {
            $agentServices.addClass("compacted");
            $agentServices.children("li:last").children(".show-more-services").on("click", function(e) {
                e.preventDefault();
                $agentServices.toggleClass("compacted");
                $agentServices.children("li:last").hide();
                EventDispatcher.dispatch("height.changed");
                return false
            });
            EventDispatcher.dispatch("height.changed")
        }
        var $agentRegions = $(".agent-regions-block").children(".list-checked");
        if ($agentRegions.height() > 150) {
            $agentRegions.addClass("compacted");
            $agentRegions.children("li:last").children(".show-more-regions").on("click", function(e) {
                e.preventDefault();
                $agentRegions.toggleClass("compacted");
                $agentRegions.children("li:last").hide();
                EventDispatcher.dispatch("height.changed");
                return false
            });
            EventDispatcher.dispatch("height.changed")
        }
        var $agentProperties = $(".agent-properties-block").children(".list-checked");
        if ($agentProperties.height() > 150) {
            $agentProperties.addClass("compacted");
            $agentProperties.children("li:last").children(".show-more-properties").on("click", function(e) {
                e.preventDefault();
                $agentProperties.toggleClass("compacted");
                $agentProperties.children("li:last").hide();
                EventDispatcher.dispatch("height.changed");
                return false
            });
            EventDispatcher.dispatch("height.changed")
        }
        $(".js-agent-details-phone-number-call").on("click", function(e) {
            e.preventDefault();
            $(this).addClass("active");
            $(this).find(".agent-details-phone-number").removeClass("hide").show();
            $(this).find("i, .phone-label").hide()
        })
    }
    )();
    (function() {
        if (!$body.is(".listing-condo-price-insights")) {
            return
        }
        var $priceInsightsSummaryText = $(".price-insights-summary-text");
        if ($priceInsightsSummaryText.height() > 60) {
            $priceInsightsSummaryText.addClass("compacted").children(".show-more").on("click", function(e) {
                e.preventDefault();
                $priceInsightsSummaryText.toggleClass("compacted");
                return false
            })
        }
    }
    )();
    (function() {
        if (!$body.is(".territory")) {
            return
        }
        var $content = $(".overview-content");
        if ($content.height() > 325) {
            $content.addClass("compacted").children(".show-more").on("click", function(e) {
                e.preventDefault();
                $content.toggleClass("compacted");
                return false
            })
        }
    }
    )();
    (function() {
        var $stickyContainer = $("#sticky-right-col")
          , $stickyParent = $stickyContainer.closest(".sticky-container-parent")
          , isSticked = false
          , $window = $(window);
        if (!$stickyContainer.length) {
            return
        }
        function calculateStickyPosition() {
            var distanceFromTop = Math.round($stickyParent.offset().top)
              , parentHeight = $stickyParent.outerHeight()
              , selfHeight = $stickyContainer.outerHeight()
              , scrollTop = $window.scrollTop()
              , stickyTime = scrollTop >= distanceFromTop - 30
              , scrollingSpace = parentHeight - selfHeight;
            if (scrollingSpace < 100) {
                if (isSticked) {
                    $stickyContainer.removeClass("sticky-container-top").removeClass("sticky-container-bottom");
                    isSticked = false
                }
                return
            }
            if (stickyTime) {
                var bottomLimit = distanceFromTop + (parentHeight - selfHeight - 49);
                if (scrollTop >= bottomLimit) {
                    $stickyContainer.addClass("sticky-container-bottom").removeClass("sticky-container-top")
                } else {
                    $stickyContainer.addClass("sticky-container-top").removeClass("sticky-container-bottom")
                }
                isSticked = true
            } else if (!stickyTime && isSticked) {
                $stickyContainer.removeClass("sticky-container-top").removeClass("sticky-container-bottom");
                isSticked = false
            }
        }
        $window.on("scroll", calculateStickyPosition);
        $window.on("resize", calculateStickyPosition);
        calculateStickyPosition()
    }
    )();
    (function() {
        if (!$body.is(".agent-details")) {
            return
        }
        $(".js-contact-form").on("submit", function() {
            $body.trigger("ga.agent.enquire.intent")
        }).on("submitDone", function() {
            $body.trigger("ga.agent.enquire.success")
        })
    }
    )();
    (function() {
        if (!$(".listing_detail").length)
            return;
        var $areainsider = $(".listing-areainsider");
        $areainsider.find("a").click(function() {
            $body.trigger("ga.listing.details.areainsider.engage", [$areainsider.data("area"), $areainsider.text().trim()])
        });
        if ($areainsider.length) {
            var handler = setInterval(function() {
                if (ga) {
                    $body.trigger("ga.listing.details.areainsider.impress", [$areainsider.data("area"), $areainsider.text().trim()]);
                    clearInterval(handler)
                }
            }, 100)
        }
        var $fbButton = $(".contact-form-side > form > fieldset .form-group #fb-button")
          , $body = $("body")
          , $window = $(window);
        if ($fbButton.length) {
            var $wrapperInner = $("#wrapper-inner");
            var onScroll = null;
            var isMobile = guruApp.fn.getCurrentDevice() === "mobile";
            var showFBButton = function() {
                $body.trigger("ga.listing.continue-with-fb.visible");
                if (isMobile) {
                    $wrapperInner.off("scroll.fbButton", onScroll)
                } else {
                    $window.off("scroll.fbButton", onScroll)
                }
            };
            $window.on("fbButton.show", showFBButton);
            if (isMobile) {
                onScroll = function() {
                    var showTime = Math.round($fbButton.offset().top) < $window.height();
                    if (showTime) {
                        $window.trigger("fbButton.show")
                    }
                }
                ;
                $wrapperInner.on("scroll.fbButton", onScroll);
                onScroll()
            } else {
                onScroll = function() {
                    var showTime = $window.scrollTop() > Math.round($fbButton.offset().top) - $window.height();
                    if (showTime) {
                        $window.trigger("fbButton.show")
                    }
                }
                ;
                $window.on("scroll.fbButton", onScroll);
                onScroll()
            }
        }
    }
    )();
    (function() {
        $('label[for="communicationUs"]').click(function(evt) {
            if (evt.target.tagName !== "INPUT") {
                var $checkbox = $(this).find("#communicationUs");
                $checkbox.prop("checked", !$checkbox.is(":checked"));
                evt.preventDefault()
            }
        })
    }
    )();
    (function() {
        if (!$(".listing").length)
            return;
        var $areainsider = $(".areainsider-box .list-group-item");
        $areainsider.find("a").click(function() {
            $body.trigger("ga.listing.search-result.areainsider.engage.rightside", [$areainsider.data("area"), $areainsider.find(".list-group-item-text").text().trim()])
        });
        if ($areainsider.length) {
            var handler = setInterval(function() {
                if (ga) {
                    $body.trigger("ga.listing.search-result.areainsider.impress.rightside", [$areainsider.data("area"), $areainsider.find(".list-group-item-text").text().trim()]);
                    clearInterval(handler)
                }
            }, 100)
        }
        var $areainsiderBottomBox = $("#areainsider-entry-point-bottom");
        if ($areainsiderBottomBox.length) {
            var title = $areainsiderBottomBox.find("h4").text().trim();
            var page = $(".pagination .active").text();
            $areainsiderBottomBox.find("a").click(function() {
                var area = $(this).text();
                $body.trigger("ga.listing.search-result.areainsider.engage.top", [area, title, page])
            });
            if ($areainsiderBottomBox.length) {
                var handler = setInterval(function() {
                    if (ga) {
                        var areas = $areainsiderBottomBox.find("li").map(function() {
                            return $(this).text()
                        }).get().join(",");
                        $body.trigger("ga.listing.search-result.areainsider.impress.top", [areas, title, page]);
                        clearInterval(handler)
                    }
                }, 100)
            }
        }
    }
    )();
    if ($(".modal-user-box").length !== 0) {
        var modalRemoveErrorMsgs = function() {
            $(".modal-user-box").on("hidden.bs.modal", function() {
                var $modalDialog = $(".modal-dialog");
                $modalDialog.find(".form-group").removeClass("has-error");
                $modalDialog.find(".alert").removeClass("show").addClass("hide");
                $modalDialog.find("input").val("")
            })
        };
        modalRemoveErrorMsgs();
        $(".openModalLink").on("click", function(e) {
            e.preventDefault();
            var targetModal = $(this).attr("data-target")
              , $activeModalBox = $(".modal-user-box:visible")
              , activeModalBoxID = $activeModalBox.attr("id");
            $("#" + activeModalBoxID).modal("toggle");
            $(targetModal).modal("toggle")
        })
    }
    var acceptCookies = localStorage.getItem("accept-cookies");
    if (!acceptCookies) {
        manageAcceptCookies.init()
    }
    $body.find(".dropdown .dropdown-menu li.mainnav-areainsider").click(function() {
        $body.trigger("ga.mainnav.areainsider.click")
    });
    $("#footer-sitemap .footer-sitemap-summary .view-more").on("click", function(event) {
        $(event.currentTarget).addClass("hidden");
        $(event.currentTarget).siblings().removeClass("hidden");
        $("#footer-sitemap .footer-sitemap-summary .row").removeClass("hidden")
    });
    $("#footer-sitemap-links div[role=tabpanel] li.view-more").on("click", function(event) {
        $(event.currentTarget).addClass("hidden");
        $(event.currentTarget).siblings().removeClass("more-item-hidden")
    });
    if ($body.is(".home_askguru") && ($body.is(".app-my") || $body.is(".app-id"))) {
        var url = new URL(window.location.href);
        var question = url.searchParams.get("question");
        if (question !== null && question !== undefined) {
            if (guruApp.user_id === null) {
                var redirectUrl = "/login?w=1&redirect=" + encodeURI(window.location.href).replace(/#/g, "%23");
                window.location = redirectUrl
            } else {
                var $questionText = $("#question_form_content_text");
                $questionText.text(question);
                $("#popup_question").modal()
            }
        }
    }
    (function() {
        var $priceInsightsWidget = $("#price-insights-widget");
        if (!guruApp.widgetPriceInsightsJsUrl || !$priceInsightsWidget.length) {
            return false
        }
        var options = {
            dataType: "script",
            url: guruApp.widgetPriceInsightsJsUrl,
            cache: true
        };
        $.ajax(options)
    }
    )();
    guruApp.enableRecentSearch = function() {
        var areaInsiderBottomBox = $("#areainsider-entry-point-bottom");
        var areaInsiderRecentSearches = $("#recent-searches");
        if (!areaInsiderRecentSearches.length) {
            return
        }
        guruApp.isRecentSearchEnable = true;
        areaInsiderBottomBox.length && areaInsiderBottomBox.hide();
        areaInsiderRecentSearches.show();
        showRecentSearches();
        function showRecentSearches() {
            if (!guruApp.recentSearchesData) {
                return
            }
            areaInsiderRecentSearches.html(renderRecentSearches(guruApp.recentSearchesData))
        }
        function renderRecentSearches(searches) {
            var resultHTML = '<h5><i class="pgicon pgicon-clock-o"></i> Recent Searches</h5>';
            searches.map(function(search) {
                resultHTML += renderRecentSearchBlock(search.url, search.lines, search.titles)
            });
            return resultHTML
        }
        function renderRecentSearchBlock(url, values, titles) {
            var separator = values[1] && values[1].separator || " &bull; ";
            var title = createSearchTextLine(values[0] ? values[0].line : [], separator);
            var propTypeSearch = createSearchTextLine(values[1] ? values[1].line : [], separator);
            var bedroomSearch = createSearchTextLine(values[2] ? values[2].line : [], separator);
            var tooltip = title + (propTypeSearch ? separator + propTypeSearch : "") + (bedroomSearch ? separator + bedroomSearch : "");
            return '<div title="' + tooltip + '" class="search-block col-xs-4"><div><a href="'.concat(url, '"></a><p class="search-text">').concat(title, "<br></p><p>").concat(propTypeSearch, "<br></p><p>").concat(bedroomSearch, "<br></p>").concat("</div></div>")
        }
        function createSearchTextLine(line, separator) {
            var text = "";
            for (var i = 0; i < line.length; i++) {
                var appendText = line[i].last ? line[i].text + " " : line[i].text + separator;
                text += appendText
            }
            return text
        }
    }
    ;
    function displayUnitTypeView(id, title) {
        $(".unit-types .card").removeClass("active");
        $('.unit-types a[data-unit-type-id="' + id + '"]').parent().addClass("active");
        showMediaGallery(id);
        displayTitle(title);
        displayUnitTypeDetails(id);
        modifySharingWidget(id);
        modifyShareEmailWidget(id);
        modifyShareSMSWidget(id);
        updateContactMessages(id)
    }
    $(".sharing-widget-js-sms").on("click", function() {
        $("#shareListingSMS").on("loaded.bs.modal", function(e) {
            var id = $(".unit-types .card.active a").data("unit-type-id");
            modifyShareSMSWidget(id)
        })
    });
    function modifyShareSMSWidget(id) {
        $(window).trigger("modifyShareSMSWidget", id)
    }
    function modifyShareEmailWidget(id) {
        if (!id) {
            return
        }
        var $shareListingEmail = $("#shareListingEmail");
        if (!$shareListingEmail.data("original-url")) {
            $shareListingEmail.data("original-url", $shareListingEmail.find('input[name="url"]').val())
        }
        var url = $shareListingEmail.data("original-url");
        var utmInfo = "";
        if (guruApp && guruApp.listingDetail) {
            if (url.indexOf("?") > -1) {
                utmInfo = "&utm_source=share&utm_medium=ldp&utm_campaign=email"
            } else {
                utmInfo = "?utm_source=share&utm_medium=ldp&utm_campaign=email"
            }
        }
        var newUrl = url + utmInfo + "#" + id;
        if (!$shareListingEmail.find('form input[name="unitId"]').length) {
            $shareListingEmail.find("form").append('<input type="hidden" name="unitId" value="' + id + '" />')
        }
        $shareListingEmail.find('input[name="url"]').val(newUrl);
        $shareListingEmail.find(".fake-input").find("a").attr("href", newUrl).text(newUrl);
        var $selectedUnitType = $('.unit-types a[data-unit-type-id="' + id + '"]');
        var $bedroom = $shareListingEmail.find(".bedroom");
        var $bathroom = $shareListingEmail.find(".bathroom");
        var newBathValue = $selectedUnitType.find(".bath").text();
        var newBedValue = $selectedUnitType.find(".bed").text();
        if ($bedroom.length) {
            $bedroom.text($bedroom.text().replace(/\d+/g, newBedValue))
        }
        if (!$bathroom.text() && newBathValue) {
            $bathroom.text(newBathValue + " Bath")
        } else {
            $bathroom.text($bathroom.text().replace(/\d+/g, newBathValue))
        }
    }
    function modifySharingWidget(id) {
        function modifyUrl($shareWidgetSocialItems) {
            $shareWidgetSocialItems.data("raw-url", window.location.href);
            if (!$shareWidgetSocialItems.data("original-url")) {
                $shareWidgetSocialItems.data("original-url", $shareWidgetSocialItems.attr("href"))
            }
            var url = $shareWidgetSocialItems.data("original-url");
            url += encodeURIComponent("#" + id);
            $shareWidgetSocialItems.attr("href", url)
        }
        var $shareWidgetSocialItems = $(".sharing-widget .btn-facebook-messenger-js, .sharing-widget .btn-facebook-share, .sharing-widget .btn-twitter, .sharing-widget .sharing-widget-js-link");
        $shareWidgetSocialItems.each(function() {
            modifyUrl($(this))
        })
    }
    function displayTitle(title) {
        $(".listing-detail-header-bar h2 span").text(title || "")
    }
    function displayUnitTypeDetails(id) {
        if (guruApp.listingDetail.unitTypesDetails && guruApp.listingDetail.unitTypesDetails[id]) {
            var unitTypesDetails = guruApp.listingDetail.unitTypesDetails[id];
            var $listingDetailPrimaryBox = $(".listing-details-primary .row > div");
            if (unitTypesDetails.completionYear.value) {
                $listingDetailPrimaryBox.find(".completion-year").removeClass("text-light-muted").find(".value-block").text(unitTypesDetails.completionYear.value)
            } else {
                $listingDetailPrimaryBox.find(".completion-year").addClass("text-light-muted").find(".value-block").text("N/A")
            }
            if (unitTypesDetails.floor.value) {
                $listingDetailPrimaryBox.find(".floor-level").removeClass("text-light-muted").find(".value-block").text(unitTypesDetails.floor.value)
            } else {
                $listingDetailPrimaryBox.find(".floor-level").addClass("text-light-muted").find(".value-block").text("N/A")
            }
            if (unitTypesDetails.furnishing.value) {
                $listingDetailPrimaryBox.find(".furnishing").removeClass("text-light-muted").find(".value-block").text(unitTypesDetails.furnishing.value)
            } else {
                $listingDetailPrimaryBox.find(".furnishing").addClass("text-light-muted").find(".value-block").text("N/A")
            }
            var $selectUnitType = $('.unit-types a[data-unit-type-id="' + id + '"]');
            $listingDetailPrimaryBox.find(".floor-area .value-block").text($selectUnitType.find(".area").text());
            var psfValue = $selectUnitType.find(".per-square-feet-price").text();
            if (psfValue) {
                $listingDetailPrimaryBox.find(".price-per-area").removeClass("text-light-muted").find(".value-block").text(psfValue)
            } else {
                $listingDetailPrimaryBox.find(".price-per-area").addClass("text-light-muted").find(".value-block").text("N/A")
            }
        }
    }
    function updateContactMessages(id) {
        var $contactForm = $(".js-contact-form");
        var message;
        if (id && guruApp.ContactWidgetData.unitTypeMessages && guruApp.ContactWidgetData.unitTypeMessages[id]) {
            message = guruApp.ContactWidgetData.unitTypeMessages[id]
        } else {
            message = guruApp.ContactWidgetData.listingMessage
        }
        $contactForm.find("input[name=message]").val(message);
        var $whatsAppLink = $contactForm.find(".js-agent-phone-number-whatsapp");
        var whatsAppUrl = $whatsAppLink.attr("href");
        if (whatsAppUrl && whatsAppUrl.indexOf("text=") > 0) {
            var unitTypeMessage = encodeURIComponent(message);
            var whatsappUrlArr = whatsAppUrl.split("text=");
            whatsAppUrl = whatsappUrlArr[0] + "text=" + unitTypeMessage;
            $whatsAppLink.attr("href", whatsAppUrl)
        }
    }
    function showMediaGallery(id) {
        if (guruApp.listingDetail.mediaGalleryHTML && guruApp.listingDetail.mediaGalleryHTML[id]) {
            $("#photosvideos").fadeTo("slow", 0, function() {
                $("#photosvideos").off().remove();
                var $html = $(guruApp.listingDetail.mediaGalleryHTML[id]);
                $html.hide();
                $(".listing-detail-header-bar").after($html);
                $html.fadeIn("slow");
                initializeCrousel()
            })
        }
    }
    if (guruApp.listingDetail) {
        function scrollElementToPosition($selectedElement) {
            var leftPosition = $selectedElement.position().left;
            var gutter = 20;
            var unitTypeCardWidth = 300;
            if (leftPosition > $(".unit-types").innerWidth() - unitTypeCardWidth) {
                leftPosition = leftPosition - gutter;
                $(".unit-types .cards").animate({
                    scrollLeft: leftPosition
                })
            }
        }
        function showDefaultUnitType() {
            var $firstUnitType = $(".unit-types a").first();
            if ($firstUnitType.length) {
                var id = $firstUnitType.data("unit-type-id");
                var title = $firstUnitType.data("title");
                displayUnitTypeView(id, title);
                if (guruApp.listingDetail) {
                    guruApp.listingDetail.selectedUnitTypeId = $firstUnitType.data("unit-type-id")
                }
            } else {
                updateContactMessages()
            }
        }
        $(".unit-types a").off("click").on("click", function(e) {
            e.preventDefault();
            var id = $(e.currentTarget).data("unit-type-id");
            var title = $(e.currentTarget).data("title");
            window.history.replaceState(undefined, undefined, "#" + id);
            displayUnitTypeView(id, title);
            if (guruApp.listingDetail) {
                guruApp.listingDetail.selectedUnitTypeId = id
            }
        });
        $(document).ready(function() {
            if (window.location.hash) {
                var id = window.location.hash.replace("#", "");
                var $selectedElement = $('.unit-types a[data-unit-type-id="' + id + '"]');
                if ($selectedElement.length) {
                    if (guruApp.listingDetail) {
                        guruApp.listingDetail.selectedUnitTypeId = id
                    }
                    var title = $selectedElement.data("title");
                    displayUnitTypeView(id, title);
                    scrollElementToPosition($selectedElement);
                    updateContactMessages(id)
                } else {
                    showDefaultUnitType()
                }
            } else {
                showDefaultUnitType()
            }
        })
    }
});
$(document).ready(function() {
    var $carousels = $(".carousel");
    if (!$carousels.length) {
        return
    }
    var triggerCarouselAppear = function() {
        var $carousel = $(this)
          , $active = $carousel.find(".carousel-inner .item.active");
        $active.add($active.next()).add($active.prev()).find("img.lazy").trigger("appear")
    };
    for (var i = 0; i < $carousels.length; i++) {
        var $carousel = $($carousels[i]);
        $carousel.on("slid.bs.carousel", triggerCarouselAppear).one("appear", triggerCarouselAppear)
    }
});
(function($) {
    "use strict";
    var facebookInitialized = false;
    var facebookPixelInitialized = false;
    function initFacebookPixel(pixelId) {
        guruApp.Logger.log("Facebook Pixel: Loading " + pixelId);
        !function(f, b, e, v, n, t, s) {
            if (f.fbq)
                return;
            n = f.fbq = function() {
                n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            }
            ;
            if (!f._fbq)
                f._fbq = n;
            n.push = n;
            n.loaded = !0;
            n.version = "2.0";
            n.queue = [];
            t = b.createElement(e);
            t.async = !0;
            t.src = v;
            s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, "script", "//connect.facebook.net/en_US/fbevents.js");
        fbq("init", pixelId);
        guruApp.fbPixel = new FbPixel(fbq);
        if (!guruApp.fbPixel.isPixelLoaded) {
            guruApp.fbPixel.start()
        } else {
            guruApp.Logger.log("Facebook Pixel: Already initialized; skipping")
        }
        facebookPixelInitialized = true;
        guruApp.Logger.log("Facebook Pixel: Done loading " + pixelId);
        guruApp.fbPixel.trackPageView()
    }
    function initFacebook() {
        guruApp.Logger.log("Facebook SDK: Initializing...");
        if (facebookInitialized) {
            guruApp.Logger.log("Facebook SDK: Already initialized; skipping");
            return
        }
        facebookInitialized = true;
        (function(d, s, id) {
            var _fbq = window._fbq || (window._fbq = []);
            if (!_fbq.loaded) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) {
                    return
                }
                js = d.createElement(s);
                js.id = id;
                js.src = "https://connect.facebook.net/en_US/sdk.js";
                js.defer = true;
                js.async = true;
                fjs.parentNode.insertBefore(js, fjs)
            }
            _fbq.loaded = true;
            window._fbq = _fbq || []
        }
        )(document, "script", "facebook-jssdk");
        guruApp.Logger.log("Facebook SDK: Initialized")
    }
    $(document).ready(function() {
        if (guruApp.facebook) {
            initFacebook();
            window.fbAsyncInit = function() {
                FB.init({
                    appId: guruApp.facebook.appId,
                    xfbml: true,
                    version: "v3.2",
                    cookie: true
                })
            }
        }
    });
    $(window).on("load", function() {
        (function() {
            if (typeof SmartBanner === "undefined") {
                return
            }
            if (window.sessionStorage) {
                try {
                    var pageViews = parseInt(window.sessionStorage.getItem("pageViewCount"), 10) || 0;
                    if (pageViews < 3) {
                        return
                    }
                } catch (e) {}
            }
            new SmartBanner({
                daysHidden: 15,
                daysReminder: 90,
                appStoreLanguage: guruApp.smartBanner.appStoreLanguage,
                title: guruApp.smartBanner.title,
                author: guruApp.smartBanner.author,
                button: guruApp.smartBanner.button,
                store: {
                    ios: guruApp.smartBanner.store_ios,
                    android: guruApp.smartBanner.store_android
                },
                price: {
                    ios: guruApp.smartBanner.price,
                    android: guruApp.smartBanner.price
                }
            });
            $("body").trigger("smartbanner.viewed");
            if (guruApp.smartBanner.getMobileUrl) {
                var $smartBanner = $("body > .smartbanner")
                  , link = null;
                if ($smartBanner.is(".smartbanner-android")) {
                    link = guruApp.smartBanner.getMobileUrl.smartbanner.android
                } else if ($smartBanner.is(".smartbanner-ios")) {
                    link = guruApp.smartBanner.getMobileUrl.ios
                }
                if (link) {
                    $smartBanner.find(".smartbanner-button").attr("href", link)
                }
            }
        }
        )();
        (function() {
            if (guruApp.marketing && guruApp.marketing.facebookPixelId) {
                initFacebook();
                guruApp.Logger.log("Trying to load Facebook Pixel");
                if (!facebookPixelInitialized) {
                    guruApp.Logger.log("Initialize Facebook Pixel");
                    initFacebookPixel(guruApp.marketing.facebookPixelId)
                } else {
                    guruApp.Logger.log("No marketing configuration enabled. Using GTM to load Facebook Pixel instead.")
                }
            }
        }
        )();
        if (guruApp.marketing && guruApp.marketing.twitterTrackEnabled) {
            jQuery.getScript("//platform.twitter.com/oct.js", function() {
                window.twttr.conversion.trackPid(guruApp.marketing.twitterTrackPid)
            })
        }
        if (guruApp.marketing && guruApp.marketing.adwords && guruApp.marketing.adwords.params) {
            jQuery.getScript("https://www.googleadservices.com/pagead/conversion_async.js", function() {
                window.google_trackConversion({
                    google_conversion_id: guruApp.marketing.adwords.conversionId,
                    google_custom_params: guruApp.marketing.adwords.params,
                    google_remarketing_only: true
                })
            })
        }
        if (guruApp.marketing && guruApp.marketing.bounceExchangeId) {
            jQuery.getScript("//tag.bounceexchange.com/" + guruApp.marketing.bounceExchangeId + "/i.js")
        }
        var pageType = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getPageType();
        if (guruApp.marketing && guruApp.marketing.survicate && guruApp.survicateAllowedPages.indexOf(pageType) != -1) {
            (function(w) {
                w["_sv"] = {
                    trackingCode: guruApp.marketing.survicate
                };
                var s = document.createElement("script");
                s.src = "//api.survicate.com/assets/survicate.js";
                s.async = true;
                s.type = "text/javascript";
                var e = document.getElementsByTagName("script")[0];
                e.parentNode.insertBefore(s, e)
            }
            )(window)
        }
        if (guruApp.marketing && guruApp.marketing.loopaautomate) {
            (function(w) {
                var trackerUrl = guruApp.marketing.loopaautomate.trackerUrl;
                delete guruApp.marketing.loopaautomate.trackerUrl;
                w.loopaData = guruApp.marketing.loopaautomate;
                var s = document.createElement("script");
                s.src = trackerUrl;
                s.async = true;
                s.type = "text/javascript";
                var e = document.getElementsByTagName("script")[0];
                e.parentNode.insertBefore(s, e)
            }
            )(window)
        }
    })
}
)(jQuery);
$(document).ready(function() {
    if (guruApp.listingDetail && guruApp.listingDetail.showCommuteTime) {
        guruApp.libs.injectAssets({
            url: guruApp.commuteComponentUrl,
            onLoad: function() {
                window.initCommuteComponent = function() {
                    var latitude = $("#map-canvas").data("latitude");
                    var longitude = $("#map-canvas").data("longitude");
                    new guruApp.component.commute({
                        seeMore: '<a class="see-more" href="#"><i class="pgicon pgicon-arrow-down"></i>See More</a>',
                        location: "Top Widget",
                        parent: $(".commute-time-top"),
                        templateWithNoRecords: guruApp.templates.commuteNoRecordsTop,
                        templateWithRecords: guruApp.templates.commuteWithRecords,
                        addButtonTemplate: guruApp.templates.commuteAddRecords,
                        cardsTemplate: guruApp.templates.commuteCardsTopPosition,
                        modalTemplate: guruApp.templates.commuteModal,
                        propertyLatitude: latitude,
                        propertyLongitude: longitude
                    });
                    new guruApp.component.commute({
                        seeMore: '<a class="see-more" href="#"><i class="pgicon pgicon-arrow-down"></i>See More</a>',
                        location: "Bottom Widget",
                        parent: $(".commute-time-bottom"),
                        templateWithNoRecords: guruApp.templates.commuteNoRecords,
                        templateWithRecords: guruApp.templates.commuteWithRecords,
                        addButtonTemplate: guruApp.templates.commuteAddRecords,
                        cardsTemplate: guruApp.templates.commuteCards,
                        modalTemplate: guruApp.templates.commuteModal,
                        propertyLatitude: latitude,
                        propertyLongitude: longitude
                    })
                }
                ;
                $.guruMap().injectGoogleMapsScript("initCommuteComponent")
            }
        })
    }
    addBeforePrintEvent(function() {
        $("body").trigger("ga.print.system")
    });
    initPGPopovers();
    var hash = window.location.hash;
    switch (hash) {
    case "#forgot-password":
        $("#modal-forgot-password").on("event.created", function() {
            $("#modal-forgot-password").modal("show")
        });
        break;
    case "#signup":
        $("#modal-login-nav").on("event.created", function() {
            $("#modal-signup").modal("show")
        });
        break;
    case "#login":
        $("#modal-login-nav").on("event.created", function() {
            $("#modal-login").modal("show")
        });
        break
    }
    function filterChanges() {
        if ($(".filter").is(":visible")) {
            $(".searchbox-container").append('<section id="filter" class="modal fade" role="dialog">' + '<div class="modal-dialog">' + '<div class="modal-content">' + '<div class="modal-header">' + '<h5 class="modal-title">' + guruApp.listingSearch.searchBy + "</h5>" + '<button type="button" class="close pgicon pgicon-cancel" data-dismiss="modal" aria-hidden="true" title="Close"></button>' + "</div>" + '<div class="modal-body"></div>' + '<div class="modal-footer"></div>' + "</div>" + "</div>" + "</section>");
            $(".searchbox-container .modal-body").append($(".searchbox-container form"));
            $(".searchbox-container > form").remove();
            if (!$(".searchbox-container .modal-footer").find(".expanded-submit-group").length) {
                $(".searchbox-container .modal-footer").html($(".expanded-submit-group"))
            }
            $(".searchbox-container .modal-body .expanded-submit-group").remove();
            $(".searchbox-container .expanded-submit-group .btn-submit").off("click").on("click", function(e) {
                e.preventDefault();
                $(".searchbox-container .modal-body form").trigger("submit")
            });
            $(".searchbox-container .expanded-submit-group .btn-reset").off("click").on("click", function(e) {
                e.preventDefault();
                $(window).trigger("resetSearchForm")
            });
            $(".filter-by").off("click").on("click", function() {
                $("#filter").modal()
            });
            $("#filter").off("shown.bs.modal").on("shown.bs.modal", function(e) {
                $("#filter .search-expanded").show()
            });
            $(".nav-search .pgicon-search").on("click", function(e) {
                e.preventDefault();
                $("#filter").modal()
            });
            $(".sort-by > span:first-child").off("click.increaseTapArea").on("click.increaseTapArea", function(e) {
                e.stopPropagation();
                $(this).parent().find(".sort-dropdown button").trigger("click")
            })
        } else {
            $(".sort-by > span:first-child").off("click.increaseTapArea");
            $(".searchbox-container").append($(".searchbox-container .modal-body form"));
            $(".search-expanded-wrapper .search-expanded").append($(".searchbox-container .modal-footer .expanded-submit-group"));
            $(".filter-by").off("click");
            $("#filter").off("shown.bs.modal");
            $("#filter").remove()
        }
    }
    filterChanges();
    (function(guruApp) {
        if (guruApp.listingSearch && $(".filter").length) {
            var lastScrollTop = 0;
            var $filterElement = $(".filter");
            var headerHeight = $(".header-nav").height();
            var $window = $(window);
            var filterOuterHeight = $filterElement.outerHeight(true);
            $filterElement.after('<div class="fake-filter" style="display: none; height: ' + filterOuterHeight + 'px">&nbsp;</div>');
            var startScrollTopPosition = $filterElement.offset().top;
            var $fakeElement = $filterElement.parent().find(".fake-filter");
            var windowWidth = window.innerWidth;
            $window.on("resize", function() {
                if (windowWidth < 768 && window.innerWidth >= 768 || windowWidth >= 768 && window.innerWidth < 768) {
                    windowWidth = window.innerWidth;
                    filterChanges(windowWidth)
                }
            });
            $window.on("scroll", function() {
                var st = $window.scrollTop();
                if (st > startScrollTopPosition && st < lastScrollTop) {
                    var distanceFromTop = $filterElement.offset().top;
                    if (!$filterElement.hasClass("sticky") && st + headerHeight > distanceFromTop) {
                        $fakeElement.show();
                        $filterElement.addClass("sticky");
                        $filterElement.css({
                            top: $("#navbar-main").outerHeight(true) + "px"
                        })
                    }
                } else if ($filterElement.hasClass("sticky")) {
                    $fakeElement.hide();
                    $filterElement.removeClass("sticky")
                }
                lastScrollTop = st <= 0 ? 0 : st
            })
        }
        var $form = $("form.searchbox");
        if ($.fn.widgetSearch && $form.length) {
            $(".listing-display-options .param-newProject a").on("click", function(e) {
                e.preventDefault();
                var checkedValue = $(e.currentTarget).parents("label").find("input").val();
                var $input = $('.param-newProject input[value="' + checkedValue + '"]');
                $(".param-newProject a").removeClass("checked");
                $input.prop("checked", "checked");
                $input.parent().find("a").addClass("checked");
                $form.find(".btn-submit:first-child").trigger("click")
            })
        }
    }
    )(guruApp)
});
$(window).load(function() {
    var exitIntent = {
        name: "multiPageTakeoverShownExpiry",
        expirationDays: 1,
        millisecondsMultiplier: 24 * 60 * 60 * 1e3,
        shown: function() {
            var expirationTime = Math.floor((new Date).getTime() / this.millisecondsMultiplier) + this.expirationDays;
            return parseInt(localStorage.getItem(this.name)) >= expirationTime && exitIntent.expirationDays > 0
        },
        localStorageExists: function() {
            if (this.expirationDays <= 0) {
                localStorage.removeItem(this.name);
                return false
            }
            if (this.shown()) {
                return true
            }
            var date = new Date;
            date.setTime(date.getTime() + this.expirationDays * this.millisecondsMultiplier);
            localStorage.setItem(this.name, Math.floor(date.getTime() / this.millisecondsMultiplier));
            return false
        }
    };
    if (guruApp.fn.getCurrentDevice() !== "desktop" || !guruApp.dfp || !guruApp.dfp.isMultipageTakeoverEnabled || !guruApp.dfp.multipageTakeoverAd || exitIntent.shown() || !(window.ga && ga.loaded) || !$(".bottom-ad").is(":visible")) {
        return
    }
    var $takeoverModal = $("#multipage-takeover-modal");
    if ($takeoverModal.length) {
        $takeoverModal.find(".google_dfp_ads_slot_desktop_multipage_takeover").append(guruApp.dfp.multipageTakeoverAd);
        $(window).on("mouseleave.multipageTakeover", function(evt) {
            if ((evt.toElement === null || evt.toElement === undefined) && evt.relatedTarget === null && $(".modal.in").length <= 0 && !exitIntent.localStorageExists()) {
                if ($takeoverModal.data("hasContent")) {
                    $takeoverModal.modal("show")
                }
            }
        });
        $takeoverModal.find(".close-button").click(function(e) {
            $takeoverModal.modal("hide");
            e.preventDefault()
        })
    }
});
$(function($) {
    var $body = $("body");
    if (typeof guruApp.widgetGoogleAnalytics === "undefined") {
        return
    }
    var createGaDimension = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.createGaDimension
      , gaCategoryPrefixFromDataLayer = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getGaCategoryPrefixFromDataLayer()
      , gaCategoryPrefixFromSearchLayer = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getGaCategoryPrefixFromSearchLayer()
      , gaCategoryPrefix = gaCategoryPrefixFromDataLayer ? gaCategoryPrefixFromDataLayer : gaCategoryPrefixFromSearchLayer
      , productType = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType();
    var trackEC = function(currencyCode, command, productDetail, category, action, nonInteraction, dimensions, options) {
        var globalDimensions = guruApp.widgetGoogleAnalytics.dimensions;
        var createGaDimension = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.createGaDimension;
        if (dimensions === null || dimensions === undefined) {
            dimensions = [];
            for (var i in globalDimensions) {
                var dimensionIndex = parseInt(i.replace("dimension", ""), 10);
                if ([2, 3, 4, 5, 13, 14].indexOf(dimensionIndex) >= 0) {
                    dimensions.push(createGaDimension(i, globalDimensions[i].toString()))
                }
            }
            if (category === "addToCart") {
                dimensions.push(createGaDimension("dimension20", JSON.stringify({
                    AddToCart: {
                        type: action,
                        payload: productDetail
                    }
                })))
            } else if (action === "Listing Search" && ["productImpression", "productClick"].indexOf(category) >= 0) {
                var searchInsights = {
                    SearchId: searchGaEvent && searchGaEvent.getUniqueSearchId(),
                    ResultCount: guruApp.listingSearch && guruApp.listingSearch.listingsResultCount
                };
                dimensions.push(createGaDimension("dimension20", JSON.stringify(searchInsights)))
            }
            if (productDetail.dimension40) {
                dimensions.push(createGaDimension("dimension27", productDetail.dimension40))
            }
        }
        guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEventEnhancedEcommerce(currencyCode, command, productDetail, category, action, nonInteraction, dimensions, options)
    };
    var track = function(category, action, label, value, noninteraction, dimensions) {
        label = cleanText(label);
        guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent(category, action, label, value, noninteraction, dimensions);
        if (guruApp && guruApp.marketing && guruApp.marketing.segment && guruApp.marketing.segment.isEnabled) {
            trackSegmentGACommonEvent(guruApp.widgetGoogleAnalytics.dimensions.dimension2, action, label, value, noninteraction, dimensions)
        }
    }
      , cleanText = function(str) {
        if ("string" === typeof str && "" !== str) {
            return str.replace(/^https?:\/\/[^\/]+/, "").replace(/^\s+/, "").replace(/\s+$/, "").replace(/\s+/, " ")
        }
    }
      , dataLayerEvent = function(eventName) {
        if ("undefined" !== typeof console && console.log) {
            console.log("GTM dataLayer event: " + eventName)
        }
        if (typeof dataLayer !== "undefined") {
            dataLayer.push({
                event: eventName
            })
        }
    };
    function getAllUrlParams(url) {
        var queryString = url ? url.split("?")[1] : decodeURIComponent(window.location.search).slice(1);
        var obj = {};
        if (queryString) {
            queryString = queryString.split("#")[0];
            var arr = queryString.split("&");
            for (var i = 0; i < arr.length; i++) {
                var a = arr[i].split("=");
                var paramNum = undefined;
                var paramName = a[0].replace(/\[\d*\]/, function(v) {
                    paramNum = v.slice(1, -1);
                    return ""
                });
                var paramValue = typeof a[1] === "undefined" ? true : a[1];
                paramName = paramName.toLowerCase();
                if (obj[paramName]) {
                    if (typeof obj[paramName] === "string") {
                        obj[paramName] = [obj[paramName]]
                    }
                    obj[paramName].push(paramValue)
                } else {
                    obj[paramName] = paramValue
                }
            }
        }
        return obj
    }
    var searchGaEvent = {
        payLoad: {},
        params: getAllUrlParams(),
        referrer: "",
        searchType: "",
        uniqueSearchId: "",
        init: function() {
            this.payLoad.SearchId = this.getUniqueSearchId();
            this.referrer = document.referrer ? document.referrer.split("?")[0] : "";
            this.payLoad.Page = this.referrer;
            if (typeof guruApp.widgetGoogleAnalytics.dimensions.dimension17 !== "undefined") {
                this.payLoad.Intent = guruApp.widgetGoogleAnalytics.dimensions.dimension17
            }
            this.searchType = localStorage.getItem("searchType");
            if (this.searchType) {
                this.payLoad.SearchType = this.searchType.ucfirst();
                localStorage.removeItem("searchType");
                this.populatePayLoad();
                this.populateSearchTerm()
            }
        },
        getUniqueSearchId: function() {
            this.uniqueSearchId = localStorage.getItem("uniqueSearchId");
            if (!this.uniqueSearchId) {
                this.uniqueSearchId = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getUuid();
                localStorage.setItem("uniqueSearchId", this.uniqueSearchId)
            }
            return this.uniqueSearchId
        },
        populatePayLoad: function() {
            for (var param in this.params) {
                var payLoadValue = this.params[param];
                if (typeof payLoadValue === "string") {
                    payLoadValue = payLoadValue.trim()
                }
                if (payLoadValue) {
                    switch (param) {
                    case "property_type_code":
                        this.payLoad.Type = this.payLoad.Type ? this.payLoad.Type.concat(payLoadValue) : payLoadValue;
                        break;
                    case "sel_hdb_type":
                        this.payLoad.Type = this.payLoad.Type ? this.payLoad.Type.concat([payLoadValue]) : [payLoadValue];
                        break;
                    case "minprice":
                        this.payLoad.MinPrice = payLoadValue;
                        break;
                    case "maxprice":
                        this.payLoad.MaxPrice = payLoadValue;
                        break;
                    case "beds":
                        this.payLoad.Bed = payLoadValue;
                        break;
                    case "minsize":
                        this.payLoad.MinFloor = payLoadValue;
                        break;
                    case "maxsize":
                        this.payLoad.MaxFloor = payLoadValue;
                        break;
                    case "minsize_land":
                        this.payLoad.MinLand = payLoadValue;
                        break;
                    case "maxsize_land":
                        this.payLoad.MaxLand = payLoadValue;
                        break;
                    case "minpriceperarea":
                    case "search_psf_min":
                        this.payLoad.MinPSF = payLoadValue;
                        break;
                    case "maxpriceperarea":
                    case "search_psf_max":
                        this.payLoad.MaxPSF = payLoadValue;
                        break;
                    case "tenure":
                    case "search_tenure":
                        this.payLoad.Tenure = payLoadValue;
                        break;
                    case "minbath":
                        this.payLoad.Bath = payLoadValue;
                        break;
                    case "furnishing":
                        this.payLoad.Furnishing = payLoadValue;
                        break;
                    case "floor_level":
                        this.payLoad.FloorLevel = payLoadValue;
                        break;
                    case "listing_posted":
                        this.payLoad.Listed = payLoadValue;
                        break;
                    case "mintop":
                        this.payLoad.MinConstructed = payLoadValue;
                        break;
                    case "maxtop":
                        this.payLoad.MaxConstructed = payLoadValue;
                        break;
                    case "search_age":
                        this.payLoad.BuildingAge = payLoadValue;
                        break;
                    case "with_photos":
                        this.payLoad.Photos = payLoadValue;
                        break;
                    case "with_stream":
                        this.payLoad.Videos = payLoadValue;
                        break;
                    case "property_id":
                        this.payLoad.PropertyId = payLoadValue;
                        break;
                    case "district_code":
                        this.payLoad.District = payLoadValue;
                        break;
                    case "tracker":
                        payLoadValue = payLoadValue.split("|").filter(function(district) {
                            return district.length > 1
                        });
                        if (payLoadValue.length) {
                            this.payLoad.District = payLoadValue
                        }
                        break;
                    case "region_code":
                        this.payLoad.Region = payLoadValue;
                        break;
                    case "area_code":
                        this.payLoad.Area = payLoadValue;
                        break;
                    case "hdb_estate":
                        this.payLoad.HdbEstate = payLoadValue;
                        break;
                    case "mrt_id":
                    case "mrt_station":
                        this.payLoad.MrtBtsStation = payLoadValue;
                        break;
                    case "school":
                        this.payLoad.School = payLoadValue;
                        break;
                    case "newproject":
                        if (payLoadValue == 1) {
                            this.payLoad.NewProject = payLoadValue
                        }
                        break
                    }
                }
            }
            this.payLoad.ResultCount = guruApp.listingSearch.listingsResultCount
        },
        populateSearchTerm: function() {
            if (this.params.hasOwnProperty("freetext") && this.params.freetext.trim().length) {
                var searchText = this.params.freetext.trim();
                if (this.params.hasOwnProperty("autocomplete")) {
                    this.payLoad.AutoComplete = searchText
                } else {
                    this.payLoad.FreeText = searchText
                }
            } else if (typeof guruApp.condoSearch !== "undefined" && guruApp.condoSearch.freeText) {
                this.payLoad.FreeText = guruApp.condoSearch.freeText
            }
        },
        send: function() {
            var gaHdbCondoCategoryPrefixFromLocalStorage = localStorage.getItem("gaHdbCondoCategoryPrefix");
            localStorage.removeItem("gaHdbCondoCategoryPrefix");
            var categoryPrefix = gaHdbCondoCategoryPrefixFromLocalStorage || gaCategoryPrefixFromSearchLayer;
            if (categoryPrefix && this.payLoad.SearchType && this.payLoad.SearchType != "Undefined") {
                var dimensions = [];
                addLocalDimensionIfExists("dimension27", dimensions);
                track(categoryPrefix + "Core", "Search", JSON.stringify(this.payLoad), undefined, undefined, dimensions)
            }
        }
    };
    var addLocalDimensionIfExists = function(dimensionName, dimensions) {
        if (guruApp.widgetGoogleAnalytics && guruApp.widgetGoogleAnalytics.localDimensions && guruApp.widgetGoogleAnalytics.localDimensions[dimensionName]) {
            dimensions.push(createGaDimension(dimensionName, guruApp.widgetGoogleAnalytics.localDimensions[dimensionName]))
        }
    };
    $("#navbar-main .navbar-nav").on("click.ga", "a", function(e) {
        var $a = $(this)
          , loc = $a.data("tracking") || "Header"
          , title = cleanText(document.title.split("|")[0])
          , dimensions = null;
        if ($a.is("li.dropdown > a, li.accordion > a")) {
            dimensions = [createGaDimension("dimension20", JSON.stringify({
                Dropdown: cleanText($a.text()),
                Loc: loc
            }))];
            track("Header-Engagement", "Toggle", "Loc=" + loc, null, true, dimensions)
        } else {
            dimensions = [createGaDimension("dimension20", JSON.stringify({
                "Main Nav": title,
                Loc: loc
            }))];
            track("Header-Engagement", "Navigate", "Loc=" + loc, null, false, dimensions)
        }
    });
    $(".nav-tools").on("click.ga", "a", function(e) {
        var $a = $(this)
          , title = cleanText(document.title.split("|")[0]);
        if ($a.is(".share-listing a", ".contact-agent a")) {
            return
        }
        if ($a.is(".dropdown-toggle, .multiple-enquire a")) {
            return
        }
        if ($a.is("li.login > a:eq(0)")) {
            var dimensions = [createGaDimension("dimension20", JSON.stringify({
                Loc: "Header"
            }))];
            track("Membership-Acquisition", "Login", "Loc=Header", null, null, dimensions)
        } else {
            var dimensions = [createGaDimension("dimension20", JSON.stringify({
                NavTool: title,
                Loc: "Header"
            }))];
            track("Header-Engagement", "Navigate", "Loc=Header", null, null, dimensions)
        }
    });
    $("#navbar-main").on("click.ga", ".header-link", function(e) {
        track("Header", "Inline Nav", $(this).attr("href"))
    });
    $(".search-tools form").on("ga.siteSearch.button", function() {
        var dimensions = [createGaDimension("dimension20", '{"Loc":"Header"}')];
        track("Header-Core", "GlobalSearch", "Loc=Header", null, null, dimensions)
    });
    $("#footer-copy").on("click.ga", "a", function(e) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Type: $(this).text(),
            Loc: "Footer"
        }))];
        track("Other-Engagement", "Navigate", "Loc=Footer", null, null, dimensions)
    });
    $("#footer-sitemap").on("click.ga", "a", function(e) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Link: $(this).text(),
            Loc: "Footer"
        }))];
        track("Other-Engagement", "Navigate", "Loc=Footer", null, null, dimensions)
    });
    $(".listings-page-results").on("click.ga", "a.btn-agent-contact-mail", function(e) {
        track("Main Search Results", "View Contact", "Contact Intent")
    });
    $(".searchbox").on("ga.searchWidget.options", function(e, param, value) {
        track("Searching", "Option", param + "=" + value, undefined, true)
    });
    $(".searchbox").on("ga.searchWidget.expand", function(e, value) {
        track("Searching", "More Options", value, undefined, true)
    });
    $body.on("ga.listing.widgetMapNearby.show", function() {
        track(productType + "-Engagement", "Scroll", "ScrollTo=Map")
    });
    $body.on("ga.listing.propertyInsightsWidget.show", function() {
        track("Insights Widget", "Load", "Load", undefined, true)
    });
    $body.on("ga.listing.details.primary.show", function() {
        track("Main Listing Detail Primary", "More Details", "Show Button - Display", undefined, true)
    });
    $body.on("ga.listing.details.show", function() {
        track("Main Listing Detail", "More Details", "Show Button - Display", undefined, true)
    });
    $body.on("ga.listing.details.areainsider.engage", function(e, area, text) {
        var dimension20 = {
            Area: area,
            Loc: "BelowLocation",
            Text: text
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track("AreaInsider-Engagement", "NavigateToArea", "Area=" + area, null, null, dimensions)
    });
    $body.on("ga.listing.details.areainsider.impress", function(e, area, text) {
        var dimension20 = {
            Area: area,
            Loc: "BelowLocation",
            Text: text
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track("AreaInsider-Impression", "GoToArea", "Area=" + area, null, null, dimensions)
    });
    $body.on("ga.listing.search-result.areainsider.engage.rightside", function(e, area, text) {
        var dimension20 = {
            Area: area,
            Loc: "RightSide",
            Text: text
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track("AreaInsider-Engagement", "NavigateToArea", "Area=" + area, null, null, dimensions)
    });
    $body.on("ga.listing.search-result.areainsider.impress.rightside", function(e, area, text) {
        var dimension20 = {
            Area: area,
            Loc: "RightSide",
            Text: text
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track("AreaInsider-Impression", "GoToArea", "Area=" + area, null, null, dimensions)
    });
    $body.on("ga.listing.search-result.areainsider.engage.top", function(e, area, text, page) {
        var dimension20 = {
            Area: area,
            Loc: "TopOfResult",
            Text: text,
            Page: page
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track("AreaInsider-Engagement", "NavigateToArea", "Page=" + page, null, null, dimensions)
    });
    $body.on("ga.listing.search-result.areainsider.impress.top", function(e, areas, text, page) {
        var dimension20 = {
            Area: areas,
            Loc: "TopOfResult",
            Text: text,
            Page: page
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track("AreaInsider-Impression", "GoToArea", "Area=" + areas, null, null, dimensions)
    });
    $body.on("ga.listing.details.show-click", function() {
        var categoryPrefix = gaCategoryPrefixFromDataLayer
          , dimensions = [createGaDimension("dimension20", '{"Link":"ReadMore"}')];
        if (categoryPrefix) {
            track(categoryPrefix + "Engagement", "ReadMore", "Link=ReadMore", null, null, dimensions)
        }
    });
    $body.on("ga.listingResult.multiEnquire.add.checkbox", function() {
        track("Main Search Results", "Add to multiple enquiry list", "Add to multiple enquiry  Checkbox")
    });
    $body.on("ga.listingResult.multiEnquire.remove.checkbox", function() {
        track("Main Search Results", "Remove from multiple enquiry list", "Remove from multiple enquiry  Uncheck")
    });
    $body.on("ga.listingResult.multiEnquire.remove.x", function(e, listingId) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            RemoveID: listingId,
            Link: "RemoveMultipleEnquire"
        }))];
        track(guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType() + "-Engagement", "Remove", "Link=RemoveMultipleEnquire", null, null, dimensions)
    });
    $body.on("ga.listingResult.multiEnquire.max.error", function() {
        track("Main Search Results", "Multiple Enquiry Limit Reached Error", "Multiple Enquiry Limit Reached Error")
    });
    $body.on("ga.listingResult.multiEnquire.submit.intent", function() {
        var dimensions = [createGaDimension("dimension20", "{'Link':'IntentMultipleEnquire'}")];
        track("Header-Engagement", "Click", "Link=IntentMultipleEnquire", null, null, dimensions);
        dataLayerEvent("listing.enquire.multiple.intent")
    });
    $body.on("ga.listingResult.multiEnquire.submit.form", function(e, idsListings) {
        track("Leads", "Enquire", "Submit multiple enquire final form", idsListings.length);
        dataLayerEvent("listing.enquire.multiple.success")
    });
    $body.on("ga.listing.share.intent", function(e, location, shareThrough) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Type: shareThrough,
            Loc: location
        }))];
        track(gaCategoryPrefixFromDataLayer + "Engagement", "Share", "Type=" + shareThrough, null, null, dimensions)
    });
    $(".listing-pagination li a").on("click", function() {
        var productType = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType()
          , uniqueSearchId = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getUniqueSearchId()
          , pageNumber = $(this).data("page")
          , dimensions = [createGaDimension("dimension20", "{SearchID:'" + uniqueSearchId + "','Page':'" + pageNumber + "'}")]
          , label = {
            page: pageNumber
        };
        label = JSON.stringify(label);
        track(productType + "-Core", "Navigate", label, null, null, dimensions)
    });
    if ($("html.listing, html.listing-overseas").length) {
        $("body.listing .listing-display-options ul, body.listing-overseas .listing-display-options ul").first().on("click", "li a", function() {
            var productType = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType();
            var uniqueSearchId = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getUniqueSearchId();
            var field = $(this).text();
            var label = "";
            if ("Recommended (default)" === field) {
                label = "Recommended"
            } else {
                label = field.replace(/ /g, "")
            }
            var dimensions = [createGaDimension("dimension20", "{SearchID:'" + uniqueSearchId + "','SortBy':'" + label + "'}")];
            track(productType + "-Core", "Sort", "SortBy=" + label, null, null, dimensions)
        })
    }
    $(".featured-listing.widget a.fl-link").on("click", function() {
        var position = parseInt($(this).closest("li").index(), 10) + 1;
        track("Featured Developer Listing", "Homepage Listing Lead", "Position " + position + " Click - " + $(this).attr("data-listingId"))
    });
    $(".box-featured-new-projects .card-container a").on("click", function() {
        var listingId = $(this).data("id");
        var dimensions = [createGaDimension("dimension20", "{'ListingID':'" + listingId + "','Loc':'Featured'}")];
        track(productType + "-Engagement", "Navigate", "Loc=Featured", null, null, dimensions)
    });
    $(".carousel-indicators div[data-id='featured-newprojects']").parent().on("click", function() {
        var position = $(this).index() + 1;
        var listingId = $(this).find("> div[data-id='featured-newprojects']").attr("data-listingId");
        var dimensions = [createGaDimension("dimension20", "{'ListingID':'" + listingId + "','Loc':'Position" + position + "'}")];
        track(productType + "-Engagement", "View", "Loc=Position" + position, null, null, dimensions)
    });
    $body.on("ga.listing.widgetSimilarListings.show", function(e, widget) {
        var payLoad = {
            Listing: [],
            recommendations_type: [],
            reason_catalog_id: []
        }, dimensions;
        var model_name = "";
        $(widget).find(".listing-card-info a.listing-card-link").each(function() {
            payLoad.Listing.push($(this).data("id"));
            if ($(this).data("recommendations_type")) {
                var listingAndReason = {};
                listingAndReason[$(this).data("id")] = $(this).data("recommendations_type");
                payLoad.recommendations_type.push(listingAndReason)
            }
            if ($(this).data("reason_catalog_id")) {
                var listingAndReasonCatalog = {};
                listingAndReasonCatalog[$(this).data("id")] = $(this).data("reason_catalog_id");
                payLoad.reason_catalog_id.push(listingAndReasonCatalog)
            }
            if (model_name == "" && $(this).data("model_name")) {
                model_name = $(this).data("model_name")
            }
        });
        if (model_name !== "") {
            payLoad["model"] = model_name
        }
        if (payLoad.recommendations_type === undefined || payLoad.recommendations_type.length == 0) {
            delete payLoad.recommendations_type
        }
        if (payLoad.reason_catalog_id === undefined || payLoad.reason_catalog_id.length == 0) {
            delete payLoad.reason_catalog_id
        }
        var widgetTitle = $(widget).data("ga-title");
        var title = widgetTitle ? widgetTitle : "Similar Listings";
        dimensions = [createGaDimension("dimension20", JSON.stringify(payLoad))];
        track(title, "Async", title + " Loaded", undefined, true, dimensions)
    });
    $body.on("ga.listing.widgetSimilarListings.viewed", function(e, widget) {
        var payLoad = {
            Listing: [],
            recommendations_type: [],
            reason_catalog_id: []
        }, dimensions, model_name = "";
        $(widget).find(".listing-card-info a.listing-card-link").each(function() {
            payLoad.Listing.push($(this).data("id"));
            if ($(this).data("recommendations_type")) {
                var listingAndReason = {};
                listingAndReason[$(this).data("id")] = $(this).data("recommendations_type");
                payLoad.recommendations_type.push(listingAndReason)
            }
            if ($(this).data("reason_catalog_id")) {
                var listingAndReasonCatalog = {};
                listingAndReasonCatalog[$(this).data("id")] = $(this).data("reason_catalog_id");
                payLoad.reason_catalog_id.push(listingAndReasonCatalog)
            }
            if (model_name == "" && $(this).data("model_name")) {
                model_name = $(this).data("model_name")
            }
        });
        if (model_name !== "") {
            payLoad["model"] = model_name
        }
        if (payLoad.recommendations_type === undefined || payLoad.recommendations_type.length == 0) {
            delete payLoad.recommendations_type
        }
        if (payLoad.reason_catalog_id === undefined || payLoad.reason_catalog_id.length == 0) {
            delete payLoad.reason_catalog_id
        }
        var widgetTitle = $(widget).data("ga-title");
        var title = widgetTitle ? widgetTitle : "Similar Listings";
        dimensions = [createGaDimension("dimension20", JSON.stringify(payLoad))];
        track(title, "Scrolled", "ViewedByUser", undefined, true, dimensions)
    });
    $body.on("ga.listing.widgetSimilarListings.showPostEnquire", function(e) {
        var categoryPrefix = gaCategoryPrefixFromDataLayer
          , dimensions = [createGaDimension("dimension20", '{"Link":"SimilarListing"}')];
        if (categoryPrefix) {
            track(categoryPrefix + "Engagement", "Click", "Link=SimilarListing", null, null, dimensions)
        }
    });
    $body.on("ga.listing.widgetSimilarListings.click", function(e, context) {
        var payLoad = {
            Listing: [],
            Clicked: context.listingId,
            recommendations_type: [],
            reason_catalog_id: []
        }, dimensions, label = "Listing #" + context.position, model_name = "";
        $(context.widget).find(".listing-card-info a.listing-card-link").each(function() {
            payLoad.Listing.push($(this).data("id"));
            if ($(this).data("recommendations_type")) {
                var listingAndReason = {};
                listingAndReason[$(this).data("id")] = $(this).data("recommendations_type");
                payLoad.recommendations_type.push(listingAndReason)
            }
            if ($(this).data("reason_catalog_id")) {
                var listingAndReasonCatalog = {};
                listingAndReasonCatalog[$(this).data("id")] = $(this).data("reason_catalog_id");
                payLoad.reason_catalog_id.push(listingAndReasonCatalog)
            }
            if (model_name == "" && $(this).data("model_name")) {
                model_name = $(this).data("model_name")
            }
        });
        if (model_name !== "") {
            payLoad["model"] = model_name
        }
        if (payLoad.recommendations_type === undefined || payLoad.recommendations_type.length == 0) {
            delete payLoad.recommendations_type
        }
        if (payLoad.reason_catalog_id === undefined || payLoad.reason_catalog_id.length == 0) {
            delete payLoad.reason_catalog_id
        }
        var widgetTitle = $(context.widget).data("ga-title");
        var title = widgetTitle ? widgetTitle : "Similar Listings";
        dimensions = [createGaDimension("dimension20", JSON.stringify(payLoad))];
        track(title, "View Similar Agent Listing", label, undefined, true, dimensions)
    });
    $body.on("ga.listing.enquire.success", function(e, form, listingId) {
        var dimensions = []
          , categoryPrefix = gaCategoryPrefixFromDataLayer
          , widgetPlacement = $(form).context.getAttribute("data-placement");
        if (widgetPlacement) {
            dimensions.push(createGaDimension("dimension20", '{"Loc":"' + widgetPlacement + '","Type":"Email"}'))
        }
        if (categoryPrefix && dimensions) {
            addLocalDimensionIfExists("dimension27", dimensions);
            track(categoryPrefix + "Conversion", "Lead", "Type=Email", null, null, dimensions)
        }
        $body.trigger("audiencepixel.listing.enquire.success");
        dataLayerEvent("listing.enquire.success");
        $body.trigger("fbpixel.listing.enquire.success")
    });
    $body.on("audiencepixel.listing.enquire.success", function(e) {
        var axel = Math.random() + "";
        var a = axel * 1e13;
        var pixel = '<img src="https://pubads.g.doubleclick.net/activity;dc_iu=/133034368/audience_ad_unit;ord=' + a + ';dc_seg=24481570?" width="1" height="1" border="0" />';
        $body.append(pixel);
        console.log("Audience Pixel ID Inserted")
    });
    $body.on("ga.listing.enquiresimilar.success", function(e, context) {
        var categoryPrefix = gaCategoryPrefixFromDataLayer
          , payLoad = {
            Loc: "PopUp",
            Type: "MultiEmail",
            Listing: context.allListingIds,
            Enquired: context.checkedListingIds
        }
          , dimensions = [createGaDimension("dimension20", JSON.stringify(payLoad))];
        if (categoryPrefix) {
            addLocalDimensionIfExists("dimension27", dimensions);
            track(categoryPrefix + "Conversion", "Lead", "Type=MultiEmail", null, null, dimensions)
        }
        dataLayerEvent("listing.enquire.similar.success")
    });
    $body.on("ga.gallery.fullscreen.open", function() {
        var pageType = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getPageType();
        track(productType + "-Engagement", "GalleryOpen", "Action=Open")
    });
    $body.on("ga.gallery.fullscreen.close", function() {
        var pageType = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getPageType();
        track(productType + "-Engagement", "GalleryClose", "Action=Close")
    });
    if ($body.is(".listing_detail")) {
        $(".btn-pdf").on("click", function() {
            var categoryPrefix = gaCategoryPrefixFromDataLayer
              , dimensions = dimensions || []
              , listingId = 0;
            if (typeof guruApp.widgetGoogleAnalytics != "undefined" && typeof guruApp.widgetGoogleAnalytics.dimensions != "undefined" && typeof guruApp.widgetGoogleAnalytics.dimensions.dimension7 != "undefined") {
                listingId = guruApp.widgetGoogleAnalytics.dimensions.dimension7
            }
            dimensions.push(createGaDimension("dimension20", '{"PDF":"' + listingId + '.pdf","File":"PDF"}'));
            addLocalDimensionIfExists("dimension27", dimensions);
            track(categoryPrefix + "Conversion", "Download", "File=PDF", null, null, dimensions)
        });
        if (guruApp && guruApp.listingDetail && guruApp.listingDetail.listingStatus) {
            track("Main Listing Detail", "Listing Status", guruApp.listingDetail.listingStatus, undefined, true)
        }
    }
    $body.on("ga.phone.call", function(e, listingId, agentId, developerListingId, section, label, dimensions) {
        dimensions = dimensions || [];
        if ($body.is(".agent-home") || $body.is(".agent-search") || $body.is(".listing_detail") || $body.is(".agent-details")) {
            var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
            var dimension25 = createGaDimension("dimension25", agentId);
            var dimension20 = createGaDimension("dimension20", '{"Loc":"' + listName + '", "Type":"Call"}');
            dimensions = [dimension20, dimension25];
            addLocalDimensionIfExists("dimension27", dimensions);
            track("Sale-Conversion", "Lead", "Type=Call", null, null, dimensions);
            $body.trigger("fbpixel.resale.phone.click", ["", listingId, agentId]);
            dataLayerEvent("phone.call")
        }
    });
    $body.on("ga.phone.show", function(e, listingId, agentId, developerListingId, section, label, dimensions) {
        var categoryPrefix = null
          , dimensions = dimensions || [];
        if ($body.is(".agent-home") || $body.is(".agent-search") || $body.is(".landing-condo") || $body.is(".listing-condo") || $body.is(".listing_detail") && ("Condo featured agents" === label || "HDB featured agents" === label)) {
            var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
            var dimension25 = createGaDimension("dimension25", agentId);
            var dimension20 = createGaDimension("dimension20", '{"Loc":"' + listName + '", "Type":"ViewPhone"}');
            dimensions = [dimension20, dimension25];
            addLocalDimensionIfExists("dimension27", dimensions);
            track("Sale-Conversion", "Lead", "Type=ViewPhone", null, null, dimensions)
        } else if (listingId) {
            categoryPrefix = gaCategoryPrefixFromDataLayer;
            if (categoryPrefix && dimensions) {
                addLocalDimensionIfExists("dimension27", dimensions);
                track(categoryPrefix + "Conversion", "Lead", "Type=ViewPhone", null, null, dimensions)
            }
        } else if (agentId) {
            track("Leads Generating", "View Number", "", 1)
        } else if (developerListingId && label == "Search Result") {
            var dimensions = [createGaDimension("dimension20", '{"Loc":"SearchResult","Type":"ViewPhone"}')];
            track("NewHome-Conversion", "Lead", "Type=ViewPhone", null, null, dimensions)
        } else if (developerListingId) {
            var location = "Right" === label ? "RightSide" : "Bottom";
            var dimensions = [createGaDimension("dimension20", '{"Loc":"' + location + '","Type":"ViewPhone"}')];
            addLocalDimensionIfExists("dimension27", dimensions);
            track(productType + "-Conversion", "Lead", "Type=ViewPhone", null, null, dimensions)
        } else if ($body.is(".listing")) {
            categoryPrefix = gaCategoryPrefixFromSearchLayer;
            if (categoryPrefix) {
                addLocalDimensionIfExists("dimension27", dimensions);
                dimensions.push(createGaDimension("dimension20", '{"Loc":"SearchResult","Type":"ViewPhone"}'));
                track(categoryPrefix + "Conversion", "Lead", "Type=ViewPhone", null, null, dimensions)
            }
        }
        dataLayerEvent("phone.show");
        $body.trigger("fbpixel.phone.show", [listingId, agentId, developerListingId, section, label])
    });
    function setSearchType() {
        var searchType = $("form.searchbox button[type=submit], form.searchbox input[type=submit]").data("title");
        localStorage.setItem("searchType", searchType);
        var uniqueSearchId = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getUuid();
        localStorage.setItem("uniqueSearchId", uniqueSearchId)
    }
    $body.on("ga.search.form.submit.main.listing", setSearchType);
    $body.on("ga.search.form.submit.expanded.listing", setSearchType);
    function setHdbCondoSearchType(event, gaCategoryPrefix, gaSearchType) {
        var searchType = gaSearchType || "Search";
        localStorage.setItem("searchType", searchType);
        var uniqueSearchId = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getUuid();
        localStorage.setItem("uniqueSearchId", uniqueSearchId);
        localStorage.setItem("gaHdbCondoCategoryPrefix", gaCategoryPrefix)
    }
    $body.on("ga.hdb.freetext.search.form.submit", setHdbCondoSearchType);
    $body.on("ga.hdb.search.form.submit", setHdbCondoSearchType);
    $body.on("ga.condo.freetext.search.form.submit", setHdbCondoSearchType);
    $body.on("ga.condo.search.form.submit", setHdbCondoSearchType);
    $("#sponsor-liputan6").on("click.ga", function(e) {
        track("External Partner", "Liputan6", "Liputan6")
    });
    $body.on("ga.listing.chart-widget.psf", function() {
        track("Listing Data Chart Widget", "Price History Select", "PSF")
    });
    $body.on("ga.listing.chart-widget.price", function() {
        track("Listing Data Chart Widget", "Price History Select", "Price")
    });
    $body.on("ga.listing.chart-widget.index-price", function() {
        track("Listing Data Chart Widget", "Price History Select", "Index Price")
    });
    $body.on("ga.listing.chart-widget.index-psf", function() {
        track("Listing Data Chart Widget", "Price History Select", "Index PSF")
    });
    $body.on("ga.listing.chart-widget.duration-3months", function() {
        track("Listing Data Chart Widget", "Price Duration", "3 months")
    });
    $body.on("ga.listing.chart-widget.duration-1year", function() {
        track("Listing Data Chart Widget", "Price Duration", "1 Year")
    });
    $body.on("ga.listing.chart-widget.duration-2year", function() {
        track("Listing Data Chart Widget", "Price Duration", "2 Year")
    });
    $body.on("ga.new-condo.condo-landing.state-search", function(e, area) {
        track("State search", "Search by state", area)
    });
    $body.on("ga.new-condo.condo-landing.ask-question", function() {
        track("Contributing", "Intent to question", "Ask Question Button")
    });
    $body.on("ga.new-condo.condo-landing.ask-question-submit", function() {
        track("Contributing", "Submit question", "Post question Button")
    });
    $body.on("ga.new-condo.condo-landing.ask-question-success", function() {
        track("Contributing", "Question", "Question")
    });
    $body.on("ga.new-condo.condo-landing.search", function(e, searchText) {
        track("Analysing", "Property Search", "Find", searchText)
    });
    $body.on("ga.new-condo.condo-qna.ask-questions", function() {
        track("Condo Q&A", "Ask Question", "Ask Question")
    });
    $body.on("ga.new-condo.condo-qna.view-property-details", function() {
        track("Condo Q&A", "View property details", "View property details")
    });
    $body.on("ga.new-condo.condo-landing.listing_for_sale", function() {
        track("Listing Search", "Listings for sale", "XX units for sale")
    });
    $body.on("ga.new-condo.condo-landing.listing_for_rent", function() {
        track("Listing Search", "Listings for rent", "XX units for rent")
    });
    $body.on("ga.new-condo.condo-reviews.top-add-review", function() {
        track("Contributing", "Intent to post review", "Side Bar")
    });
    $body.on("ga.new-condo.condo-reviews.thumbs-up", function() {
        track("Contributing", "Rate Review", "Thumbs up")
    });
    $body.on("ga.new-condo.condo-reviews.thumbs-down", function() {
        track("Contributing", "Rate Review", "Thumbs down")
    });
    $body.on("ga.new-condo.condo-reviews.report", function() {
        track("Contributing", "Rate Review", "Report Review")
    });
    $body.on("ga.new-condo.condo-reviews.post", function() {
        track("Contributing", "Submit review", "Post review")
    });
    $body.on("ga.new-condo.condo-reviews.post-review-success", function() {
        track("Contributing", "Review", "Post Review Success")
    });
    $body.on("ga.new-condo.condo-reviews.rating", function(e, category) {
        track("Analysing", "Condo Rating", category)
    });
    $body.on("ga.new-condo.condo-reviews.recommend", function(e, category) {
        track("Contributing", "Recommended for", category)
    });
    $body.on("ga.new-condo.condo-qna.ask-questions", function() {
        track("Condo Q&A", "Ask Question", "Ask Question")
    });
    $body.on("ga.new-condo.condo-details.photo-trigger", function() {
        track("Analysing", "View media", "Photo icon")
    });
    $body.on("ga.new-condo.condo-details.ask-questions", function() {
        track("Contributing", "Intent to question", "Ask questions")
    });
    $body.on("ga.new-condo.condo-details.ask-questions-submit", function() {
        track("Contributing", "Submit question", "Post question")
    });
    $body.on("ga.new-condo.condo-details.add-review", function() {
        track("Contributing", "Intent to review", "Add review")
    });
    $body.on("ga.new-condo.condo-details.post-review", function() {
        track("Contributing", "Submit review", "Post review")
    });
    $body.on("ga.new-condo.condo-details.translate", function() {
        track("Other-Core", "Translate", "Condo-Detail")
    });
    $(document).on("submit", ".listing_detail .contact-specialist.contact-agent-form", function() {
        if ($("#page-type-code").length) {
            var $this = $(this)
              , dimensions = []
              , label = null;
            var $listingId = $("input[name=listingId]")
              , listingId = 0;
            if ($listingId.length) {
                listingId = $listingId.val()
            }
            var $agentId = $("input[name=agentId]")
              , agentId = 0;
            if ($agentId.length) {
                agentId = $agentId.val()
            }
            if (agentId === "") {
                agentId = $this.data("agentid")
            } else {
                agentId = 0
            }
            label = "Condo featured agents";
            var pageTypeCode = $("#page-type-code").val();
            if (pageTypeCode === "HDB") {
                label = "HDB featured agents"
            }
            $body.trigger("ga.listing_detail.enquire.intent", [listingId, agentId, null, null, label, dimensions])
        }
    });
    $body.on("ga.new-condo.condo-details.featured-agents", function(e, form) {
        var agentsDisplayed = [];
        var agentsContacted = [];
        var agents = $(form).find(".agent_list input");
        var label = "";
        var pageTypeCode = "";
        $.each(agents, function() {
            var agentId = $(this).val();
            agentsDisplayed.push(agentId);
            if ($(this).is(":enabled")) {
                agentsContacted.push(agentId)
            }
        });
        var gaAction = agentsContacted.length > 1 ? "Contact All Featured Agents" : "Contact Featured Agent";
        var gaLabel = JSON.stringify({
            agentsContacted: agentsContacted
        });
        var dimension20 = {
            projectId: $(form).find("input[name=referenceId]").val(),
            projectType: $(form).find("input[name=enquiryType]").val(),
            agentsContacted: agentsContacted,
            agentsDisplayed: agentsDisplayed
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track("ProjectDetail-Engagement", gaAction, gaLabel, null, null, dimensions);
        if ($("#page-type-code").length > 0) {
            label = "Condo featured agents";
            pageTypeCode = $("#page-type-code").val();
            if (pageTypeCode === "HDB") {
                label = "HDB featured agents"
            }
            var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
            var dimension20 = createGaDimension("dimension20", '{"Loc":"' + listName + '", "Type":"Email"}');
            dimensions = [dimension20];
            track("Sale-Conversion", "Lead", "Type=Email", null, null, dimensions);
            dataLayerEvent("listing_detail.enquire.success");
            $body.trigger("fbpixel.agent.enquire.success")
        }
    });
    $body.on("ga.new-condo.condo-details.condo-specialists-submit", function(e, count) {
        track("Enquiring", "Enquire submitted", "Condo Featured Agent", count)
    });
    $body.on("ga.new-condo.condo-details.condo-specialists-success", function(e, count) {
        track("Enquiring", "Enquire", "Condo Featured Agent", count)
    });
    $body.on("ga.print.system ga.print.button", function() {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Type: "Print"
        }))];
        track(guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType() + "-Engagement", "Print", "Type=Print", null, null, dimensions)
    });
    $body.on("click.ga.smartbanner", ".smartbanner-android a.smartbanner-button", function() {
        var dimensionData = {
            Loc: "AndroidSmartBanner"
        };
        var listingId;
        var $element = $(".listing-detail.listing-detail-body, .listing-detail #details");
        if ($element.length) {
            dimensionData["ListingID"] = $element.data("id")
        }
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimensionData))];
        track("Other-Conversion", "Download", "Loc=AndroidSmartBanner", null, null, dimensions)
    });
    $body.on("ga.createalert.intent", function() {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Status: "Intent"
        }))];
        track("Membership-Engagement", "CreateAlert", "Status=Intent", null, null, dimensions)
    });
    $body.on("ga.savesearch.intent", function() {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Status: "Intent"
        }))];
        track("Membership-Acquisition", "SaveSearch", "Status=Intent", null, null, dimensions)
    });
    $body.on("ga.createalert.success", function() {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Status: "Confirmed"
        }))];
        track("Membership-Engagement", "CreateAlert", "Status=Confirmed", null, null, dimensions)
    });
    $body.on("ga.savesearch.success", function() {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Status: "Confirmed"
        }))];
        track("Membership-Acquisition", "SaveSearch", "Status=Confirmed", null, null, dimensions)
    });
    $body.on("ga.phone.click", function(e, position, listingId, agentId) {
        if (position == "Bottom") {
            var categoryPrefix = gaCategoryPrefixFromDataLayer
              , dimensions = [createGaDimension("dimension20", '{"Loc":"' + position + '","Type":"Call"}')];
            if (categoryPrefix) {
                addLocalDimensionIfExists("dimension27", dimensions);
                track(categoryPrefix + "Conversion", "Lead", "Type=Call", null, null, dimensions)
            }
        } else if ($body.is(".agent-details")) {
            var label = "Agent Profile";
            var ecImpression = $(".js-contact-form").data("ec-impression");
            var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
            var dimension25 = createGaDimension("dimension25", agentId);
            var dimension20 = createGaDimension("dimension20", '{"Loc":"' + listName + '", "Type":"ViewPhone"}');
            dimensions = [dimension20, dimension25];
            addLocalDimensionIfExists("dimension27", dimensions);
            track("Sale-Conversion", "Lead", "Type=ViewPhone", null, null, dimensions);
            ecImpression.productData.dimension25 = ecImpression.productData.dimension25.toString();
            $("body").trigger("ga.ec.purchase", {
                currency: ecImpression.currency,
                productData: ecImpression.productData,
                purchaseType: "View Phone"
            })
        } else {
            track("Leads Generating", "Calling Phone Number", position)
        }
        dataLayerEvent("phone.click");
        $body.trigger("fbpixel.resale.phone.click", [position, listingId, agentId])
    });
    $body.on("click.ga", ".js-agent-phone-number-sms", function() {
        var label = "";
        if ($(this).is(".contact-agent-phone-btns .js-agent-phone-number-sms")) {
            label = "Under Gallery";
            track("Leads Generating", "SMS Phone Number", label)
        } else {
            label = '{"Loc":"Bottom","Type":"SMS"}';
            var categoryPrefix = gaCategoryPrefixFromDataLayer
              , dimensions = [createGaDimension("dimension20", label)];
            if (categoryPrefix) {
                addLocalDimensionIfExists("dimension27", dimensions);
                track(categoryPrefix + "Conversion", "Lead", "Type=SMS", null, null, dimensions)
            }
        }
        dataLayerEvent("phone.sms");
        $body.trigger("fbpixel.phone.sms")
    });
    $body.on("click.ga", ".js-agent-phone-number-whatsapp", function() {
        var label = '{"Loc":"Bottom","Type":"WhatsApp"}'
          , categoryPrefix = gaCategoryPrefixFromDataLayer
          , dimensions = [createGaDimension("dimension20", label)];
        if (categoryPrefix) {
            addLocalDimensionIfExists("dimension27", dimensions);
            track(categoryPrefix + "Conversion", "Lead", "Type=WhatsApp", null, null, dimensions)
        }
        dataLayerEvent("phone.whatsapp");
        $body.trigger("fbpixel.phone.whatsapp")
    });
    $body.on("ga.new-login-intent-transaction-widget", function() {
        var dimensions = [];
        dimensions.push(createGaDimension("dimension20", '{"Status":"Intent"}'));
        track("Membership-Acquisition", "Login", "Status=Intent", null, null, dimensions)
    });
    $body.on("ga.new-registration-intent-transaction-widget", function() {
        var dimensions = [];
        dimensions.push(createGaDimension("dimension20", '{"Status":"Intent"}'));
        track("Membership-Acquisition", "SignUp", "Status=Intent", null, null, dimensions)
    });
    $body.on("ga.transaction-widget.tabclick", function(e, transactionType, productType) {
        var dimensions = [];
        dimensions.push(createGaDimension("dimension20", '{"PropertyType":"' + transactionType + '","Type":"TransactionTable"}'));
        track(productType + "-Engagement", "Analyze", "Type=TransactionTable", null, null, dimensions)
    });
    $body.on("ga.price-trends-widget.bedrooms-dropdown", function(e, roomsSelected, productType) {
        var dimensions = [];
        dimensions.push(createGaDimension("dimension20", '{"Bedroom":"' + roomsSelected + '","Type":"PriceTrendChart"}'));
        track(productType + "-Engagement", "Analyze", "Type=PriceTrendChart", null, null, dimensions)
    });
    $body.on("ga.price-trends-widget.years-dropdown", function(e, years, productType) {
        var dimensions = [];
        dimensions.push(createGaDimension("dimension20", '{"Years":"' + years + '","Type":"PriceTrendChart"}'));
        track(productType + "-Engagement", "Analyze", "Type=PriceTrendChart", null, null, dimensions)
    });
    $body.on("ga.price-trends-widget.propertytype-dropdown", function(e, propertytype, productType) {
        var dimensions = [];
        dimensions.push(createGaDimension("dimension20", '{"PropertyType":"' + propertytype + '","Type":"PriceTrendChart"}'));
        track(productType + "-Engagement", "Analyze", "Type=PriceTrendChart", null, null, dimensions)
    });
    $body.on("ga.agent.enquire.intent", function(e) {
        label = "Agent Profile";
        track("Leads Generating", "Enquiry Submit Attempt", label, null, null, null);
        dataLayerEvent("agent.enquire.intent")
    });
    $body.on("ga.agent.directory.enquire.intent", function(e, listingId, agentId, developerListingId, section, label, dimensions) {
        if ($body.is(".agent-home") || $body.is(".agent-search")) {
            track("Leads Generating", "Enquiry Submit Attempt", label, null, null, dimensions);
            dataLayerEvent("agent.directory.enquire.intent")
        }
    });
    $body.on("ga.agent.enquire.success", function(e) {
        label = "Agent Profile";
        track("Leads Generating", "Enquiry Successful", label, null, null, null);
        dataLayerEvent("agent.enquire.success");
        $body.trigger("fbpixel.agent.enquire.success");
        var ecImpression = $(".js-contact-form").data("ec-impression");
        ecImpression.productData.dimension25 = ecImpression.productData.dimension25.toString();
        $("body").trigger("ga.ec.purchase", {
            currency: ecImpression.currency,
            productData: ecImpression.productData,
            purchaseType: "Message Agent"
        })
    });
    $body.on("ga.agent.visit.website", function(e) {
        var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
        var dimensions = [createGaDimension("dimension20", '{"Loc":"' + listName + '", "Type":"VisitWebsite"}')];
        addLocalDimensionIfExists("dimension27", dimensions);
        track("Sale-Conversion", "Lead", "Type=VisitWebsite", null, null, dimensions);
        var ecImpression = $(".js-contact-form").data("ec-impression");
        ecImpression.productData.dimension25 = ecImpression.productData.dimension25.toString();
        $("body").trigger("ga.ec.purchase", {
            currency: ecImpression.currency,
            productData: ecImpression.productData,
            purchaseType: "Visit website"
        })
    });
    $body.on("ga.agent.directory.enquire.success", function(e, listingId, agentId, developerListingId, section, label, dimensions) {
        if ($body.is(".agent-home") || $body.is(".agent-search")) {
            var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
            var dimension25 = createGaDimension("dimension25", agentId);
            var dimension20 = createGaDimension("dimension20", '{"Loc":"' + listName + '", "Type":"Email"}');
            dimensions = [dimension20, dimension25];
            track("Sale-Conversion", "Lead", "Type=Email", null, null, dimensions);
            dataLayerEvent("agent.directory.enquire.success");
            $body.trigger("fbpixel.agent.enquire.success");
            if ($("#ecImpression").length) {
                var ecImpression = $("#ecImpression").data("ec-impression");
                ecImpression.productData.dimension25 = ecImpression.productData.dimension25.toString();
                $("body").trigger("ga.ec.purchase", {
                    currency: ecImpression.currency,
                    productData: ecImpression.productData,
                    purchaseType: "Message Agent"
                })
            }
        }
    });
    $body.on("ga.listing_detail.enquire.intent", function(e, listingId, agentId, developerListingId, section, label, dimensions) {
        if ($body.is(".listing_detail")) {
            track("Leads Generating", "Enquiry Submit Attempt", label, null, null, dimensions);
            dataLayerEvent("listing_detail.enquire.intent")
        }
    });
    $body.on("ga.map.sort", function(e, field) {
        track("Searching", "Sort Listings", field)
    });
    $body.on("ga.map.page", function(e, pageNumber) {
        track("Searching", "Change Page", pageNumber)
    });
    $body.on("ga.map.error", function(e, errorElement) {
        track("Viewing Error", "Map search error", "More info: " + errorElement, undefined, true)
    });
    $body.on("ga.moneyCalculatorWidget.loaded", function() {
        try {
            if (typeof guruApp.moneyCalculatorWidgetData != "undefined") {
                var widgetData = guruApp.moneyCalculatorWidgetData;
                var labels = {
                    "cta-button": "Click " + widgetData.widget.analyticsEvents.button,
                    "bank-logo": "Click " + widgetData.widget.analyticsEvents.button,
                    "secondary-link": "Click " + widgetData.widget.analyticsEvents.link,
                    "interest-rate": "Edit Interest",
                    "loan-tenure": "Edit Tenure",
                    "loan-amount": "Edit Loan",
                    "widget-load": "Widget Load"
                };
                jQuery.each(labels, function(evt, label) {
                    $body.on("ga.money.widget." + evt, function() {
                        track("listingcalculator", "[" + widgetData.propertyType + "]" + "[" + widgetData.region + "]" + "[" + widgetData.language + "]", label, undefined, evt === "widget-load")
                    })
                })
            }
        } catch (err) {}
    });
    $body.on("ga.price-insights.mortage", function(event, action, label) {
        track("listingcalculator", action, label, undefined, false)
    });
    if (guruApp.listingSearch || typeof guruApp.condoSearch !== "undefined") {
        searchGaEvent.init();
        searchGaEvent.send()
    }
    if (guruApp.agentSearch) {
        if (guruApp.agentSearch.hasSearchSuggestion) {
            track("Finding Agent", "Zero Results Page", "Suggested Freetext Alternates", guruApp.agentSearch.agentsShownCount)
        } else if (guruApp.agentSearch.hasSearchSuggestionForced) {
            track("Finding Agent", "Zero Results Page", "Autocorrect Freetext", guruApp.agentSearch.agentsShownCount)
        } else if (guruApp.agentSearch.agentsShownCount === 0) {
            track("Finding Agent", "Zero Results Page", "Over filtering", guruApp.agentSearch.agentsShownCount)
        }
    }
    $body.on("click.ga", ".listing-mortgage a", function(e) {
        var $a = $(this)
          , $p = $a.closest("p");
        if ($p.is(".listing-mortgage-monthly")) {
            track("Analysing", "Estimated Mortgage", $a.data("tracking-label"))
        } else {
            track("Leads Generating", "Bank Lead Interest", $a.data("tracking-label"))
        }
    });
    $body.on("ga.listing.search.clicked", function(e, listingId) {
        var dimensions = [];
        if (typeof listingId != "undefined") {
            dimensions[dimensions.length] = createGaDimension("dimension7", listingId)
        }
        dimensions[dimensions.length] = createGaDimension("transport", "beacon");
        if (dimensions.length > 0) {
            track(gaCategoryPrefixFromSearchLayer + "Engagement", "Navigate", "Link=DetailListing", null, null, dimensions)
        }
    });
    EventDispatcher.addListener("shortlisted.add", function($element) {
        var location = guruApp.widgetGoogleAnalytics.dimensions.dimension2 == "Listing Detail" ? "RightSideBar" : "ListingSearch";
        if ($element.closest("#navbar-main").length) {
            location = "Header"
        }
        if ($element.hasClass("gallery-form__thankyou__btn-shortlist")) {
            location = "GalleryForm"
        }
        if ($element.hasClass("shortlist-tooltip-in-info-btn")) {
            location = "In-Page"
        }
        track(productType + "-Engagement", "Shortlist", "Loc=" + location, null, null, [createGaDimension("dimension20", JSON.stringify({
            Loc: location
        }))])
    });
    var shortlistedListingIdsCanceledWithHeader = [];
    EventDispatcher.addListener("shortlisted.del", function($element) {
        var listingId = parseInt($element.data("listing-id"), 10), location = "Header", index, categoryPrefix = productType, dimensionListingId = parseInt(guruApp.widgetGoogleAnalytics.dimensions.dimension7, 10);
        if ($element.length && listingId) {
            index = shortlistedListingIdsCanceledWithHeader.indexOf(listingId);
            if (index == -1) {
                location = "ListingSearch"
            } else {
                shortlistedListingIdsCanceledWithHeader.splice(index, 1)
            }
        } else if (guruApp.widgetGoogleAnalytics.dimensions.dimension2 == "Listing Detail" && dimensionListingId) {
            index = shortlistedListingIdsCanceledWithHeader.indexOf(dimensionListingId);
            if (index == -1 && $element.length && !$element.closest("#navbar-main").length) {
                location = "RightSideBar"
            } else {
                shortlistedListingIdsCanceledWithHeader.splice(index, 1)
            }
        } else {
            categoryPrefix = "Header"
        }
        if ($element.hasClass("gallery-form__thankyou__btn-shortlist")) {
            location = "GalleryForm"
        }
        if ($element.hasClass("shortlist-tooltip-in-info-btn")) {
            location = "In-Page"
        }
        track(categoryPrefix + "-Engagement", "UnShortlist", "Loc=" + location, null, null, [createGaDimension("dimension20", JSON.stringify({
            Loc: location
        }))])
    });
    $body.on("ga.listingResult.multiEnquire.cancel.clicked", function(e, listingId) {
        shortlistedListingIdsCanceledWithHeader.push(parseInt(listingId, 10))
    });
    $body.on("agent.singup.submitted", function() {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            User: "Agent"
        }))];
        track("AgentDirectory-Acquisition", "SignUp", "User=Agent", null, null, dimensions)
    });
    $body.on("ga.mainnav.areainsider.click", function() {
        var dimension20 = {
            Page: "AreaInsiderLandingPage",
            Loc: "HeaderMore"
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track("AreaInsider-Engagement", "NavigateToLanding", "Page=AreaInsiderLandingPage", null, null, dimensions)
    });
    $body.on("ga.listing.widgetSimilarListings.sponsorClick", function() {
        track(productType + "-Engagement", "Navigate", "Link=ExternalAd")
    });
    $body.on("ga.listing.widgetMapNearbyV2.detail.tab.click", function(e, tabName) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Tab: tabName
        }))];
        track(productType + "-Engagement", "Map-Detail", "Click " + tabName, null, null, dimensions)
    });
    $body.on("ga.listing.widgetMapNearbyV2.overview.gofullscreen", function(e, clickLocation, cards, commuteProvided) {
        var payload = [{
            ClickLocation: clickLocation
        }, {
            "Cards Visible": cards
        }, {
            CommuteProvided: commuteProvided
        }];
        var dimensions = [createGaDimension("dimension20", JSON.stringify(payload))];
        track(productType + "-Engagement", "Map-Overview", "Location=Overview", null, null, dimensions)
    });
    $body.on("ga.listing.widgetMapNearbyV2.overview.addcommute", function(e, screen, locations) {
        var payload = {};
        for (var i = 0; i < locations.length; i++) {
            payload["Location" + (i + 1)] = {
                PlaceID: locations[i].userSearchedPlaceId,
                Address: locations[i].locationAddress
            }
        }
        var dimensions = [createGaDimension("dimension20", JSON.stringify(payload))];
        track(productType + "-Engagement", "Map-Commute", "Location=" + screen, null, null, dimensions)
    });
    $body.on("ga.ec.listing_detail.impression", function(e, currency, productDetail) {
        trackEC(currency, "addProduct", productDetail, "productDetails", "DetailsView", true)
    });
    $body.on("ga.ec.listing.click", function(e, currency, productDetail) {
        var listName = productDetail["list"] || guruApp.widgetGoogleAnalytics.dimensions["dimension2"] || "";
        delete productDetail["list"];
        trackEC(currency, "addProduct", productDetail, "productClick", listName, false, null, {
            transport: "beacon"
        })
    });
    $body.on("ga.ec.agent.click", function(e, currency, productDetail) {
        var listName = productDetail["list"] || guruApp.widgetGoogleAnalytics.dimensions["dimension2"] || "";
        delete productDetail["list"];
        trackEC(currency, "addProduct", productDetail, "productClick", listName, false, null, {
            transport: "beacon"
        })
    });
    $body.on("ga.spotlightMediaTracking", function(event, product) {
        track(product.variant + "-Engagement", "Spotlight Image Scroll", product.mediaLabel, undefined, false, product.dimension)
    });
    $body.on("ga.ec.listing.impression", function(event, currency, impression, listName, options) {
        trackEC(currency, "addImpression", impression, "productImpression", listName, true, null, options)
    });
    $body.on("ga.ec.agent.click", function(e, currency, productDetail) {
        var listName = productDetail["list"] || guruApp.widgetGoogleAnalytics.dimensions["dimension2"] || "";
        delete productDetail["list"];
        trackEC(currency, "addProduct", productDetail, "productClick", listName, false, null, {
            transport: "beacon"
        })
    });
    $body.on("ga.ec.agent.impression", function(event, currency, impression, listName, options) {
        trackEC(currency, "addImpression", impression, "productImpression", listName, true, null, options)
    });
    (function() {
        var category = "Mortgage-Engagement";
        $body.on("ga.mortgageBank.openFlow", function(e, linkText, location) {
            track(category, "Navigate", linkText + " - " + location)
        });
        $body.on("ga.mortgageBank.isBankUser", function(e, isBankUser) {
            track(category, "Navigate", "Select Bank - " + isBankUser)
        });
        $body.on("ga.mortgageBank.isAuthenticated", function(e, isAuthenticated) {
            track(category, "DBS Auth", isAuthenticated)
        });
        $body.on("ga.mortgageBank.propertyType", function(e, propertyType) {
            track(category, "Navigate", "Select Property - " + propertyType)
        });
        $body.on("ga.mortgageBank.income", function(e) {
            track(category, "Navigate", "Income Details")
        });
        $body.on("ga.mortgageBank.liabilities", function(e) {
            track(category, "Navigate", "Liabilities Details")
        });
        $body.on("ga.mortgageBank.dob", function(e) {
            track(category, "Navigate", "Date of Birth provided")
        });
        $body.on("ga.mortgageBank.estimate", function(e, isSuccess, data) {
            var dimensions = [createGaDimension("dimension20", JSON.stringify(data))];
            track(category, "Estimate", isSuccess, null, null, dimensions)
        });
        $body.on("ga.mortgageBank.initiateApplication", function(e, isSuccess, data) {
            var dimensions = [createGaDimension("dimension20", JSON.stringify(data))];
            track(category, "Create Application - DBS", isSuccess, null, null, dimensions)
        });
        $body.on("ga.mortgageBank.close", function(e, stepName) {
            track(category, "Navigate", "Flow closed -" + stepName)
        })
    }
    )();
    var EcCart = function(key) {
        this.key = key;
        if (window.localStorage) {
            this.cart = JSON.parse(window.localStorage.getItem(this.key)) || []
        } else {
            this.cart = []
        }
    };
    EcCart.prototype.addToCart = function(item) {
        this.clearExpired();
        var index = this.findProduct(item);
        if (index === -1) {
            item.timestamp = Date.now();
            this.cart.push(item);
            if (window.localStorage) {
                window.localStorage.setItem(this.key, JSON.stringify(this.cart))
            }
            trackEC(item.currency, "addProduct", item.productData, "addToCart", item.addToCartEventName)
        }
    }
    ;
    EcCart.prototype.purchase = function(item) {
        this.clearExpired();
        var index = this.findProduct(item);
        if (index === -1) {
            trackEC(item.currency, "addProduct", item.productData, "addToCart", item.purchaseType);
            trackEC(item.currency, "addProduct", item.productData, "purchase", item.purchaseType)
        } else {
            this.cart.splice(index, 1);
            if (window.localStorage) {
                window.localStorage.setItem(this.key, JSON.stringify(this.cart))
            }
            trackEC(item.currency, "addProduct", item.productData, "purchase", item.purchaseType)
        }
    }
    ;
    EcCart.prototype.clearExpired = function() {
        var index = 0;
        while (index < this.cart.length) {
            if (this.isProductExpired(this.cart[index])) {
                this.cart.splice(index, 1)
            } else {
                ++index
            }
        }
        if (window.localStorage) {
            window.localStorage.setItem(this.key, JSON.stringify(this.cart))
        }
    }
    ;
    EcCart.prototype.isProductExpired = function(item) {
        return Date.now() - item.timestamp > 30 * 24 * 3600 * 1e3
    }
    ;
    EcCart.prototype.findProduct = function(item) {
        if (item && item.productData) {
            for (var i = 0; i < this.cart.length; ++i) {
                if (typeof this.cart[i].productData !== "undefined" && typeof this.cart[i].productData.id !== "undefined" && typeof item.productData.id !== "undefined") {
                    if (this.cart[i].productData.id === item.productData.id) {
                        return i
                    }
                }
            }
        }
        return -1
    }
    ;
    var gaEcCart = new EcCart("ga-ec-cart");
    $body.on("ga.ec.addToCart", function(event, product) {
        gaEcCart.addToCart(product)
    });
    $body.on("ga.ec.purchase", function(event, product) {
        gaEcCart.purchase(product)
    });
    $body.on("ga.price-widget.tracking", function(event, transType, tabName, isDataAvailable) {
        var payload = [{
            Tab: tabName
        }, {
            "Data Available": isDataAvailable ? "Yes" : "No"
        }];
        var dimensions = [createGaDimension("dimension20", JSON.stringify(payload))];
        track(transType + "-Engagement", "Price Widget", tabName, undefined, false, dimensions)
    });
    $body.on("ga.homepage.collection.click", function(event, category, collection, label, searchUrl, listingNum) {
        var payload = {
            "Search Url": searchUrl,
            "Number of listings": listingNum
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(payload))];
        track(category, collection, label, undefined, false, dimensions)
    });
    $body.on("ga.gallery.cta.click", function(event) {
        var categoryPrefix = gaCategoryPrefixFromDataLayer
          , dimensions = dimensions || [];
        track(categoryPrefix + "Engagement", "Scroll", "CTRGalleryForm", null, null, dimensions)
    });
    $body.on("ga.gallery.form.visible", function(event) {
        var categoryPrefix = gaCategoryPrefixFromDataLayer
          , dimensions = dimensions || [];
        track(categoryPrefix + "Engagement", "Scroll", "ViewGalleryForm", null, null, dimensions)
    });
    $body.on("ga.listing.continue-with-fb.visible", function(event) {
        var categoryPrefix = gaCategoryPrefixFromDataLayer
          , dimensions = dimensions || [];
        track(categoryPrefix + "Experiment", "FB Button Listing Detail", "Visible = True", null, null, dimensions)
    });
    $body.on("ga.listing.continue-with-fb.click", function(event) {
        var categoryPrefix = gaCategoryPrefixFromDataLayer
          , dimensions = dimensions || [];
        track(categoryPrefix + "Experiment", "FB Button Listing Detail", "Click = True", null, null, dimensions)
    });
    $body.on("ga.listing.continue-with-fb.success", function(event) {
        var categoryPrefix = gaCategoryPrefixFromDataLayer
          , dimensions = dimensions || [];
        track(categoryPrefix + "Experiment", "FB Button Listing Detail", "Success = True", null, null, dimensions)
    });
    $body.on("ga.login.continue-with-fb.click", function(event) {
        var categoryPrefix = gaCategoryPrefixFromDataLayer
          , dimensions = dimensions || [];
        track("Personalizing", "Facebook Login Attempt", "Page", null, "non-interactive")
    });
    $body.on("ga.signup.continue-with-fb.click", function(event) {
        var categoryPrefix = gaCategoryPrefixFromDataLayer
          , dimensions = dimensions || [];
        track("Personalizing", "Facebook Registration Submit Attempt", "Page", null, "non-interactive")
    });
    $body.on("ga.login.tooltip.click", function(event) {
        track("Membership-Acquisition", "Login", "Loc=tooltip", null, null, null)
    });
    $body.on("ga.listing.details.property-estimate.helper-opened", function() {
        track("Sale-Experiment", "Price Estimate", "Tap", null, null, null)
    });
    $body.on("ga.listing.details.property-estimate.feedback-submitted", function(event, rating, feedback) {
        var dimension20 = {
            rating: rating,
            feedback: feedback
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track("Sale-Experiment", "Price Estimate", "Feedback", null, null, dimensions)
    });
    $body.on("ga.hlpa.loan-amount-calculated", function(event, loanAmount) {
        var label = JSON.stringify(loanAmount);
        track("Sale-Engagement", "Mortgage Prequalifier", label, null, null, null)
    });
    $body.on("ga.listing.details.price-insights.engagement", function(event, listingType) {
        var category = listingType === "sale" ? "Sale-Engagement" : "Rent-Engagement";
        track(category, "Price Widget", "On ViewPort", null, null, null)
    });
    $body.on("ga.hlpa.myproperty.click", function(event, trackingData) {
        var action = trackingData.action;
        var label = JSON.stringify(trackingData.label);
        track("HomeLoanPreApprovalTool-Engagement", action, label, null, null, null)
    });
    $body.on("ga.hlpa.myproperty.conversion", function(event, trackingData) {
        var action = trackingData.action;
        var label = JSON.stringify(trackingData.label);
        track("HomeLoanPreApprovalTool-Conversion", action, label, null, null, null)
    });
    $body.on("ga.hlpa.myproperty.pageview", function(event, url) {
        ga("send", "pageview", url)
    });
    $body.on("ga.genericHlpaTracker", function(event, hlpaTrackingData) {
        dimensions = [createGaDimension("dimension20", JSON.stringify(hlpaTrackingData.payload))];
        track(hlpaTrackingData.category, hlpaTrackingData.action, hlpaTrackingData.label, null, null, dimensions)
    });
    $body.on("ga.listing.details.trackCommute", function(event, data, type) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify(data))];
        track(guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType() + "-Engagement", "Commute Time", type + " / Type (" + data.type + ")", null, null, dimensions)
    });
    $body.on("ga.widgets.contentWidget", function(event, payload) {
        var category = payload.item_type.substr(0, 1).toUpperCase() + payload.item_type.substr(1);
        var dimensions = [createGaDimension("dimension20", JSON.stringify(payload))];
        track("ContentWidget", "Click", category, null, null, dimensions)
    });
    if ($body.is(".agent-details")) {
        var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
        var ecImpression = $(".js-contact-form").data("ec-impression");
        trackEC(ecImpression.currency, "addProduct", ecImpression.productData, "productDetails", listName, false, null, {
            nonInteraction: true
        })
    }
    var bodyDom = $body[0];
    bodyDom.addEventListener("ga.mortgage.calculator.inputs.submitForm", function() {
        track("Affordability Calculator", "Click", "Calculate my affordability", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.inputs.goBackToTop", function() {
        track("Affordability Calculator", "Click", "Back to Top", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.result.moveSlider", function() {
        track("Affordability Results", "Moved", "Slider", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.result.showInputSummary", function() {
        track("Affordability Results", "Click", "Show input details", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.result.moreFinancialInformation", function() {
        track("Affordability Results", "Click", "Read financial Glossary", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.result.editInputs", function() {
        track("Affordability Results", "Click", "Edit inputs", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.result.next.showFindHomes", function() {
        track("Affordability Next Steps", "View", "Find homes", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.result.next.goFindHomes", function() {
        track("Affordability Next Steps", "Click", "Find homes", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.result.next.showCompareLoans", function() {
        track("Affordability Next Steps", "View", "Compare loans", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.result.next.goCompareLoans", function() {
        track("Affordability Next Steps", "Click", "Compare loans", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.contact.form.enquire", function() {
        track("Mortgage-Conversion", "Lead", "Type=EnquiryForm", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.result.enquiryWidget.open", function() {
        track("Mortgage-Engagement", "Open Enquiry Widget", "Loc=AffordabilityCalculator", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.calculator.result.enquiryWidget.submit", function() {
        track("Mortgage-Conversion", "Lead", "Loc=AffordabilityCalculator", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.loan.landing.header.enquiryWidget.open", function() {
        track("Mortgage-Engagement", "Open Enquiry Widget", "Loc=LoansLanding_Header", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.loan.landing.private.enquiryWidget.open", function() {
        track("Mortgage-Engagement", "Open Enquiry Widget", "Loc=LoansLanding_Private", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.loan.landing.hdb.enquiryWidget.open", function() {
        track("Mortgage-Engagement", "Open Enquiry Widget", "Loc=LoansLanding_HDB", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.loan.landing.advisor.enquiryWidget.open", function() {
        track("Mortgage-Engagement", "Open Enquiry Widget", "Loc=LoansLanding_Advisors", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.loan.landing.header.enquiryWidget.submit", function() {
        track("Mortgage-Conversion", "Lead", "Loc=LoansLanding_Header", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.loan.landing.private.enquiryWidget.submit", function() {
        track("Mortgage-Conversion", "Lead", "Loc=LoansLanding_Private", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.loan.landing.hdb.enquiryWidget.submit", function() {
        track("Mortgage-Conversion", "Lead", "Loc=LoansLanding_HDB", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.loan.landing.advisor.enquiryWidget.submit", function() {
        track("Mortgage-Conversion", "Lead", "Loc=LoansLanding_Advisors", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.landing.header.cta", function() {
        track("Mortgage-Engagement", "Navigate", "Link=FinanceLanding_Header", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.landing.journey.affordability.cta", function() {
        track("Mortgage-Engagement", "Navigate", "Link=FinanceLanding_Affordability", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.landing.journey.loans.cta", function() {
        track("Mortgage-Engagement", "Navigate", "Link=FinanceLanding_Loans", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.landing.advisor.enquiryWidget.open", function() {
        track("Mortgage-Engagement", "Open Enquiry Widget", "Loc=FinanceLanding_Advisors", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.landing.advisor.enquiryWidget.submit", function() {
        track("Mortgage-Conversion", "Lead", "Loc=FinanceLanding_Advisors", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.landing.blog.readMore", function() {
        track("Mortgage-Engagement", "Navigate", "Link=FinanceLanding_Blog", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.landing.blog.article", function() {
        track("Mortgage-Engagement", "Navigate", "Link=FinanceLanding_Article", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.landing.faq", function() {
        track("Mortgage-Engagement", "Navigate", "Link=FinanceLanding_FAQ", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.landing.footer.cta", function() {
        track("Mortgage-Engagement", "Navigate", "Link=FinanceLanding_BottomCTA", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.filter.completed", function() {
        track("Mortgage-Engagement", "Filter", "Select=PropertyStatus_Completed", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.filter.construction", function() {
        track("Mortgage-Engagement", "Filter", "Select=PropertyStatus_UnderConstruction", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.private.enquiryWidget.open", function() {
        track("Mortgage-Engagement", "Open Enquiry Widget", "Loc=LoanResults_PrivateProperty", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.hdb.enquiryWidget.open", function() {
        track("Mortgage-Engagement", "Open Enquiry Widget", "Loc=LoanResults_HDB", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.help.enquiryWidget.open", function() {
        track("Mortgage-Engagement", "Open Enquiry Widget", "Loc=LoanResults_Help", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.private.enquiryWidget.submit", function(event) {
        var dimensions = null;
        if (event.detail) {
            dimensions = [createGaDimension("dimension20", JSON.stringify(event.detail))]
        }
        track("Mortgage-Conversion", "Lead", "Loc=LoanResults_PrivateProperty", null, null, dimensions)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.hdb.enquiryWidget.submit", function(event) {
        var dimensions = null;
        if (event.detail) {
            dimensions = [createGaDimension("dimension20", JSON.stringify(event.detail))]
        }
        track("Mortgage-Conversion", "Lead", "Loc=LoanResults_HDB", null, null, dimensions)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.help.enquiryWidget.submit", function() {
        track("Mortgage-Conversion", "Lead", "Loc=LoanResults_Help", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.hdb.link.private", function() {
        track("Mortgage-Engagement", "Navigate", "Link=LoanResults_PrivateProperty", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.private.link.hdb", function() {
        track("Mortgage-Engagement", "Navigate", "Link=LoanResults_HDB", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.faq", function() {
        track("Mortgage-Engagement", "Navigate", "Link=LoanResults_FAQ", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.blog.readMore", function() {
        track("Mortgage-Engagement", "Navigate", "Link=LoanResults_Blog", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.blog.article", function() {
        track("Mortgage-Engagement", "Navigate", "Link=LoanResults_Article", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.calculator.mortgage.calculate", function() {
        track("Mortgage-Engagement", "Navigate", "Link=LoanResults_MortgageCalculator", null, null, null)
    });
    bodyDom.addEventListener("ga.mortgage.finance.loan.result.calculator.refinance.calculate", function() {
        track("Mortgage-Engagement", "Navigate", "Link=LoanResults_RefinanceCalculator", null, null, null)
    })
});
$(document).ready(function() {
    "use strict";
    var $body = $("body");
    function trackECListings(listings) {
        if (!listings || listings.length === 0) {
            return
        }
        var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
        var options = {
            commit: false
        }
          , maxAllowedBytes = 8192
          , payloadBytes = 0
          , count = 0
          , average = 0;
        for (var i = 0; i < listings.length; ++i) {
            var payload = [listings[i].currency, listings[i].productData, listName, options];
            count = i + 1;
            payloadBytes += encodeURIComponent(JSON.stringify(payload)).length;
            average = payloadBytes / count;
            if (payloadBytes >= maxAllowedBytes - average || i === listings.length - 1) {
                payloadBytes = 0;
                options.commit = true
            } else {
                options.commit = false
            }
            $body.trigger("ga.ec.listing.impression", payload)
        }
    }
    function trackECWidgetClick($elements, listings) {
        $elements.each(function(index) {
            var $listItem = $(this);
            var ecListings = listings[index];
            if (ecListings !== undefined) {
                $listItem.on("click.ec-tracking", function(e) {
                    var clickedElementType = e.target.nodeName;
                    if ("A" == clickedElementType || "IMG" == clickedElementType) {
                        $body.trigger("ga.ec.listing.click", [ecListings.currency, ecListings.productData])
                    }
                })
            }
        })
    }
    function trackECSearchListingClick($elements, listings) {
        $elements.each(function(index) {
            var $listItem = $(this);
            var ecListings = listings[index];
            if (ecListings !== undefined) {
                $listItem.on("click.ec-tracking", function(e) {
                    var $clickElement = $(e.target);
                    var $btnTools = $listItem.find(".btn-tools");
                    if (0 == $btnTools.has($clickElement).length) {
                        $body.trigger("ga.ec.listing.click", [ecListings.currency, ecListings.productData])
                    }
                })
            }
        })
    }
    function trackECDeveloperCarouselWidgetClick($elements, listings) {
        $elements.each(function(index) {
            var $listItem = $(this);
            var $parents = $listItem.parentsUntil(".cycle-slideshow");
            var actualindex = $($parents[$parents.length - 1]).index();
            var ecListings = listings[actualindex];
            if (ecListings !== undefined) {
                $listItem.on("click.ec-tracking", function(e) {
                    $body.trigger("ga.ec.listing.click", [ecListings.currency, ecListings.productData])
                })
            }
        })
    }
    function initECTrackedItems() {
        $("a[data-ec-tracked-item-id],img[data-ec-tracked-item-id]").each(function() {
            $(this).on("click.ec-tracking", trackECItem)
        })
    }
    function trackECItem(event) {
        var ecListing = findECListingByProductDataId($(event.target).data("ec-tracked-item-id"));
        if (ecListing) {
            $body.trigger("ga.ec.listing.click", [ecListing.currency, ecListing.productData])
        }
    }
    function findECListingByProductDataId(id) {
        var ecListing = null;
        $(guruApp.ecListings).each(function() {
            if (id === this.productData.id) {
                ecListing = this;
                return false
            }
        });
        return ecListing
    }
    (function() {
        initECTrackedItems();
        if ($body.is(".agent-home") || $body.is(".agent-search") || $body.is(".listing_detail") || $body.is(".SG-condo-directory") || $body.is(".SG-singapore-property-listing-hdb") || $body.is(".district") || $body.is(".state") || $body.is(".territory") || $body.is(".landing-condo") || $body.is(".listing-condo")) {
            var featuredAgentBoxs = $body.find(".featured-agent");
            featuredAgentBoxs.each(function(index) {
                var $listItem = $(this);
                var ecImpression = $listItem.data("ec-impression");
                if (ecImpression) {
                    var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
                    if (!ecImpression.productData.list) {
                        ecImpression.productData.list = listName
                    }
                    var options = {
                        commit: false
                    };
                    if (index === featuredAgentBoxs.length - 1) {
                        options.commit = true
                    }
                    $listItem.find(".images a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $listItem.find(".agent-name a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $body.trigger("ga.ec.agent.impression", [ecImpression.currency, ecImpression.productData, listName, options]);
                    $listItem.find(".btn-contact").on("click", function(e) {
                        if ($("#ecImpression").length == 0) {
                            $("<input id='ecImpression' data-ec-impression='" + JSON.stringify(ecImpression) + "' type='hidden'>").appendTo("body")
                        } else {
                            $("#ecImpression").attr("data-ec-impression", JSON.stringify(ecImpression))
                        }
                        ecImpression.productData.dimension25 = ecImpression.productData.dimension25.toString();
                        $("body").trigger("ga.ec.addToCart", {
                            currency: ecImpression.currency,
                            productData: ecImpression.productData,
                            addToCartEventName: "Contact Agent"
                        });
                        $("body").trigger("ga.ec.purchase", {
                            currency: ecImpression.currency,
                            productData: ecImpression.productData,
                            purchaseType: "Contact Agent"
                        })
                    })
                }
            });
            var agentSpecialistLegacy = $body.find(".singapore-condo__specialists-section__content__agent__container");
            agentSpecialistLegacy.each(function(index) {
                var $listItem = $(this);
                var ecImpression = $listItem.data("ec-impression");
                if (ecImpression) {
                    var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
                    if (!ecImpression.productData.list) {
                        ecImpression.productData.list = listName
                    }
                    var options = {
                        commit: false
                    };
                    if (index === agentSpecialistLegacy.length - 1) {
                        options.commit = true
                    }
                    $listItem.find(".media-left a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $listItem.find(".list-group-item-heading a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $body.trigger("ga.ec.agent.impression", [ecImpression.currency, ecImpression.productData, listName, options])
                }
            });
            var agentSpecialistLegacy = $body.find(".singapore-property-listing-hdb-page__specialists-section__content__agent");
            agentSpecialistLegacy.each(function(index) {
                var $listItem = $(this);
                var ecImpression = $listItem.data("ec-impression");
                if (ecImpression) {
                    var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
                    if (!ecImpression.productData.list) {
                        ecImpression.productData.list = listName
                    }
                    var options = {
                        commit: false
                    };
                    if (index === agentSpecialistLegacy.length - 1) {
                        options.commit = true
                    }
                    $listItem.find(".singapore-property-listing-hdb-page__specialists-section__content__agent__image-container a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $listItem.find(".singapore-property-listing-hdb-page__specialists-section__content__agent__info a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $body.trigger("ga.ec.agent.impression", [ecImpression.currency, ecImpression.productData, listName, options])
                }
            });
            var agentSpecialist = $body.find(".specialist-agent-box");
            agentSpecialist.each(function(index) {
                var $listItem = $(this);
                var ecImpression = $listItem.data("ec-impression");
                if (ecImpression) {
                    var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
                    if (!ecImpression.productData.list) {
                        ecImpression.productData.list = listName
                    }
                    var options = {
                        commit: false
                    };
                    if (index === agentSpecialist.length - 1) {
                        options.commit = true
                    }
                    $listItem.find(".media-left:first-child a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $listItem.find(".list-group-item-heading:first-child a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $body.trigger("ga.ec.agent.impression", [ecImpression.currency, ecImpression.productData, listName, options]);
                    $listItem.find(".btn-contact").on("click", function(e) {
                        if ($("#ecImpression").length == 0) {
                            $("<input id='ecImpression' data-ec-impression='" + JSON.stringify(ecImpression) + "' type='hidden'>").appendTo("body")
                        } else {
                            $("#ecImpression").attr("data-ec-impression", JSON.stringify(ecImpression))
                        }
                    })
                }
            });
            var agentCard = $body.find(".agent-card");
            agentCard.each(function(index) {
                var $listItem = $(this);
                var ecImpression = $listItem.data("ec-impression");
                if (ecImpression) {
                    var listName = guruApp.widgetGoogleAnalytics.dimensions.dimension2;
                    if (!ecImpression.productData.list) {
                        ecImpression.productData.list = listName
                    }
                    var options = {
                        commit: false
                    };
                    if (index === agentCard.length - 1) {
                        options.commit = true
                    }
                    $listItem.find(".agent-photo a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $listItem.find(".agent-info-name a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $listItem.find(".agent-name a").on("click.ec-tracking", function(e) {
                        $body.trigger("ga.ec.agent.click", [ecImpression.currency, ecImpression.productData])
                    });
                    $body.trigger("ga.ec.agent.impression", [ecImpression.currency, ecImpression.productData, listName, options])
                }
            })
        }
        if ($body.is(".listing_detail")) {
            if (guruApp.listingDetail !== undefined) {
                var currency = guruApp.listingDetail.gaECCurrency
                  , productData = guruApp.listingDetail.gaECData;
                if (currency !== undefined && productData !== undefined) {
                    $body.trigger("ga.ec.listing_detail.impression", [currency, productData])
                }
            }
        }
        if ($body.is(".listing") || $body.is(".listing-overseas")) {
            if (guruApp.listingResultsWidget && guruApp.listingResultsWidget.gaECListings) {
                trackECSearchListingClick($(".listing-list .listing-item, .listing-widget-new .listing-card"), guruApp.listingResultsWidget.gaECListings);
                trackECListings(guruApp.listingResultsWidget.gaECListings)
            }
            if (guruApp.newProjectWidgets && guruApp.newProjectWidgets.gaECListings) {
                trackECListings(guruApp.newProjectWidgets.gaECListings);
                trackECWidgetClick($(".new-projects-box .list-group .list-group-item"), guruApp.newProjectWidgets.gaECListings)
            }
            if (guruApp.featuredListingSidebox && guruApp.featuredListingSidebox.gaECListings) {
                trackECListings(guruApp.featuredListingSidebox.gaECListings);
                trackECWidgetClick($(".featured-listing-sidebox .list-group .list-group-item"), guruApp.featuredListingSidebox.gaECListings)
            }
            var getECDataByListingId = function(listingId) {
                if (guruApp.listingResultsWidget && guruApp.listingResultsWidget.gaECListings) {
                    for (var i = 0; i < guruApp.listingResultsWidget.gaECListings.length; ++i) {
                        var listItem = guruApp.listingResultsWidget.gaECListings[i];
                        if (listItem.productData.id === listingId) {
                            return {
                                currency: listItem.currency,
                                productData: {
                                    id: listItem.productData.id,
                                    name: listItem.productData.name,
                                    price: listItem.productData.price,
                                    category: listItem.productData.category,
                                    brand: listItem.productData.brand,
                                    variant: listItem.productData.variant,
                                    quantity: 1,
                                    dimension22: listItem.productData.dimension22,
                                    dimension23: listItem.productData.dimension23,
                                    dimension24: listItem.productData.dimension24,
                                    dimension25: listItem.productData.dimension25
                                }
                            }
                        }
                    }
                }
                return null
            };
            $(".js-agent-phone-number, .js-agent-phone-number-call").on("click", function() {
                var listingId = $(this).data("listing-id");
                guruApp.fn.purchaseListingItem(listingId, "View Phone (Listing Card)")
            });
            $(".btn-agent-contact-mail, .btn-tools .sms-button").on("click", function() {
                var listingId = $(this).data("listing-id");
                guruApp.fn.purchaseListingItem(listingId, "Message Agent (Listing Card)")
            });
            $(".gallery-wrapper .crousel-navigation").on("click", function() {
                var $this = $(this)
                  , listingId = $this.parents(".listing-card").data("listing-id")
                  , ecData = getECDataByListingId(listingId);
                if (ecData) {
                    var productData = ecData.productData;
                    var dimension20 = JSON.parse(productData.dimension22);
                    dimension20.listingId = productData.id;
                    dimension20.direction = $this.hasClass("next") ? "next" : "prev";
                    dimension20 = [guruApp.widgetGoogleAnalytics.googleAnalyticsObject.createGaDimension("dimension20", JSON.stringify(dimension20))];
                    $("body").trigger("ga.spotlightMediaTracking", {
                        variant: productData.variant,
                        mediaLabel: "Image " + $this.parents(".gallery-wrapper").data("current-tab"),
                        dimension: dimension20
                    })
                }
            })
        }
        if ($body.is(".new-projects") || $body.is(".overseas")) {
            if (guruApp.featuredProjectWidget && guruApp.featuredProjectWidget.gaECListings) {
                trackECListings(guruApp.featuredProjectWidget.gaECListings);
                trackECWidgetClick($("#carousel-featured-project .cycle-slideshow .item"), guruApp.featuredProjectWidget.gaECListings);
                trackECWidgetClick($("#carousel-featured-project .carousel-indicators li a"), guruApp.featuredProjectWidget.gaECListings);
                trackECDeveloperCarouselWidgetClick($('#carousel-featured-project .cycle-slideshow .item div[data-id="featured-newprojects"] a'), guruApp.featuredProjectWidget.gaECListings)
            }
        }
        if ($body.is(".home")) {
            if (guruApp.featureDeveloperWidget && guruApp.featureDeveloperWidget.gaECListings) {
                trackECListings(guruApp.featureDeveloperWidget.gaECListings);
                trackECWidgetClick($(".box-featured-new-projects .carousel-listing").find(".card-container"), guruApp.featureDeveloperWidget.gaECListings)
            }
        }
    }
    )()
});
(function($, global) {
    "use strict";
    function FbPixel(fbq) {
        this.fbq = fbq;
        this.isPixelLoaded = false;
        this.logger = new Logger("FBPixel event")
    }
    FbPixel.prototype.trackPageView = function() {
        this.logger.log("Pageview");
        this.track("track", "PageView")
    }
    ;
    FbPixel.prototype.track = function track(type, eventName, category, action, label, value) {
        var params = {};
        if (typeof category !== "undefined") {
            params["category"] = category
        }
        if (typeof action !== "undefined") {
            params["action"] = action
        }
        if (typeof label !== "undefined") {
            params["label"] = label
        }
        if (typeof value !== "undefined") {
            params["value"] = value
        }
        if (typeof this.fbq === "function") {
            this.fbq(type, eventName, params)
        }
    }
    ;
    FbPixel.prototype.getEventNameFromSection = function getEventNameFromSection(section) {
        var eventName = {
            "Property Review": "PropertyReviewLead",
            Overseas: "OverseasLead",
            "New Projects": "NewProjectLead"
        };
        if (eventName.hasOwnProperty(section)) {
            return eventName[section]
        }
        return null
    }
    ;
    FbPixel.prototype.start = function start() {
        (function(fbPixel) {
            $(function() {
                var $body = $("body")
                  , trackLeadEvent = function(actionName) {
                    if (dataLayer && dataLayer[0] && dataLayer[0]["listingId"]) {
                        var trackingObject = {
                            content_ids: [dataLayer[0]["listingId"]],
                            category: "Leads Generating",
                            action: actionName,
                            property_type: dataLayer[0]["listingPropertyType"],
                            listing_type: dataLayer[0]["listingType"],
                            area: dataLayer[0]["listingArea"],
                            bedroom: dataLayer[0]["listingBedrooms"] || "",
                            floor_size: dataLayer[0]["listingFloorArea"] || "",
                            price: dataLayer[0]["listingPrice"],
                            currency: dataLayer[0]["listingCurrency"],
                            content_type: "product"
                        };
                        switch (dataLayer[0]["listingCurrency"]) {
                        case "SGD":
                        case "MYR":
                            fbPixel.fbq("track", "Lead", $.extend({}, trackingObject, {
                                region: dataLayer[0]["listingRegion"]
                            }));
                            break;
                        case "IDR":
                        case "THB":
                            fbPixel.fbq("track", "Lead", $.extend({}, trackingObject, {
                                city: dataLayer[0]["listingDistrict"],
                                province: dataLayer[0]["listingRegion"]
                            }));
                            break
                        }
                    }
                }
                  , trackPurchaseEvent = function() {
                    if (dataLayer && dataLayer[0] && dataLayer[0]["listingId"]) {
                        fbPixel.fbq("track", "Purchase", {
                            content_ids: [dataLayer[0]["listingId"]],
                            content_type: "product",
                            content_name: dataLayer[0]["listingPropertyType"],
                            content_category: dataLayer[0]["listingIsNewHome"] ? "new projects" : dataLayer[0]["listingType"],
                            value: 1,
                            currency: dataLayer[0]["listingCurrency"]
                        })
                    }
                };
                $body.on("fbpixel.phone.show", function(e, listingId, agentId, developerListingId, section, label) {
                    if (listingId) {
                        fbPixel.track("trackCustom", "Lead", "Leads Generating", "View Phone Number", null, 1);
                        trackLeadEvent("View Phone Number");
                        fbPixel.logger.log("phone.show")
                    } else if (developerListingId) {
                        fbPixel.track("trackCustom", fbPixel.getEventNameFromSection(section), section, "Leads View Phone Number", null, 1);
                        trackLeadEvent("View Phone Number");
                        fbPixel.logger.log("phone.show")
                    }
                });
                $body.on("fbpixel.enquiry.form.open", function() {
                    fbPixel.track("trackCustom", "Lead", "Leads Generating", "Enquiry Form Open Attempt", null, 1);
                    trackLeadEvent("Open Enquiry Form");
                    fbPixel.logger.log("enquiry.form.open")
                });
                $body.on("fbpixel.phone.whatsapp", function() {
                    trackLeadEvent("Whatsapp Message");
                    fbPixel.logger.log("Whatsapp")
                });
                $body.on("fbpixel.resale.phone.click", function(e, position, listingId, agentId) {
                    fbPixel.track("trackCustom", "Lead", "Leads Generating", "Calling Phone Number", null, 1);
                    trackLeadEvent("Calling Phone Number");
                    fbPixel.logger.log("phone.click")
                });
                $body.on("fbpixel.phone.sms", function() {
                    fbPixel.track("trackCustom", "Lead", "Leads Generating", "SMS Phone Number", null, 1);
                    trackLeadEvent("SMS Phone Number");
                    fbPixel.logger.log("phone.sms")
                });
                $body.on("fbpixel.agent.enquire.success", function(e) {
                    fbPixel.track("trackCustom", "Lead", "Leads Generating", "Successful Enquiry ", null, 1);
                    fbPixel.logger.log("agent.enquire.success")
                });
                $body.on("fbpixel.listing.enquire.success", function(e, form, listingId) {
                    trackLeadEvent("Successful Enquiry");
                    trackPurchaseEvent();
                    fbPixel.logger.log("listing.enquire.success")
                });
                $body.on("fbpixel.dev-listing.enquire.success", function(e, section, form) {
                    if (section) {
                        fbPixel.track("trackCustom", fbPixel.getEventNameFromSection(section), section, "Leads Successful Enquiry", null, 1);
                        trackPurchaseEvent();
                        fbPixel.logger.log("dev-listing.enquire.success")
                    }
                });
                $body.on("fbpixel.dev-listing.enquirerelatedproject.success", function(e, i, form, section, listingId) {
                    if (section) {
                        fbPixel.track("trackCustom", fbPixel.getEventNameFromSection(section), section, "Leads Successful Enquiry", null, 1);
                        fbPixel.logger.log("dev-listing.enquirerelatedproject.success")
                    }
                });
                $body.on("fbpixel.newproject.phone.click", function(e, position, section) {
                    if (section) {
                        fbPixel.track("trackCustom", fbPixel.getEventNameFromSection(section), section, "Leads Calling Phone Number", null, 1);
                        fbPixel.logger.log("dev-listing.phone.click")
                    }
                });
                $body.on("fbpixel.hlpa.myproperty.click", function(event, trackingData) {
                    fbq("trackCustom", "HomeLoanPreApprovalTool", trackingData)
                });
                $(document).ready(function() {
                    if ($body.is(".listing_detail")) {
                        if (dataLayer && dataLayer[0] && dataLayer[0]["listingId"]) {
                            var trackingObject = {
                                content_ids: [dataLayer[0]["listingId"]],
                                property_type: dataLayer[0]["listingPropertyType"],
                                listing_type: dataLayer[0]["listingIsNewHome"] ? "new projects" : dataLayer[0]["listingType"],
                                area: dataLayer[0]["listingArea"],
                                bedroom: dataLayer[0]["listingBedrooms"],
                                floor_size: dataLayer[0]["listingFloorArea"],
                                price: dataLayer[0]["listingPrice"],
                                currency: dataLayer[0]["listingCurrency"],
                                content_type: "product"
                            };
                            switch (dataLayer[0]["listingCurrency"]) {
                            case "SGD":
                            case "MYR":
                                fbPixel.fbq("track", "Listing Detail", $.extend({}, trackingObject, {
                                    region: dataLayer[0]["listingRegion"]
                                }));
                                fbPixel.logger.log("ListingDetail");
                                break;
                            case "IDR":
                            case "THB":
                                fbPixel.fbq("track", "Listing Detail", $.extend({}, trackingObject, {
                                    city: dataLayer[0]["listingDistrict"],
                                    province: dataLayer[0]["listingRegion"]
                                }));
                                fbPixel.logger.log("ListingDetail");
                                break
                            }
                            fbPixel.logger.log("ViewContent");
                            fbPixel.fbq("track", "ViewContent", {
                                content_ids: [dataLayer[0]["listingId"]],
                                content_type: "product",
                                content_name: dataLayer[0]["listingPropertyType"],
                                content_category: dataLayer[0]["listingIsNewHome"] ? "new projects" : dataLayer[0]["listingType"],
                                value: 0,
                                currency: dataLayer[0]["listingCurrency"]
                            })
                        }
                    }
                })
            })
        }
        )(this);
        this.isPixelLoaded = true
    }
    ;
    global.FbPixel = FbPixel
}
)(jQuery, window);
$(document).ready(function() {
    (function($) {
        var ShortlistRenderer = {
            storageKey: "web.multiple-enquire",
            $shortlistBox: null,
            $dropdownToggle: null,
            $loading: null,
            shortlistUrl: null,
            $items: [],
            init: function() {
                this.$shortlistBox = $("#multiple-enquire");
                this.$items = this.$shortlistBox.find(".mltp-listings-items-container");
                this.$dropdownToggle = this.$shortlistBox.closest(".dropdown");
                this.$loading = this.$shortlistBox.find(".shortlist-loading");
                this.shortlistUrl = this.$shortlistBox.data("get-shortlists-url");
                if (!this.$shortlistBox.length) {
                    $(".contactmultiple-page form").on("submit", function(e) {
                        var listingIds = [];
                        $(this).find("input.cart_ids:checked").each(function() {
                            var val = $(this).val();
                            if (val) {
                                listingIds.push(val)
                            }
                        });
                        $(this).trigger("ga.listingResult.multiEnquire.submit.form", [listingIds]);
                        if (window.localStorage && window.localStorage.getItem(this.storageKey)) {
                            window.localStorage.removeItem(this.storageKey)
                        }
                    });
                    return
                }
                this.$items.on("click", ".pgicon-cancel", function(e) {
                    e.preventDefault();
                    var $removeBtn = $(this)
                      , $li = $removeBtn.closest("li.listing-item")
                      , listingId = $li.find("input[name^=id]").val()
                      , $listing = $(".listing-id-" + listingId).not($li)
                      , delAction = $removeBtn.data("action-del");
                    ShortlistRenderer.$shortlistBox.trigger("ga.listingResult.multiEnquire.cancel.clicked", [listingId]);
                    if ($listing.length) {
                        $listing.find(".btn-shortlist.shortlisted").trigger("click")
                    } else {
                        ShortlistRenderer.unShortlist(delAction, listingId)
                    }
                    return false
                });
                this.$shortlistBox.find("form").on("submit", function(e) {
                    ShortlistRenderer.submittedShortlist()
                });
                this.$dropdownToggle.on("show.bs.dropdown", function(e) {
                    var $dropdown = $(this);
                    if (!ShortlistRenderer.$dropdownToggle.is(".fake-open") && $dropdown.find(".js-session-saved-properties.hasCount")) {
                        ShortlistRenderer.loadShortlistContent()
                    }
                    if (ShortlistRenderer.$dropdownToggle.is(".fake-open")) {
                        ShortlistRenderer.$dropdownToggle.removeClass("fake-open");
                        e.preventDefault();
                        return false
                    }
                    return true
                });
                EventDispatcher.addListener("shortlisted.add", function() {
                    ShortlistRenderer.loadShortlistContent()
                });
                EventDispatcher.addListener("shortlisted.del", function() {
                    ShortlistRenderer.loadShortlistContent()
                })
            },
            submittedShortlist: function() {
                this.$shortlistBox.trigger("ga.listingResult.multiEnquire.submit.intent")
            },
            removedShortlist: function() {
                var listingId = this.$items.find("input").val();
                this.$shortlistBox.trigger("ga.listingResult.multiEnquire.remove.x", listingId)
            },
            getRenderedItemsCount: function() {
                return this.$items.children(".mltp-listings-items").children().length
            },
            updateShortlist: function() {
                var sItem = this.getRenderedItemsCount();
                if (sItem > 0 && !guruApp.client.is_mobile) {
                    if ($("body").hasClass("listing") || $("body").hasClass("mapsearch")) {
                        if (!this.$dropdownToggle.hasClass("open")) {
                            this.$dropdownToggle.addClass("fake-open")
                        }
                    }
                }
                this.$shortlistBox.find(".mltp-selected").toggle(sItem > 0).end().find(".mltp-splash").toggle(sItem === 0).end()
            },
            loadShortlistContent: function() {
                this.$loading.removeClass("hide");
                guruApp.fn.shortlist.fetchShortlist(this.shortlistUrl, function(R) {
                    ShortlistRenderer.render(R)
                })
            },
            render: function(html) {
                this.$shortlistBox.find(".mltp-listings-items-container").html(html);
                this.updateShortlist();
                this.$loading.addClass("hide")
            },
            unShortlist: function(delAction, listingId) {
                guruApp.fn.shortlist.removeShortListItem(delAction, function(R, status, jqXHR) {
                    var ok = $.isPlainObject(R) && R.success;
                    if (ok) {
                        var data = $({});
                        data.data("listing-id", listingId);
                        EventDispatcher.dispatch("shortlisted.del", data);
                        ShortlistRenderer.removedShortlist()
                    } else {
                        alert("Something went wrong! Sorry!")
                    }
                })
            }
        };
        ShortlistRenderer.init()
    }
    )(jQuery)
});
$.fn.rating = function() {
    var val = 0
      , size = 0
      , stars = 5;
    return this.each(function(i, e) {
        val = parseFloat($(e).text());
        size = $(e).outerWidth() / stars;
        $(e).html($("<span/>").animate({
            width: val * size
        }, 1e3))
    })
}
;
var widget__graphs = {
    init: function() {
        var data__priceIndex = {}
          , data__valid = true;
        if (typeof guruApp.propertyInsightsWidget === "undefined" || typeof guruApp.propertyInsightsWidget.WidgetData === "undefined") {
            data__valid = false;
            return
        }
        data__priceIndex.json = $.parseJSON(guruApp.propertyInsightsWidget.WidgetData);
        setTimeout(function() {
            $(".w-graph__1").removeClass("loading");
            if (data__valid === true) {
                widget__graphs.bindGraphElements(data__priceIndex);
                widget__graphs.createGraphData("askPrice", 2, data__priceIndex);
                $(".w-graph-chart").highcharts().xAxis[0].setExtremes(widget__graphs.getXYearsInThePast(2), widget__graphs.getXDaysInThePast(1))
            } else {
                $(".w-graph__1").addClass("not__found")
            }
        }, 200)
    },
    getXYearsInThePast: function(x) {
        return Date.now() - 1e3 * 3600 * 24 * 365.2425 * x
    },
    getXDaysInThePast: function(x) {
        return Date.now() - 1e3 * 3600 * 24 * x
    },
    bindGraphElements: function(data__priceIndex) {
        var type = "askPrice"
          , filter = .25
          , needRedraw = false
          , $wgrap = $(".w-graph")
          , $btnGroupYears = $wgrap.find(".btn-group-years")
          , $btnGroupYearsLinks = $btnGroupYears.find("a")
          , $body = $("body");
        $(".w-graph .dropdown-menu a").click(function(e) {
            e.preventDefault();
            type = $(this).attr("data-graphType");
            if (type == "askPrice") {
                $body.trigger("ga.listing.chart-widget.price")
            } else if (type == "askPsm") {
                $body.trigger("ga.listing.chart-widget.psf")
            } else if (type == "listIndex") {
                $body.trigger("ga.listing.chart-widget.index-price")
            } else if (type == "listIndexPsm") {
                $body.trigger("ga.listing.chart-widget.index-psf")
            }
            $(".btn-graph-type .btn:first-child").text($(this).text());
            $(".btn-graph-type .btn:first-child").val($(this).text());
            needRedraw = true;
            $(".w-graph .btn-group-years a:first-child").addClass("no-track").trigger("click")
        });
        $(".w-graph .btn-group-years a").click(function(e) {
            e.preventDefault();
            filter = $(this).attr("data-yearRange");
            if ($(this).hasClass("no-track")) {
                $(this).removeClass("no-track")
            } else {
                if (filter == "0.25") {
                    $body.trigger("ga.listing.chart-widget.duration-3months")
                } else if (filter == "1") {
                    $body.trigger("ga.listing.chart-widget.duration-1year")
                } else if (filter == "2") {
                    $body.trigger("ga.listing.chart-widget.duration-2year")
                }
            }
            $(".btn-group-years a").removeClass("active");
            $(this).addClass("active");
            if (needRedraw || type == "listIndex" || type == "listIndexPsm") {
                widget__graphs.createGraphData(type, filter, data__priceIndex)
            }
            needRedraw = false;
            $(".w-graph-chart").highcharts().xAxis[0].setExtremes(widget__graphs.getXYearsInThePast(filter), widget__graphs.getXDaysInThePast(1))
        })
    },
    getLowestTimestamp: function(series) {
        var min_val = 1e22;
        for (var i = 0; i < series.length; i++) {
            if (series[i] === null) {
                continue
            }
            for (var j = 0; j < series[i].length; j++) {
                if (series[i][j][1] !== null) {
                    if (series[i][j][0] < min_val) {
                        min_val = series[i][j][0]
                    }
                    break
                }
            }
        }
        return min_val
    },
    reindexFromYear: function(serie, filter) {
        var x = widget__graphs.getXYearsInThePast(filter);
        if (typeof serie == "undefined" || serie === null) {
            return null
        }
        var index = null;
        for (var i = 0; i < serie.length; i++) {
            if (serie[i][0] > x) {
                index = i;
                break
            }
        }
        if (index === 0 || index === null || serie[index - 1][1] === null || serie[index][1] === null) {
            return null
        }
        var x0 = serie[index - 1][0]
          , x1 = serie[index][0]
          , y0 = serie[index - 1][1]
          , y1 = serie[index][1];
        var valueAtNorm = y0 + (y1 - y0) * (x - x0) / (x1 - x0)
          , factor = 100 / valueAtNorm;
        return widget__graphs.scaleSeries(serie, factor)
    },
    scaleSeries: function(serie, factor) {
        if (!$.isArray(serie)) {
            return null
        }
        var out = serie.slice(0);
        for (var i = 0; i < serie.length; i++) {
            out[i][1] = serie[i][1] === null ? null : serie[i][1] * factor
        }
        return out
    },
    createColumnData: function(type, filter, data) {
        var graphProperties = {}
          , date__filter = new Date
          , title = "Average Rental Price";
        graphProperties.categories = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        graphProperties.series = [{
            name: "HDB 1",
            type: "column",
            color: "#cc2222",
            width: 50,
            data: [900, 400, 500, 800, 1e3, 1250, 1200, 1100, 1200, 1300, 950, 500]
        }, {
            name: "Exec Condo",
            type: "column",
            color: "#344953",
            width: 50,
            data: [2100, 4e3, 3e3, 1500, 2300, 2e3, 3200, 2500, 2600, 1900, 1750, 1500]
        }];
        graphProperties.crosshairs = false;
        graphProperties.xAxisLabel = "";
        graphProperties.yAxisLabel = "SGD$";
        widget__graphs.displayGraph(graphProperties)
    },
    createGraphData: function(type, filter, data) {
        var graphProperties = {}
          , date__filter = new Date;
        data_guru_locale = "ms";
        if (type == "column") {
            widget__graphs.createColumnData(type, filter, data);
            return
        }
        data = jQuery.extend(true, {}, data);
        data.districtCount = parseInt(data.json.district.count, 10);
        data.districtAvgPrice = data.json.district.avgPrice;
        data.districtAvgPricePerArea = data.json.district.avgPricePerArea;
        data.regionCount = parseInt(data.json.region.count, 10);
        data.regionAvgPrice = data.json.region.avgPrice;
        data.regionAvgPricePerArea = data.json.region.avgPricePerArea;
        var propertypriceIndex = 0
          , propertyPricePerAreaIndex = 0;
        if (data.json.property !== null && typeof data.json.property !== "undefined") {
            data.propertyCount = parseInt(data.json.property.count, 10);
            data.propertyAvgPrice = data.json.property.avgPrice;
            data.propertyAvgPricePerArea = data.json.property.avgPricePerArea;
            propertypriceIndex = data.json.property.priceIndex;
            propertyPricePerAreaIndex = data.json.property.pricePerAreaIndex
        } else {
            data.propertyCount = 0;
            data.propertyAvgPrice = 0;
            data.propertyAvgPricePerArea = 0
        }
        graphProperties.districtName = data.json.meta.districtName;
        graphProperties.regionName = data.json.meta.regionName;
        graphProperties.propertyName = data.json.meta.propertyName;
        graphProperties.listingCount = data.regionCount;
        switch (type) {
        case "askPrice":
            data.priceIndex = widget__graphs.scaleSeries(data.json.district.priceIndex, data.districtAvgPrice / 100);
            data.regionPriceIndex = widget__graphs.scaleSeries(data.json.region.priceIndex, data.regionAvgPrice / 100);
            data.propertyPriceIndex = widget__graphs.scaleSeries(propertypriceIndex, data.propertyAvgPrice / 100);
            graphProperties.yAxisLabel = data.json.meta.currencySymbol;
            break;
        case "askPsm":
            data.priceIndex = widget__graphs.scaleSeries(data.json.district.pricePerAreaIndex, data.districtAvgPricePerArea / 100);
            data.regionPriceIndex = widget__graphs.scaleSeries(data.json.region.pricePerAreaIndex, data.regionAvgPricePerArea / 100);
            data.propertyPriceIndex = widget__graphs.scaleSeries(propertyPricePerAreaIndex, data.propertyAvgPricePerArea / 100);
            graphProperties.yAxisLabel = data.json.meta.currencySymbol;
            break;
        case "listIndex":
            data.priceIndex = widget__graphs.reindexFromYear(data.json.district.priceIndex, filter);
            data.regionPriceIndex = widget__graphs.reindexFromYear(data.json.region.priceIndex, filter);
            data.propertyPriceIndex = widget__graphs.reindexFromYear(propertypriceIndex, filter);
            graphProperties.yAxisLabel = "";
            break;
        case "listIndexPsm":
            data.priceIndex = widget__graphs.reindexFromYear(data.json.district.pricePerAreaIndex, filter);
            data.regionPriceIndex = widget__graphs.reindexFromYear(data.json.region.pricePerAreaIndex, filter);
            data.propertyPriceIndex = widget__graphs.reindexFromYear(propertyPricePerAreaIndex, filter);
            graphProperties.yAxisLabel = "";
            break;
        default:
            widget__graphs.displayTimeSeries(graphProperties);
            return
        }
        graphProperties.title = "Asking Price";
        graphProperties.count = data.json.national.count;
        graphProperties.sourceText = $(".w-graph__1").attr("data-sourceText");
        graphProperties.comparableText = $(".w-graph__1").attr("data-comparableText");
        graphProperties.listingsText = $(".w-graph__1").attr("data-listingsText");
        graphProperties.siteName = $(".w-graph__1").attr("data-siteName");
        if (graphProperties.siteName === "") {
            graphProperties.siteName = "PropertyGuru"
        }
        graphProperties.series = [{
            name: graphProperties.districtName,
            type: "spline",
            color: "#333",
            width: .5,
            data: data.priceIndex
        }, {
            name: graphProperties.regionName,
            type: "spline",
            color: "#2980b9",
            width: .5,
            data: data.regionPriceIndex
        }, {
            name: graphProperties.propertyName,
            type: "spline",
            color: "#cc2222",
            width: .5,
            data: data.propertyPriceIndex
        }];
        graphProperties.crosshairs = {
            color: "#999999",
            dashStyle: "solid"
        };
        graphProperties.xAxisLabel = "";
        graphProperties.xfloor = widget__graphs.getLowestTimestamp([data.priceIndex, data.regionPriceIndex]);
        widget__graphs.displayTimeSeries(graphProperties)
    },
    displayTimeSeries: function(graphProperties) {
        var disclaimer;
        if (typeof graphProperties.siteName !== "undefined") {
            disclaimer = graphProperties.sourceText + ": " + parseInt(graphProperties.count, 10).format() + " " + graphProperties.comparableText + " " + graphProperties.siteName + " " + graphProperties.listingsText + "."
        } else {
            disclaimer = "Source: " + parseInt(graphProperties.count, 10).format() + " comparable PropertyGuru listings. "
        }
        var chart = $(".w-graph-chart").highcharts({
            chart: {
                backgroundColor: "transparent",
                spacingBottom: 40,
                spacingTop: 30
            },
            title: {
                text: "",
                align: "left",
                verticalAlign: "top",
                x: 0
            },
            subtitle: {
                align: "center",
                floating: true,
                verticalAlign: "bottom",
                text: disclaimer,
                borderWidth: 0,
                height: 20,
                x: 0,
                y: 40
            },
            legend: {
                align: "right",
                floating: true,
                verticalAlign: "top",
                layout: "horizontal",
                borderWidth: 0,
                x: 0,
                y: -30
            },
            xAxis: {
                type: "datetime",
                dateTimeLabelFormats: {
                    month: "%e. %b",
                    year: "%b"
                },
                labels: {
                    format: "{value:%b} {value:%Y}'",
                    rotation: 0,
                    step: 3
                },
                title: {
                    text: graphProperties.xAxisLabel
                },
                tickPixelInterval: 100,
                floor: graphProperties.xfloor,
                minRange: 1e3 * 3600 * 24 * 30,
                ceiling: widget__graphs.getXDaysInThePast(1)
            },
            yAxis: {
                title: {
                    text: graphProperties.yAxisLabel
                },
                labels: {
                    formatter: function() {
                        return Highcharts.numberFormat(this.value, 0)
                    }
                }
            },
            plotOptions: {
                series: {
                    marker: {
                        enabled: false
                    }
                }
            },
            tooltip: {
                headerFormat: "<b>{series.name}</b><br/>",
                pointFormat: "<small>{point.x:%d %b %Y}</small><br/><b>Value: </b>{point.y:,.0f}",
                crosshairs: graphProperties.crosshairs
            },
            credits: {
                enabled: false
            },
            series: graphProperties.series
        })
    },
    displayGraph: function(graphProperties) {
        $(".w-graph-chart").highcharts({
            chart: {
                backgroundColor: "transparent",
                spacingBottom: 40
            },
            title: {
                text: "",
                align: "left",
                verticalAlign: "top",
                x: 0
            },
            subtitle: {
                align: "center",
                floating: true,
                verticalAlign: "bottom",
                text: "Source: propertyguru.com.sg",
                borderWidth: 0,
                height: 20,
                x: 0,
                y: 40
            },
            legend: {
                align: "top",
                floating: true,
                verticalAlign: "top",
                layout: "horizontal",
                borderWidth: 0,
                x: 100,
                y: 10
            },
            xAxis: {
                title: {
                    text: graphProperties.xAxisLabel
                },
                categories: graphProperties.categories,
                labels: {
                    step: 1
                },
                lineWidth: 0,
                minorGridLineWidth: 0,
                lineColor: "transparent",
                minorTickLength: 0,
                tickLength: 0
            },
            yAxis: {
                title: {
                    text: graphProperties.yAxisLabel
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: "#cc2222"
                }],
                lineWidth: 0,
                minorGridLineWidth: 0,
                lineColor: "transparent",
                minorTickLength: 0,
                tickLength: 0
            },
            tooltip: {
                valuePrefix: "SGD$",
                crosshairs: graphProperties.crosshairs
            },
            credits: {
                enabled: false
            },
            series: graphProperties.series
        })
    }
};
$(function() {
    if ($("#title-latest-transactions").length > 0) {
        $(window).on("highcharts.loaded", function() {
            widget__graphs.init()
        })
    }
});
Number.prototype.format = function(n, x) {
    var re = "\\d(?=(\\d{" + (x || 3) + "})+" + (n > 0 ? "\\." : "$") + ")";
    return this.toFixed(Math.max(0, ~~n)).replace(new RegExp(re,"g"), "$&,")
}
;
(function(window, $) {
    $.fn.priceTrend = function(options) {
        var settings = $.extend({
            template: "",
            dataByPropertyTypeGroup: {},
            avgByPropertyTypeGroup: {},
            currencySymbol: "$"
        }, options);
        function buildCategories(data) {
            var categories = [];
            var min = Math.min.apply(Math, data);
            var max = Math.max.apply(Math, data);
            var start = new Date(min * 1e3);
            var stop = new Date(max * 1e3);
            var year = start.getUTCFullYear();
            var month = start.getUTCMonth();
            var startMs = Date.UTC(year, month);
            var stopMs = Date.UTC(stop.getUTCFullYear(), stop.getUTCMonth());
            var date;
            do {
                t = Date.UTC(year, month);
                ++month;
                date = new Date(t);
                categories.push(buildCategories.months[date.getUTCMonth()].charAt(0))
            } while (t < stopMs);return categories
        }
        buildCategories.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        function updateControls(obj) {
            var ptg = $(".selector-property-type-group a.active", obj).data("property-type-group");
            var avg = settings.avgByPropertyTypeGroup[ptg];
            $(".label-avg", obj).text(avg)
        }
        function updateChart(obj) {
            var series;
            var ptg = $(".selector-property-type-group a.active", obj).data("property-type-group");
            var data = settings.dataByPropertyTypeGroup[ptg];
            var newData = [];
            Object.keys(data).forEach(function(key) {
                var value = data[key];
                newData.push([key, value])
            });
            $(".highchart-canvas", obj).highcharts({
                chart: {
                    backgroundColor: "transparent",
                    height: 400
                },
                title: null,
                xAxis: {
                    categories: buildCategories(newData.map(function(pair) {
                        return pair[0]
                    })),
                    title: {
                        text: "Last 24 months"
                    }
                },
                yAxis: {
                    title: {
                        text: "Price (PSF)"
                    },
                    labels: {
                        format: String(settings.currencySymbol) + " {value}"
                    }
                },
                tooltip: {
                    headerFormat: "<b>{series.name}</b><br>",
                    pointFormat: String(settings.currencySymbol) + " {point.y}"
                },
                series: [{
                    name: "Average PSF",
                    type: "line",
                    color: "#2980b9",
                    width: 50,
                    data: newData
                }],
                credits: {
                    enabled: false
                }
            })
        }
        return this.each(function() {
            var widget = this;
            $(this).html(settings.template.innerHTML);
            var options = $(".selector-property-type-group a", widget);
            options.click(function(event) {
                event.preventDefault();
                options.removeClass("active");
                var option = $(this);
                option.addClass("active");
                var label = option.text();
                $(".selector-property-type-group button", widget).text(label);
                updateControls(widget);
                updateChart(widget)
            });
            updateControls(widget);
            $(window).on("highcharts.loaded", function() {
                updateChart(widget)
            })
        })
    }
}
)(window, window.jQuery);
(function($) {
    "use strict";
    var getPmt = function(rate, tenure, loan) {
        loan = +loan;
        if (rate == 0 || tenure == 0 || loan == 0)
            return 0;
        return rate * -loan * Math.pow(1 + rate, tenure) / (1 - Math.pow(1 + rate, tenure))
    };
    guruApp.moneyCalculatorWidget = {
        initialize: function(widgetData) {
            var LinksUpdater = {
                $links: $(),
                includeQueryParametersToggle: false,
                init: function($links, toggles) {
                    this.links = $links;
                    this.checkForToggle(toggles);
                    this.links.each(function() {
                        var $a = $(this);
                        $a.data("original-url", $a.attr("href"))
                    }).each(this.updateLinks)
                },
                checkForToggle: function(toggles) {
                    $.each(toggles, function(index, feature) {
                        if (feature.IncludeQueryParameters) {
                            LinksUpdater.includeQueryParametersToggle = true
                        }
                    })
                },
                updateLinks: function() {
                    if (!LinksUpdater.includeQueryParametersToggle) {
                        return
                    }
                    var $a = $(this), url = $a.data("original-url"), params = {
                        interest_rate: $("#interest-rate").val(),
                        loan_tenure: $("#loan-tenure").val() * 12,
                        loan_amount: $("#loan-amount").val(),
                        property_value: actualPropertyValue,
                        property_type: widgetData.propertyType,
                        region_code: widgetData.region_code ? widgetData.region_code.split("##") : "",
                        listing_id: widgetData.listingId
                    }, delimiter;
                    if (typeof url != "undefined" && typeof url.indexOf("?") != "undefined") {
                        delimiter = url.indexOf("?") > 0 ? "&" : "?";
                        $a.attr("href", url + delimiter + $.param(params))
                    }
                    $a.attr("href", url + delimiter + $.param(params))
                }
            };
            var propertyValueField = $("#property-value")
              , actualPropertyValue = propertyValueField.html()
              , $links = $("#bank-logo, #cta-button, .secondary-link")
              , includeQueryParametersToggle = false;
            var recalculate = function() {
                var apr = widgetData.calculator.interestRate.value / 1200;
                widgetData.calculator.interest.value = Math.round(apr * widgetData.calculator.loan.value);
                widgetData.calculator.monthlyRepayment.value = Math.round(getPmt(apr, widgetData.calculator.tenure.value, widgetData.calculator.loan.value));
                widgetData.calculator.principle.value = widgetData.calculator.monthlyRepayment.value - widgetData.calculator.interest.value;
                LinksUpdater.updateLinks()
            };
            var formatCurrency = function(number) {
                var separator = ",";
                if (widgetData.region.toLowerCase() === "id")
                    separator = ".";
                number = number.toString().split(".");
                var regex = /(\d+)(\d{3})/;
                while (regex.test(number[0])) {
                    number[0] = number[0].replace(regex, "$1" + separator + "$2")
                }
                return widgetData.calculator.price.currencySymbol + " " + number.join(".")
            };
            var redrawGraph = function() {
                var data = [{
                    name: widgetData.calculator.principle.label,
                    color: "#CC2222",
                    y: +widgetData.calculator.principle.value
                }, {
                    name: widgetData.calculator.interest.label,
                    color: "#CCCCCC",
                    y: +widgetData.calculator.interest.value
                }]
                  , defaults = {
                    subtitle: {
                        text: widgetData.chart.title + '<br/><span style="font-size:.8em">' + widgetData.chart.disclaimer + "</span>",
                        verticalAlign: "top",
                        y: 4
                    },
                    credits: {
                        enabled: false
                    },
                    chart: {
                        backgroundColor: null,
                        plotBorderWidth: 0,
                        plotShadow: false,
                        renderTo: "widget-graph",
                        style: {
                            fontFamily: '"Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif',
                            fontSize: "14px"
                        }
                    },
                    title: {
                        text: '<span style="font-size: 14px"> ' + formatCurrency(Math.round(widgetData.calculator.monthlyRepayment.value)) + '</span><br/><span style="font-size:.6em">' + widgetData.calculator.monthlyRepayment.suffix + "</span>",
                        align: "center",
                        verticalAlign: "middle",
                        y: 0
                    },
                    tooltip: {
                        pointFormat: "{point.percentage:.1f}%",
                        formatter: function() {
                            return this.point.name + " " + formatCurrency(Math.round(this.point.y))
                        }
                    },
                    plotOptions: {
                        pie: {
                            size: "70%",
                            center: ["50%", "50%"],
                            dataLabels: {
                                enabled: false,
                                distance: -50,
                                style: {
                                    fontWeight: "bold",
                                    color: "white",
                                    textShadow: "0px 1px 2px black"
                                }
                            },
                            point: {
                                events: {
                                    legendItemClick: function() {
                                        return false
                                    }
                                }
                            },
                            showInLegend: true,
                            startAngle: 0,
                            endAngle: 360
                        },
                        allowPointSelect: false
                    },
                    series: [{
                        type: "pie",
                        name: "",
                        innerSize: "60%",
                        data: data
                    }],
                    legend: {
                        verticalAlign: "bottom",
                        layout: "vertical",
                        floating: true,
                        y: 0,
                        itemStyle: {
                            fontWeight: "normal"
                        },
                        labelFormatter: function() {
                            return formatCurrency(Math.round(this.y)) + " " + this.name
                        }
                    }
                };
                new Highcharts.Chart(defaults)
            };
            var updateMobileBanner = function() {
                $(".monthly-repayment").text(formatCurrency(widgetData.calculator.monthlyRepayment.value));
                $(".interest").text(widgetData.calculator.interest.value);
                $(".principal").text(widgetData.calculator.principle.value)
            };
            LinksUpdater.init($links, widgetData.widget.featureToggle);
            propertyValueField.html(formatCurrency(actualPropertyValue));
            $("#loan-amount, #loan-tenure, #interest-rate").keyup(function() {
                var $this = $(this);
                if ($this.data("old-value") !== $this.val()) {
                    $this.trigger("value-change");
                    $this.data("old-value", $this.val());
                    guruApp.fn.addListingDetailToCart("Mortgage Affordability Calculator")
                }
            }).each(function() {
                var $this = $(this);
                $this.data("old-value", $this.val())
            });
            $("#loan-amount, #interest-rate").on("value-change", function() {
                widgetData.calculator[vm[this.id]].value = this.value;
                recalculate();
                updateMobileBanner();
                redrawGraph()
            });
            var vm = {
                "loan-amount": "loan",
                "loan-tenure": "tenure",
                "interest-rate": "interestRate"
            };
            $("#loan-tenure").on("value-change", function() {
                widgetData.calculator[vm[this.id]].value = +this.value * 12;
                recalculate();
                updateMobileBanner();
                redrawGraph()
            }).val(widgetData.calculator.tenure.value / 12);
            var events = {
                "#cta-button": {
                    event: "cta-button",
                    domEvent: "click"
                },
                "#bank-logo": {
                    event: "bank-logo",
                    domEvent: "click"
                },
                ".secondary-link": {
                    event: "secondary-link",
                    domEvent: "click"
                },
                "#interest-rate": {
                    event: "interest-rate",
                    domEvent: "focus"
                },
                "#loan-tenure": {
                    event: "loan-tenure",
                    domEvent: "focus"
                },
                "#loan-amount": {
                    event: "loan-amount",
                    domEvent: "focus"
                }
            };
            jQuery.each(events, function(selector, options) {
                $(selector).bind(options.domEvent, function() {
                    $("body").trigger("ga.money.widget." + options.event);
                    if (selector === "#cta-button" || selector === "#bank-logo" || selector === ".secondary-link") {
                        guruApp.fn.addListingDetailToCart("Mortgage Affordability Calculator")
                    }
                })
            });
            $("body").trigger("ga.moneyCalculatorWidget.loaded");
            $("body").trigger("ga.money.widget.widget-load");
            redrawGraph();
            updateMobileBanner()
        }
    }
}
)(jQuery);
(function($) {
    var expectedCalls = 2
      , callCount = 0;
    $(function() {
        var $calculatorWidget = $("#calculator-widget");
        if (guruApp && guruApp.moneyCalculatorWidgetParams && $calculatorWidget.length) {
            guruApp.moneyCalculatorWidgetParams.uikit = true;
            var calculatorWidgetUrl = guruApp.moneyCalculatorWidgetParams.widgetURL;
            delete guruApp.moneyCalculatorWidgetParams.widgetURL;
            $.get(calculatorWidgetUrl, guruApp.moneyCalculatorWidgetParams).then(function(data) {
                if (data === null) {
                    $("#calculator-widget").remove()
                } else {
                    $calculatorWidget.html(data).removeClass("hide");
                    if (guruApp.moneyCalculatorWidgetData) {
                        $("#faux-calculator-widget > .section-title").removeClass("hide");
                        callCount++;
                        innitializeMoneyWidgets()
                    }
                }
            }).fail(function() {
                $("#calculator-widget").remove()
            })
        }
    });
    try {
        $(window).on("highcharts.loaded", function() {
            callCount++;
            innitializeMoneyWidgets()
        })
    } catch (e) {}
    var innitializeMoneyWidgets = function() {
        if (callCount != expectedCalls) {
            return
        }
        var widgetData = guruApp && guruApp.moneyCalculatorWidgetData;
        guruApp.moneyCalculatorWidget.initialize(widgetData)
    }
}
)(jQuery);
(function(l) {
    "object" === typeof exports && "undefined" !== typeof module ? module.exports = l() : "function" === typeof define && define.amd ? define([], l) : ("undefined" !== typeof window ? window : "undefined" !== typeof global ? global : "undefined" !== typeof self ? self : this).SmartBanner = l()
}
)(function() {
    return function d(g, f, e) {
        function b(c, m) {
            if (!f[c]) {
                if (!g[c]) {
                    var k = "function" == typeof require && require;
                    if (!m && k)
                        return k(c, !0);
                    if (a)
                        return a(c, !0);
                    k = Error("Cannot find module '" + c + "'");
                    throw k.code = "MODULE_NOT_FOUND",
                    k
                }
                k = f[c] = {
                    exports: {}
                };
                g[c][0].call(k.exports, function(a) {
                    var e = g[c][1][a];
                    return b(e ? e : a)
                }, k, k.exports, d, g, f, e)
            }
            return f[c].exports
        }
        for (var a = "function" == typeof require && require, c = 0; c < e.length; c++)
            b(e[c]);
        return b
    }({
        1: [function(d, g, f) {
            var e = d("xtend/mutable")
              , b = d("component-query")
              , a = d("get-doc")
              , c = a && a.documentElement
              , h = d("cookie-cutter")
              , m = {
                ios: {
                    appMeta: "apple-itunes-app",
                    iconRels: ["apple-touch-icon-precomposed", "apple-touch-icon"],
                    getStoreLink: function() {
                        return "https://itunes.apple.com/" + this.options.appStoreLanguage + "/app/id" + this.appId
                    }
                },
                android: {
                    appMeta: "google-play-app",
                    iconRels: ["android-touch-icon", "apple-touch-icon-precomposed", "apple-touch-icon"],
                    getStoreLink: function() {
                        return "http://play.google.com/store/apps/details?id=" + this.appId
                    }
                },
                windows: {
                    appMeta: "msApplication-ID",
                    iconRels: ["windows-touch-icon", "apple-touch-icon-precomposed", "apple-touch-icon"],
                    getStoreLink: function() {
                        return "http://www.windowsphone.com/s?appid=" + this.appId
                    }
                }
            };
            d = function(b) {
                var a = navigator.userAgent;
                this.options = e({}, {
                    daysHidden: 15,
                    daysReminder: 90,
                    appStoreLanguage: "us",
                    button: "OPEN",
                    store: {
                        ios: "On the App Store",
                        android: "In Google Play",
                        windows: "In the Windows Store"
                    },
                    price: {
                        ios: "FREE",
                        android: "FREE",
                        windows: "FREE"
                    },
                    force: !1
                }, b || {});
                this.options.force ? this.type = this.options.force : null != a.match(/Windows Phone/i) && null !== a.match(/Touch/i) ? this.type = "windows" : null !== a.match(/iPad|iPhone|iPod/i) ? null !== a.match(/Safari/i) && (null !== a.match(/CriOS/i) || 6 > Number(a.substr(a.indexOf("OS ") + 3, 3).replace("_", "."))) && (this.type = "ios") : null !== a.match(/Android/i) && (this.type = "android");
                !this.type || navigator.standalone || h.get("smartbanner-closed") || h.get("smartbanner-installed") || (e(this, m[this.type]),
                this.parseAppId() && (this.create(),
                this.show()))
            }
            ;
            d.prototype = {
                constructor: d,
                create: function() {
                    for (var c = this.getStoreLink(), e = this.options.price[this.type] + " - " + this.options.store[this.type], d, f = 0; f < this.iconRels.length; f++) {
                        var g = b('link[rel="' + this.iconRels[f] + '"]');
                        if (g) {
                            d = g.getAttribute("href");
                            break
                        }
                    }
                    var h = a.createElement("div");
                    h.className = "smartbanner smartbanner-" + this.type;
                    h.innerHTML = '<div class="smartbanner-container"><a href="javascript:void(0);" class="smartbanner-close">&times;</a><span class="smartbanner-icon" style="background-image: url(' + d + ')"></span><div class="smartbanner-info"><div class="smartbanner-title">' + this.options.title + "</div><div>" + this.options.author + "</div><span>" + e + '</span></div><a href="' + c + '" class="smartbanner-button"><span class="smartbanner-button-text">' + this.options.button + "</span></a></div>";
                    a.body ? a.body.appendChild(h) : a && a.addEventListener("DOMContentLoaded", function() {
                        a.body.appendChild(h)
                    });
                    b(".smartbanner-button", h).addEventListener("click", this.install.bind(this), !1);
                    b(".smartbanner-close", h).addEventListener("click", this.close.bind(this), !1)
                },
                hide: function() {
                    c.classList.remove("smartbanner-show")
                },
                show: function() {
                    c.classList.add("smartbanner-show")
                },
                close: function() {
                    this.hide();
                    h.set("smartbanner-closed", "true", {
                        path: "/",
                        expires: +new Date + 864e5 * this.options.daysHidden
                    })
                },
                install: function() {
                    this.hide();
                    h.set("smartbanner-installed", "true", {
                        path: "/",
                        expires: +new Date + 864e5 * this.options.daysReminder
                    })
                },
                parseAppId: function() {
                    var a = b('meta[name="' + this.appMeta + '"]');
                    if (a)
                        return this.appId = "windows" === this.type ? a.getAttribute("content") : /app-id=([^\s,]+)/.exec(a.getAttribute("content"))[1]
                }
            };
            g.exports = d
        }
        , {
            "component-query": 2,
            "cookie-cutter": 3,
            "get-doc": 4,
            "xtend/mutable": 6
        }],
        2: [function(d, g, f) {
            function e(b, a) {
                return a.querySelector(b)
            }
            f = g.exports = function(b, a) {
                a = a || document;
                return e(b, a)
            }
            ;
            f.all = function(b, a) {
                a = a || document;
                return a.querySelectorAll(b)
            }
            ;
            f.engine = function(b) {
                if (!b.one)
                    throw Error(".one callback required");
                if (!b.all)
                    throw Error(".all callback required");
                e = b.one;
                f.all = b.all;
                return f
            }
        }
        , {}],
        3: [function(d, g, f) {
            f = g.exports = function(e) {
                e || (e = {});
                "string" === typeof e && (e = {
                    cookie: e
                });
                void 0 === e.cookie && (e.cookie = "");
                return {
                    get: function(b) {
                        for (var a = e.cookie.split(/;\s*/), c = 0; c < a.length; c++) {
                            var d = a[c].split("=");
                            if (unescape(d[0]) === b)
                                return unescape(d[1])
                        }
                    },
                    set: function(b, a, c) {
                        c || (c = {});
                        b = escape(b) + "=" + escape(a);
                        c.expires && (b += "; expires=" + c.expires);
                        c.path && (b += "; path=" + escape(c.path));
                        return e.cookie = b
                    }
                }
            }
            ;
            "undefined" !== typeof document && (d = f(document),
            f.get = d.get,
            f.set = d.set)
        }
        , {}],
        4: [function(d, g, f) {
            d = d("has-dom");
            g.exports = d() ? document : null
        }
        , {
            "has-dom": 5
        }],
        5: [function(d, g, f) {
            g.exports = function() {
                return "undefined" !== typeof window && "undefined" !== typeof document && "function" === typeof document.createElement
            }
        }
        , {}],
        6: [function(d, g, f) {
            g.exports = function(d) {
                for (var b = 1; b < arguments.length; b++) {
                    var a = arguments[b], c;
                    for (c in a)
                        a.hasOwnProperty(c) && (d[c] = a[c])
                }
                return d
            }
        }
        , {}]
    }, {}, [1])(1)
});
+function($, Modernizr) {
    "use strict";
    if (!$.fn.carousel) {
        throw new Error("carousel-swipe required bootstrap carousel")
    }
    var SupportHelper = {
        versionToNumber: function(versionString) {
            versionString = (versionString + "").split(".");
            var majorVersion = parseInt(versionString[0], 10) || 0
              , minorVersion = parseInt(versionString[1], 10) || 0
              , patchVersion = parseInt(versionString[2], 10) || 0;
            return {
                major: majorVersion,
                minor: minorVersion,
                patch: patchVersion
            }
        },
        supports: function(fromVersion, thisVersion) {
            fromVersion = this.versionToNumber(fromVersion);
            thisVersion = this.versionToNumber(thisVersion);
            if (fromVersion.major > thisVersion.major) {
                return false
            }
            if (fromVersion.minor > thisVersion.minor) {
                return false
            }
            if (fromVersion.patch > thisVersion.patch) {
                return false
            }
            return true
        }
    }
      , bootstrapSupport = {
        carousel3DTransform: "3.3.0"
    }
      , boostrapVersion = {
        carousel: "0.0.0"
    };
    if ($.fn.carousel.Constructor && $.fn.carousel.Constructor.VERSION) {
        boostrapVersion.carousel = $.fn.carousel.Constructor.VERSION
    }
    if (SupportHelper.supports(bootstrapSupport.carousel3DTransform, boostrapVersion.carousel) && !Modernizr) {
        throw new Error("carousel-swipe required Modernizr for feature detection")
    }
    var CarouselSwipe = function(element) {
        this.$element = $(element);
        this.carousel = this.$element.data("bs.carousel");
        this.options = $.extend({}, CarouselSwipe.DEFAULTS, this.carousel.options);
        this.startX = null;
        this.startY = null;
        this.startTime = null;
        this.cycling = null;
        this.$active = null;
        this.$items = null;
        this.$next = null;
        this.$prev = null;
        this.dx = null;
        this.carouselUses3DTransform = false;
        this.$element.on("touchstart", $.proxy(this.touchstart, this)).on("touchmove", $.proxy(this.touchmove, this)).on("touchend", $.proxy(this.touchend, this))
    };
    CarouselSwipe.DEFAULTS = {
        swipe: 50,
        use3DTransform: SupportHelper.supports(bootstrapSupport.carousel3DTransform, boostrapVersion.carousel) && Modernizr.csstransforms3d
    };
    CarouselSwipe.prototype.moveLeft = function($el, value) {
        if (this.options.use3DTransform) {
            var translate = "";
            if (value !== "") {
                translate = "translate3d(" + value + ", 0, 0)"
            }
            $el.css("-webkit-transform", translate).css("transform", translate)
        } else {
            $el.css("left", value)
        }
    }
    ;
    CarouselSwipe.prototype.touchstart = function(e) {
        if (!this.options.swipe) {
            return
        }
        var touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;
        this.dx = 0;
        this.startX = touch.pageX;
        this.startY = touch.pageY;
        this.cycling = null;
        this.width = this.$element.width();
        this.startTime = e.timeStamp
    }
    ;
    CarouselSwipe.prototype.touchmove = function(e) {
        if (!this.options.swipe) {
            return
        }
        var touch = e.originalEvent.touches ? e.originalEvent.touches[0] : e;
        var dx = touch.pageX - this.startX;
        var dy = touch.pageY - this.startY;
        if (Math.abs(dx) < Math.abs(dy)) {
            return
        }
        if (this.cycling === null) {
            this.cycling = !!this.carousel.interval;
            this.cycling && this.carousel.pause()
        }
        e.preventDefault();
        this.dx = dx / (this.width || 1) * 100;
        this.swipe(this.dx)
    }
    ;
    CarouselSwipe.prototype.touchend = function(e) {
        if (!this.options.swipe)
            return;
        if (!this.$active) {
            return
        }
        var all = $().add(this.$active).add(this.$prev).add(this.$next).carousel_transition(true);
        var dt = (e.timeStamp - this.startTime) / 1e3;
        var speed = Math.abs(this.dx / dt);
        if (this.dx > 40 || this.dx > 0 && speed > this.options.swipe) {
            this.carousel.prev()
        } else if (this.dx < -40 || this.dx < 0 && speed > this.options.swipe) {
            this.carousel.next()
        } else {
            this.$active.one($.support.transition.end, function() {
                all.removeClass("prev next")
            }).emulateTransitionEnd(this.$active.css("transition-duration").slice(0, -1) * 1e3)
        }
        this.moveLeft(all, "");
        this.cycling && this.carousel.cycle();
        this.$active = null
    }
    ;
    CarouselSwipe.prototype.swipe = function(percent) {
        var $active = this.$active || this.getActive();
        if (percent > 100) {
            percent = 100
        } else if (percent < -100) {
            percent = -100
        }
        if (percent < 0) {
            this.$prev.removeClass("prev").carousel_transition(true);
            this.moveLeft(this.$prev, "");
            if (!this.$next.length || this.$next.hasClass("active")) {
                return
            }
            this.$next.carousel_transition(false).addClass("next");
            this.moveLeft(this.$next, percent + 100 + "%")
        } else {
            this.$next.removeClass("next").carousel_transition(true);
            this.moveLeft(this.$next, "");
            if (!this.$prev.length || this.$prev.hasClass("active")) {
                return
            }
            this.$prev.carousel_transition(false).addClass("prev");
            this.moveLeft(this.$prev, percent - 100 + "%")
        }
        $active.carousel_transition(false);
        this.moveLeft($active, percent + "%")
    }
    ;
    CarouselSwipe.prototype.getActive = function() {
        this.$active = this.$element.find(".item.active");
        this.$items = this.$active.parent().children();
        this.$next = this.$active.next();
        this.$prev = this.$active.prev();
        if (!this.$next.length && this.options.wrap) {
            this.$next = this.$items.first()
        }
        if (!this.$prev.length && this.options.wrap) {
            this.$prev = this.$items.last()
        }
        return this.$active
    }
    ;
    var old = $.fn.carousel;
    $.fn.carousel = function() {
        old.apply(this, arguments);
        return this.each(function() {
            var $this = $(this);
            var data = $this.data("bs.carousel.swipe");
            if (!data) {
                $this.data("bs.carousel.swipe", new CarouselSwipe(this))
            }
        })
    }
    ;
    $.extend($.fn.carousel, old);
    $.fn.carousel_transition = function(enable) {
        enable = enable ? "" : "none";
        return this.each(function() {
            $(this).css("-webkit-transition", enable).css("transition", enable).css("-webkit-transform", enable).css("transform", enable)
        })
    }
}(jQuery, Modernizr);
(function($, Hogan, Log) {
    "use strict";
    Log = Log || {
        log: function() {}
    };
    if (typeof guruApp === "undefined") {
        Log.log("ListingsMortgageInfo: guruApp is undefined");
        return
    }
    var fetchingFor = "listingResultsWidget";
    if (!guruApp[fetchingFor]) {
        Log.log("ListingsMortgageInfo: guruApp." + fetchingFor + " missing for MortgageInfo, trying for listingDetail");
        fetchingFor = "listingDetail";
        if (!guruApp[fetchingFor]) {
            Log.log("ListingsMortgageInfo: guruApp." + fetchingFor + " missing for MortgageInfo");
            return
        } else if (guruApp.listingDetail.unitTypesDetails) {
            Log.log("ListingsMortgageInfo: guruApp." + fetchingFor + " - Do not fetch data for Project Listings");
            return
        }
    }
    if (!guruApp[fetchingFor].mortgageInputData) {
        Log.log("ListingsMortgageInfo: Missing mortgage data");
        return
    }
    if (!guruApp[fetchingFor].mortgageSearchUrl) {
        Log.log("ListingsMortgageInfo: Missing mortgage search url");
        return
    }
    if (!$.isArray(guruApp[fetchingFor].mortgageInputData)) {
        Log.log("ListingsMortgageInfo: Mortgage data is not an array");
        return
    }
    if (guruApp[fetchingFor].mortgageInputData.length === 0) {
        Log.log("ListingsMortgageInfo: Mortgage data has no entries");
        return
    }
    if (typeof Hogan !== "object") {
        Log.log("ListingsMortgageInfo: No Render engine. Hogan not present");
        return
    }
    var MortageInfo = {
        listingData: null,
        apiEndPoint: null,
        mortgageData: null,
        template: null,
        fetchingFor: null,
        init: function(listingData, apiEndPoint, RenderEngine, fetchingFor) {
            this.listingData = listingData;
            this.apiEndPoint = apiEndPoint;
            this.fetchingFor = fetchingFor;
            this.template = RenderEngine.compile(this.getTemplate());
            if ($(".listing-widget-new").length) {
                this.getMortgageData(this.successHandlerForNewListing)
            } else if (fetchingFor === "listingResultsWidget") {
                this.getMortgageData(this.successHandlerForResults)
            } else if (fetchingFor === "listingDetail") {
                this.getMortgageData(this.successHandlerForDetails)
            }
        },
        getTemplate: function() {
            var countrySpecificString = '<p class="listing-mortgage-monthly"><a href="{{monthlyRepaymentUrl}}" target="_blank" data-tracking-label="{{trackingLabels.monthlyRepayment}}">{{monthlyRepaymentLabel}} <span class="mrtg-repayment">{{monthlyRepayment}}</span>{{#promoText}} <span class="mrtg-promo">{{promoText}}</span>{{/promoText}}</a></p>';
            if (guruApp.country === "MY" && typeof guruApp.listingDetail !== "undefined" && typeof guruApp.listingDetail.hlpaData !== "undefined") {
                countrySpecificString = '<p class="listing-mortgage-monthly"><div data-tracking-label="{{trackingLabels.monthlyRepayment}}">{{newMonthlyRepaymentLabel}} <span class="mortgage-bold">{{monthlyRepayment}}</span> {{#promoText}} <span class="mrtg-promo">{{promoText}}</span>{{/promoText}}</div></p>'
            }
            var template = "";
            template += '<div class="listing-mortgage">';
            template += "{{^showPromoLine}}";
            template += countrySpecificString;
            template += "{{/showPromoLine}}";
            template += "{{#showPromoLine}}";
            template += '<p class="listing-mortgage-promoline"><a href="{{promoUrl}}" target="_blank" data-tracking-label="{{trackingLabels.promoLine}}">{{promoLine}}{{#logo}} <img src="{{url}}" alt="{{altText}}" />{{/logo}}</a></p>';
            template += "{{/showPromoLine}}";
            template += "</div>";
            return template
        },
        getTransformedDataForRequest: function() {
            var i, length = this.listingData.length, requestData = {
                location: null,
                id: [],
                regionCode: [],
                propertyType: [],
                listingPrice: []
            }, d = null;
            for (i = 0; i < length; i++) {
                d = this.listingData[i];
                requestData.id.push(d.id);
                requestData.regionCode.push(d.regionCode);
                requestData.propertyType.push(d.propertyType);
                requestData.listingPrice.push(d.listingPrice)
            }
            if (this.fetchingFor === "listingResultsWidget") {
                requestData.location = "search"
            } else if (this.fetchingFor === "listingDetail") {
                requestData.location = "listing"
            }
            return requestData
        },
        getMortgageData: function(successHandler) {
            var requestData = this.getTransformedDataForRequest();
            $.ajax({
                type: "GET",
                url: this.apiEndPoint,
                data: $.param(requestData),
                success: successHandler,
                context: this,
                dataType: "json"
            })
        },
        successHandlerForResults: function(mortgageData) {
            var $listings = $("ul.listing-items > li.listing-item")
              , contextThis = this;
            if (!$.isArray(mortgageData)) {
                return
            }
            if (mortgageData.length !== $listings.length) {
                return
            }
            $listings.each(function(i) {
                if (mortgageData[i] !== null) {
                    contextThis.injectMortgageDataForResults($(this), mortgageData[i])
                }
            })
        },
        successHandlerForNewListing: function(mortgageData) {
            var $listings = $(".listing-card-sale")
              , contextThis = this;
            if (!$.isArray(mortgageData)) {
                return
            }
            if (mortgageData.length !== $listings.length) {
                return
            }
            $listings.each(function(i) {
                if (mortgageData[i] !== null) {
                    contextThis.injectMortgageDataForResultsNew($(this), mortgageData[i])
                }
            })
        },
        successHandlerForDetails: function(mortgageData) {
            var $classNametoSearch = ".listing-detail-summary-bar-price";
            if (guruApp.country === "MY" && typeof guruApp.listingDetail.hlpaData !== "undefined") {
                $classNametoSearch = ".mortgage-info"
            }
            var $listingHeader = $($classNametoSearch);
            if (mortgageData[0] !== null) {
                this.injectMortgateDataForDetails($listingHeader, mortgageData[0])
            }
        },
        injectMortgageDataForResults: function($listing, listingMortgageData) {
            var mortageInfoHtml = this.template.render(listingMortgageData)
              , $btnTools = $listing.find(".btn-tools");
            if ($btnTools.length) {
                if (listingMortgageData.showPromoLine) {
                    $listing.addClass("has-paid-mortgage")
                }
                $btnTools.before(mortageInfoHtml)
            }
        },
        injectMortgageDataForResultsNew: function($listing, listingMortgageData) {
            if (listingMortgageData.monthlyRepayment) {
                var amount = listingMortgageData.monthlyRepayment;
                if (amount && amount.length && parseInt(amount.replace(/\D/gi, ""), 10) > 0) {
                    var mortageInfoHtml = this.template.render(listingMortgageData)
                      , $priceEle = $listing.find(".listing-features .list-price");
                    if (listingMortgageData.showPromoLine) {
                        $listing.addClass("has-paid-mortgage")
                    }
                    $priceEle.append(mortageInfoHtml)
                }
            }
        },
        injectMortgateDataForDetails: function($listingHeader, listingMortgageData) {
            var $listingValues = $listingHeader.find(".mortgage-link")
              , otherMortgageUrl = $listingHeader.data("mortgage-url")
              , mortageInfoHtml = null
              , $listingMortgageMonthly = null
              , listingMortgageMonthlyVal = null
              , $listingMortgageMonthlySubTitle = null;
            if (otherMortgageUrl) {
                listingMortgageData.monthlyRepaymentUrl = otherMortgageUrl
            }
            mortageInfoHtml = this.template.render(listingMortgageData);
            if ($listingValues.length) {
                $listingValues.append(mortageInfoHtml);
                $listingValues.removeClass("hide");
                $listingMortgageMonthly = $(".listing-mortgage-monthly");
                listingMortgageMonthlyVal = $listingMortgageMonthly.children("a").children("span").text();
                $listingMortgageMonthlySubTitle = $("#faux-calculator-widget .section-title .title-sub-value");
                if ($listingMortgageMonthly.is(":visible")) {
                    $listingMortgageMonthlySubTitle.text(listingMortgageMonthlyVal)
                }
            }
        }
    };
    $(document).ready(function() {
        MortageInfo.init(guruApp[fetchingFor].mortgageInputData, guruApp[fetchingFor].mortgageSearchUrl, Hogan, fetchingFor);
        function getListingDetailHLPAData($type) {
            return {
                content: guruApp.listingDetail.hlpaData.isProjectHlpa ? "Pre-Approved" : "Not Pre-Approved",
                value: guruApp.listingDetail.hlpaData.isProjectHlpa ? "99%" : guruApp.listingDetail.hlpaData.approvalChanceString,
                validity: guruApp.listingDetail.hlpaData.isExpired ? "valid" : "expired",
                type: $type
            }
        }
        $(".contact-form-side .btn.btn-primary.btn-block").on("click", function() {
            if (guruApp.listingDetail) {
                var data = {
                    type: "button",
                    content: typeof guruApp.listingDetail.hlpaData === "undefined" || !guruApp.listingDetail.hlpaData.hasUserDoneTheTool ? "No Home Loan Pre-Approval" : guruApp.listingDetail.hlpaData.isProjectHlpa ? "Pre-Approved" : "Not Pre-Approved",
                    value: typeof guruApp.listingDetail.hlpaData === "undefined" || !guruApp.listingDetail.hlpaData.hasUserDoneTheTool ? null : guruApp.listingDetail.hlpaData.isProjectHlpa ? "99%" : guruApp.listingDetail.hlpaData.approvalChanceString,
                    validity: typeof guruApp.listingDetail.hlpaData === "undefined" || !guruApp.listingDetail.hlpaData.hasUserDoneTheTool ? null : guruApp.listingDetail.hlpaData.isExpired ? "expired" : "valid"
                };
                $("body").trigger("ga.genericHlpaTracker", {
                    category: "HomeLoanPreApproval-Conversion",
                    action: "Submit",
                    label: "location=LDP-EnquiryForm",
                    payload: data
                })
            }
        });
        var flipper = $(".flip-container");
        if (flipper.length > 0) {
            flipper.one("mouseenter", function() {
                var $content = guruApp.listingDetail.hlpaData.isProjectHlpa ? "Pre-Approved" : "Not Pre-Approved";
                var $value = guruApp.listingDetail.hlpaData.isProjectHlpa ? "99%" : guruApp.listingDetail.hlpaData.approvalChanceString;
                var $validity = guruApp.listingDetail.hlpaData.isExpired ? "valid" : "expired";
                $("body").trigger("ga.genericHlpaTracker", {
                    category: "HomeLoanPreApproval-Engagement",
                    action: "View",
                    label: "location=LDP-HomeLoanPre-ApprovalLabelMoreDetails",
                    payload: {
                        content: $content,
                        type: "label",
                        value: $value,
                        validity: $validity
                    }
                })
            })
        }
        if (typeof guruApp.listingDetail !== "undefined" && typeof guruApp.listingDetail.hlpaData !== "undefined" && guruApp.listingDetail.hlpaData.hasUserDoneTheTool && $(".hlpa-card").length > 0) {
            var $content = guruApp.listingDetail.hlpaData.isProjectHlpa ? "Pre-Approved" : "Not Pre-Approved";
            var $value = guruApp.listingDetail.hlpaData.isProjectHlpa ? "99%" : guruApp.listingDetail.hlpaData.approvalChanceString;
            var $validity = guruApp.listingDetail.hlpaData.isExpired ? "valid" : "expired";
            $("body").trigger("ga.genericHlpaTracker", {
                category: "HomeLoanPreApproval-Engagement",
                action: "View",
                label: "location=LDP-HomeLoanPre-ApprovalLabel",
                payload: {
                    content: $content,
                    type: "label",
                    value: $value,
                    validity: $validity
                }
            })
        }
        $("#hlpaDoneCard").click(function() {
            $("body").trigger("ga.genericHlpaTracker", {
                category: "HomeLoanPreApproval-Engagement",
                action: "Click",
                label: "location=LDP-HomeLoanPre-ApprovalLabelMoreDetails",
                payload: getListingDetailHLPAData("label")
            })
        });
        $("#hlpaNotDoneCard").click(function() {
            $("body").trigger("ga.genericHlpaTracker", {
                category: "HomeLoanPreApproval-Acquisition",
                action: "Click",
                label: "location=LDP-LabelBeforeCompletingHomeLoanPre-Approval",
                payload: {
                    content: "Whats my loan approval chance?",
                    type: "link"
                }
            })
        });
        $(".hlpa_right_price_trigger").click(function() {
            $("body").trigger("ga.genericHlpaTracker", {
                category: "HomeLoanPreApproval-Acquisition",
                action: "Click",
                label: "location=SERP-CtaBelowTotal",
                payload: {
                    content: "Got the right price range?",
                    type: "link"
                }
            })
        });
        var hlpaTagCount = $(".pull-left.hlpa").length;
        if (guruApp.country === "MY" && guruApp.listingSearch) {
            if (hlpaTagCount > 0) {
                $("body").trigger("ga.genericHlpaTracker", {
                    category: "HomeLoanPreApproval-Engagement",
                    action: "View",
                    label: "location=SERP",
                    payload: {
                        content: "With Home Loan Pre-Approval",
                        type: "tag",
                        validity: guruApp.listingSearch.hlpaData.isExpired ? "valid" : "expired"
                    }
                })
            } else {
                $("body").trigger("ga.genericHlpaTracker", {
                    category: "HomeLoanPreApproval-Engagement",
                    action: "View",
                    label: "location=SERP",
                    payload: {
                        content: "Without Home Loan Pre-Approval",
                        type: "tag",
                        validity: "not-applicable"
                    }
                })
            }
        }
    })
}
)(jQuery, Hogan, guruApp.Logger);
$(function($) {
    "use strict";
    (function() {
        $(".browse-item-more").on("click", function(e) {
            e.preventDefault();
            $(this).parent().addClass("browse-items-all");
            $(this).hide()
        })
    }
    )()
});
$(function($) {
    "use strict";
    var filter = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
    var resetPasswordGenerateNewNonce = function() {
        $.ajax({
            url: "/user/reset-password/nonce",
            success: function(data) {
                $("#form-modal-forgot-password input[name=nonce]").val(data.token)
            }
        })
    };
    var toggleElement = function(elementId, toggleStatus) {
        if (toggleStatus == "show") {
            $(elementId).addClass("show");
            $(elementId).removeClass("hide");
            $(elementId).fadeOut()
        }
        if (toggleStatus == "hide") {
            $(elementId).addClass("hide");
            $(elementId).removeClass("show");
            $(elementId).fadeIn()
        }
    };
    var validateEmailAndPassword = function(email, password) {
        var emailError = false;
        var passwordError = false;
        if (email.length <= 0) {
            inputIsError("#login-userid", guruSignUpAndLogin.ERR_EMAIL_EMPTY);
            emailError = true
        } else if (!filter.test(email)) {
            inputIsError("#login-userid", guruSignUpAndLogin.ERR_EMAIL_FORMAT);
            emailError = true
        }
        if (password.length <= 0) {
            inputIsError("#login-password", guruSignUpAndLogin.ERR_PASSWORD_EMPTY);
            passwordError = true
        }
        return !(emailError || passwordError)
    };
    var loadAndInitGooglePlateformApi = function() {
        if (typeof gapi === "undefined") {
            $.getScript("https://apis.google.com/js/platform.js", function() {
                gapi.load("auth2", function() {
                    gapi.auth2.init({
                        client_id: window.guruApp.googleApi.appId
                    })
                })
            })
        }
    };
    var performGoogleLogin = function(successCb) {
        var googleAuth = gapi.auth2.getAuthInstance();
        googleAuth.signIn().then(function(googleUser) {
            socialLoginSignup(googleUser.getBasicProfile().getId(), googleUser.getAuthResponse(true).access_token, "google", function() {
                successCb()
            })
        })
    };
    $("#modal-login, #modal-signup").on("show.bs.modal", loadAndInitGooglePlateformApi);
    $("div.modal #link-google-modal-login").on("click", function() {
        guruApp.widgetGoogleAnalytics && guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent("Personalizing", "Google Login Submit Attempt", "Pop-Up", null, "non-interactive");
        performGoogleLogin(function() {
            guruApp.widgetGoogleAnalytics && guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent("Personalizing", "Google Login Successful", "Pop-Up", null, "non-interactive");
            location.reload()
        })
    });
    $("div.modal #link-google-modal-signup").on("click", function() {
        guruApp.widgetGoogleAnalytics && guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent("Personalizing", "Google Registration Submit Attempt", "Pop-Up", null, "non-interactive");
        performGoogleLogin(function() {
            guruApp.widgetGoogleAnalytics && guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent("Personalizing", "Google Registration Successful", "Pop-Up", null, "non-interactive");
            location.reload()
        })
    });
    $("#login-userid").on("change", function(e) {
        $(this).parent().removeClass("has-error");
        toggleElement("#login-error-message", "hide")
    });
    $("#login-password").on("change", function(e) {
        $(this).parent().removeClass("has-error");
        toggleElement("#login-error-message", "hide")
    });
    $("#signup-subscription").on("change", function(e) {
        var facebook = $("#link-facebook-modal-signup");
        var google = $("#link-google-modal-signup");
        var getBaseUrl = function(url) {
            return url.split("?")[0]
        };
        if (this.checked) {
            facebook.attr("href", getBaseUrl(facebook.attr("href")) + "?subscribe=1");
            google.attr("href", getBaseUrl(google.attr("href")) + "?subscribe=1")
        } else {
            facebook.attr("href", getBaseUrl(facebook.attr("href")));
            google.attr("href", getBaseUrl(google.attr("href")))
        }
    });
    var inputIsError = function(element, errorText) {
        var element = $(element).parent();
        element.addClass("has-error");
        element.children(".error-msg").text(errorText)
    };
    $("#btn_login").on("click", function(e) {
        e.preventDefault();
        var theForm = this;
        var email = $("#login-userid").val();
        var password = $("#login-password").val();
        if (!validateEmailAndPassword(email, password)) {
            return
        }
        var sendLoginForm = function() {
            var userid = $("#login-userid").val();
            var password = $("#login-password").val();
            var remember_me = $("input[name='remember_me']").is(":checked");
            var data = {
                userid: userid,
                password: password,
                submit: "submit",
                fromModal: "1"
            };
            if (remember_me)
                data.remember_me = "1";
            $.ajax({
                type: "post",
                url: guruApp.loginModalWidget.path,
                data: data,
                timeout: 1e4,
                complete: function(xhr, status) {
                    if (status === "success") {
                        if (typeof guruApp.widgetGoogleAnalytics !== "undefined") {
                            guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent("Personalizing", "Login Successful", "Pop-Up", null, "non-interactive")
                        }
                        location.reload()
                    }
                },
                error: function(result) {
                    var errorSelector = "#login-error-message";
                    $(errorSelector).text(result.responseText);
                    toggleElement(errorSelector, "show")
                }
            })
        };
        sendLoginForm()
    });
    $(".js-logout").click(function(event) {
        event.preventDefault();
        if (guruApp && guruApp.marketing && guruApp.marketing.segment && guruApp.marketing.segment.isEnabled) {
            segmentReset()
        }
        var href = this.href;
        $.get(guruApp.identityEndpoint + "/reset", function(pgutid) {
            guruApp.pgutid = pgutid;
            localStorage.setItem("pgutid", pgutid)
        }).done(function() {
            location.href = href
        }).fail(function() {
            guruApp.pgutid = null;
            localStorage.removeItem("pgutid")
        })
    });
    $("#signup-userid").on("change", function(e) {
        $("#signup-error-message").removeClass("show");
        $(this).parent().removeClass("has-error")
    });
    $("#signup-password").on("change", function(e) {
        $("#signup-error-message").removeClass("show");
        $(this).parent().removeClass("has-error")
    });
    $("#btn-signup-modal-signup").on("click", function(e) {
        e.preventDefault();
        $("#signup-error-message").removeClass("show");
        var theForm = this;
        var email = $("#signup-userid").val();
        var password = $("#signup-password").val();
        var emailError = false;
        var passwordError = false;
        var filter = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
        if (email.length <= 0) {
            inputIsError("#signup-userid", guruSignUpAndLogin.ERR_EMAIL_EMPTY);
            emailError = true
        } else if (!filter.test(email)) {
            inputIsError("#signup-userid", guruSignUpAndLogin.ERR_EMAIL_FORMAT);
            emailError = true
        }
        if (password.length <= 0) {
            inputIsError("#signup-password", guruSignUpAndLogin.ERR_PASSWORD_EMPTY);
            passwordError = true
        }
        if (emailError || passwordError) {
            return
        }
        var formSubmit = function(data) {
            if (data === false) {
                var formData = {
                    userid: $("#signup-userid").val(),
                    password: $("#signup-password").val(),
                    communication_us: $("input[name=subscription]").val(),
                    news_subscription: $("input[name=subscription]").val()
                };
                signUpAction(formData)
            } else {
                var text = $("#modal-signup-email").html();
                var res = text.replace("demo@demo.com", email);
                $("#modal-signup-email").html(res);
                $("#signup-error-message").addClass("show");
                inputIsError("#signup-userid", guruSignUpAndLogin.ERR_EMAIL_EXISTS)
            }
        };
        var signUpSuccess = function(returnData) {
            if (returnData.error === false) {
                $("#modal-signup").modal("hide");
                $("#modal-signup-confirmation-link").modal("show");
                $("#modal-signup-confirmation-link img").trigger("appear")
            } else {
                formSubmit(returnData)
            }
        };
        var signUpAction = function(formData) {
            $.ajax({
                type: "post",
                url: $("#form-modal-signup").attr("action"),
                data: formData,
                success: function(data) {
                    signUpSuccess(data)
                },
                error: function(data) {
                    formSubmit(data)
                }
            })
        };
        formSubmit(false)
    });
    var gaTagging = function() {
        if (typeof guruApp.widgetGoogleAnalytics === "undefined") {
            return
        }
        var track = function(category, action, label, value, noninteraction, dimensions) {
            label = cleanText(label);
            guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent(category, action, label, value, noninteraction, dimensions)
        }
          , cleanText = function(str) {
            return str.replace(/^https?:\/\/[^\/]+/, "").replace(/^\s+/, "").replace(/\s+$/, "").replace(/\s+/, " ")
        };
        $("div.modal #btn_login").on("click", function() {
            track("Personalizing", "Login Submit Attempt", "Pop-Up", null, "non-interactive")
        });
        $("div.modal #link-login-modal-signup").on("click", function() {
            track("Personalizing", "Transfer from Registration to Login", "Pop-Up", null, "non-interactive")
        });
        $("#modal-login").on("shown.bs.modal", function() {
            track("Personalizing", "Viewing Login", "Pop-Up", null, "non-interactive")
        });
        $("div.modal#modal-login").on("hide.bs.modal", function() {
            track("Personalizing", "Login Cancel Attempt", "Pop-Up", null, "non-interactive")
        });
        $("div.modal #btn-signup-modal-signup").on("click", function() {
            track("Personalizing", "Registration Submit Attempt", "Pop-Up", null, "non-interactive")
        });
        $("div.modal #link-sign-up-modal-login").on("click", function() {
            track("Personalizing", "Transfer from Login to Registration", "Pop-Up", null, "non-interactive")
        });
        $("div.modal#modal-signup-confirmation-link").on("shown.bs.modal", function() {
            track("Personalizing", "Registration Successful", "Pop-Up", 1, "non-interactive")
        });
        $("#modal-signup").on("shown.bs.modal", function() {
            track("Personalizing", "Viewing Registration", "Pop-Up", null, "non-interactive")
        });
        $("div.modal#modal-signup").on("hide.bs.modal", function() {
            track("Personalizing", "Registration Cancel Attempt", "Pop-Up", null, "non-interactive")
        });
        $("#modal-signup-after-confirmation").on("shown.bs.modal", function() {
            var dimensions = [guruApp.widgetGoogleAnalytics.googleAnalyticsObject.createGaDimension("dimension20", JSON.stringify({
                Loc: "RegistrationPage",
                User: "Consumer"
            }))];
            track("Membership-Acquisition", "SignUp", "User=Consumer", null, null, dimensions)
        });
        $("#modal-forgot-password").on("shown.bs.modal", function() {
            track("Personalizing", "Viewing Forget Password", "Pop-Up", null, "non-interactive")
        });
        $("div.modal #btn_reset").on("click", function() {
            track("Personalizing", "Forget Password Attempt", "Pop-Up", null, "non-interactive")
        })
    };
    var googleLoginSingupTracking = function() {
        if (typeof guruApp.widgetGoogleAnalytics === "undefined") {
            return
        }
        if (localStorage.googleLoginSignupPage && localStorage.googleLoginSignupSource) {
            guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent("Personalizing", "Google " + localStorage.googleLoginSignupPage + " Successful", localStorage.googleLoginSignupSource, null, "non-interactive");
            localStorage.removeItem("googleLoginSignupPage");
            localStorage.removeItem("googleLoginSignupSource")
        }
    };
    gaTagging();
    googleLoginSingupTracking();
    $("#modal-login img").trigger("appear");
    $("#modal-signup img").trigger("appear");
    $("#modal-forgot-password").on("shown.bs.modal", function() {
        if (guruSignUpAndLogin.GENERATE_NEW_NONCE !== "undefined" && guruSignUpAndLogin.GENERATE_NEW_NONCE == 1) {
            resetPasswordGenerateNewNonce()
        }
    });
    $("#modal-forgot-password").trigger("event.created");
    $("#modal-login-nav").trigger("event.created")
});
function addEventToSession(catalog_id, timestamp, event_type) {
    if (sessionStorage) {
        var events = getEventsFromSession();
        if (!events || !Array.isArray(events)) {
            events = []
        }
        events.push({
            catalog_id: catalog_id + "",
            timestamp: timestamp,
            event_type: event_type
        });
        sessionStorage.setItem("sessionEvents", JSON.stringify(events))
    }
}
function getEventsFromSession() {
    if (sessionStorage) {
        var events = sessionStorage.getItem("sessionEvents") ? JSON.parse(sessionStorage.getItem("sessionEvents")) : null;
        return events
    } else {
        return null
    }
}
function registerLeadEventsListener() {
    $(".js-contact-form .btn.btn-primary.ins-init-condition-tracking").on("click", function() {
        if (guruApp.listingDetail && guruApp.listingDetail.gaECData) {
            var listingId = guruApp.listingDetail.gaECData.id;
            addEventToSession(listingId, getUnixTimestamp(), "LEAD")
        }
    })
}
function registerShortlistEventsListener() {
    $(".btn-shortlist").on("click", function(event) {
        var element = event.currentTarget;
        if (!$(element).hasClass("shortlisted")) {
            var listingId = element.getAttribute("data-listing-id");
            addEventToSession(listingId, getUnixTimestamp(), "SHORTLIST")
        }
    })
}
function registerViewListener() {
    if (guruApp.listingDetail && guruApp.listingDetail.gaECData) {
        var listingId = guruApp.listingDetail.gaECData.id;
        addEventToSession(listingId, getUnixTimestamp(), "VIEW")
    }
}
function getUnixTimestamp() {
    return Math.round((new Date).getTime() / 1e3)
}
$(window).on("load", function() {
    registerViewListener();
    registerShortlistEventsListener();
    registerLeadEventsListener()
});
$(function($) {
    "use strict";
    var $body = $("body");
    if (!guruApp.developerListing) {
        guruApp.developerListing = {}
    }
    if (guruApp.developerListing.developerObject) {
        throw "guruApp.developerListing.developerObject already defined!"
    }
    var developerListing = {
        isDetail: function() {
            if (!$("body").hasClass("listing_detail")) {
                return
            }
        },
        section: function() {
            developerListing.isDetail();
            var section = "New Projects";
            if ($("div.contents").hasClass("overseas-page") || $("body").attr("class").indexOf("overseas") > 0) {
                section = "Overseas"
            }
            if ($("section.main-content.project-reviews-details, section .container.property-review", $("body")).length > 0) {
                section = "Property Review"
            }
            return section
        },
        leadsSection: function() {
            developerListing.isDetail();
            var sections = {
                "newprojects-page": "new-project",
                "overseas-page": "overseas-property",
                "property-reviews": "new-project-reviews"
            }
              , leadsSection = "new-project";
            $.each(sections, function(index, value) {
                if ($("div.contents").hasClass(index)) {
                    leadsSection = value;
                    return false
                }
            });
            return leadsSection
        },
        listingId: function() {
            developerListing.isDetail();
            var listingId = $("#details", $("body")).attr("data-id")
              , section = developerListing.section();
            if (!listingId && section == "Property Review" && $(".project-reviews-details").length > 0) {
                listingId = $(".project-reviews-details").data("id")
            }
            return listingId
        }
    };
    guruApp.developerListing.developerObject = developerListing
});
(function($) {
    "use strict";
    $(document).on("change", ".internal-link-widget__moreless", function(e) {
        var $this = $(this);
        var $label = $this.prev();
        var text = $this.is(":checked") ? "less" : "more";
        $label.text($label.attr("data-" + text + "-text"));
        e.preventDefault()
    });
    $(document).on("click", ".internal-link-widget__readmore", function(e) {
        $(this).hide().prev().css({
            height: "auto",
            overflow: "none"
        });
        e.preventDefault()
    })
}
)(jQuery);
var data__widgets = {
    init: function() {
        var $ddlBinding = $("#faux-price-trend-widget .section-title")
          , $priceTrend = $ddlBinding.parent().find("#price-trend")
          , priceTrendStatus = $priceTrend.data("init");
        $ddlBinding.parent().show();
        if ($ddlBinding.length && $ddlBinding.parent().css("border-top-color").toLowerCase() == "rgb(255, 255, 255)") {
            $ddlBinding.on("click", function(e) {
                if ($(".w-graph__trends")[0] && priceTrendStatus == false) {
                    priceTrendStatus = true;
                    $priceTrend.data("init", true);
                    data__widgets.buildChart()
                } else {
                    $(".w-graph-chart").highcharts().reflow()
                }
            })
        } else {
            data__widgets.buildChart()
        }
    },
    buildChart: function() {
        if (typeof chartData === "undefined") {
            return
        }
        var type = chartData.transactionType;
        type = type.toLowerCase();
        data__widgets.trendChart(type);
        setTimeout(function() {
            $(".w-graph-chart").highcharts().reflow()
        }, 0)
    },
    trendChart: function(chartType) {
        var data__priceIndex = {}
          , data__valid = true
          , bedList = {}
          , room = $(".dropdown-graphRoom li .active").attr("data-roomcount")
          , defaultYear = $(".chart-wrap .btn-group-years").attr("data-defaultYear");
        chartType = typeof chartType !== "undefined" ? chartType : "default";
        room = typeof room !== "undefined" ? room : "all";
        if (room <= 0 || room == "All") {
            room = "all"
        }
        data__priceIndex = data__widgets.getChartData(chartType);
        trend__chart.createBedlist(chartType);
        trend__chart.displayRoomList(chartType);
        trend__chart.displayYearList(chartType);
        $(".w-graph__trends").removeClass("loading");
        if (data__valid == true) {
            trend__chart.bindGraphElements(data__priceIndex);
            trend__chart.createGraphData(chartType, defaultYear, data__priceIndex, room);
            $(".w-graph__trends .w-graph-chart").highcharts().xAxis[0].setExtremes(trend__chart.getXYearsInThePast(1), trend__chart.getXDaysInThePast(1));
            data__widgets.automationTests(data__priceIndex, room)
        } else {
            $(".w-graph__trends").addClass("not__found")
        }
    },
    automationTests: function(data__priceIndex, room) {
        var chartData = trend__chart.getRoom(data__priceIndex, room)
          , volumeTimeLow = 0
          , volumeTimeHigh = 0
          , volumeValueLow = 0
          , volumeValueHigh = 0
          , priceTimeLow = 0
          , priceTimeHigh = 0
          , priceIndexLow = 0
          , priceIndexHigh = 0
          , districtVolumeTrend = chartData.volumeTrend
          , districtPriceIndex = chartData.priceIndex;
        volumeTimeLow = $(districtVolumeTrend).first()[0][0];
        volumeTimeHigh = $(districtVolumeTrend).last()[0][0];
        volumeValueLow = $(districtVolumeTrend).first()[0][1];
        volumeValueHigh = $(districtVolumeTrend).last()[0][1];
        priceTimeLow = $(districtPriceIndex).first()[0][0];
        priceTimeHigh = $(districtPriceIndex).last()[0][0];
        priceIndexLow = $(districtPriceIndex).first()[0][1];
        priceIndexHigh = $(districtPriceIndex).last()[0][1];
        $(".chart-wrap").attr("data-volume-time-low", volumeTimeLow);
        $(".chart-wrap").attr("data-volume-time-high", volumeTimeHigh);
        $(".chart-wrap").attr("data-volume-value-low", volumeValueLow);
        $(".chart-wrap").attr("data-volume-value-high", volumeValueHigh);
        $(".chart-wrap").attr("data-price-time-low", priceTimeLow);
        $(".chart-wrap").attr("data-price-time-high", priceTimeHigh);
        $(".chart-wrap").attr("data-price-index-low", priceIndexLow);
        $(".chart-wrap").attr("data-price-index-high", priceIndexHigh)
    },
    getChartData: function(chartType) {
        var data__priceIndex = {};
        if (chartType == "sale") {
            data__priceIndex.json = $.parseJSON(chartData.trendSale)
        }
        if (chartType == "rent") {
            data__priceIndex.json = $.parseJSON(chartData.trendRent)
        }
        if (chartType == "default") {
            data__priceIndex.json = $.parseJSON(chartData.trend)
        }
        return data__priceIndex
    },
    bindings: function() {
        $body = $("body");
        var currentUrl = document.referrer
          , transactionType = ""
          , cellSize = 200
          , size = 0
          , rowCount = 0
          , highestCell = 0;
        if ($(".enable-login")[0]) {
            $(".widget-login").click(function(e) {
                $body.trigger("ga.new-login-intent-transaction-widget");
                parent.postMessage("loginforPremiumContent", "*")
            });
            $(".widget-signup").click(function(e) {
                $body.trigger("ga.new-registration-intent-transaction-widget");
                parent.postMessage("signupforPremiumContent", "*")
            })
        }
        if ($(".table-responsive-v-scroll")[0]) {
            $(".table-responsive-v-scroll").each(function(e) {
                size = 0;
                rowCount = 0;
                rowCount = $(this).find("tbody tr").length;
                size = rowCount * cellSize;
                $(this).find("tbody").width(Math.ceil(size))
            })
        }
        $(".insights-transactions li a").on("click", function(e) {
            var transactionType = $(this).attr("data-type"), productType;
            if (transactionType == "rent") {
                productType = "Rent"
            } else {
                productType = "Sale"
            }
            $body.trigger("ga.transaction-widget.tabclick", [toTitleCase(transactionType), productType])
        })
    }
};
var trend__chart = {
    createBedlist: function(chartType) {
        var options, activeBed, status = "", buttonText = "", $dropdownList = $(".dropdown-graphRoom"), unit = "Bedroom";
        if (chartType == "rent") {
            options = $.parseJSON(chartData.bedListRent)
        }
        if (chartType == "sale") {
            options = $.parseJSON(chartData.bedListSale)
        }
        if (chartType == "default") {
            options = $.parseJSON(chartData.bedList)
        }
        return options
    },
    displayRoomList: function(type) {
        $(".btn-graph-rooms").hide().removeClass("active");
        $(".btn-graph-rooms[data-type='" + type + "']").css("display", "inline-block").addClass("active")
    },
    displayYearList: function(type) {
        $(".btn-group-years").hide().removeClass("active");
        $(".btn-group-years[data-type='" + type + "']").css("display", "inline-block").addClass("active")
    },
    getXYearsInThePast: function(x) {
        return Date.now() - 1e3 * 3600 * 24 * 365.2425 * x
    },
    getXDaysInThePast: function(x) {
        return Date.now() - 1e3 * 3600 * 24 * x
    },
    getXDaysInTheFuture: function(x) {
        return Date.now() + 1e3 * 3600 * 24 * x
    },
    bindGraphElements: function(data__priceIndex) {
        var $wgraph = $(".w-graph")
          , $chart = $(".w-graph-chart")
          , $btnGroupYears = $wgraph.find(".btn-group-years")
          , btnGroupDefaultYear = parseInt($btnGroupYears.attr("data-defaultYear"), 10)
          , $btnGroupYearsLinks = $btnGroupYears.find("a")
          , $btnGroupYearsActive = $btnGroupYears.find(".active")
          , $btnGroupType = $wgraph.find(".dropdown-graphType a")
          , $btnGroupRoom = $wgraph.find(".dropdown-graphRoom a")
          , $btnGroupRoomActive = $btnGroupRoom.find(".active")
          , $resetZoom = $wgraph.find(".btn-reset-zoom a")
          , $years_trigger = $btnGroupYears.find(".btn-main")
          , $rooms_trigger = $(".btn-graph-rooms .btn-main")
          , graphRoom = $btnGroupRoom.parent().find(".active").attr("data-roomCount")
          , graphFilter = $btnGroupYears.find(".active").attr("data-yearrange")
          , graphRoomText = $btnGroupRoom.parent().find(".active").first().text()
          , propertyType = ""
          , unitType = ""
          , graphTypeParam = chartData.transactionType.toLowerCase()
          , needRedraw = true;
        if (graphTypeParam == "sale") {
            graphType = $btnGroupType.parent().find(".active").attr("data-graphType")
        } else {
            graphType = "rent"
        }
        $btnGroupType.unbind("click");
        $btnGroupRoom.unbind("click");
        $btnGroupYearsLinks.unbind("click");
        propertyType = chartData.propertyType;
        if (graphRoomText == "") {
            if (propertyType == "condo") {
                unitType = "Bedrooms"
            }
            if (propertyType == "hdb") {
                unitType = "Flats"
            }
            graphRoomText = "All"
        }
        $rooms_trigger.find(".roomText").html(graphRoomText + " " + unitType);
        $btnGroupType.click(function(e) {
            e.preventDefault();
            var $type_trigger = $(".btn-graph-type .btn-main"), text = $(this).text(), graphType = $(this).attr("data-graphType"), $yearObject = "", productType;
            if (graphType == "rent") {
                productType = "Rental"
            } else {
                productType = "Sales"
            }
            $body.trigger("ga.price-trends-widget.propertytype-dropdown", [text, productType]);
            $btnGroupType.removeClass("active");
            $(this).addClass("active");
            $type_trigger.text(text).val(text);
            trend__chart.displayRoomList(graphType);
            trend__chart.displayYearList(graphType);
            $btnGroupYearsLinks.each(function(e) {
                if ($(this).attr("data-yearrange") == btnGroupDefaultYear) {
                    $yearObject = $(this)
                }
            });
            $btnGroupYearsLinks.removeClass("active");
            $yearObject.addClass("active");
            $years_trigger.text($yearObject.text()).val($yearObject.attr("data-yearrange"));
            graphFilter = $btnGroupYears.find(".active").attr("data-yearrange");
            if ($chart.highcharts()) {
                $chart.highcharts().destroy()
            }
            data__widgets.trendChart(graphType);
            $(".w-graph-chart").highcharts().xAxis[0].setExtremes(widget__graphs.getXYearsInThePast(graphFilter), widget__graphs.getXDaysInThePast(1));
            guruApp.fn.addListingDetailToCart("Price Trend Widget")
        });
        $btnGroupRoom.click(function(e) {
            e.preventDefault();
            var roomNum = $(this).attr("roomCount"), text = $(this).text(), productType, roomsSelected;
            $btnGroupRoom.removeClass("active");
            $(this).addClass("active");
            $rooms_trigger.attr("data-activeRoom", roomNum).val(roomNum).find("roomTxt").html(text);
            graphRoomText = $(this).text();
            if (graphTypeParam == "sale") {
                graphType = $btnGroupType.parent().find(".active").attr("data-graphType")
            } else {
                graphType = "rent"
            }
            if (graphType == "rent") {
                productType = "Rental"
            } else {
                productType = "Sales"
            }
            roomsSelected = $(".dropdown-graphRoom li .active").attr("data-roomcount");
            $body.trigger("ga.price-trends-widget.bedrooms-dropdown", [roomsSelected, productType]);
            graphRoom = $btnGroupRoom.parent().find(".active").attr("data-roomCount");
            graphFilter = $btnGroupYearsActive.attr("data-yearRange");
            data__priceIndex = data__widgets.getChartData(graphType);
            if ($chart.highcharts()) {
                $chart.highcharts().destroy()
            }
            data__widgets.trendChart(graphType);
            $(".w-graph-chart").highcharts().xAxis[0].setExtremes(widget__graphs.getXYearsInThePast(graphFilter), widget__graphs.getXDaysInThePast(1));
            guruApp.fn.addListingDetailToCart("Price Trend Widget")
        });
        $btnGroupYearsLinks.click(function(e) {
            e.preventDefault();
            var text = $(this).text(), productType;
            if (graphTypeParam == "sale") {
                graphType = $btnGroupType.parent().find(".active").attr("data-graphType")
            } else {
                graphType = "rent"
            }
            if (graphType == "rent") {
                productType = "Rental"
            } else {
                productType = "Sales"
            }
            graphRoom = $btnGroupRoom.parent().find(".active").attr("data-roomCount");
            graphFilter = $(this).attr("data-yearRange");
            $body.trigger("ga.price-trends-widget.years-dropdown", [graphFilter, productType]);
            $btnGroupYearsLinks.removeClass("active");
            $(this).addClass("active");
            $btnGroupYearsActive = $(this);
            $years_trigger.text(text).val(text);
            if ($chart.highcharts()) {
                $chart.highcharts().destroy()
            }
            data__widgets.trendChart(graphType);
            $(".w-graph-chart").highcharts().xAxis[0].setExtremes(widget__graphs.getXYearsInThePast(graphFilter), widget__graphs.getXDaysInThePast(1));
            guruApp.fn.addListingDetailToCart("Price Trend Widget")
        });
        $resetZoom.click(function(e) {
            var $btnGroupYears = $(".btn-group-years a");
            e.preventDefault();
            $btnGroupYears.removeClass("active");
            $chart.parent().removeClass("zoom-active");
            if ($chart.highcharts()) {
                $chart.highcharts().destroy()
            }
            data__widgets.trendChart(graphType)
        })
    },
    getLowestTimestamp: function(series) {
        var min_val = 1e22;
        for (var i = 0; i < series.length; i++) {
            if (series[i] === null) {
                continue
            }
            for (var j = 0; j < series[i].length; j++) {
                if (series[i][j] < min_val) {
                    min_val = series[i][j]
                }
                break
            }
        }
        return min_val
    },
    getHighestTimestamp: function(series) {
        var max_val = 0;
        for (var i = 0; i < series.length; i++) {
            for (var j = 0; j < series[i].length; j++) {
                if (series[i][j] > max_val) {
                    min_val = series[i][j]
                }
                break
            }
        }
        return max_val
    },
    reindexFromYear: function(serie, filter) {
        var x = trend__chart.getXYearsInThePast(filter);
        if (typeof serie == "undefined" || serie === null) {
            return null
        }
        var index = null;
        for (var i = 0; i < serie.length; i++) {
            if (serie[i][0] > x) {
                index = i;
                break
            }
        }
        if (index === 0 || index === null || serie[index - 1][1] === null || serie[index][1] === null) {
            return null
        }
        var x0 = serie[index - 1][0]
          , x1 = serie[index][0]
          , y0 = serie[index - 1][1]
          , y1 = serie[index][1];
        var valueAtNorm = y0 + (y1 - y0) * (x - x0) / (x1 - x0)
          , factor = 100 / valueAtNorm;
        return trend__chart.scaleSeries(serie, factor)
    },
    scaleSeries: function(serie, factor) {
        if (!$.isArray(serie)) {
            return null
        }
        var out = serie.slice(0);
        for (var i = 0; i < serie.length; i++) {
            out[i][1] = serie[i][1] === null ? null : serie[i][1] * factor
        }
        return out
    },
    getRoom: function(data, room) {
        var row, found = false, roomObject = {}, allRoomObject = {};
        for (var i = 0; i < data.json.length; i++) {
            if (data.json[i]["bedroomsType"]instanceof Array) {
                allRoomObject = data.json[i]
            } else {
                if (data.json[i]["bedroomsType"].charAt(0).toLowerCase() == room.toLowerCase()) {
                    found = true;
                    roomObject = data.json[i]
                }
            }
        }
        if (room.toLowerCase() != "all") {
            if (found == true) {
                return roomObject
            }
        }
        volumeTimeLow = 0;
        volumeTimeHigh = 0;
        volumeValueLow = 0;
        volumeValueHigh = 0;
        priceTimeLow = 0;
        priceTimeHigh = 0;
        priceIndexLow = 0;
        priceIndexHigh = 0;
        $(".btn-graph-rooms .btn-main .roomText").text($('.btn-graph-rooms *[data-roomcount="all"]').first().text());
        return allRoomObject
    },
    createGraphData: function(type, filter, data, froom) {
        var graphProperties = {}
          , date__filter = new Date
          , data_guru_locale = "my"
          , rentDataCache = {}
          , saleDataCache = {}
          , data__specific = {}
          , chartCached = false
          , districtMeta = $.parseJSON(chartData.districtMeta);
        data = jQuery.extend(true, {}, data);
        data.json = trend__chart.getRoom(data, froom);
        if (data.json != null && typeof data.json !== "undefined") {
            data.districtAvgPSF = data.json.avgPsf;
            data.districtVolumeTrend = data.json.volumeTrend;
            data.districtPriceIndex = data.json.priceIndex;
            data.districtBedrooms = data.json.bedroomsType
        } else {
            data.propertyCount = 0;
            data.propertyAvgPrice = 0;
            data.propertyAvgPricePerArea = 0
        }
        graphProperties.graphType = type;
        graphProperties.districtDescription = districtMeta.districtDescription;
        graphProperties.propertyType = districtMeta.propertyType;
        data.districtPriceIndex = trend__chart.scaleSeries(data.json.priceIndex, data.districtAvgPSF);
        graphProperties.title = type + " trend";
        graphProperties.count = data.json.numTrans;
        graphProperties.room = room + " room";
        if (room > 1 || room == "all") {
            graphProperties.room += "s"
        }
        graphProperties.siteName = "PropertyGuru";
        if (graphProperties.siteName == "") {
            graphProperties.siteName = "PropertyGuru"
        }
        graphProperties.series = [{
            name: "Volume",
            metric: "units",
            symbol: "",
            type: "column",
            color: "#81c08d",
            width: 100,
            data: data.districtVolumeTrend
        }, {
            name: "Price Trend",
            metric: "psf",
            symbol: "$",
            type: "spline",
            color: "#9cbbe9",
            width: .5,
            yAxis: 1,
            data: data.districtPriceIndex
        }];
        graphProperties.crosshairs = {
            color: "#999999",
            dashStyle: "solid"
        };
        graphProperties.xAxisLabel = "";
        graphProperties.yAxisLabel = "Units";
        graphProperties.xfloor = trend__chart.getLowestTimestamp(data.districtPriceIndex);
        trend__chart.displayTimeSeries(graphProperties)
    },
    displayTimeSeries: function(graphProperties) {
        var disclaimer = "Source: URA, HDB & PropertyGuru.<br/>Based on " + parseInt(graphProperties.count, 10).format() + " " + graphProperties.propertyType + " transactions in " + graphProperties.districtDescription;
        var chart = $(".w-graph-chart").highcharts({
            chart: {
                backgroundColor: "transparent",
                spacingBottom: 40,
                spacingTop: 30,
                zoomType: "xy",
                resetZoomButton: {
                    theme: {
                        display: "none"
                    }
                },
                events: {
                    selection: function(event) {
                        $(".w-graph__trends").addClass("zoom-active");
                        $(".btn-group-years a").removeClass("active")
                    }
                }
            },
            title: {
                text: "",
                align: "left",
                verticalAlign: "top",
                x: 0
            },
            subtitle: {
                align: "center",
                floating: true,
                verticalAlign: "bottom",
                text: disclaimer,
                borderWidth: 0,
                height: 20,
                x: 0,
                y: 40
            },
            legend: {
                align: "right",
                floating: true,
                verticalAlign: "top",
                layout: "horizontal",
                borderWidth: 0,
                x: 0,
                y: -30
            },
            xAxis: {
                type: "datetime",
                dateTimeLabelFormats: {
                    month: "%e. %b",
                    year: "%b"
                },
                labels: {
                    format: "{value:%b} {value:%y}",
                    rotation: 0,
                    step: 1
                },
                title: {
                    text: graphProperties.xAxisLabel
                },
                floor: graphProperties.xfloor,
                ceiling: trend__chart.getXDaysInTheFuture(1),
                minRange: 1e3 * 3600 * 24 * 30
            },
            yAxis: [{
                title: {
                    text: graphProperties.yAxisLabel
                },
                floor: 0,
                title: {
                    text: "Transaction Volume",
                    style: {}
                },
                ceiling: trend__chart.getXDaysInTheFuture(1),
                labels: {
                    formatter: function() {
                        return Highcharts.numberFormat(this.value, 0)
                    },
                    style: {},
                    format: "{value:%b} {value:%y}",
                    rotation: 0,
                    step: 1
                }
            }, {
                gridLineWidth: 0,
                title: {
                    text: "Price Per Square Feet ",
                    style: {}
                },
                ceiling: trend__chart.getXDaysInTheFuture(1),
                labels: {
                    formatter: function() {
                        return "$" + Highcharts.numberFormat(this.value, 2)
                    },
                    style: {},
                    format: "{value}",
                    rotation: 0,
                    step: 1
                },
                opposite: true
            }],
            plotOptions: {
                series: {
                    marker: {
                        enabled: false
                    },
                    events: {
                        legendItemClick: function() {}
                    }
                }
            },
            tooltip: {
                shared: true,
                useHTML: true,
                followPointer: true,
                formatter: function() {
                    var tooltip_markup = ""
                      , timestamp = new Date(this.points[0].x)
                      , y_value = 0;
                    tooltip_markup += '<div class="inside-tooltip"><div class="header">' + '<h2 class="series-type">' + graphProperties.graphType.capitalizeFirstLetter() + '</h2> <span class="date">' + timestamp.customFormat("#MMM# #D##th# #YY#") + "</span></div>" + '<span class="rooms"> ' + $(".btn-graph-rooms.active .btn-main").text() + "</span>" + "<table>";
                    $.each(this.points, function() {
                        y_value = this.y;
                        if (this.series.options.metric == "psf") {
                            y_value = Highcharts.numberFormat(this.y, 2)
                        }
                        tooltip_markup += "<tr>" + '<td class="series-label" style="color:' + this.series.color + '">' + this.series.name + ": </td>" + '<td style="text-align: right"><b>' + this.series.options.symbol + y_value + " " + this.series.options.metric + "</b></td>" + "</tr>"
                    });
                    tooltip_markup += "</table></div>";
                    return tooltip_markup
                },
                valueDecimals: 2,
                crosshairs: graphProperties.crosshairs
            },
            credits: {
                enabled: false
            },
            series: graphProperties.series
        })
    }
};
function updateQueryString(key, value) {
    var re = new RegExp("([?&])" + key + "=.*?(&|#|$)(.*)","gi"), hash, url = window.location.href;
    if (re.test(url)) {
        if (typeof value !== "undefined" && value !== null)
            return url.replace(re, "$1" + key + "=" + value + "$2$3");
        else {
            hash = url.split("#");
            url = hash[0].replace(re, "$1$3").replace(/(&|\?)$/, "");
            if (typeof hash[1] !== "undefined" && hash[1] !== null)
                url += "#" + hash[1];
            return url
        }
    } else {
        if (typeof value !== "undefined" && value !== null) {
            var separator = url.indexOf("?") !== -1 ? "&" : "?";
            hash = url.split("#");
            url = hash[0] + separator + key + "=" + value;
            if (typeof hash[1] !== "undefined" && hash[1] !== null)
                url += "#" + hash[1];
            return url
        } else
            return url
    }
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)")
      , results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "))
}
String.prototype.escapeSpecialChars = function() {
    return this.replace(/&quot;/g, '"').replace(/\\n/g, "\\n").replace(/\\'/g, "\\'").replace(/\\"/g, '\\"').replace(/\\&/g, "\\&").replace(/\\r/g, "\\r").replace(/\\t/g, "\\t").replace(/\\b/g, "\\b").replace(/\\f/g, "\\f")
}
;
String.prototype.capitalizeFirstLetter = function() {
    return this.charAt(0).toUpperCase() + this.slice(1)
}
;
Date.prototype.customFormat = function(formatString) {
    var YYYY, YY, MMMM, MMM, MM, M, DDDD, DDD, DD, D, hhhh, hhh, hh, h, mm, m, ss, s, ampm, AMPM, dMod, th;
    YY = ((YYYY = this.getFullYear()) + "").slice(-2);
    MM = (M = this.getMonth() + 1) < 10 ? "0" + M : M;
    MMM = (MMMM = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][M - 1]).substring(0, 3);
    DD = (D = this.getDate()) < 10 ? "0" + D : D;
    DDD = (DDDD = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][this.getDay()]).substring(0, 3);
    th = D >= 10 && D <= 20 ? "th" : (dMod = D % 10) == 1 ? "st" : dMod == 2 ? "nd" : dMod == 3 ? "rd" : "th";
    formatString = formatString.replace("#YYYY#", YYYY).replace("#YY#", YY).replace("#MMMM#", MMMM).replace("#MMM#", MMM).replace("#MM#", MM).replace("#M#", M).replace("#DDDD#", DDDD).replace("#DDD#", DDD).replace("#DD#", DD).replace("#D#", D).replace("#th#", th);
    h = hhh = this.getHours();
    if (h == 0)
        h = 24;
    if (h > 12)
        h -= 12;
    hh = h < 10 ? "0" + h : h;
    hhhh = h < 10 ? "0" + hhh : hhh;
    AMPM = (ampm = hhh < 12 ? "am" : "pm").toUpperCase();
    mm = (m = this.getMinutes()) < 10 ? "0" + m : m;
    ss = (s = this.getSeconds()) < 10 ? "0" + s : s;
    return formatString.replace("#hhhh#", hhhh).replace("#hhh#", hhh).replace("#hh#", hh).replace("#h#", h).replace("#mm#", mm).replace("#m#", m).replace("#ss#", ss).replace("#s#", s).replace("#ampm#", ampm).replace("#AMPM#", AMPM)
}
;
function toTitleCase(str) {
    return str.replace(/\w\S*/g, function(txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()
    })
}
$(function() {
    if (!$("body").is(".app-sg")) {
        return
    }
    var $window = $(window);
    $window.on("highcharts.loaded", function() {
        data__widgets.init()
    });
    data__widgets.bindings()
});
(function($) {
    function updateSortableTable($sortIcon, urlHandler) {
        var searchParams = urlHandler.getSearchQuery()
          , sortParams = /[&]*(sort|order)=[a-zA-Z0-9]+/g
          , newUrl = "?";
        if ($sortIcon.hasClass("active")) {
            return true
        }
        searchParams = searchParams.replace(sortParams, "");
        if (searchParams.length > 1) {
            newUrl = searchParams + "&"
        }
        newUrl += "sort=" + $sortIcon.closest(".sort").attr("data-sort");
        newUrl += "&order=" + ($sortIcon.hasClass("desc") ? "desc" : "asc");
        urlHandler.setNewUrl(newUrl);
        return true
    }
    $.fn.sortableTable = function(urlHandler) {
        $(this).find(".sort span").click(function() {
            updateSortableTable($(this), urlHandler)
        })
    }
}
)(jQuery);
$(function() {
    var $propertyDigest = $(".my-account-property-digest");
    var $ddlList = $(".ddl-digest-frequency")
      , textValue = ""
      , digestButton = $ddlList.find(".btn")
      , $digestInput = $ddlList.find(".ddlDigest");
    $ddlList.find("a").on("click", function(event) {
        event.preventDefault();
        textValue = $(this).text();
        digestButton.text(textValue);
        $digestInput.val(textValue);
        if (textValue == "Never") {
            $propertyDigest.find("input[type=checkbox]").removeAttr("checked")
        }
    })
});
function initializeCrousel() {
    var $allCarouselPhotos = $(".media-gallery-widget");
    if (!$allCarouselPhotos.length) {
        return
    }
    $allCarouselPhotos.carousel({
        interval: false,
        wrap: false
    });
    $allCarouselPhotos.each(function() {
        var $carouselPhotos = $(this)
          , $carouselInner = $carouselPhotos.find(".carousel-inner")
          , $photosvideos = $carouselPhotos.closest(".photosvideos-gallery")
          , $isInfiniteWidthGallery = $photosvideos.hasClass("infinite");
        try {
            if ($photosvideos.hasClass("infinite")) {
                $carouselPhotos.removeClass("slide");
                $carouselPhotos.data("bs.carousel.swipe").options.swipe = false
            } else {
                $carouselPhotos.data("bs.carousel.swipe").options.swipe = true
            }
        } catch (e) {}
        var carouselElem = $carouselPhotos.get(0)
          , hasFullscreenApi = carouselElem.requestFullscreen || carouselElem.msRequestFullscreen || carouselElem.mozRequestFullScreen || carouselElem.webkitRequestFullscreen
          , $firstMediaType = $carouselPhotos.find(".js-img:first, .js-imgFloor:first, .js-vid:first, .js-vt:first");
        $carouselPhotos.find(".item img").on("lazyLoad", function() {
            var $img = $(this)
              , carouselRatio = 4 / 3
              , height = parseInt(this.height, 10) || 0
              , width = parseInt(this.width, 10) || 0
              , imageRatio = height > 0 ? width / height : 0;
            $img.closest(".item").addClass("item-" + (imageRatio >= carouselRatio ? "horiz" : "vert"))
        });
        function setActivePhotoCaption(caption, property) {
            var $type = $carouselPhotos.find(".carousel-information .type");
            var $title = $carouselPhotos.find(".carousel-information .title");
            var $details = $(".carousel-information .detail");
            if (property) {
                $type.html(property).removeClass("hide")
            } else {
                $type.addClass("hide")
            }
            if (caption) {
                $title.html(caption).removeClass("hide")
            } else {
                $title.addClass("hide")
            }
            if (property === "Project") {
                $details.css({
                    visibility: "hidden"
                })
            } else {
                $details.css({
                    visibility: "visible"
                })
            }
        }
        function handleSlideControlDisplay() {
            if ($carouselInner.find(".item:last-child").hasClass("active")) {
                $carouselInner.parent().find(".right.carousel-control").addClass("disabled");
                $carouselInner.parent().find(".left.carousel-control").removeClass("disabled")
            } else if ($carouselInner.find(".item:first-child").hasClass("active")) {
                $carouselInner.parent().find(".left.carousel-control").addClass("disabled");
                $carouselInner.parent().find(".right.carousel-control").removeClass("disabled")
            } else {
                $carouselInner.parent().find(".left.carousel-control").removeClass("disabled");
                $carouselInner.parent().find(".right.carousel-control").removeClass("disabled")
            }
            var $carouselIndicators = $carouselPhotos.find(".carousel-indicators");
            if ($carouselIndicators.find(".indicator-item:last-child").hasClass("active")) {
                $carouselIndicators.parent().find(".right.carousel-control").addClass("disabled");
                $carouselIndicators.parent().find(".left.carousel-control").removeClass("disabled")
            } else if ($carouselIndicators.find(".indicator-item:first-child").hasClass("active")) {
                $carouselIndicators.parent().find(".left.carousel-control").addClass("disabled");
                $carouselIndicators.parent().find(".right.carousel-control").removeClass("disabled")
            } else {
                $carouselIndicators.parent().find(".left.carousel-control").removeClass("disabled");
                $carouselIndicators.parent().find(".right.carousel-control").removeClass("disabled")
            }
        }
        var onClickMediaType = function(event) {
            event.preventDefault();
            var type = event.currentTarget.hash.replace(/[^a-zA-Z\-_]+/, "");
            $firstMediaType.filter(".js-" + type).click();
            if ($isInfiniteWidthGallery) {
                var $carouselContainer = $carouselPhotos.find(".carousel-inner.infinite");
                var firstMediaTypeElement = $carouselPhotos.find("." + type).first();
                var elementLeft = firstMediaTypeElement.position().left;
                var pos = $carouselContainer.scrollLeft() + elementLeft;
                $carouselContainer.stop().animate({
                    scrollLeft: pos
                }, "slow")
            }
            return false
        };
        var $firstTabItem = $carouselPhotos.find(".carousel-indicator-tabs .nav-tabs>li:first-child");
        var toggleIndicatorTab = function(index) {
            var $indicators = $carouselPhotos.find(".carousel-indicators");
            var $activeIndicator = $indicators.children().eq(index);
            var $activeThumb = $activeIndicator.children("img");
            var $tabItem = null;
            $(".carousel-major").removeClass("full-height");
            $(".make-an-enquiry, .close-btn").removeClass("hide");
            $(".btn--back").addClass("hide");
            if (guruApp.client.is_mobile) {
                $(".carousel-bottom-toolbar").css({
                    visibility: "visible"
                })
            } else {
                $(".carousel-information .detail").removeClass("hide")
            }
            if ($activeThumb.is(".js-img")) {
                $tabItem = $carouselPhotos.find(".carousel-indicator-tabs .nav-tabs a[href=\\#img]").parent()
            } else if ($activeThumb.is(".js-imgFloor")) {
                $tabItem = $carouselPhotos.find(".carousel-indicator-tabs .nav-tabs a[href=\\#imgFloor]").parent()
            } else if ($activeThumb.is(".js-vid")) {
                $tabItem = $carouselPhotos.find(".carousel-indicator-tabs .nav-tabs a[href=\\#vid]").parent()
            } else if ($activeThumb.is(".js-form")) {
                $("body").trigger("ga.gallery.form.visible");
                $(".carousel-major").addClass("full-height");
                $(".make-an-enquiry, .close-btn").addClass("hide");
                $(".btn--back").removeClass("hide");
                if (guruApp.client.is_mobile) {
                    $(".carousel-bottom-toolbar").css({
                        visibility: "hidden"
                    })
                } else {
                    $(".carousel-information .detail").addClass("hide")
                }
            }
            var caption = $activeThumb.data("caption") || "";
            var property = $activeThumb.data("property") || "";
            setActivePhotoCaption(caption, property);
            if ($tabItem) {
                if ($firstTabItem && $firstTabItem[0] !== $tabItem[0]) {
                    $firstTabItem.toggleClass("active", false)
                }
                $tabItem.toggleClass("active", true);
                $firstTabItem = $tabItem
            } else {
                if ($firstTabItem) {
                    $firstTabItem.toggleClass("active", false)
                }
                $firstTabItem = $tabItem
            }
        };
        $carouselPhotos.on("slide.bs.carousel", function(e) {
            if ($carouselInner.hasClass("infinite")) {
                e.stopPropagation();
                var dir = e.direction === "left" ? "+=" : "-=";
                $carouselInner.stop().animate({
                    scrollLeft: dir + screen.width
                }, "slow")
            } else {
                var $carousel = $(this)
                  , $indicators = $carousel.find(".carousel-indicators")
                  , $activeItem = $(e.relatedTarget)
                  , $oldActive = $carousel.find(".carousel-inner").children(".active")
                  , activeIndex = $carousel.find(".carousel-inner").children().index(e.relatedTarget)
                  , $activeIndicator = $indicators.children().eq(activeIndex)
                  , $activeThumb = $activeIndicator.children("img")
                  , left = $activeIndicator.position() ? $activeIndicator.position().left : 0
                  , $counterUI = $carousel.find(".carousel-media-count-current")
                  , id = $carousel.find(".carousel-inner").children().eq(activeIndex).find(".gallery-item").data("id");
                if ($counterUI.length) {
                    $counterUI.html(activeIndex + 1)
                }
                var caption = $activeThumb.data("caption") || "";
                var property = $activeThumb.data("property") || "";
                setActivePhotoCaption(caption, property);
                $carousel.carousel("pause");
                $activeIndicator.addClass("active");
                $carousel.toggleClass("showing-video", $activeThumb.is(".js-vid, .js-vt, .js-form"));
                $carousel.toggleClass("showing-form", $activeThumb.is(".js-form"));
                if ($oldActive.is(".item-htm")) {
                    var $iframe = $oldActive.children("iframe");
                    if ($iframe.length) {
                        $iframe.get(0).contentWindow.postMessage('{"event":"command","func":"' + "pauseVideo" + '","args":""}', "*")
                    }
                }
                $indicators.animate({
                    scrollLeft: $indicators.prop("scrollLeft") + left
                }, {
                    duration: 600
                });
                var $toLoad = $activeItem.add($activeItem.next()).add($activeItem.prev()).find("img.lazy");
                $toLoad.trigger("appear");
                toggleIndicatorTab(activeIndex)
            }
        }).on("slide.bs.carousel", function() {
            $carouselPhotos.find(".carousel-indicators img.lazy").trigger("appear")
        }).on("slid.bs.carousel", function() {
            handleSlideControlDisplay()
        }).on("click.carousel", ".carousel-media-breakdown a", onClickMediaType).on("click.carousel", ".carousel-indicator-tabs .nav-tabs a", onClickMediaType);
        if ($carouselInner.children(".item").length <= 1) {
            $carouselPhotos.find(".right.carousel-control").toggleClass("disabled", true)
        }
        var $infiniteCarousels = $carouselPhotos.find(".carousel-inner.infinite");
        if ($infiniteCarousels.length) {
            $("img.lazy").lazyload({
                container: $infiniteCarousels
            })
        }
        var $firstCarouselSlide = $carouselInner.children().first();
        $firstCarouselSlide.find("img.lazy").one("appear", function() {
            $firstCarouselSlide.next().find("img.lazy").trigger("appear")
        });
        var $fullscreenLink = $carouselPhotos.find(".carousel-fullscreen");
        var closeTitle = $fullscreenLink.attr("title");
        $fullscreenLink.removeClass("hide");
        $fullscreenLink.attr("title", "");
        var $images = $photosvideos.find(".carousel-inner .item .gallery-item img");
        var GalleryHeightManager = {
            indicators: $photosvideos.find(".carousel-indicators"),
            setFullScreen: function() {
                var $activeThumb = this.indicators.find(".active img");
                var caption = $activeThumb.data("caption") || "";
                var property = $activeThumb.data("property") || "";
                setActivePhotoCaption(caption, property);
                $fullscreenLink.attr("title", closeTitle)
            },
            setRegular: function() {
                $fullscreenLink.attr("title", "")
            },
            resetInfiniteGallery: function() {
                if ($isInfiniteWidthGallery) {
                    $photosvideos.addClass("infinite");
                    $photosvideos.find(".carousel-inner").addClass("infinite");
                    GalleryHeightManager.indicators.addClass("hidden");
                    $carouselPhotos.removeClass("slide");
                    $carouselInner.find(".item:first-child").addClass("active").siblings().removeClass("active");
                    try {
                        $carouselPhotos.data("bs.carousel.swipe").options.swipe = false
                    } catch (e) {}
                }
            }
        };
        $fullscreenLink.on("click", function(e) {
            e.preventDefault();
            toggleFullScreen(carouselElem);
            $carouselPhotos.find(".carousel-indicators img.lazy").trigger("appear");
            return false
        });
        $(".make-an-enquiry").off("click").on("click", function(e) {
            e.preventDefault();
            $(".carousel-indicator-tabs ol li:last-child").trigger("click")
        });
        $(".back-button").off("click").on("click", function(e) {
            e.preventDefault();
            $(".carousel-indicator-tabs ol li:last-child").prev().trigger("click")
        });
        $(".close-fullscreen").off("click").on("click", function(e) {
            e.preventDefault();
            toggleFullScreen(carouselElem)
        });
        $carouselPhotos.find(".js-share-bs-dropdown .dropdown-menu a").on("click", function() {
            toggleFullScreen(carouselElem)
        });
        function showMediaViewInFulscreen($fa, $galleryForm, $photosGallery) {
            var $fullScreenElement = getFullScreenElement();
            if ($fullScreenElement) {
                $fullScreenElement = $($fullScreenElement);
                if ($fullScreenElement.is(".gallery-item > iframe")) {
                    var index = $fullScreenElement.closest(".item").index();
                    $fullScreenElement.closest(".carousel").find(".carousel-indicators").children().eq(index).trigger("click")
                }
            }
            $photosGallery.removeClass("not-in-fullscreen").addClass("in-fullscreen");
            GalleryHeightManager.setFullScreen();
            $fa.removeClass("pgicon-fullscreen").addClass("pgicon-cancel");
            $carouselPhotos.addClass("slide");
            $photosvideos.removeClass("infinite");
            $photosvideos.find(".carousel-inner").removeClass("infinite");
            $photosvideos.find(".carousel-indicators").removeClass("hidden");
            try {
                $carouselPhotos.data("bs.carousel.swipe").options.swipe = true
            } catch (e) {}
            $("#galleryFormInputName").val($('form[data-placement="RightSide"] #inputName').val());
            $("#galleryFormInputMobile").val($('form[data-placement="RightSide"] #inputMobile').val());
            $("#galleryFormInputMobile").attr("pattern", $('form[data-placement="RightSide"] #inputMobile').attr("pattern"));
            $("#galleryFormInputEmail").val($('form[data-placement="RightSide"] #inputEmail').val());
            $galleryForm.show();
            var $activeItem = $carouselInner.children(".active");
            var activeIndex = $carouselInner.children().index($activeItem[0]);
            toggleIndicatorTab(activeIndex);
            $carouselPhotos.trigger("ga.gallery.fullscreen.open")
        }
        function exitMediaFullView($fa, $galleryForm) {
            GalleryHeightManager.resetInfiniteGallery();
            GalleryHeightManager.setRegular();
            $carouselPhotos.addClass("not-in-fullscreen").removeClass("in-fullscreen");
            $fa.addClass("pgicon-fullscreen").removeClass("pgicon-cancel");
            $galleryForm.hide();
            $carouselPhotos.trigger("ga.gallery.fullscreen.close")
        }
        $(window).on("enterFullScreenMediaGalleryView", function(_, $photosWrapper) {
            if ($photosWrapper.length) {
                var $fa = $fullscreenLink.children(".pgicon")
                  , $galleryForm = $photosWrapper.find(".gallery-form");
                showMediaViewInFulscreen($fa, $galleryForm, $photosWrapper.find(".media-gallery-widget"));
                handleSlideControlDisplay($photosWrapper)
            }
        });
        $(window).on("exitFullScreenMediaGalleryView", function(_, $photosWrapper) {
            if ($photosWrapper.length) {
                var $fa = $fullscreenLink.children(".pgicon")
                  , $galleryForm = $photosWrapper.find(".gallery-form");
                exitMediaFullView($fa, $galleryForm);
                handleSlideControlDisplay($carouselPhotos)
            }
        });
        $(document).on("fullscreenchange mozfullscreenchange webkitfullscreenchange mskitfullscreenchange", function(e) {
            var $fa = $fullscreenLink.children(".pgicon")
              , $galleryForm = $photosvideos.find(".gallery-form");
            if (isInFullScreen()) {
                showMediaViewInFulscreen($fa, $galleryForm, $carouselPhotos)
            } else {
                exitMediaFullView($fa, $galleryForm)
            }
            handleSlideControlDisplay($carouselPhotos)
        });
        $photosvideos.find(".carousel-inner .item").on("click tap", function(e) {
            if ($carouselInner.hasClass("infinite")) {
                var carouselChildren = $carouselInner.children()
                  , activeIndex = carouselChildren.index(e.currentTarget)
                  , $activeIndicator = $carouselPhotos.find(".carousel-indicators").children().removeClass("active").eq(activeIndex);
                carouselChildren.removeClass("active");
                carouselChildren.eq(activeIndex).addClass("active");
                $activeIndicator.addClass("active");
                $activeIndicator.click();
                $carouselPhotos.find(".carousel-indicators img.lazy").trigger("appear");
                toggleFullScreen(carouselElem)
            } else {
                $photosvideos.find(".carousel.slide").carousel("next")
            }
            setTimeout(function() {
                $carouselPhotos.toggleClass("showing-video", $(".media-thumbs .active img").is(".js-vid, .js-vt, .js-form"));
                $carouselPhotos.toggleClass("showing-form", $(".media-thumbs .active img").is(".js-form"))
            }, 100);
            if ($(e.target).parent(".photosvideos-gallery .gallery-form")) {
                return true
            }
            return false
        });
        $("body").keydown(function(e) {
            if (isInFullScreen()) {
                if (e.keyCode === 37) {
                    $carouselPhotos.carousel("prev")
                } else if (e.keyCode === 39) {
                    $carouselPhotos.carousel("next")
                }
            }
        });
        $("#schedule-btn").click(function(e) {
            if (isInFullScreen()) {
                $(".carousel.slide").carousel($(".carousel.slide .gallery-form").parent().index());
                $body.trigger("ga.gallery.cta.click")
            }
        });
        var $galleryForm = $('form[data-placement="GalleryForm"]');
        var $galleryCheckboxs = $galleryForm.find('#gallery-form-checkbox-group input[type="checkbox"]');
        var $gallerySubmitBtn = $galleryForm.find('button[type="submit"]');
        $gallerySubmitBtn.on("click", function() {
            var appendMsg = $galleryCheckboxs.map(function() {
                return $(this).is(":checked") ? $(this).data("text") : null
            }).get().join(", ");
            var msgText = $('form[data-placement="RightSide"]').find('input[name="message"]').val();
            var $msgInput = $(".photosvideos-gallery .gallery-form").find('input[name="message"]');
            if (appendMsg) {
                msgText = msgText + "\nPreferred Time: " + appendMsg
            }
            $msgInput.val(msgText)
        });
        var $indicatorTabs = $carouselPhotos.find(".carousel-indicator-tabs");
        $indicatorTabs.find(".carousel-control").on("click", function(event) {
            event.preventDefault();
            var $indicatorsContainer = $indicatorTabs.find(".carousel-indicators");
            var indicatorsContainerWidth = $indicatorsContainer.width();
            var scrollLength = $(this).hasClass("right") ? indicatorsContainerWidth : -indicatorsContainerWidth;
            $indicatorsContainer.stop().animate({
                scrollLeft: $indicatorsContainer.scrollLeft() + scrollLength
            }, "slow");
            handleSlideControlDisplay()
        });
        var $carouselIndicators = $carouselPhotos.find(".carousel-indicators");
        var onStopPropogate = function(event) {
            event.stopPropagation()
        };
        $carouselPhotos.find(".carousel-control").on("click", function(e) {
            if ($carouselInner.hasClass("infinite")) {
                var items = $("#carousel-photos").find(".carousel-inner").children(".item")
                  , index = Math.floor(items.length / 2);
                items.removeClass("active").eq(index).addClass("active")
            }
        });
        $carouselIndicators.on("touchstart", onStopPropogate).on("touchmove", onStopPropogate).on("touchend", onStopPropogate);
        var $leftControl = $carouselPhotos.find(".left.carousel-control")
          , $rightControl = $carouselPhotos.find(".right.carousel-control");
        $carouselInner.on("scroll", function() {
            if (this.scrollLeft > 0) {
                $leftControl.removeClass("disabled")
            } else {
                $leftControl.addClass("disabled")
            }
            if (this.scrollLeft < this.scrollWidth - $carouselPhotos.width()) {
                $rightControl.removeClass("disabled")
            } else {
                $rightControl.addClass("disabled")
            }
        })
    })
}
$(document).ready(function() {
    initializeCrousel()
});
$(document).ready(function() {
    $("#bank-lead-failure").hide();
    $("#bank-lead-success").hide();
    $("#submit-loan-application").attr("disabled", "disabled");
    $(".loan-rates").find("input[type=checkbox]").prop("checked", true);
    $(".bank-option:has(:checked)").addClass("selected");
    $(".bank-checkbox").change(function() {
        $(".bank-option:has(:checked)").addClass("selected");
        $(".bank-option:not(:has(:checked))").removeClass("selected")
    });
    var selectedBanksSize = $(".bank-checkbox:checked").size();
    if (selectedBanksSize && selectedBanksSize > 0) {
        $("#submit-loan-application").removeAttr("disabled")
    } else {
        $("#submit-loan-application").attr("disabled", "disabled")
    }
    $("#bank-lead-form").submit(function(e) {
        e.preventDefault();
        var userId = guruApp.user_id;
        var listingId = guruApp.listingDetail.gaECData.id;
        var selectedBanks = [];
        var allBanks = [];
        var $url = $(location).attr("protocol") + "//" + $(location).attr("host") + "/ajax/hlpaBankLead/";
        $("#bank-lead-form input:checked").each(function() {
            selectedBanks.push($(this).attr("name"))
        });
        $("#bank-lead-form input").each(function() {
            allBanks.push($(this).attr("name"))
        });
        $("body").trigger("ga.genericHlpaTracker", {
            category: "HomeLoanPreApproval-Conversion",
            action: "Submit",
            label: "location=Post-EnquiryThankYouModal",
            payload: {
                content: allBanks,
                selected: selectedBanks,
                type: "bank-options"
            }
        });
        var $postData = {
            enquirerName: $("#inputName").val(),
            enquirerEmail: $("#inputEmail").val(),
            enquirerPhone: $("#inputMobile").val(),
            listingId: listingId,
            bankIdentifiers: selectedBanks
        };
        $.ajax({
            type: "POST",
            url: $url,
            headers: {
                "Content-Type": "application/json"
            },
            data: JSON.stringify($postData),
            success: function() {
                $("#bank-lead-success #bl-success-title")[0].innerText = "Your loan application has been submitted";
                $("#bank-lead-success #bl-success-subtitle")[0].innerText = "The bank(s) will contact you within 1 working day";
                $("#bank-lead-form").hide();
                $("#bank-lead-success").show()
            },
            error: function(xhr, status, error) {
                $("#bank-lead-failure")[0].innerText = "Something went wrong, please try again later.";
                $("#bank-lead-failure").show()
            }
        })
    })
});
(function($, guruApp) {
    "use strict";
    $("body.home").on("click", ".content-widget-home-container a", function(e) {
        $("body").trigger("ga.widgets.contentWidget", {
            location: "Homepage",
            position: "main",
            item_id: $(this).data("item-id"),
            item_type: $(this).data("item-type").toLowerCase()
        })
    });
    $("body.listing").on("click", ".content-widget-side-container a, .content-widget-bottom-container a", function(e) {
        var listingType = guruApp.SearchDataLayer.listingType;
        $("body").trigger("ga.widgets.contentWidget", {
            location: listingType.substr(0, 1).toUpperCase() + listingType.substr(1) + " search results page",
            position: $(this).parents(".content-widget-side-container").length ? "sidebar" : "bottom",
            item_id: $(this).data("item-id"),
            item_type: $(this).data("item-type").toLowerCase()
        })
    })
}
)(jQuery, guruApp);
$(document).ready(function() {
    if (guruApp.marketing && guruApp.marketing.yahooPixel && guruApp.marketing.yahooPixel.id) {
        (function(w, d, t, r, u) {
            w[u] = w[u] || [];
            w[u].push({
                projectId: "10000",
                properties: {
                    pixelId: guruApp.marketing.yahooPixel.id
                }
            });
            var s = d.createElement(t);
            s.src = r;
            s.async = true;
            s.onload = s.onreadystatechange = function() {
                var y, rs = this.readyState, c = w[u];
                if (rs && rs != "complete" && rs != "loaded") {
                    return
                }
                try {
                    y = YAHOO.ywa.I13N.fireBeacon;
                    w[u] = [];
                    w[u].push = function(p) {
                        y([p])
                    }
                    ;
                    y(c)
                } catch (e) {}
            }
            ;
            var scr = d.getElementsByTagName(t)[0]
              , par = scr.parentNode;
            par.insertBefore(s, scr)
        }
        )(window, document, "script", "https://s.yimg.com/wi/ytc.js", "dotq");
        const FREETEXT = "freetext";
        const NULL_STRING = "null";
        const SEARCH = "Search";
        const DETAIL = "ListingDetail";
        const yahooPixelUrl = "https://sp.analytics.yahoo.com/spp.pl";
        const a = 1e4;
        const yahooPixelId = guruApp.marketing.yahooPixel.id;
        const et = "custom";
        const ea = "ViewProduct";
        const SMS = "SMS";
        const EMAIL = "Email";
        const WHATSAPP = "Whatsapp";
        const PHONECALL = "Phonecall";
        const VIEWPHONE = "Viewphone";
        const eventsArray = [SMS, EMAIL, WHATSAPP, PHONECALL, VIEWPHONE];
        var pageViewType = guruApp.listingSearch ? SEARCH : guruApp.listingDetail ? DETAIL : "";
        var pixelTag = getImageTag(pageViewType);
        var $pageContent = $("body");
        function getImageTag(type) {
            switch (type) {
            case SEARCH:
                fireSearchYahooPixel();
                break;
            case DETAIL:
                fireDetailYahooPixel();
                break;
            default:
                break
            }
        }
        $pageContent.find("form.js-contact-form").on("submit", function(e) {
            console.log("EMAIL");
            fireEventYahooPixel(EMAIL)
        });
        $pageContent.find(".btn-tools .phone-call-action-tracking, .js-agent-phone-number-call").not(".reveal-phone-number").on("click", function(e) {
            fireEventYahooPixel(PHONECALL)
        });
        $pageContent.on("click", ".js-agent-phone-number-sms", function(e) {
            fireEventYahooPixel(SMS)
        });
        $pageContent.find(".btn-tools .whatsapp-button, .btn-whatsapp, .js-agent-phone-number-whatsapp").on("click", function(e) {
            fireEventYahooPixel(WHATSAPP)
        });
        $pageContent.find(".btn-tools .reveal-phone-number, .agent-phone .js-agent-phone-number, .listing-values .js-agent-phone-number, .developer-phone-number, .developer-show-number").on("click", function(e) {
            fireEventYahooPixel(VIEWPHONE)
        });
        function fireSearchYahooPixel() {
            var i_Lo = getLocation();
            var i_Type = guruApp.marketing.yahooPixel.propertyType;
            var i_Price = formatPrice();
            window.dotq = window.dotq || [];
            window.dotq.push({
                projectId: "10000",
                properties: {
                    pixelId: yahooPixelId,
                    qstrings: {
                        et: "custom",
                        ec: i_Lo,
                        el: i_Type,
                        ev: i_Price
                    }
                }
            })
        }
        function fireDetailYahooPixel() {
            var i_PropertyId = guruApp.marketing.yahooPixel.listingId;
            window.dotq = window.dotq || [];
            window.dotq.push({
                projectId: "10000",
                properties: {
                    pixelId: yahooPixelId,
                    qstrings: {
                        et: "custom",
                        ec: NULL_STRING,
                        el: NULL_STRING,
                        ev: NULL_STRING,
                        ea: "ViewProduct",
                        product_id: i_PropertyId
                    }
                }
            })
        }
        function fireEventYahooPixel($event) {
            if (eventsArray.includes($event) && guruApp.marketing.yahooPixel.listingId) {
                var i_PropertyId = guruApp.marketing.yahooPixel.listingId;
                window.dotq = window.dotq || [];
                window.dotq.push({
                    projectId: "10000",
                    properties: {
                        pixelId: yahooPixelId,
                        qstrings: {
                            et: "custom",
                            ec: NULL_STRING,
                            el: NULL_STRING,
                            ev: NULL_STRING,
                            ea: $event,
                            product_id: i_PropertyId
                        }
                    }
                })
            }
        }
        function formatPrice() {
            return "S:" + guruApp.marketing.yahooPixel.minPrice + "|M:" + guruApp.marketing.yahooPixel.maxPrice
        }
        function getURLSearchParams(name) {
            var results = new RegExp("[?&]" + name + "=([^&#]*)").exec(window.location.search);
            return !results || !results.length ? null : decodeURI(results[1])
        }
        function getLocation() {
            return getURLSearchParams(FREETEXT) || NULL_STRING
        }
    }
});
if (guruApp && guruApp.marketing && guruApp.marketing.segment && guruApp.marketing.segment.isEnabled) {
    const listingSearchEventdataModel = {
        SearchId: undefined,
        Page: undefined,
        Intent: undefined,
        HdbEstate: undefined,
        Type: undefined,
        MinPrice: undefined,
        MaxPrice: undefined,
        Bed: undefined,
        Bath: undefined,
        MinConstructed: undefined,
        MaxConstructed: undefined,
        MinPSF: undefined,
        MaxPSF: undefined,
        MinFloor: undefined,
        MaxFloor: undefined,
        MinLand: undefined,
        MaxLand: undefined,
        LeaseTerm: undefined,
        FloorLevel: undefined,
        MrtBtsStation: undefined,
        DistanceRange: undefined,
        Furnishing: undefined,
        Tenure: undefined,
        ResultCount: undefined,
        FreeText: undefined,
        NewProject: undefined,
        Region: undefined,
        District: undefined,
        Area: undefined,
        ListedOn: undefined,
        Certificate: undefined,
        Intent: undefined,
        PropertyType: undefined
    };
    const listingMetadataModel = {
        ListingId: undefined,
        Type: undefined,
        Bedroom: undefined,
        Bathroom: undefined,
        Region: undefined,
        District: undefined,
        Area: undefined,
        Price: undefined,
        FloorArea: undefined,
        PropertyType: undefined,
        IsNewProject: undefined,
        Project: undefined
    };
    const leadEventdataModel = {
        Type: undefined
    };
    const shortlistEventdataModel = {
        Location: undefined
    };
    const galleryEventdataModel = {
        Action: undefined
    };
    const readMoreEventdataModel = {
        Link: undefined,
        More: undefined
    };
    var getListingSearchMetadataModel = function() {
        return listingSearchMetadataModel
    };
    var getListingSearchEventdataModel = function() {
        return listingSearchEventdataModel
    };
    var getLeadEventdataModel = function() {
        return leadEventdataModel
    };
    var getShortlistEventdataModel = function() {
        return shortlistEventdataModel
    };
    var getGalleryEventdataModel = function() {
        return galleryEventdataModel
    };
    var getReadMoreEventdataModel = function() {
        return readMoreEventdataModel
    }
}
if (guruApp && guruApp.marketing && guruApp.marketing.segment && guruApp.marketing.segment.isEnabled) {
    const segmentGACommonEvents = {
        GalleryOpen: {
            metaData: "getListingMetaData",
            eventData: "getGalleryEventData"
        },
        GalleryClose: {
            metaData: "getListingMetaData",
            eventData: "getGalleryEventData"
        },
        Search: {
            eventData: "getSearchEventdata"
        },
        Lead: {
            metaData: "getListingMetaData",
            eventData: "getLeadEventData"
        },
        ReadMore: {
            metaData: "getListingMetaData",
            eventData: "getReadMoreEventData"
        },
        Scrolled: {
            name: "Scroll Similar Listing",
            eventData: "getScrolledEventData"
        },
        "View Similar Agent Listing": {
            name: "ViewSimilarListing",
            eventData: "getViewedSimilarListingsEventData"
        }
    };
    const segmentEvents = {
        Shortlist: {
            metaData: "getListingMetaData",
            eventData: "getShortlistEventData"
        },
        UnShortlist: {
            metaData: "getUnShortlistMetaData",
            eventData: "getShortlistEventData"
        },
        ListingDetailPage: {
            metaData: "getListingMetaData",
            eventData: "getLDPEventData"
        }
    };
    var trackSegmentGACommonEvent = function(pageName, eventName, label, value, noninteraction, dimensions) {
        if (isSegmentGACommonTrackEvent(eventName)) {
            parameters = constructEventParameters(eventName, {
                label: label,
                value: value,
                noninteraction: noninteraction,
                dimensions: dimensions
            }, segmentGACommonEvents);
            eventName = segmentGACommonEvents[eventName]["name"] ? segmentGACommonEvents[eventName]["name"] : eventName;
            segmentTrack(pageName, eventName, parameters)
        }
    };
    var trackSegmentEvent = function(pageName, eventName, optionalPayload) {
        if (isSegmentTrackEvent(eventName)) {
            parameters = constructEventParameters(eventName, optionalPayload, segmentEvents);
            segmentTrack(pageName, eventName, parameters)
        }
    };
    var isSegmentGACommonTrackEvent = function(eventName) {
        return Object.keys(segmentGACommonEvents).includes(eventName)
    };
    var isSegmentTrackEvent = function(eventName) {
        return Object.keys(segmentEvents).includes(eventName)
    };
    var executeFunction = function(functionName, optionalPayload) {
        var functionCall = window[functionName];
        var data = {};
        if (functionCall && typeof functionCall === "function") {
            data = functionCall(optionalPayload)
        }
        return data
    };
    var constructEventParameters = function(eventName, optionalPayload, configMap) {
        return convertToDotNotation({
            eventData: configMap[eventName]["eventData"] ? executeFunction(configMap[eventName]["eventData"], optionalPayload) : {},
            metaData: configMap[eventName]["metaData"] ? executeFunction(configMap[eventName]["metaData"], optionalPayload) : {}
        })
    };
    var getListingMetaData = function(payLoad) {
        if (guruApp.listingDetail && guruApp.marketing && guruApp.marketing.segment) {
            return Object.assign({}, getListingMetadataModel(), {
                ListingId: typecastNumbers(guruApp.marketing.segment.ListingId),
                Type: guruApp.marketing.segment.ListingType,
                Bedroom: typecastNumbers(guruApp.marketing.segment.Beds),
                Bathroom: typecastNumbers(guruApp.marketing.segment.Baths),
                Region: guruApp.marketing.segment.LocalityRegion,
                District: guruApp.marketing.segment.LocalityDistrict,
                Area: typecastNumbers(guruApp.marketing.segment.LocalityArea),
                Price: typecastNumbers(guruApp.marketing.segment.Price),
                FloorArea: typecastNumbers(guruApp.marketing.segment.FloorArea),
                PropertyType: guruApp.marketing.segment.PropertyType,
                IsNewProject: guruApp.marketing.segment.IsNewProject,
                Project: typecastNumbers(guruApp.marketing.segment.LocalityProject)
            })
        }
        if (guruApp.listingSearch) {
            var listingId = "";
            var listingDetails = {};
            if (payLoad.dimensions) {
                payLoad.dimensions.forEach(function(dimension) {
                    if (dimension.name === "dimension7") {
                        listingId = dimension.value
                    }
                })
            }
            if (payLoad.listingId) {
                listingId = payLoad.listingId
            }
            if (listingId) {
                guruApp.listingResultsWidget.gaECListings.forEach(function(listing) {
                    if (listing.productData.id.toString() === listingId) {
                        listingDetails = listing.productData
                    }
                });
                return Object.assign({}, getListingMetadataModel(), {
                    ListingId: typecastNumbers(listingId),
                    Type: typecastNumbers(listingDetails.variant),
                    Bedroom: typecastNumbers($(".listing-id-" + listingId + " .bed")[0].innerText.trim()),
                    Bathroom: typecastNumbers($(".listing-id-" + listingId + " .bath")[0].innerText.trim()),
                    Area: typecastNumbers($(".listing-id-" + listingId + " .listing-location")[0].innerText.trim()),
                    Price: typecastNumbers(listingDetails.price),
                    FloorArea: typecastNumbers($(".listing-id-" + listingId + " .listing-floorarea")[0].innerText.trim()),
                    PropertyType: typecastNumbers(listingDetails.category)
                })
            }
        }
        return getListingMetadataModel()
    };
    var getLeadEventData = function(payLoad) {
        if (payLoad && payLoad.label) {
            return Object.assign({}, getLeadEventdataModel(), {
                Type: payLoad.label && payLoad.label.startsWith("Type=") ? payLoad.label.split("Type=")[1] : ""
            })
        }
        return getLeadEventdataModel()
    };
    var getShortlistEventData = function(payLoad) {
        if (payLoad && payLoad.location) {
            return Object.assign({}, getShortlistEventdataModel(), {
                Location: payLoad.location
            })
        }
        return getShortlistEventdataModel()
    };
    var getUnShortlistMetaData = function(payLoad) {
        if (payLoad && payLoad.location) {
            return Object.assign({}, getListingMetadataModel(), {
                ListingId: typecastNumbers(payLoad.listingId)
            })
        }
        return getListingMetadataModel()
    };
    var getGalleryEventData = function(payLoad) {
        if (payLoad && payLoad.label) {
            return Object.assign({}, getGalleryEventdataModel(), {
                Action: payLoad.label && payLoad.label.startsWith("Action=") ? payLoad.label.split("Action=")[1] : ""
            })
        }
        return getGalleryEventdataModel()
    };
    var getReadMoreEventData = function(payLoad) {
        if (payLoad && payLoad.label) {
            return Object.assign({}, getReadMoreEventdataModel(), {
                Link: payLoad.label && payLoad.label.startsWith("Link=") ? payLoad.label.split("Link=")[1] : "",
                More: payLoad.label && payLoad.label.startsWith("More=") ? payLoad.label.split("More=")[1] : ""
            })
        }
        return getReadMoreEventdataModel()
    };
    var getScrolledEventData = function(payLoad) {
        return Object.assign({}, {
            Label: payLoad.label ? payLoad.label : ""
        })
    };
    var getViewedSimilarListingsEventData = function(payLoad) {
        return Object.assign({}, {
            ListingPosition: payLoad.label ? payLoad.label : ""
        })
    };
    var getLDPEventData = function(payLoad) {
        return {
            Action: "PageViewed"
        }
    };
    var getSearchEventdata = function(payLoad) {
        if (guruApp && guruApp.listingSearch) {
            if (isValidJson(payLoad.label)) {
                $payloadLabel = JSON.parse(payLoad.label);
                return typecastAllFields(Object.assign({}, getListingSearchEventdataModel(), $payloadLabel, {
                    Intent: $payloadLabel.Intent,
                    PropertyType: $payloadLabel.Type
                }))
            }
        }
        return getListingSearchMetadataModel()
    };
    var isValidJson = function(input) {
        try {
            JSON.parse(input)
        } catch (error) {
            return false
        }
        return true
    };
    var getQueryParamsAsKeyValue = function() {
        var match, pl = /\+/g, search = /([^&=]+)=?([^&]*)/g, decode = function(s) {
            return decodeURIComponent(s.replace(pl, " "))
        }, query = window.location.search.substring(1);
        urlParams = {};
        while (match = search.exec(query)) {
            if (urlParams[decode(match[1])]) {
                urlParams[decode(match[1])] = urlParams[decode(match[1])] + "," + decode(match[2])
            } else {
                urlParams[decode(match[1])] = decode(match[2])
            }
        }
        return urlParams
    };
    var getPageName = function() {
        if (guruApp.widgetGoogleAnalytics.dimensions.dimension2) {
            return guruApp.widgetGoogleAnalytics.dimensions.dimension2
        }
        if (new RegExp("^agentnet","i").test(location.hostname)) {
            return "Agent-HomePage"
        }
        if (location.pathname === "/") {
            return "HomePage"
        }
        if (new RegExp("^/listing","i").test(location.pathname)) {
            return "ListingDetail"
        }
        if (new RegExp("^/property-for-","i").test(location.pathname)) {
            return "ListingSearch"
        }
        return location.pathname
    };
    var convertToDotNotation = function(obj, current, dotNotationObject) {
        dotNotationObject = dotNotationObject ? dotNotationObject : {};
        for (var key in obj) {
            var value = obj[key];
            var newKey = current ? current + "." + key : key;
            if (Array.isArray(value)) {
                dotNotationObject[newKey] = JSON.stringify(value)
            } else if (value && typeof value === "object") {
                convertToDotNotation(value, newKey, dotNotationObject)
            } else {
                dotNotationObject[newKey] = value
            }
        }
        return dotNotationObject
    };
    var typecastAllFields = function($object) {
        $typecastedObj = {};
        Object.keys($object).forEach(function($key) {
            $typecastedObj[$key] = typecastNumbers($object[$key])
        });
        return $typecastedObj
    };
    var typecastNumbers = function($val) {
        if (!isNaN($val) && typeof $val === "string") {
            return parseInt($val)
        }
        return $val
    }
}
if (guruApp && guruApp.marketing && guruApp.marketing.segment && guruApp.marketing.segment.isEnabled) {
    var $body = $("body");
    EventDispatcher.addListener("shortlisted.add", function($element) {
        var payload = {};
        var location = guruApp.widgetGoogleAnalytics.dimensions.dimension2 == "Listing Detail" ? "RightSideBar" : "ListingSearch";
        if ($element.closest("#navbar-main").length) {
            location = "Header"
        }
        if ($element.hasClass("gallery-form__thankyou__btn-shortlist")) {
            location = "GalleryForm"
        }
        if ($element.hasClass("shortlist-tooltip-in-info-btn")) {
            location = "In-Page"
        }
        if (guruApp.listingSearch) {
            payload = {
                listingId: $element.context.dataset.listingId,
                location: location
            }
        } else {
            payload = {
                location: location
            }
        }
        trackSegmentEvent(getPageName(), "Shortlist", payload)
    });
    var canceledShortlistFromHeader = [];
    EventDispatcher.addListener("shortlisted.del", function($element) {
        var payload = {};
        var listingId = parseInt($element.data("listing-id"), 10);
        if (listingId) {
            var location = "Header";
            index = canceledShortlistFromHeader.indexOf(listingId);
            if (index == -1 && guruApp.listingDetail && $element.length && !$element.closest("#navbar-main").length) {
                location = "RightSideBar"
            }
            if ($element.hasClass("gallery-form__thankyou__btn-shortlist")) {
                location = "GalleryForm"
            }
            if ($element.hasClass("shortlist-tooltip-in-info-btn")) {
                location = "In-Page"
            }
            if (index === -1 && guruApp.listingSearch) {
                location = "ListingSearch"
            }
            payload = {
                listingId: listingId,
                location: location
            }
        }
        trackSegmentEvent(getPageName(), "UnShortlist", payload)
    });
    $body.on("ga.listingResult.multiEnquire.cancel.clicked", function(e, listingId) {
        canceledShortlistFromHeader.push(parseInt(listingId, 10))
    });
    $(document).ready(function() {
        $pageTrackerConf = {
            "Listing Detail": "ListingDetailPage"
        };
        if (typeof analytics !== "undefined") {
            $page = getPageName();
            if (Object.keys($pageTrackerConf).indexOf($page) !== -1) {
                trackSegmentEvent($page, $pageTrackerConf[$page])
            }
        }
    })
}
(function($, EventDispatcher) {
    "use strict";
    $(document).ready(function() {
        $("#remove-shortlist-card").hide();
        $(".cancel-shortlist-btn").hide();
        $("#select-all-shortlist-card").hide();
        $(".checkbox-card").hide();
        $("#remove-shortlist-card").removeClass("hide");
        $(".cancel-shortlist-btn").removeClass("hide");
        $("#select-all-shortlist-card").removeClass("hide");
        $(".checkbox-card").removeClass("hide");
        $("#select-shortlist-card").on("click", function() {
            $("#select-shortlist-card").hide();
            $("#remove-shortlist-card").show();
            $(".cancel-shortlist-btn").show();
            $("#select-all-shortlist-card").show();
            $(".heart-box").hide();
            $(".checkbox-card").show();
            $(".sort-group-btn").hide()
        });
        $(".shortlist-heart-button").on("click", function() {
            var listingCard = $(this).closest(".shortlist-box");
            var listingId = $(this).attr("value");
            var checkedListings = {};
            var removedListingNameText = "";
            checkedListings[listingId] = listingCard;
            listingCard.hide();
            removedListingNameText = $(this).attr("name");
            deleteShortlists(checkedListings, removedListingNameText, 1)
        });
        var $checkboxes = $('#checkbox-card input[type="checkbox"]');
        $checkboxes.change(function() {
            var countCheckedCheckboxes = $checkboxes.filter(":checked").length;
            if (countCheckedCheckboxes > 0) {
                $("#remove-shortlist-card").attr("disabled", false);
                $("#checked-listings-count").text(countCheckedCheckboxes)
            } else {
                $("#remove-shortlist-card").attr("disabled", true);
                $("#checked-listings-count").text("")
            }
            $(this).closest("#shortlist-card").find("#image-shortlist .image-shortlist-card").toggleClass("selected-overlay", $(this).is(":checked"));
            $(this).closest("#checkbox-card").toggleClass("selected-option-b", $(this).is(":checked"));
            $(this).closest("#shortlist-card").toggleClass("selected-shortlist-card", $(this).is(":checked"))
        });
        $("#remove-shortlist-card").on("click", function() {
            $("#remove-shortlist-card").attr("disabled", true);
            var $checkboxes = $('#checkbox-card input[type="checkbox"]');
            var $checkedCheckboxes = $checkboxes.filter(":checked");
            var checkedListings = {};
            var removedListingNameText = "";
            var listingsCount = 0;
            $checkedCheckboxes.each(function() {
                var listingCard = $(this).closest(".shortlist-box");
                var listingId = $(this).attr("value");
                checkedListings[listingId] = listingCard;
                listingCard.hide();
                if (listingsCount == 0) {
                    removedListingNameText = $(this).attr("name")
                }
                listingsCount++
            });
            $checkboxes.removeAttr("checked");
            $("#checked-listings-count").empty();
            $checkboxes.closest("#shortlist-card").toggleClass("selected-shortlist-card", $(this).is(":checked"));
            deleteShortlists(checkedListings, removedListingNameText, listingsCount)
        });
        $("#select-all-shortlist-card").click(function() {
            var $checkboxes = $('#checkbox-card input[type="checkbox"]');
            $checkboxes.each(function(index, value) {
                $(this).closest("#shortlist-card").find("#image-shortlist .image-shortlist-card").addClass("selected-overlay", value);
                $checkboxes.attr("checked", "checked");
                $checkboxes.prop("checked", "checked");
                $(this).closest("#checkbox-card").addClass("selected-option-b", value);
                $(this).closest("#shortlist-card").addClass("selected-shortlist-card", value)
            });
            var countCheckedCheckboxes = $checkboxes.filter(":checked").length;
            $("#remove-shortlist-card").attr("disabled", false);
            $("#checked-listings-count").text(countCheckedCheckboxes)
        });
        $(".cancel-shortlist-btn").click(function() {
            $checkboxes.each(function(index, value) {
                $(this).closest("#shortlist-card").find("#image-shortlist .image-shortlist-card").removeClass("selected-overlay", value);
                $checkboxes.removeAttr("checked");
                $(this).closest("#checkbox-card").removeClass("selected-option-b", value);
                $(this).closest("#shortlist-card").removeClass("selected-shortlist-card", value)
            });
            var countCheckedCheckboxes = $checkboxes.filter(":checked").length;
            $("#checked-listings-count").empty();
            $("#select-shortlist-card").show();
            $("#remove-shortlist-card").hide();
            $(".checked-value").text("");
            $(".cancel-shortlist-btn").hide();
            $("#select-all-shortlist-card").hide();
            $(".heart-box").show();
            $(".checkbox-card").hide();
            $(".sort-group-btn").show()
        })
    });
    var deleteShortlists = function(checkedListings, removedListingNameText, listingsCount) {
        var listingId;
        var listingIds = [];
        for (listingId in checkedListings) {
            listingIds.push(listingId);
            guruApp.shortlistItemStorage.removeItem(parseInt(listingId, 10))
        }
        var data = {};
        data["listingIds"] = listingIds;
        AjaxQueue.queue("delete", "/shortlists/delete", data, function(R, status, jqXHR) {
            if ($.isPlainObject(R) && R.success) {
                EventDispatcher.dispatch("shortlisted.del", $({}))
            }
        });
        var $toast = $("#snackbar-removed");
        $toast.addClass("show");
        $toast.find(".property-title").html(removedListingNameText);
        $toast.find(".property-count").html(listingsCount - 1);
        if (listingsCount > 1) {
            $toast.find(".property-others").show()
        } else {
            $toast.find(".property-others").hide()
        }
        $toast.find("#undo-removed-shortlists").on("click", function() {
            $toast.removeClass("show");
            var listing;
            var listingIds = [];
            for (listing in checkedListings) {
                checkedListings[listing].show();
                listingIds.push(listing);
                guruApp.shortlistItemStorage.set(parseInt(listingId, 10))
            }
            var data = {};
            data["listingIds"] = listingIds;
            AjaxQueue.queue("post", "/shortlists/add", data, function(R, status, jqXHR) {
                if ($.isPlainObject(R) && R.success) {
                    EventDispatcher.dispatch("shortlisted.add", $({}))
                }
            })
        });
        setTimeout(function() {
            if ($toast.hasClass("show")) {
                $toast.removeClass("show");
                var listing;
                for (listing in checkedListings) {
                    checkedListings[listing].remove()
                }
                AjaxQueue.queue("", "", "", function() {
                    location.reload()
                })
            }
        }, 3e3)
    };
    var AjaxQueue = {
        isQueueBeingProcessed: false,
        requestsQueue: [],
        queue: function(type, url, data, onSuccess) {
            this.requestsQueue.push({
                type: type,
                url: url,
                data: data,
                onSuccess: onSuccess
            });
            this.process()
        },
        process: function() {
            if (this.isQueueBeingProcessed) {
                return
            }
            this.isQueueBeingProcessed = true;
            this.next()
        },
        next: function() {
            var next = this.requestsQueue.shift();
            if (next !== undefined) {
                this.invoke(next)
            } else {
                this.isQueueBeingProcessed = false
            }
        },
        invoke: function(request) {
            if (request.type == "" && request.url == "") {
                request.onSuccess();
                AjaxQueue.next()
            } else {
                $.ajax({
                    url: request.url,
                    type: request.type,
                    data: request.data,
                    success: function(R, status, jqXHR) {
                        request.onSuccess(R, status, jqXHR);
                        AjaxQueue.next()
                    }
                })
            }
        }
    }
}
)(jQuery, EventDispatcher);
function mapTracking($searchForm) {
    $(".btn.btn-primary.btn-submit", $searchForm).on("click.ga", function() {
        $searchForm.trigger("ga.search.form.submit.main")
    });
    $(".dropdown-menu a", $searchForm).click(function() {
        var newValue = $(this).text()
          , btn = $(this).closest(".btn-group")
          , name = btn.find("input[type='hidden']").attr("name")
          , oldValue = btn.find(".btn-title").text();
        if (oldValue !== newValue) {
            $searchForm.trigger("ga.search.form.submit.parameter", [name, newValue])
        }
    })
}
function updateOverseasFormDropDown(value, target, listType, resetType) {
    if (guruApp.widgetSearch.propertyTypeCountry[listType] !== undefined) {
        var list = guruApp.widgetSearch.propertyTypeCountry[listType];
        if (list[value] !== undefined) {
            if ($("input[type='hidden']", target).val() == "") {
                $("button span", target).text($("button", target).attr("data-title"));
                $("li:gt(1)", target).hide();
                for (var key in list[value]) {
                    $("li a[href='#" + key + "']", target).closest("li").show()
                }
            }
        } else {
            resetOverseasFormDropDown(target, resetType)
        }
    }
}
function resetOverseasFormDropDown(target, listType, targetLimit, limitType) {
    var value = $("input[type='hidden']", target).val();
    if (guruApp.widgetSearch.propertyTypeCountry[listType] !== undefined) {
        var list = guruApp.widgetSearch.propertyTypeCountry[listType];
        $("li:gt(1)", target).removeClass("active").hide();
        if (value != "") {
            $("li a[href='#" + value + "']", target).closest("li").addClass("active")
        }
        for (var value in list) {
            $("li a[href='#" + value + "']", target).closest("li").show()
        }
    }
    if (targetLimit !== undefined) {
        var limit = $("input[type='hidden']", targetLimit).val();
        if (guruApp.widgetSearch.propertyTypeCountry[limitType] !== undefined && limit != "") {
            var limitList = guruApp.widgetSearch.propertyTypeCountry[limitType];
            if (limitList[limit] !== undefined) {
                $("li:gt(1)", target).hide();
                for (var key in limitList[limit]) {
                    $("li a[href='#" + key + "']", target).closest("li").show()
                }
            }
        }
    }
}
$(document).ready(function() {
    "use strict";
    var $searchForm = $(".overseas-search");
    if ($searchForm.length > 0) {
        mapTracking($searchForm);
        resetOverseasFormDropDown($(".param-countryCode", $searchForm), "countries", $(".param-propertyType", $searchForm), "properties");
        resetOverseasFormDropDown($(".param-propertyType", $searchForm), "properties", $(".param-countryCode", $searchForm), "countries");
        $(".overseas-search .param-countryCode .dropdown-menu li a").click(function() {
            updateOverseasFormDropDown($(this).attr("href").replace("#", ""), $(".param-propertyType", $searchForm), "countries", "properties")
        });
        $(".overseas-search .param-propertyType .dropdown-menu li a").click(function() {
            updateOverseasFormDropDown($(this).attr("href").replace("#", ""), $(".param-countryCode", $searchForm), "properties", "countries")
        })
    }
});
(function($) {
    "use strict";
    var version = "2.1.6";
    $.fn.cycle = function(options) {
        var o;
        if (this.length === 0 && !$.isReady) {
            o = {
                s: this.selector,
                c: this.context
            };
            $.fn.cycle.log("requeuing slideshow (dom not ready)");
            $(function() {
                $(o.s, o.c).cycle(options)
            });
            return this
        }
        return this.each(function() {
            var data, opts, shortName, val;
            var container = $(this);
            var log = $.fn.cycle.log;
            if (container.data("cycle.opts"))
                return;
            if (container.data("cycle-log") === false || options && options.log === false || opts && opts.log === false) {
                log = $.noop
            }
            log("--c2 init--");
            data = container.data();
            for (var p in data) {
                if (data.hasOwnProperty(p) && /^cycle[A-Z]+/.test(p)) {
                    val = data[p];
                    shortName = p.match(/^cycle(.*)/)[1].replace(/^[A-Z]/, lowerCase);
                    log(shortName + ":", val, "(" + typeof val + ")");
                    data[shortName] = val
                }
            }
            opts = $.extend({}, $.fn.cycle.defaults, data, options || {});
            opts.timeoutId = 0;
            opts.paused = opts.paused || false;
            opts.container = container;
            opts._maxZ = opts.maxZ;
            opts.API = $.extend({
                _container: container
            }, $.fn.cycle.API);
            opts.API.log = log;
            opts.API.trigger = function(eventName, args) {
                opts.container.trigger(eventName, args);
                return opts.API
            }
            ;
            container.data("cycle.opts", opts);
            container.data("cycle.API", opts.API);
            opts.API.trigger("cycle-bootstrap", [opts, opts.API]);
            opts.API.addInitialSlides();
            opts.API.preInitSlideshow();
            if (opts.slides.length)
                opts.API.initSlideshow()
        })
    }
    ;
    $.fn.cycle.API = {
        opts: function() {
            return this._container.data("cycle.opts")
        },
        addInitialSlides: function() {
            var opts = this.opts();
            var slides = opts.slides;
            opts.slideCount = 0;
            opts.slides = $();
            slides = slides.jquery ? slides : opts.container.find(slides);
            if (opts.random) {
                slides.sort(function() {
                    return Math.random() - .5
                })
            }
            opts.API.add(slides)
        },
        preInitSlideshow: function() {
            var opts = this.opts();
            opts.API.trigger("cycle-pre-initialize", [opts]);
            var tx = $.fn.cycle.transitions[opts.fx];
            if (tx && $.isFunction(tx.preInit))
                tx.preInit(opts);
            opts._preInitialized = true
        },
        postInitSlideshow: function() {
            var opts = this.opts();
            opts.API.trigger("cycle-post-initialize", [opts]);
            var tx = $.fn.cycle.transitions[opts.fx];
            if (tx && $.isFunction(tx.postInit))
                tx.postInit(opts)
        },
        initSlideshow: function() {
            var opts = this.opts();
            var pauseObj = opts.container;
            var slideOpts;
            opts.API.calcFirstSlide();
            if (opts.container.css("position") == "static")
                opts.container.css("position", "relative");
            $(opts.slides[opts.currSlide]).css({
                opacity: 1,
                display: "block",
                visibility: "visible"
            });
            opts.API.stackSlides(opts.slides[opts.currSlide], opts.slides[opts.nextSlide], !opts.reverse);
            if (opts.pauseOnHover) {
                if (opts.pauseOnHover !== true)
                    pauseObj = $(opts.pauseOnHover);
                pauseObj.hover(function() {
                    opts.API.pause(true)
                }, function() {
                    opts.API.resume(true)
                })
            }
            if (opts.timeout) {
                slideOpts = opts.API.getSlideOpts(opts.currSlide);
                opts.API.queueTransition(slideOpts, slideOpts.timeout + opts.delay)
            }
            opts._initialized = true;
            opts.API.updateView(true);
            opts.API.trigger("cycle-initialized", [opts]);
            opts.API.postInitSlideshow()
        },
        pause: function(hover) {
            var opts = this.opts()
              , slideOpts = opts.API.getSlideOpts()
              , alreadyPaused = opts.hoverPaused || opts.paused;
            if (hover)
                opts.hoverPaused = true;
            else
                opts.paused = true;
            if (!alreadyPaused) {
                opts.container.addClass("cycle-paused");
                opts.API.trigger("cycle-paused", [opts]).log("cycle-paused");
                if (slideOpts.timeout) {
                    clearTimeout(opts.timeoutId);
                    opts.timeoutId = 0;
                    opts._remainingTimeout -= $.now() - opts._lastQueue;
                    if (opts._remainingTimeout < 0 || isNaN(opts._remainingTimeout))
                        opts._remainingTimeout = undefined
                }
            }
        },
        resume: function(hover) {
            var opts = this.opts(), alreadyResumed = !opts.hoverPaused && !opts.paused, remaining;
            if (hover)
                opts.hoverPaused = false;
            else
                opts.paused = false;
            if (!alreadyResumed) {
                opts.container.removeClass("cycle-paused");
                if (opts.slides.filter(":animated").length === 0)
                    opts.API.queueTransition(opts.API.getSlideOpts(), opts._remainingTimeout);
                opts.API.trigger("cycle-resumed", [opts, opts._remainingTimeout]).log("cycle-resumed")
            }
        },
        add: function(slides, prepend) {
            var opts = this.opts();
            var oldSlideCount = opts.slideCount;
            var startSlideshow = false;
            var len;
            if ($.type(slides) == "string")
                slides = $.trim(slides);
            $(slides).each(function(i) {
                var slideOpts;
                var slide = $(this);
                if (prepend)
                    opts.container.prepend(slide);
                else
                    opts.container.append(slide);
                opts.slideCount++;
                slideOpts = opts.API.buildSlideOpts(slide);
                if (prepend)
                    opts.slides = $(slide).add(opts.slides);
                else
                    opts.slides = opts.slides.add(slide);
                opts.API.initSlide(slideOpts, slide, --opts._maxZ);
                slide.data("cycle.opts", slideOpts);
                opts.API.trigger("cycle-slide-added", [opts, slideOpts, slide])
            });
            opts.API.updateView(true);
            startSlideshow = opts._preInitialized && (oldSlideCount < 2 && opts.slideCount >= 1);
            if (startSlideshow) {
                if (!opts._initialized)
                    opts.API.initSlideshow();
                else if (opts.timeout) {
                    len = opts.slides.length;
                    opts.nextSlide = opts.reverse ? len - 1 : 1;
                    if (!opts.timeoutId) {
                        opts.API.queueTransition(opts)
                    }
                }
            }
        },
        calcFirstSlide: function() {
            var opts = this.opts();
            var firstSlideIndex;
            firstSlideIndex = parseInt(opts.startingSlide || 0, 10);
            if (firstSlideIndex >= opts.slides.length || firstSlideIndex < 0)
                firstSlideIndex = 0;
            opts.currSlide = firstSlideIndex;
            if (opts.reverse) {
                opts.nextSlide = firstSlideIndex - 1;
                if (opts.nextSlide < 0)
                    opts.nextSlide = opts.slides.length - 1
            } else {
                opts.nextSlide = firstSlideIndex + 1;
                if (opts.nextSlide == opts.slides.length)
                    opts.nextSlide = 0
            }
        },
        calcNextSlide: function() {
            var opts = this.opts();
            var roll;
            if (opts.reverse) {
                roll = opts.nextSlide - 1 < 0;
                opts.nextSlide = roll ? opts.slideCount - 1 : opts.nextSlide - 1;
                opts.currSlide = roll ? 0 : opts.nextSlide + 1
            } else {
                roll = opts.nextSlide + 1 == opts.slides.length;
                opts.nextSlide = roll ? 0 : opts.nextSlide + 1;
                opts.currSlide = roll ? opts.slides.length - 1 : opts.nextSlide - 1
            }
        },
        calcTx: function(slideOpts, manual) {
            var opts = slideOpts;
            var tx;
            if (opts._tempFx)
                tx = $.fn.cycle.transitions[opts._tempFx];
            else if (manual && opts.manualFx)
                tx = $.fn.cycle.transitions[opts.manualFx];
            if (!tx)
                tx = $.fn.cycle.transitions[opts.fx];
            opts._tempFx = null;
            this.opts()._tempFx = null;
            if (!tx) {
                tx = $.fn.cycle.transitions.fade;
                opts.API.log('Transition "' + opts.fx + '" not found.  Using fade.')
            }
            return tx
        },
        prepareTx: function(manual, fwd) {
            var opts = this.opts();
            var after, curr, next, slideOpts, tx;
            if (opts.slideCount < 2) {
                opts.timeoutId = 0;
                return
            }
            if (manual && (!opts.busy || opts.manualTrump)) {
                opts.API.stopTransition();
                opts.busy = false;
                clearTimeout(opts.timeoutId);
                opts.timeoutId = 0
            }
            if (opts.busy)
                return;
            if (opts.timeoutId === 0 && !manual)
                return;
            curr = opts.slides[opts.currSlide];
            next = opts.slides[opts.nextSlide];
            slideOpts = opts.API.getSlideOpts(opts.nextSlide);
            tx = opts.API.calcTx(slideOpts, manual);
            opts._tx = tx;
            if (manual && slideOpts.manualSpeed !== undefined)
                slideOpts.speed = slideOpts.manualSpeed;
            if (opts.nextSlide != opts.currSlide && (manual || !opts.paused && !opts.hoverPaused && opts.timeout)) {
                opts.API.trigger("cycle-before", [slideOpts, curr, next, fwd]);
                if (tx.before)
                    tx.before(slideOpts, curr, next, fwd);
                after = function() {
                    opts.busy = false;
                    if (!opts.container.data("cycle.opts"))
                        return;
                    if (tx.after)
                        tx.after(slideOpts, curr, next, fwd);
                    opts.API.trigger("cycle-after", [slideOpts, curr, next, fwd]);
                    opts.API.queueTransition(slideOpts);
                    opts.API.updateView(true)
                }
                ;
                opts.busy = true;
                if (tx.transition)
                    tx.transition(slideOpts, curr, next, fwd, after);
                else
                    opts.API.doTransition(slideOpts, curr, next, fwd, after);
                opts.API.calcNextSlide();
                opts.API.updateView()
            } else {
                opts.API.queueTransition(slideOpts)
            }
        },
        doTransition: function(slideOpts, currEl, nextEl, fwd, callback) {
            var opts = slideOpts;
            var curr = $(currEl)
              , next = $(nextEl);
            var fn = function() {
                next.animate(opts.animIn || {
                    opacity: 1
                }, opts.speed, opts.easeIn || opts.easing, callback)
            };
            next.css(opts.cssBefore || {});
            curr.animate(opts.animOut || {}, opts.speed, opts.easeOut || opts.easing, function() {
                curr.css(opts.cssAfter || {});
                if (!opts.sync) {
                    fn()
                }
            });
            if (opts.sync) {
                fn()
            }
        },
        queueTransition: function(slideOpts, specificTimeout) {
            var opts = this.opts();
            var timeout = specificTimeout !== undefined ? specificTimeout : slideOpts.timeout;
            if (opts.nextSlide === 0 && --opts.loop === 0) {
                opts.API.log("terminating; loop=0");
                opts.timeout = 0;
                if (timeout) {
                    setTimeout(function() {
                        opts.API.trigger("cycle-finished", [opts])
                    }, timeout)
                } else {
                    opts.API.trigger("cycle-finished", [opts])
                }
                opts.nextSlide = opts.currSlide;
                return
            }
            if (opts.continueAuto !== undefined) {
                if (opts.continueAuto === false || $.isFunction(opts.continueAuto) && opts.continueAuto() === false) {
                    opts.API.log("terminating automatic transitions");
                    opts.timeout = 0;
                    if (opts.timeoutId)
                        clearTimeout(opts.timeoutId);
                    return
                }
            }
            if (timeout) {
                opts._lastQueue = $.now();
                if (specificTimeout === undefined)
                    opts._remainingTimeout = slideOpts.timeout;
                if (!opts.paused && !opts.hoverPaused) {
                    opts.timeoutId = setTimeout(function() {
                        opts.API.prepareTx(false, !opts.reverse)
                    }, timeout)
                }
            }
        },
        stopTransition: function() {
            var opts = this.opts();
            if (opts.slides.filter(":animated").length) {
                opts.slides.stop(false, true);
                opts.API.trigger("cycle-transition-stopped", [opts])
            }
            if (opts._tx && opts._tx.stopTransition)
                opts._tx.stopTransition(opts)
        },
        advanceSlide: function(val) {
            var opts = this.opts();
            clearTimeout(opts.timeoutId);
            opts.timeoutId = 0;
            opts.nextSlide = opts.currSlide + val;
            if (opts.nextSlide < 0)
                opts.nextSlide = opts.slides.length - 1;
            else if (opts.nextSlide >= opts.slides.length)
                opts.nextSlide = 0;
            opts.API.prepareTx(true, val >= 0);
            return false
        },
        buildSlideOpts: function(slide) {
            var opts = this.opts();
            var val, shortName;
            var slideOpts = slide.data() || {};
            for (var p in slideOpts) {
                if (slideOpts.hasOwnProperty(p) && /^cycle[A-Z]+/.test(p)) {
                    val = slideOpts[p];
                    shortName = p.match(/^cycle(.*)/)[1].replace(/^[A-Z]/, lowerCase);
                    opts.API.log("[" + (opts.slideCount - 1) + "]", shortName + ":", val, "(" + typeof val + ")");
                    slideOpts[shortName] = val
                }
            }
            slideOpts = $.extend({}, $.fn.cycle.defaults, opts, slideOpts);
            slideOpts.slideNum = opts.slideCount;
            try {
                delete slideOpts.API;
                delete slideOpts.slideCount;
                delete slideOpts.currSlide;
                delete slideOpts.nextSlide;
                delete slideOpts.slides
            } catch (e) {}
            return slideOpts
        },
        getSlideOpts: function(index) {
            var opts = this.opts();
            if (index === undefined)
                index = opts.currSlide;
            var slide = opts.slides[index];
            var slideOpts = $(slide).data("cycle.opts");
            return $.extend({}, opts, slideOpts)
        },
        initSlide: function(slideOpts, slide, suggestedZindex) {
            var opts = this.opts();
            slide.css(slideOpts.slideCss || {});
            if (suggestedZindex > 0)
                slide.css("zIndex", suggestedZindex);
            if (isNaN(slideOpts.speed))
                slideOpts.speed = $.fx.speeds[slideOpts.speed] || $.fx.speeds._default;
            if (!slideOpts.sync)
                slideOpts.speed = slideOpts.speed / 2;
            slide.addClass(opts.slideClass)
        },
        updateView: function(isAfter, isDuring, forceEvent) {
            var opts = this.opts();
            if (!opts._initialized)
                return;
            var slideOpts = opts.API.getSlideOpts();
            var currSlide = opts.slides[opts.currSlide];
            if (!isAfter && isDuring !== true) {
                opts.API.trigger("cycle-update-view-before", [opts, slideOpts, currSlide]);
                if (opts.updateView < 0)
                    return
            }
            if (opts.slideActiveClass) {
                opts.slides.removeClass(opts.slideActiveClass).eq(opts.currSlide).addClass(opts.slideActiveClass)
            }
            if (isAfter && opts.hideNonActive)
                opts.slides.filter(":not(." + opts.slideActiveClass + ")").css("visibility", "hidden");
            if (opts.updateView === 0) {
                setTimeout(function() {
                    opts.API.trigger("cycle-update-view", [opts, slideOpts, currSlide, isAfter])
                }, slideOpts.speed / (opts.sync ? 2 : 1))
            }
            if (opts.updateView !== 0)
                opts.API.trigger("cycle-update-view", [opts, slideOpts, currSlide, isAfter]);
            if (isAfter)
                opts.API.trigger("cycle-update-view-after", [opts, slideOpts, currSlide])
        },
        getComponent: function(name) {
            var opts = this.opts();
            var selector = opts[name];
            if (typeof selector === "string") {
                return /^\s*[\>|\+|~]/.test(selector) ? opts.container.find(selector) : $(selector)
            }
            if (selector.jquery)
                return selector;
            return $(selector)
        },
        stackSlides: function(curr, next, fwd) {
            var opts = this.opts();
            if (!curr) {
                curr = opts.slides[opts.currSlide];
                next = opts.slides[opts.nextSlide];
                fwd = !opts.reverse
            }
            $(curr).css("zIndex", opts.maxZ);
            var i;
            var z = opts.maxZ - 2;
            var len = opts.slideCount;
            if (fwd) {
                for (i = opts.currSlide + 1; i < len; i++)
                    $(opts.slides[i]).css("zIndex", z--);
                for (i = 0; i < opts.currSlide; i++)
                    $(opts.slides[i]).css("zIndex", z--)
            } else {
                for (i = opts.currSlide - 1; i >= 0; i--)
                    $(opts.slides[i]).css("zIndex", z--);
                for (i = len - 1; i > opts.currSlide; i--)
                    $(opts.slides[i]).css("zIndex", z--)
            }
            $(next).css("zIndex", opts.maxZ - 1)
        },
        getSlideIndex: function(el) {
            return this.opts().slides.index(el)
        }
    };
    $.fn.cycle.log = function log() {
        if (window.console && console.log)
            console.log("[cycle2] " + Array.prototype.join.call(arguments, " "))
    }
    ;
    $.fn.cycle.version = function() {
        return "Cycle2: " + version
    }
    ;
    function lowerCase(s) {
        return (s || "").toLowerCase()
    }
    $.fn.cycle.transitions = {
        custom: {},
        none: {
            before: function(opts, curr, next, fwd) {
                opts.API.stackSlides(next, curr, fwd);
                opts.cssBefore = {
                    opacity: 1,
                    visibility: "visible",
                    display: "block"
                }
            }
        },
        fade: {
            before: function(opts, curr, next, fwd) {
                var css = opts.API.getSlideOpts(opts.nextSlide).slideCss || {};
                opts.API.stackSlides(curr, next, fwd);
                opts.cssBefore = $.extend(css, {
                    opacity: 0,
                    visibility: "visible",
                    display: "block"
                });
                opts.animIn = {
                    opacity: 1
                };
                opts.animOut = {
                    opacity: 0
                }
            }
        },
        fadeout: {
            before: function(opts, curr, next, fwd) {
                var css = opts.API.getSlideOpts(opts.nextSlide).slideCss || {};
                opts.API.stackSlides(curr, next, fwd);
                opts.cssBefore = $.extend(css, {
                    opacity: 1,
                    visibility: "visible",
                    display: "block"
                });
                opts.animOut = {
                    opacity: 0
                }
            }
        },
        scrollHorz: {
            before: function(opts, curr, next, fwd) {
                opts.API.stackSlides(curr, next, fwd);
                var w = opts.container.css("overflow", "hidden").width();
                opts.cssBefore = {
                    left: fwd ? w : -w,
                    top: 0,
                    opacity: 1,
                    visibility: "visible",
                    display: "block"
                };
                opts.cssAfter = {
                    zIndex: opts._maxZ - 2,
                    left: 0
                };
                opts.animIn = {
                    left: 0
                };
                opts.animOut = {
                    left: fwd ? -w : w
                }
            }
        }
    };
    $.fn.cycle.defaults = {
        allowWrap: true,
        autoSelector: ".cycle-slideshow[data-cycle-auto-init!=false]",
        delay: 0,
        easing: null,
        fx: "fade",
        hideNonActive: true,
        loop: 0,
        manualFx: undefined,
        manualSpeed: undefined,
        manualTrump: true,
        maxZ: 100,
        pauseOnHover: false,
        reverse: false,
        slideActiveClass: "cycle-slide-active",
        slideClass: "cycle-slide",
        slideCss: {
            position: "absolute",
            top: 0,
            left: 0
        },
        slides: "> img",
        speed: 500,
        startingSlide: 0,
        sync: true,
        timeout: 4e3,
        updateView: 0
    };
    $(document).ready(function() {
        $($.fn.cycle.defaults.autoSelector).cycle()
    })
}
)(jQuery);
(function($) {
    "use strict";
    $.extend($.fn.cycle.defaults, {
        autoHeight: 0,
        autoHeightSpeed: 250,
        autoHeightEasing: null
    });
    $(document).on("cycle-initialized", function(e, opts) {
        var autoHeight = opts.autoHeight;
        var t = $.type(autoHeight);
        var resizeThrottle = null;
        var ratio;
        if (t !== "string" && t !== "number")
            return;
        opts.container.on("cycle-slide-added cycle-slide-removed", initAutoHeight);
        opts.container.on("cycle-destroyed", onDestroy);
        if (autoHeight == "container") {
            opts.container.on("cycle-before", onBefore)
        } else if (t === "string" && /\d+\:\d+/.test(autoHeight)) {
            ratio = autoHeight.match(/(\d+)\:(\d+)/);
            ratio = ratio[1] / ratio[2];
            opts._autoHeightRatio = ratio
        }
        if (t !== "number") {
            opts._autoHeightOnResize = function() {
                clearTimeout(resizeThrottle);
                resizeThrottle = setTimeout(onResize, 50)
            }
            ;
            $(window).on("resize orientationchange", opts._autoHeightOnResize)
        }
        setTimeout(onResize, 30);
        function onResize() {
            initAutoHeight(e, opts)
        }
    });
    function initAutoHeight(e, opts) {
        var clone, height, sentinelIndex;
        var autoHeight = opts.autoHeight;
        if (autoHeight == "container") {
            height = $(opts.slides[opts.currSlide]).outerHeight();
            opts.container.height(height)
        } else if (opts._autoHeightRatio) {
            opts.container.height(opts.container.width() / opts._autoHeightRatio)
        } else if (autoHeight === "calc" || $.type(autoHeight) == "number" && autoHeight >= 0) {
            if (autoHeight === "calc")
                sentinelIndex = calcSentinelIndex(e, opts);
            else if (autoHeight >= opts.slides.length)
                sentinelIndex = 0;
            else
                sentinelIndex = autoHeight;
            if (sentinelIndex == opts._sentinelIndex)
                return;
            opts._sentinelIndex = sentinelIndex;
            if (opts._sentinel)
                opts._sentinel.remove();
            clone = $(opts.slides[sentinelIndex].cloneNode(true));
            clone.removeAttr("id name rel").find("[id],[name],[rel]").removeAttr("id name rel");
            clone.css({
                position: "static",
                visibility: "hidden",
                display: "block"
            }).prependTo(opts.container).addClass("cycle-sentinel cycle-slide").removeClass("cycle-slide-active");
            clone.find("*").css("visibility", "hidden");
            opts._sentinel = clone
        }
    }
    function calcSentinelIndex(e, opts) {
        var index = 0
          , max = -1;
        opts.slides.each(function(i) {
            var h = $(this).height();
            if (h > max) {
                max = h;
                index = i
            }
        });
        return index
    }
    function onBefore(e, opts, outgoing, incoming, forward) {
        var h = $(incoming).outerHeight();
        opts.container.animate({
            height: h
        }, opts.autoHeightSpeed, opts.autoHeightEasing)
    }
    function onDestroy(e, opts) {
        if (opts._autoHeightOnResize) {
            $(window).off("resize orientationchange", opts._autoHeightOnResize);
            opts._autoHeightOnResize = null
        }
        opts.container.off("cycle-slide-added cycle-slide-removed", initAutoHeight);
        opts.container.off("cycle-destroyed", onDestroy);
        opts.container.off("cycle-before", onBefore);
        if (opts._sentinel) {
            opts._sentinel.remove();
            opts._sentinel = null
        }
    }
}
)(jQuery);
(function($) {
    "use strict";
    $.extend($.fn.cycle.defaults, {
        caption: "> .cycle-caption",
        captionTemplate: "{{slideNum}} / {{slideCount}}",
        overlay: "> .cycle-overlay",
        overlayTemplate: "<div>{{title}}</div><div>{{desc}}</div>",
        captionModule: "caption"
    });
    $(document).on("cycle-update-view", function(e, opts, slideOpts, currSlide) {
        if (opts.captionModule !== "caption")
            return;
        var el;
        $.each(["caption", "overlay"], function() {
            var name = this;
            var template = slideOpts[name + "Template"];
            var el = opts.API.getComponent(name);
            if (el.length && template) {
                el.html(opts.API.tmpl(template, slideOpts, opts, currSlide));
                el.show()
            } else {
                el.hide()
            }
        })
    });
    $(document).on("cycle-destroyed", function(e, opts) {
        var el;
        $.each(["caption", "overlay"], function() {
            var name = this
              , template = opts[name + "Template"];
            if (opts[name] && template) {
                el = opts.API.getComponent("caption");
                el.empty()
            }
        })
    })
}
)(jQuery);
(function($) {
    "use strict";
    var c2 = $.fn.cycle;
    $.fn.cycle = function(options) {
        var cmd, cmdFn, opts;
        var args = $.makeArray(arguments);
        if ($.type(options) == "number") {
            return this.cycle("goto", options)
        }
        if ($.type(options) == "string") {
            return this.each(function() {
                var cmdArgs;
                cmd = options;
                opts = $(this).data("cycle.opts");
                if (opts === undefined) {
                    c2.log('slideshow must be initialized before sending commands; "' + cmd + '" ignored');
                    return
                } else {
                    cmd = cmd == "goto" ? "jump" : cmd;
                    cmdFn = opts.API[cmd];
                    if ($.isFunction(cmdFn)) {
                        cmdArgs = $.makeArray(args);
                        cmdArgs.shift();
                        return cmdFn.apply(opts.API, cmdArgs)
                    } else {
                        c2.log("unknown command: ", cmd)
                    }
                }
            })
        } else {
            return c2.apply(this, arguments)
        }
    }
    ;
    $.extend($.fn.cycle, c2);
    $.extend(c2.API, {
        next: function() {
            var opts = this.opts();
            if (opts.busy && !opts.manualTrump)
                return;
            var count = opts.reverse ? -1 : 1;
            if (opts.allowWrap === false && opts.currSlide + count >= opts.slideCount)
                return;
            opts.API.advanceSlide(count);
            opts.API.trigger("cycle-next", [opts]).log("cycle-next")
        },
        prev: function() {
            var opts = this.opts();
            if (opts.busy && !opts.manualTrump)
                return;
            var count = opts.reverse ? 1 : -1;
            if (opts.allowWrap === false && opts.currSlide + count < 0)
                return;
            opts.API.advanceSlide(count);
            opts.API.trigger("cycle-prev", [opts]).log("cycle-prev")
        },
        destroy: function() {
            this.stop();
            var opts = this.opts();
            var clean = $.isFunction($._data) ? $._data : $.noop;
            clearTimeout(opts.timeoutId);
            opts.timeoutId = 0;
            opts.API.stop();
            opts.API.trigger("cycle-destroyed", [opts]).log("cycle-destroyed");
            opts.container.removeData();
            clean(opts.container[0], "parsedAttrs", false);
            if (!opts.retainStylesOnDestroy) {
                opts.container.removeAttr("style");
                opts.slides.removeAttr("style");
                opts.slides.removeClass(opts.slideActiveClass)
            }
            opts.slides.each(function() {
                var slide = $(this);
                slide.removeData();
                slide.removeClass(opts.slideClass);
                clean(this, "parsedAttrs", false)
            })
        },
        jump: function(index, fx) {
            var fwd;
            var opts = this.opts();
            if (opts.busy && !opts.manualTrump)
                return;
            var num = parseInt(index, 10);
            if (isNaN(num) || num < 0 || num >= opts.slides.length) {
                opts.API.log("goto: invalid slide index: " + num);
                return
            }
            if (num == opts.currSlide) {
                opts.API.log("goto: skipping, already on slide", num);
                return
            }
            opts.nextSlide = num;
            clearTimeout(opts.timeoutId);
            opts.timeoutId = 0;
            opts.API.log("goto: ", num, " (zero-index)");
            fwd = opts.currSlide < opts.nextSlide;
            opts._tempFx = fx;
            opts.API.prepareTx(true, fwd)
        },
        stop: function() {
            var opts = this.opts();
            var pauseObj = opts.container;
            clearTimeout(opts.timeoutId);
            opts.timeoutId = 0;
            opts.API.stopTransition();
            if (opts.pauseOnHover) {
                if (opts.pauseOnHover !== true)
                    pauseObj = $(opts.pauseOnHover);
                pauseObj.off("mouseenter mouseleave")
            }
            opts.API.trigger("cycle-stopped", [opts]).log("cycle-stopped")
        },
        reinit: function() {
            var opts = this.opts();
            opts.API.destroy();
            opts.container.cycle()
        },
        remove: function(index) {
            var opts = this.opts();
            var slide, slideToRemove, slides = [], slideNum = 1;
            for (var i = 0; i < opts.slides.length; i++) {
                slide = opts.slides[i];
                if (i == index) {
                    slideToRemove = slide
                } else {
                    slides.push(slide);
                    $(slide).data("cycle.opts").slideNum = slideNum;
                    slideNum++
                }
            }
            if (slideToRemove) {
                opts.slides = $(slides);
                opts.slideCount--;
                $(slideToRemove).remove();
                if (index == opts.currSlide)
                    opts.API.advanceSlide(1);
                else if (index < opts.currSlide)
                    opts.currSlide--;
                else
                    opts.currSlide++;
                opts.API.trigger("cycle-slide-removed", [opts, index, slideToRemove]).log("cycle-slide-removed");
                opts.API.updateView()
            }
        }
    });
    $(document).on("click.cycle", "[data-cycle-cmd]", function(e) {
        e.preventDefault();
        var el = $(this);
        var command = el.data("cycle-cmd");
        var context = el.data("cycle-context") || ".cycle-slideshow";
        $(context).cycle(command, el.data("cycle-arg"))
    })
}
)(jQuery);
(function($) {
    "use strict";
    $(document).on("cycle-pre-initialize", function(e, opts) {
        onHashChange(opts, true);
        opts._onHashChange = function() {
            onHashChange(opts, false)
        }
        ;
        $(window).on("hashchange", opts._onHashChange)
    });
    $(document).on("cycle-update-view", function(e, opts, slideOpts) {
        if (slideOpts.hash && "#" + slideOpts.hash != window.location.hash) {
            opts._hashFence = true;
            window.location.hash = slideOpts.hash
        }
    });
    $(document).on("cycle-destroyed", function(e, opts) {
        if (opts._onHashChange) {
            $(window).off("hashchange", opts._onHashChange)
        }
    });
    function onHashChange(opts, setStartingSlide) {
        var hash;
        if (opts._hashFence) {
            opts._hashFence = false;
            return
        }
        hash = window.location.hash.substring(1);
        opts.slides.each(function(i) {
            if ($(this).data("cycle-hash") == hash) {
                if (setStartingSlide === true) {
                    opts.startingSlide = i
                } else {
                    var fwd = opts.currSlide < i;
                    opts.nextSlide = i;
                    opts.API.prepareTx(true, fwd)
                }
                return false
            }
        })
    }
}
)(jQuery);
(function($) {
    "use strict";
    $.extend($.fn.cycle.defaults, {
        loader: false
    });
    $(document).on("cycle-bootstrap", function(e, opts) {
        var addFn;
        if (!opts.loader)
            return;
        addFn = opts.API.add;
        opts.API.add = add;
        function add(slides, prepend) {
            var slideArr = [];
            if ($.type(slides) == "string")
                slides = $.trim(slides);
            else if ($.type(slides) === "array") {
                for (var i = 0; i < slides.length; i++)
                    slides[i] = $(slides[i])[0]
            }
            slides = $(slides);
            var slideCount = slides.length;
            if (!slideCount)
                return;
            slides.css("visibility", "hidden").appendTo("body").each(function(i) {
                var count = 0;
                var slide = $(this);
                var images = slide.is("img") ? slide : slide.find("img");
                slide.data("index", i);
                images = images.filter(":not(.cycle-loader-ignore)").filter(':not([src=""])');
                if (!images.length) {
                    --slideCount;
                    slideArr.push(slide);
                    return
                }
                count = images.length;
                images.each(function() {
                    if (this.complete) {
                        imageLoaded()
                    } else {
                        $(this).load(function() {
                            imageLoaded()
                        }).on("error", function() {
                            if (--count === 0) {
                                opts.API.log("slide skipped; img not loaded:", this.src);
                                if (--slideCount === 0 && opts.loader == "wait") {
                                    addFn.apply(opts.API, [slideArr, prepend])
                                }
                            }
                        })
                    }
                });
                function imageLoaded() {
                    if (--count === 0) {
                        --slideCount;
                        addSlide(slide)
                    }
                }
            });
            if (slideCount)
                opts.container.addClass("cycle-loading");
            function addSlide(slide) {
                var curr;
                if (opts.loader == "wait") {
                    slideArr.push(slide);
                    if (slideCount === 0) {
                        slideArr.sort(sorter);
                        addFn.apply(opts.API, [slideArr, prepend]);
                        opts.container.removeClass("cycle-loading")
                    }
                } else {
                    curr = $(opts.slides[opts.currSlide]);
                    addFn.apply(opts.API, [slide, prepend]);
                    curr.show();
                    opts.container.removeClass("cycle-loading")
                }
            }
            function sorter(a, b) {
                return a.data("index") - b.data("index")
            }
        }
    })
}
)(jQuery);
(function($) {
    "use strict";
    $.extend($.fn.cycle.defaults, {
        pager: "> .cycle-pager",
        pagerActiveClass: "cycle-pager-active",
        pagerEvent: "click.cycle",
        pagerEventBubble: undefined,
        pagerTemplate: "<span>&bull;</span>"
    });
    $(document).on("cycle-bootstrap", function(e, opts, API) {
        API.buildPagerLink = buildPagerLink
    });
    $(document).on("cycle-slide-added", function(e, opts, slideOpts, slideAdded) {
        if (opts.pager) {
            opts.API.buildPagerLink(opts, slideOpts, slideAdded);
            opts.API.page = page
        }
    });
    $(document).on("cycle-slide-removed", function(e, opts, index, slideRemoved) {
        if (opts.pager) {
            var pagers = opts.API.getComponent("pager");
            pagers.each(function() {
                var pager = $(this);
                $(pager.children()[index]).remove()
            })
        }
    });
    $(document).on("cycle-update-view", function(e, opts, slideOpts) {
        var pagers;
        if (opts.pager) {
            pagers = opts.API.getComponent("pager");
            pagers.each(function() {
                $(this).children().removeClass(opts.pagerActiveClass).eq(opts.currSlide).addClass(opts.pagerActiveClass)
            })
        }
    });
    $(document).on("cycle-destroyed", function(e, opts) {
        var pager = opts.API.getComponent("pager");
        if (pager) {
            pager.children().off(opts.pagerEvent);
            if (opts.pagerTemplate)
                pager.empty()
        }
    });
    function buildPagerLink(opts, slideOpts, slide) {
        var pagerLink;
        var pagers = opts.API.getComponent("pager");
        pagers.each(function() {
            var pager = $(this);
            if (slideOpts.pagerTemplate) {
                var markup = opts.API.tmpl(slideOpts.pagerTemplate, slideOpts, opts, slide[0]);
                pagerLink = $(markup).appendTo(pager)
            } else {
                pagerLink = pager.children().eq(opts.slideCount - 1)
            }
            pagerLink.on(opts.pagerEvent, function(e) {
                if (!opts.pagerEventBubble)
                    e.preventDefault();
                opts.API.page(pager, e.currentTarget)
            })
        })
    }
    function page(pager, target) {
        var opts = this.opts();
        if (opts.busy && !opts.manualTrump)
            return;
        var index = pager.children().index(target);
        var nextSlide = index;
        var fwd = opts.currSlide < nextSlide;
        if (opts.currSlide == nextSlide) {
            return
        }
        opts.nextSlide = nextSlide;
        opts._tempFx = opts.pagerFx;
        opts.API.prepareTx(true, fwd);
        opts.API.trigger("cycle-pager-activated", [opts, pager, target])
    }
}
)(jQuery);
(function($) {
    "use strict";
    $.extend($.fn.cycle.defaults, {
        next: "> .cycle-next",
        nextEvent: "click.cycle",
        disabledClass: "disabled",
        prev: "> .cycle-prev",
        prevEvent: "click.cycle",
        swipe: false
    });
    $(document).on("cycle-initialized", function(e, opts) {
        opts.API.getComponent("next").on(opts.nextEvent, function(e) {
            e.preventDefault();
            opts.API.next()
        });
        opts.API.getComponent("prev").on(opts.prevEvent, function(e) {
            e.preventDefault();
            opts.API.prev()
        });
        if (opts.swipe) {
            var nextEvent = opts.swipeVert ? "swipeUp.cycle" : "swipeLeft.cycle swipeleft.cycle";
            var prevEvent = opts.swipeVert ? "swipeDown.cycle" : "swipeRight.cycle swiperight.cycle";
            opts.container.on(nextEvent, function(e) {
                opts._tempFx = opts.swipeFx;
                opts.API.next()
            });
            opts.container.on(prevEvent, function() {
                opts._tempFx = opts.swipeFx;
                opts.API.prev()
            })
        }
    });
    $(document).on("cycle-update-view", function(e, opts, slideOpts, currSlide) {
        if (opts.allowWrap)
            return;
        var cls = opts.disabledClass;
        var next = opts.API.getComponent("next");
        var prev = opts.API.getComponent("prev");
        var prevBoundry = opts._prevBoundry || 0;
        var nextBoundry = opts._nextBoundry !== undefined ? opts._nextBoundry : opts.slideCount - 1;
        if (opts.currSlide == nextBoundry)
            next.addClass(cls).prop("disabled", true);
        else
            next.removeClass(cls).prop("disabled", false);
        if (opts.currSlide === prevBoundry)
            prev.addClass(cls).prop("disabled", true);
        else
            prev.removeClass(cls).prop("disabled", false)
    });
    $(document).on("cycle-destroyed", function(e, opts) {
        opts.API.getComponent("prev").off(opts.nextEvent);
        opts.API.getComponent("next").off(opts.prevEvent);
        opts.container.off("swipeleft.cycle swiperight.cycle swipeLeft.cycle swipeRight.cycle swipeUp.cycle swipeDown.cycle")
    })
}
)(jQuery);
(function($) {
    "use strict";
    $.extend($.fn.cycle.defaults, {
        progressive: false
    });
    $(document).on("cycle-pre-initialize", function(e, opts) {
        if (!opts.progressive)
            return;
        var API = opts.API;
        var nextFn = API.next;
        var prevFn = API.prev;
        var prepareTxFn = API.prepareTx;
        var type = $.type(opts.progressive);
        var slides, scriptEl;
        if (type == "array") {
            slides = opts.progressive
        } else if ($.isFunction(opts.progressive)) {
            slides = opts.progressive(opts)
        } else if (type == "string") {
            scriptEl = $(opts.progressive);
            slides = $.trim(scriptEl.html());
            if (!slides)
                return;
            if (/^(\[)/.test(slides)) {
                try {
                    slides = $.parseJSON(slides)
                } catch (err) {
                    API.log("error parsing progressive slides", err);
                    return
                }
            } else {
                slides = slides.split(new RegExp(scriptEl.data("cycle-split") || "\n"));
                if (!slides[slides.length - 1])
                    slides.pop()
            }
        }
        if (prepareTxFn) {
            API.prepareTx = function(manual, fwd) {
                var index, slide;
                if (manual || slides.length === 0) {
                    prepareTxFn.apply(opts.API, [manual, fwd]);
                    return
                }
                if (fwd && opts.currSlide == opts.slideCount - 1) {
                    slide = slides[0];
                    slides = slides.slice(1);
                    opts.container.one("cycle-slide-added", function(e, opts) {
                        setTimeout(function() {
                            opts.API.advanceSlide(1)
                        }, 50)
                    });
                    opts.API.add(slide)
                } else if (!fwd && opts.currSlide === 0) {
                    index = slides.length - 1;
                    slide = slides[index];
                    slides = slides.slice(0, index);
                    opts.container.one("cycle-slide-added", function(e, opts) {
                        setTimeout(function() {
                            opts.currSlide = 1;
                            opts.API.advanceSlide(-1)
                        }, 50)
                    });
                    opts.API.add(slide, true)
                } else {
                    prepareTxFn.apply(opts.API, [manual, fwd])
                }
            }
        }
        if (nextFn) {
            API.next = function() {
                var opts = this.opts();
                if (slides.length && opts.currSlide == opts.slideCount - 1) {
                    var slide = slides[0];
                    slides = slides.slice(1);
                    opts.container.one("cycle-slide-added", function(e, opts) {
                        nextFn.apply(opts.API);
                        opts.container.removeClass("cycle-loading")
                    });
                    opts.container.addClass("cycle-loading");
                    opts.API.add(slide)
                } else {
                    nextFn.apply(opts.API)
                }
            }
        }
        if (prevFn) {
            API.prev = function() {
                var opts = this.opts();
                if (slides.length && opts.currSlide === 0) {
                    var index = slides.length - 1;
                    var slide = slides[index];
                    slides = slides.slice(0, index);
                    opts.container.one("cycle-slide-added", function(e, opts) {
                        opts.currSlide = 1;
                        opts.API.advanceSlide(-1);
                        opts.container.removeClass("cycle-loading")
                    });
                    opts.container.addClass("cycle-loading");
                    opts.API.add(slide, true)
                } else {
                    prevFn.apply(opts.API)
                }
            }
        }
    })
}
)(jQuery);
(function($) {
    "use strict";
    $.extend($.fn.cycle.defaults, {
        tmplRegex: "{{((.)?.*?)}}"
    });
    $.extend($.fn.cycle.API, {
        tmpl: function(str, opts) {
            var regex = new RegExp(opts.tmplRegex || $.fn.cycle.defaults.tmplRegex,"g");
            var args = $.makeArray(arguments);
            args.shift();
            return str.replace(regex, function(_, str) {
                var i, j, obj, prop, names = str.split(".");
                for (i = 0; i < args.length; i++) {
                    obj = args[i];
                    if (!obj)
                        continue;
                    if (names.length > 1) {
                        prop = obj;
                        for (j = 0; j < names.length; j++) {
                            obj = prop;
                            prop = prop[names[j]] || str
                        }
                    } else {
                        prop = obj[str]
                    }
                    if ($.isFunction(prop))
                        return prop.apply(obj, args);
                    if (prop !== undefined && prop !== null && prop != str)
                        return prop
                }
                return str
            })
        }
    })
}
)(jQuery);
(function() {
    "use strict";
    function setup($) {
        $.fn._fadeIn = $.fn.fadeIn;
        var noOp = $.noop || function() {}
        ;
        var msie = /MSIE/.test(navigator.userAgent);
        var ie6 = /MSIE 6.0/.test(navigator.userAgent) && !/MSIE 8.0/.test(navigator.userAgent);
        var mode = document.documentMode || 0;
        var setExpr = $.isFunction(document.createElement("div").style.setExpression);
        $.blockUI = function(opts) {
            install(window, opts)
        }
        ;
        $.unblockUI = function(opts) {
            remove(window, opts)
        }
        ;
        $.growlUI = function(title, message, timeout, onClose) {
            var $m = $('<div class="growlUI"></div>');
            if (title)
                $m.append("<h1>" + title + "</h1>");
            if (message)
                $m.append("<h2>" + message + "</h2>");
            if (timeout === undefined)
                timeout = 3e3;
            var callBlock = function(opts) {
                opts = opts || {};
                $.blockUI({
                    message: $m,
                    fadeIn: typeof opts.fadeIn !== "undefined" ? opts.fadeIn : 700,
                    fadeOut: typeof opts.fadeOut !== "undefined" ? opts.fadeOut : 1e3,
                    timeout: typeof opts.timeout !== "undefined" ? opts.timeout : timeout,
                    centerY: false,
                    showOverlay: false,
                    onUnblock: onClose,
                    css: $.blockUI.defaults.growlCSS
                })
            };
            callBlock();
            var nonmousedOpacity = $m.css("opacity");
            $m.mouseover(function() {
                callBlock({
                    fadeIn: 0,
                    timeout: 3e4
                });
                var displayBlock = $(".blockMsg");
                displayBlock.stop();
                displayBlock.fadeTo(300, 1)
            }).mouseout(function() {
                $(".blockMsg").fadeOut(1e3)
            })
        }
        ;
        $.fn.block = function(opts) {
            if (this[0] === window) {
                $.blockUI(opts);
                return this
            }
            var fullOpts = $.extend({}, $.blockUI.defaults, opts || {});
            this.each(function() {
                var $el = $(this);
                if (fullOpts.ignoreIfBlocked && $el.data("blockUI.isBlocked"))
                    return;
                $el.unblock({
                    fadeOut: 0
                })
            });
            return this.each(function() {
                if ($.css(this, "position") == "static") {
                    this.style.position = "relative";
                    $(this).data("blockUI.static", true)
                }
                this.style.zoom = 1;
                install(this, opts)
            })
        }
        ;
        $.fn.unblock = function(opts) {
            if (this[0] === window) {
                $.unblockUI(opts);
                return this
            }
            return this.each(function() {
                remove(this, opts)
            })
        }
        ;
        $.blockUI.version = 2.7;
        $.blockUI.defaults = {
            message: "<h1>Please wait...</h1>",
            title: null,
            draggable: true,
            theme: false,
            css: {
                padding: 0,
                margin: 0,
                width: "30%",
                top: "40%",
                left: "35%",
                textAlign: "center",
                color: "#000",
                border: "3px solid #aaa",
                backgroundColor: "#fff",
                cursor: "wait"
            },
            themedCSS: {
                width: "30%",
                top: "40%",
                left: "35%"
            },
            overlayCSS: {
                backgroundColor: "#000",
                opacity: .6,
                cursor: "wait"
            },
            cursorReset: "default",
            growlCSS: {
                width: "350px",
                top: "10px",
                left: "",
                right: "10px",
                border: "none",
                padding: "5px",
                opacity: .6,
                cursor: "default",
                color: "#fff",
                backgroundColor: "#000",
                "-webkit-border-radius": "10px",
                "-moz-border-radius": "10px",
                "border-radius": "10px"
            },
            iframeSrc: /^https/i.test(window.location.href || "") ? "javascript:false" : "about:blank",
            forceIframe: false,
            baseZ: 1e3,
            centerX: true,
            centerY: true,
            allowBodyStretch: true,
            bindEvents: true,
            constrainTabKey: true,
            fadeIn: 200,
            fadeOut: 400,
            timeout: 0,
            showOverlay: true,
            focusInput: true,
            focusableElements: ":input:enabled:visible",
            onBlock: null,
            onUnblock: null,
            onOverlayClick: null,
            quirksmodeOffsetHack: 4,
            blockMsgClass: "blockMsg",
            ignoreIfBlocked: false
        };
        var pageBlock = null;
        var pageBlockEls = [];
        function install(el, opts) {
            var css, themedCSS;
            var full = el == window;
            var msg = opts && opts.message !== undefined ? opts.message : undefined;
            opts = $.extend({}, $.blockUI.defaults, opts || {});
            if (opts.ignoreIfBlocked && $(el).data("blockUI.isBlocked"))
                return;
            opts.overlayCSS = $.extend({}, $.blockUI.defaults.overlayCSS, opts.overlayCSS || {});
            css = $.extend({}, $.blockUI.defaults.css, opts.css || {});
            if (opts.onOverlayClick)
                opts.overlayCSS.cursor = "pointer";
            themedCSS = $.extend({}, $.blockUI.defaults.themedCSS, opts.themedCSS || {});
            msg = msg === undefined ? opts.message : msg;
            if (full && pageBlock)
                remove(window, {
                    fadeOut: 0
                });
            if (msg && typeof msg != "string" && (msg.parentNode || msg.jquery)) {
                var node = msg.jquery ? msg[0] : msg;
                var data = {};
                $(el).data("blockUI.history", data);
                data.el = node;
                data.parent = node.parentNode;
                data.display = node.style.display;
                data.position = node.style.position;
                if (data.parent)
                    data.parent.removeChild(node)
            }
            $(el).data("blockUI.onUnblock", opts.onUnblock);
            var z = opts.baseZ;
            var lyr1, lyr2, lyr3, s;
            if (msie || opts.forceIframe)
                lyr1 = $('<iframe class="blockUI" style="z-index:' + z++ + ';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="' + opts.iframeSrc + '"></iframe>');
            else
                lyr1 = $('<div class="blockUI" style="display:none"></div>');
            if (opts.theme)
                lyr2 = $('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:' + z++ + ';display:none"></div>');
            else
                lyr2 = $('<div class="blockUI blockOverlay" style="z-index:' + z++ + ';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');
            if (opts.theme && full) {
                s = '<div class="blockUI ' + opts.blockMsgClass + ' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:' + (z + 10) + ';display:none;position:fixed">';
                if (opts.title) {
                    s += '<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">' + (opts.title || "&nbsp;") + "</div>"
                }
                s += '<div class="ui-widget-content ui-dialog-content"></div>';
                s += "</div>"
            } else if (opts.theme) {
                s = '<div class="blockUI ' + opts.blockMsgClass + ' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:' + (z + 10) + ';display:none;position:absolute">';
                if (opts.title) {
                    s += '<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">' + (opts.title || "&nbsp;") + "</div>"
                }
                s += '<div class="ui-widget-content ui-dialog-content"></div>';
                s += "</div>"
            } else if (full) {
                s = '<div class="blockUI ' + opts.blockMsgClass + ' blockPage" style="z-index:' + (z + 10) + ';display:none;position:fixed"></div>'
            } else {
                s = '<div class="blockUI ' + opts.blockMsgClass + ' blockElement" style="z-index:' + (z + 10) + ';display:none;position:absolute"></div>'
            }
            lyr3 = $(s);
            if (msg) {
                if (opts.theme) {
                    lyr3.css(themedCSS);
                    lyr3.addClass("ui-widget-content")
                } else
                    lyr3.css(css)
            }
            if (!opts.theme)
                lyr2.css(opts.overlayCSS);
            lyr2.css("position", full ? "fixed" : "absolute");
            if (msie || opts.forceIframe)
                lyr1.css("opacity", 0);
            var layers = [lyr1, lyr2, lyr3]
              , $par = full ? $("body") : $(el);
            $.each(layers, function() {
                this.appendTo($par)
            });
            if (opts.theme && opts.draggable && $.fn.draggable) {
                lyr3.draggable({
                    handle: ".ui-dialog-titlebar",
                    cancel: "li"
                })
            }
            var expr = setExpr && (!$.support.boxModel || $("object,embed", full ? null : el).length > 0);
            if (ie6 || expr) {
                if (full && opts.allowBodyStretch && $.support.boxModel)
                    $("html,body").css("height", "100%");
                if ((ie6 || !$.support.boxModel) && !full) {
                    var t = sz(el, "borderTopWidth")
                      , l = sz(el, "borderLeftWidth");
                    var fixT = t ? "(0 - " + t + ")" : 0;
                    var fixL = l ? "(0 - " + l + ")" : 0
                }
                $.each(layers, function(i, o) {
                    var s = o[0].style;
                    s.position = "absolute";
                    if (i < 2) {
                        if (full)
                            s.setExpression("height", "Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:" + opts.quirksmodeOffsetHack + ') + "px"');
                        else
                            s.setExpression("height", 'this.parentNode.offsetHeight + "px"');
                        if (full)
                            s.setExpression("width", 'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"');
                        else
                            s.setExpression("width", 'this.parentNode.offsetWidth + "px"');
                        if (fixL)
                            s.setExpression("left", fixL);
                        if (fixT)
                            s.setExpression("top", fixT)
                    } else if (opts.centerY) {
                        if (full)
                            s.setExpression("top", '(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');
                        s.marginTop = 0
                    } else if (!opts.centerY && full) {
                        var top = opts.css && opts.css.top ? parseInt(opts.css.top, 10) : 0;
                        var expression = "((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + " + top + ') + "px"';
                        s.setExpression("top", expression)
                    }
                })
            }
            if (msg) {
                if (opts.theme)
                    lyr3.find(".ui-widget-content").append(msg);
                else
                    lyr3.append(msg);
                if (msg.jquery || msg.nodeType)
                    $(msg).show()
            }
            if ((msie || opts.forceIframe) && opts.showOverlay)
                lyr1.show();
            if (opts.fadeIn) {
                var cb = opts.onBlock ? opts.onBlock : noOp;
                var cb1 = opts.showOverlay && !msg ? cb : noOp;
                var cb2 = msg ? cb : noOp;
                if (opts.showOverlay)
                    lyr2._fadeIn(opts.fadeIn, cb1);
                if (msg)
                    lyr3._fadeIn(opts.fadeIn, cb2)
            } else {
                if (opts.showOverlay)
                    lyr2.show();
                if (msg)
                    lyr3.show();
                if (opts.onBlock)
                    opts.onBlock.bind(lyr3)()
            }
            bind(1, el, opts);
            if (full) {
                pageBlock = lyr3[0];
                pageBlockEls = $(opts.focusableElements, pageBlock);
                if (opts.focusInput)
                    setTimeout(focus, 20)
            } else
                center(lyr3[0], opts.centerX, opts.centerY);
            if (opts.timeout) {
                var to = setTimeout(function() {
                    if (full)
                        $.unblockUI(opts);
                    else
                        $(el).unblock(opts)
                }, opts.timeout);
                $(el).data("blockUI.timeout", to)
            }
        }
        function remove(el, opts) {
            var count;
            var full = el == window;
            var $el = $(el);
            var data = $el.data("blockUI.history");
            var to = $el.data("blockUI.timeout");
            if (to) {
                clearTimeout(to);
                $el.removeData("blockUI.timeout")
            }
            opts = $.extend({}, $.blockUI.defaults, opts || {});
            bind(0, el, opts);
            if (opts.onUnblock === null) {
                opts.onUnblock = $el.data("blockUI.onUnblock");
                $el.removeData("blockUI.onUnblock")
            }
            var els;
            if (full)
                els = $("body").children().filter(".blockUI").add("body > .blockUI");
            else
                els = $el.find(">.blockUI");
            if (opts.cursorReset) {
                if (els.length > 1)
                    els[1].style.cursor = opts.cursorReset;
                if (els.length > 2)
                    els[2].style.cursor = opts.cursorReset
            }
            if (full)
                pageBlock = pageBlockEls = null;
            if (opts.fadeOut) {
                count = els.length;
                els.stop().fadeOut(opts.fadeOut, function() {
                    if (--count === 0)
                        reset(els, data, opts, el)
                })
            } else
                reset(els, data, opts, el)
        }
        function reset(els, data, opts, el) {
            var $el = $(el);
            if ($el.data("blockUI.isBlocked"))
                return;
            els.each(function(i, o) {
                if (this.parentNode)
                    this.parentNode.removeChild(this)
            });
            if (data && data.el) {
                data.el.style.display = data.display;
                data.el.style.position = data.position;
                data.el.style.cursor = "default";
                if (data.parent)
                    data.parent.appendChild(data.el);
                $el.removeData("blockUI.history")
            }
            if ($el.data("blockUI.static")) {
                $el.css("position", "static")
            }
            if (typeof opts.onUnblock == "function")
                opts.onUnblock(el, opts);
            var body = $(document.body)
              , w = body.width()
              , cssW = body[0].style.width;
            body.width(w - 1).width(w);
            body[0].style.width = cssW
        }
        function bind(b, el, opts) {
            var full = el == window
              , $el = $(el);
            if (!b && (full && !pageBlock || !full && !$el.data("blockUI.isBlocked")))
                return;
            $el.data("blockUI.isBlocked", b);
            if (!full || !opts.bindEvents || b && !opts.showOverlay)
                return;
            var events = "mousedown mouseup keydown keypress keyup touchstart touchend touchmove";
            if (b)
                $(document).bind(events, opts, handler);
            else
                $(document).unbind(events, handler)
        }
        function handler(e) {
            if (e.type === "keydown" && e.keyCode && e.keyCode == 9) {
                if (pageBlock && e.data.constrainTabKey) {
                    var els = pageBlockEls;
                    var fwd = !e.shiftKey && e.target === els[els.length - 1];
                    var back = e.shiftKey && e.target === els[0];
                    if (fwd || back) {
                        setTimeout(function() {
                            focus(back)
                        }, 10);
                        return false
                    }
                }
            }
            var opts = e.data;
            var target = $(e.target);
            if (target.hasClass("blockOverlay") && opts.onOverlayClick)
                opts.onOverlayClick(e);
            if (target.parents("div." + opts.blockMsgClass).length > 0)
                return true;
            return target.parents().children().filter("div.blockUI").length === 0
        }
        function focus(back) {
            if (!pageBlockEls)
                return;
            var e = pageBlockEls[back === true ? pageBlockEls.length - 1 : 0];
            if (e)
                e.focus()
        }
        function center(el, x, y) {
            var p = el.parentNode
              , s = el.style;
            var l = (p.offsetWidth - el.offsetWidth) / 2 - sz(p, "borderLeftWidth");
            var t = (p.offsetHeight - el.offsetHeight) / 2 - sz(p, "borderTopWidth");
            if (x)
                s.left = l > 0 ? l + "px" : "0";
            if (y)
                s.top = t > 0 ? t + "px" : "0"
        }
        function sz(el, p) {
            return parseInt($.css(el, p), 10) || 0
        }
    }
    if (typeof define === "function" && define.amd && define.amd.jQuery) {
        define(["jquery"], setup)
    } else {
        setup(jQuery)
    }
}
)();
"use strict";
!function(a) {
    "function" == typeof define && define.amd ? define(["jquery"], a) : a("object" == typeof exports ? require("jquery") : jQuery)
}(function(a) {
    var b = "horizonSwiper"
      , c = {
        item: ".horizon-item",
        showItems: "auto",
        dots: !1,
        numberedDots: !1,
        arrows: !0,
        arrowPrevText: "",
        arrowNextText: "",
        animationSpeed: 500,
        mouseDrag: !0,
        onStart: function() {},
        onEnd: function() {},
        onSlideStart: function() {},
        onSlideEnd: function() {},
        onDragStart: function() {},
        onDragEnd: function() {}
    }
      , d = {
        $window: a(window),
        $document: a(document),
        innerClass: "horizon-inner",
        outerClass: "horizon-outer",
        dotContainer: '<nav class="horizon-dots"></nav>',
        arrowPrev: ['<button class="horizon-prev">', "</button>"],
        arrowNext: ['<button class="horizon-next">', "</button>"],
        showArrowsClass: "arrows",
        showDotsClass: "dots",
        initializedClass: "initialized",
        mouseDragClass: "mouse-drag",
        firstItemClass: "first-item",
        lastItemClass: "last-item"
    }
      , e = function() {
        function b(b, e) {
            var f = this;
            f.settings = a.extend({}, c, e),
            f.$element = a(b),
            f.$items = f.$element.find(this.settings.item),
            f.$inner = null,
            f.$outer = null,
            f.$dots = null,
            f.$arrowPrev = null,
            f.$arrowNext = null,
            f.initialized = !1,
            f.maxHeight = 0,
            f.innerContainerWidth = 0,
            f.viewportSize = 0,
            f.isAnimate = !1;
            var g = function h() {
                f.initialized ? f.setSizes() : setTimeout(function() {
                    h()
                }, 1e3)
            };
            d.$document.ready(function() {
                f.init()
            }),
            d.$window.load(function() {
                g()
            })
        }
        return b.prototype.init = function() {
            var a = this;
            a._setWrapper(),
            a._addArrows(),
            a._addDots(),
            a._mouseDrag(),
            a.setSizes(),
            a._resize(),
            a._checkPosition(),
            a.initialized = !0
        }
        ,
        b.prototype.setSizes = function() {
            var b = this;
            b.maxHeight = 0,
            b.innerContainerWidth = 0;
            for (var c = 0; c < b.$items.length; ++c) {
                var e = a(b.$items[c])
                  , f = e.outerHeight(!0)
                  , g = e.outerWidth(!0);
                f > b.maxHeight && (b.maxHeight = f),
                b.innerContainerWidth += g
            }
            b.viewportSize = b.$inner.width(),
            b.$outer.css({
                "max-height": b.maxHeight + "px"
            }),
            b.viewportSize < b.innerContainerWidth ? (b.$element.addClass(d.initializedClass),
            b.settings.arrows && b.$element.addClass(d.showArrowsClass),
            b.settings.dots && b.$element.addClass(d.showDotsClass)) : (b.$element.removeClass(d.initializedClass),
            b.$element.addClass(d.showArrowsClass))
        }
        ,
        b.prototype._resize = function() {
            var a = this
              , b = null
              , c = function() {
                a.setSizes(),
                a._checkPosition()
            };
            d.$window.resize(function() {
                clearTimeout(b),
                setTimeout(function() {
                    c()
                }, 250)
            })
        }
        ,
        b.prototype._setWrapper = function() {
            var b = this
              , c = 0;
            b.$items.wrapAll('<div class="' + d.outerClass + '">'),
            b.$items.wrapAll('<div class="' + d.innerClass + '">'),
            b.$inner = b.$element.find("." + d.innerClass),
            b.$outer = b.$element.find("." + d.outerClass),
            "auto" !== b.settings.showItems && b.settings.showItems === parseInt(b.settings.showItems, 10) && (c = 100 / b.settings.showItems,
            b.$items.css({
                width: c + "%"
            }));
            for (var e = 0; e < b.$items.length; ++e)
                a(b.$items[e]).attr("data-horizon-index", e)
        }
        ,
        b.prototype._addDots = function() {
            var b = this;
            if (b.settings.dots) {
                b.$dots = a(d.dotContainer);
                for (var c = 0; c < b.$items.length; ++c) {
                    var e = b.settings.numberedDots ? c : ""
                      , f = a('<button class="horizon-dot" data-horizon-target="' + c + '">' + e + "</button>");
                    b.$dots.append(f)
                }
                b.$element.append(b.$dots),
                b.$dots.find("button").on("click", function(c) {
                    c.preventDefault();
                    var d = a(this).attr("data-horizon-target");
                    b._dotScroll(d)
                })
            }
        }
        ,
        b.prototype._dotScroll = function(b) {
            var c = this
              , d = c.$dots.find('[data-horizon-index="' + b + '"]')
              , e = d.outerWidth(!0)
              , f = 0
              , g = 0
              , h = c.viewportSize / 2 - e / 2;
            c.isAnimate = !0,
            c.settings.onSlideStart();
            for (var i = 0; i < c.$items.length; ++i)
                b > i && (f += a(c.$items[i]).outerWidth(!0));
            g = f - h,
            0 > g ? g = 0 : g > c.innerContainerWidth - c.viewportSize && (g = c.innerContainerWidth - c.viewportSize),
            c.$inner.animate({
                scrollLeft: g
            }, c.settings.animationSpeed, function() {
                c._checkPosition(),
                c.settings.onSlideEnd(),
                b === c.$items.length ? c.settings.onEnd() : 0 === b && c.settings.onStart(),
                c.isAnimate = !1
            })
        }
        ,
        b.prototype._addArrows = function() {
            var b = this;
            b.settings.arrows === !0 && (b.$arrowPrev = a(d.arrowPrev[0] + b.settings.arrowPrevText + d.arrowPrev[1]),
            b.$arrowNext = a(d.arrowNext[0] + b.settings.arrowNextText + d.arrowNext[1]),
            b.$arrowNext.insertAfter(b.$outer),
            b.$arrowPrev.insertAfter(b.$outer),
            b.$element.addClass(d.firstItemClass),
            b.$arrowPrev.attr("disabled", "disabled"),
            b.$arrowPrev.on("click", function(a) {
                a.preventDefault(),
                b.isAnimate || b._scrollTo("previous")
            }),
            b.$arrowNext.on("click", function(a) {
                a.preventDefault(),
                b.isAnimate || b._scrollTo("next")
            }))
        }
        ,
        b.prototype._scrollTo = function(a) {
            var b = this
              , c = b._getOffset(a);
            return b.isAnimate = !0,
            "end" === c || "start" === c ? void (b.isAnimate = !1) : (b.settings.onSlideStart(),
            void b.$inner.animate({
                scrollLeft: c[0]
            }, b.settings.animationSpeed, function() {
                "end" === c[1] ? b.settings.onEnd() : "start" === c[1] && b.settings.onStart(),
                b._checkPosition(),
                b.settings.onSlideEnd(),
                b.isAnimate = !1
            }))
        }
        ,
        b.prototype._getOffset = function(b) {
            var c = this
              , d = c.$inner.scrollLeft()
              , e = 0
              , f = d + c.viewportSize;
            if ("next" === b && d + c.viewportSize === c.innerContainerWidth)
                return "end";
            if ("previous" === b && 0 === d)
                return "start";
            for (var g = 0; g < c.$items.length; ++g) {
                var h = a(c.$items[g]).outerWidth(!0)
                  , i = "";
                if (e += h,
                "next" === b && e > f)
                    return g + 1 === c.$items.length && (i = "end"),
                    [e - c.viewportSize, i];
                if ("previous" === b && e >= d)
                    return 0 >= e - h && (i = "start"),
                    [e - h, i]
            }
        }
        ,
        b.prototype._mouseDrag = function() {
            var a = this
              , b = !1
              , c = !1
              , e = 0
              , f = 0
              , g = (a.$inner.offset().left,
            0)
              , h = !1
              , i = !1
              , j = null
              , k = function(c) {
                b || (g = f + (e - c.pageX),
                a.$inner.scrollLeft(g))
            };
            a.$element.on({
                touchstart: function(c) {
                    b = !0,
                    h = !0,
                    i = !0,
                    a.settings.onDragStart()
                }
            }),
            d.$document.on({
                touchend: function(b) {
                    h && (a._checkPosition(),
                    a.settings.onDragEnd(),
                    h = !1)
                }
            }),
            a.$inner.scroll(function() {
                clearTimeout(j),
                j = setTimeout(function() {
                    i && (a._checkPosition(),
                    a.settings.onDragEnd(),
                    i = !1)
                }, 250)
            }),
            a.settings.mouseDrag && !b && (a.$element.addClass(d.mouseDragClass),
            a.$element.on({
                mousedown: function(b) {
                    c = !0,
                    e = b.pageX,
                    f = a.$inner.scrollLeft(),
                    "button" !== b.target.tagName.toLowerCase() && a.settings.onDragStart()
                }
            }),
            d.$document.on({
                mousemove: function(a) {
                    c && k(a)
                },
                mouseup: function(b) {
                    c && "button" !== b.target.tagName.toLowerCase() && (a._checkPosition(),
                    a.settings.onDragEnd()),
                    c = !1
                }
            }))
        }
        ,
        b.prototype._checkPosition = function() {
            var a = this
              , b = a.$inner.scrollLeft();
            a.settings.arrows && a._checkArrowState(b),
            a.settings.dots && a._checkActiveDots(b)
        }
        ,
        b.prototype._checkActiveDots = function(b) {
            for (var c = this, d = 0, e = 0, f = [b, b + c.viewportSize], g = 0; g < c.$items.length; ++g) {
                var h = a(c.$items[g])
                  , i = h.outerWidth(!0);
                e += i,
                d + i / 2 >= f[0] && e - i / 2 <= f[1] ? c.$dots.find('[data-horizon-target="' + g + '"]').addClass("active") : c.$dots.find('[data-horizon-target="' + g + '"]').removeClass("active"),
                d += i
            }
        }
        ,
        b.prototype._checkArrowState = function(a) {
            var b = this;
            a + b.viewportSize >= b.innerContainerWidth - 1 ? (b.$element.addClass(d.lastItemClass),
            b.$arrowNext.attr("disabled", "disabled"),
            b.$element.removeClass(d.firstItemClass),
            b.$arrowPrev.removeAttr("disabled")) : 0 >= a ? (b.$element.addClass(d.firstItemClass),
            b.$arrowPrev.attr("disabled", "disabled"),
            b.$element.removeClass(d.lastItemClass),
            b.$arrowNext.removeAttr("disabled")) : (b.$element.removeClass(d.lastItemClass).removeClass(d.firstItemClass),
            b.$arrowPrev.removeAttr("disabled"),
            b.$arrowNext.removeAttr("disabled"))
        }
        ,
        b
    }();
    a.fn[b] = function(c) {
        return this.each(function() {
            a.data(this, b) || a.data(this, b, new e(this,c))
        }),
        this
    }
});
(function($) {
    $(document).ready(function() {
        "use strict";
        var $body = $("body");
        $("#subscribeAlertsNewProjects").on("submit.shareListing", "form", function(e) {
            e.preventDefault();
            var $form = $(this)
              , action = $form.attr("action")
              , callbacks = {
                done: function(data) {
                    $form.removeClass("processing").find("input[type=submit]").prop("disabled", false);
                    if (data.errors !== undefined) {
                        highlightFormGroupError($form, data.errors)
                    } else {
                        $form.find(".modal-body.success").removeClass("hidden").siblings(".modal-body").hide()
                    }
                },
                fail: function(event) {
                    $form.removeClass("processing").find("input[type=submit]").prop("disabled", false);
                    if (event.responseJSON.errors !== undefined) {
                        highlightFormGroupError($form, event.responseJSON.errors)
                    }
                }
            };
            if ($form.is(".processing")) {
                return false
            }
            $form.addClass("processing").find("input[type=submit]").prop("disabled", true);
            $.post(action, $form.serialize(), callbacks.done, "json").fail(callbacks.fail);
            return false
        });
        var highlightFormGroupError = function(target, errors) {
            $.each(errors, function(index, value) {
                var error = value.error
                  , element = $(target).find(".form-control[name='" + error.field + "']");
                $(element).closest(".form-group").addClass("has-error").on("change", function() {
                    $(this).removeClass("has-error")
                })
            })
        }
    })
}
)(jQuery);
$(document).ready(function() {
    var $body = $("body");
    if (typeof guruApp.widgetGoogleAnalytics === "undefined") {
        return
    }
    var createGaDimension = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.createGaDimension;
    var track = function(category, action, label, value, noninteraction, dimensions) {
        label = cleanText(label);
        if (guruApp.widgetGoogleAnalytics.googleAnalyticsObject !== null) {
            guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent(category, action, label, value, noninteraction, dimensions)
        }
    }
      , cleanText = function(str) {
        return str.replace(/^https?:\/\/[^\/]+/, "").replace(/^\s+/, "").replace(/\s+$/, "").replace(/\s+/, " ")
    };
    var section = guruApp.developerListing.developerObject.section();
    var eventCategoryBySection;
    switch (section) {
    case "Overseas":
        eventCategoryBySection = "Oversea-";
        break;
    case "Property Review":
        eventCategoryBySection = "Content-";
        break;
    default:
        eventCategoryBySection = "NewHome-"
    }
    var listingId = guruApp.developerListing.developerObject.listingId();
    $body.off("ga.listing.details.show");
    $body.off("ga.listing.details.show-click");
    $body.on("ga.listing.details.show-click", function() {
        var categoryPrefix = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType()
          , dimensions = [createGaDimension("dimension20", '{"Link":"ReadMore"}')];
        if (categoryPrefix) {
            track(categoryPrefix + "-Engagement", "ReadMore", "Link=ReadMore", null, null, dimensions)
        }
    });
    $body.off("ga.listing.widgetMapNearby.show");
    $body.on("ga.listing.widgetMapNearby.show", function() {
        var categoryPrefix = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType()
          , dimensions = [createGaDimension("dimension20", "{'ScrollTo':'Map'}")];
        if (categoryPrefix && categoryPrefix != "Other") {
            track(categoryPrefix + "-Engagement", "Scroll", "ScrollTo=Map", null, null, dimensions)
        }
    });
    $body.off("ga.listing.share.open");
    $body.on("ga.listing.share.open", function(e, location) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Type: "General",
            Loc: location
        }))];
        track(guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType() + "-Engagement", "Share", "Type=General", null, null, dimensions)
    });
    $body.off("ga.listing.share.intent");
    $body.on("ga.listing.share.intent", function(e, location, shareThrough) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Type: shareThrough
        }))];
        track(eventCategoryBySection + "Engagement", "Share", "Type=" + shareThrough, null, null, dimensions)
    });
    $body.on("ga.dev-listing.enquire.success", function(e, form, listingId) {
        var location = form.closest("aside").length > 0 ? "RightSide" : "Bottom";
        var dimensions = [createGaDimension("dimension20", '{"Loc":"' + location + '","Type":"Email"}')];
        track(guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType() + "-Conversion", "Lead", "Type=Email", null, null, dimensions);
        $body.trigger("audiencepixel.listing.enquire.success");
        $body.trigger("leads.dev-listing.enquire.success", [listingId]);
        $body.trigger("form.setup-related-projects-enquire-form", [form]);
        $body.trigger("fbpixel.dev-listing.enquire.success", [section, form])
    });
    $body.on("ga.dev-listing.appointment.success", function(e, form, listingId) {
        track(section, "Appointment", "ID=" + listingId + ";Date=" + form.find("#appointDate").val() + ";Time=" + form.find("#appointTime").val().replace(" - ", "-") + ";Phone=" + form.find("#appointPhone").val(), 1)
    });
    $body.off("ga.listing.enquire.success");
    $body.on("ga.listing.enquire.success", function(e, form, listingId) {
        var location = form.hasClass("sidebox-enquiry") ? "RightSide" : "Bottom";
        if (section == "Property Review" && $(".project-reviews-details").length > 0) {
            location = form.closest("aside").length > 0 ? "RightSide" : "Bottom";
            listingId = $(".project-reviews-details").data("id")
        }
        var dimensions = [createGaDimension("dimension20", '{"Loc":"' + location + '","Type":"Email"}')];
        track(guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType() + "-Conversion", "Lead", "Type=Email", null, null, dimensions);
        $body.trigger("leads.dev-listing.enquire.success", [listingId])
    });
    $body.on("ga.dev-listing.enquirerelatedproject.success", function(e, form, listingIds) {
        $.each(listingIds, function(i, listingId) {
            var dimensions = [createGaDimension("dimension20", '{"Loc":"PopUp","Type":"MultiEmail"}')];
            track(guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType() + "-Conversion", "Lead", "Type=Email", null, null, dimensions);
            $body.trigger("fbpixel.dev-listing.enquirerelatedproject.success", [i, form, section, listingId])
        })
    });
    $(".overseas-page .btn.btn-primary").click(function() {
        track("Overseas Listing", "Enquiry", "Listing Detail", 1)
    });
    $(".newprojects-page .btn.btn-primary").click(function() {
        track("New Home Listing", "Enquiry", "Listing Detail", 1)
    });
    $(".listing-overseas").on("click.ga", "a.btn-agent-contact-mail", function(e) {
        e.stopPropagation();
        var dimensions = [createGaDimension("dimension20", '{"Loc":"SearchResult","Type":"Email"}')];
        track("Oversea-Conversion", "Lead", "Type=Email", null, null, dimensions)
    });
    $(".listing").on("click.ga", "a.btn-agent-contact-mail", function(e) {
        e.stopPropagation();
        var dimensions = [createGaDimension("dimension20", '{"Loc":"SearchResult","Type":"Email"}')];
        track("NewHome-Conversion", "Lead", "Type=Email", null, null, dimensions)
    });
    $body.on("ga.listing.details.sale.gallery.click", function(e, listingId) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Loc: "SalesGallery",
            Type: "ViewPhone"
        }))];
        track("NewHome-Conversion", "Lead", "Type=ViewPhone", 1, null, dimensions)
    });
    $body.off("ga.search.form.submit.main");
    $body.on("ga.search.form.submit.main", function() {
        if ($body.hasClass("listing-overseas")) {
            localStorage.setItem("overseaSearchType", "Refined")
        } else {
            localStorage.setItem("overseaSearchType", "Search")
        }
        var overseaUniqueSearchId = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getUuid();
        localStorage.setItem("overseaUniqueSearchId", overseaUniqueSearchId)
    });
    $body.on("ga.search.form.submit.browse-all", function() {
        track(section, "Search", "Browse All Button")
    });
    $body.on("ga.search.form.submit.parameter", function(e, type, value) {
        track(section, "Search", "Search Parameter " + type + " " + value)
    });
    $body.on("ga.search.form.submit.freetext", function(e, type, value) {
        track(section, "Search", "Search Freetext " + type + " " + value)
    });
    $body.on("ga.search.singleline.submit", function() {
        if (!$(".newprojects-page.landing-page").length && $("html.listing").length) {
            localStorage.setItem("newHomeSearchType", "Refined")
        } else {
            localStorage.setItem("newHomeSearchType", "Search")
        }
        var newHomeUniqueSearchId = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getUuid();
        localStorage.setItem("newHomeUniqueSearchId", newHomeUniqueSearchId)
    });
    $body.on("ga.featured.listing.slide", function(e, position) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Loc: "Thumbnail",
            Position: position
        }))];
        track(eventCategoryBySection + "Engagement", "Navigate", "Loc=Thumbnail", null, null, dimensions)
    });
    $body.on("ga.featured.listing.open", function(e, location, position) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            Loc: location,
            Position: position
        }))];
        track(eventCategoryBySection + "Engagement", "Navigate", "Loc=" + location, null, null, dimensions)
    });
    $body.on("ga.property-review.toggle-section", function(e, action, position) {
        if (section == "Property Review") {
            var labelStatus = "Toggle" + (action == "Collapse" ? "Off" : "On")
              , dimensionObject = {};
            dimensionObject[labelStatus] = position;
            var dimensions = [createGaDimension("dimension20", JSON.stringify(dimensionObject))];
            track("Content-Engagement", "Toggle", labelStatus + "=" + position, null, null, dimensions)
        }
    });
    $body.on("ga.property-review.show-more-section", function(e, position) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            More: position
        }))];
        track("Content-Engagement", "ReadMore", "More=" + position, null, null, dimensions)
    });
    $body.on("ga.property-review.section.show", function(e, position) {
        var dimensions = [createGaDimension("dimension20", JSON.stringify({
            ScrollTo: position
        }))];
        track(eventCategoryBySection + "Engagement", "Scroll", "ScrollTo=" + position, null, null, dimensions)
    });
    $body.on("ga.dev-listing.phone.click", function(e, position) {
        var dimensions = [createGaDimension("dimension20", '{"Loc":"' + position + '","Type":"Call"}')];
        track(guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getProductType() + "-Conversion", "Lead", "Type=Call", null, null, dimensions);
        if (section !== "Overseas") {
            track(section, "Leads Generating", "Calling phone number", 1)
        }
        $body.trigger("fbpixel.dev-listing.phone.click", [position, section])
    });
    if (listingId !== undefined) {
        $("a.btn-agent-contact-mail").on("click", function() {
            track("Leads Generating", "Enquiry Intent", "Side", 1)
        })
    }
    var searchNewHomeGaEvent = {
        payLoad: {},
        params: getSearchParams(),
        referrer: "",
        searchType: "",
        uniqueSearchId: "",
        init: function() {
            this.payLoad.SearchId = this.getUniqueSearchId();
            this.referrer = document.referrer ? document.referrer.split("?")[0] : "";
            this.payLoad.Page = this.referrer;
            this.payLoad.Types = "All";
            this.searchType = localStorage.getItem("newHomeSearchType");
            if (this.searchType) {
                this.payLoad.SearchType = this.searchType.ucfirst();
                localStorage.removeItem("newHomeSearchType");
                this.populatePropertyTypes();
                this.populatePayLoad();
                this.populateStartingPrice()
            }
        },
        getUniqueSearchId: function() {
            this.uniqueSearchId = localStorage.getItem("newHomeUniqueSearchId");
            if (!this.uniqueSearchId) {
                this.uniqueSearchId = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getUuid();
                localStorage.setItem("newHomeUniqueSearchId", this.uniqueSearchId)
            }
            return this.uniqueSearchId
        },
        populatePropertyTypes: function() {
            if (typeof this.params["propertytype"] !== "undefined" && this.params["propertytype"]) {
                this.payLoad.Types = this.params["propertytype"]
            }
        },
        populatePayLoad: function() {
            for (var param in this.params) {
                var payLoadValue = this.params[param];
                switch (param) {
                case "regioncode":
                    this.payLoad.Region = payLoadValue;
                    break;
                case "district_code":
                case "districtcode":
                    this.payLoad.District = payLoadValue;
                    break;
                case "hasreview":
                    this.payLoad.ProjectWithReview = payLoadValue;
                    break;
                case "topyear":
                    this.payLoad.CompletionYear = payLoadValue;
                    break;
                case "freetext":
                    this.payLoad.FreeText = payLoadValue;
                    break
                }
            }
        },
        populateStartingPrice: function() {
            if (typeof this.params.startingpricemin !== "undefined" && typeof this.params.startingpricemax !== "undefined") {
                this.payLoad.StartingPriceMin = this.params.startingpricemin;
                this.payLoad.StartingPriceMax = this.params.startingpricemax
            } else if (typeof this.params.startingprice !== "undefined") {
                this.payLoad.StartingPriceMin = payLoadValue
            }
        },
        send: function() {
            if (this.payLoad.SearchType && this.payLoad.SearchType != "Undefined") {
                track("NewHome-Core", "Search", JSON.stringify(this.payLoad))
            }
        }
    };
    if (typeof guruApp.widgetGoogleAnalytics.dimensions.dimension2 !== "undefined" && guruApp.widgetGoogleAnalytics.dimensions.dimension2 == "New Projects Search") {
        searchNewHomeGaEvent.init();
        searchNewHomeGaEvent.send()
    }
    var searchOverseaGaEvent = {
        payLoad: {},
        params: getSearchParams(),
        referrer: "",
        searchType: "",
        uniqueSearchId: "",
        init: function() {
            this.payLoad.SearchId = this.getUniqueSearchId();
            this.referrer = document.referrer ? document.referrer.split("?")[0] : "";
            this.payLoad.Page = this.referrer;
            this.payLoad.Types = "All";
            this.payLoad.Country = "All";
            this.searchType = localStorage.getItem("overseaSearchType");
            if (this.searchType) {
                this.payLoad.SearchType = this.searchType.ucfirst();
                localStorage.removeItem("overseaSearchType");
                this.populatePayLoad()
            }
        },
        getUniqueSearchId: function() {
            this.uniqueSearchId = localStorage.getItem("overseaUniqueSearchId");
            if (!this.uniqueSearchId) {
                this.uniqueSearchId = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.getUuid();
                localStorage.setItem("overseaUniqueSearchId", this.uniqueSearchId)
            }
            return this.uniqueSearchId
        },
        populatePayLoad: function() {
            for (var param in this.params) {
                var payLoadValue = this.params[param];
                switch (param) {
                case "countrycode":
                    this.payLoad.Country = payLoadValue;
                    break;
                case "propertytype":
                    this.payLoad.Types = payLoadValue;
                    break;
                case "topyear":
                    this.payLoad.CompletionYear = payLoadValue;
                    break
                }
            }
        },
        send: function() {
            if (this.payLoad.SearchType && this.payLoad.SearchType != "Undefined") {
                track("Oversea-Core", "Search", JSON.stringify(this.payLoad))
            }
        }
    };
    if (typeof guruApp.widgetGoogleAnalytics.dimensions.dimension2 !== "undefined" && guruApp.widgetGoogleAnalytics.dimensions.dimension2 == "Overseas Search") {
        searchOverseaGaEvent.init();
        searchOverseaGaEvent.send()
    }
});
var adsBetween = {
    init: function() {
        if ($("body.app-sg").length > 0) {
            var position = [{
                position: "3",
                ads: "spotlight1"
            }, {
                position: "7",
                ads: "spotlight2"
            }];
            adsBetween.setAdsBetween(position)
        }
    },
    setAdsBetween: function(position) {
        if ($(".listing-item").size() > 0) {
            $.each(position, function(i, v) {
                if ($("li.listing-item:eq(" + v.position + ")").length > 0) {
                    $("li.listing-item:eq(" + v.position + ")").before($(".ads-between[data-info=" + v.ads + "]"))
                }
                $(".ads-between[data-info=" + v.ads + "]").removeClass("hide")
            })
        }
    },
    setAdsPosition: function() {
        if (!guruApp.client.is_mobile || $(".listing_detail").length > 0) {
            return
        }
        $.each([".explore-box", ".img-banner"], function(index, selector) {
            screenSizeDetect.ele = $(selector);
            screenSizeDetect.mappingDevice(0, 767, "position-change");
            screenSizeDetect.mappingDevice(768, 1024, "position-remain");
            if ($(selector).length > 0 && $(selector).hasClass("position-change")) {
                $(selector).appendTo(".main-content:last")
            }
        })
    }
};
var screenSizeDetect = {
    ele: null,
    mappingDevice: function(min, max, className) {
        var width = $(window).width();
        if (width >= min && width <= max) {
            screenSizeDetect.ele.addClass(className)
        }
    }
};
function removeElem(elem, count) {
    if (elem.css("display") == "none" || elem.hasClass("loading")) {
        elem.parent().remove();
        count--
    }
    return count
}
function addListIndicator(count, collection, indicator) {
    if (count <= 1) {
        indicator.remove();
        if (count == 1) {
            collection.parent().first().show().addClass("active")
        }
    } else {
        indicator.removeClass("hide");
        for (var i = 0; i < count; i++) {
            indicator.append('<li data-target="#adsCarousel" data-slide-to="' + i + '"></li>')
        }
        indicator.find("li:first").addClass("active");
        collection.parent().first().addClass("active");
        $("#adsCarousel").attr("data-ride", "carousel");
        $("#adsCarousel").carousel()
    }
}
$(document).ready(function() {
    $(window).on("createGoogleAdsCarouselIndicator", function() {
        var section = $(".large-banner")
          , adsCollection = section.find("div.ads-dfp")
          , adsIndicator = section.find(".ads-indicator")
          , count = adsCollection.size();
        setTimeout(function() {
            adsCollection.each(function() {
                count = removeElem($(this), count)
            });
            addListIndicator(count, adsCollection, adsIndicator)
        }, 1e3);
        (function() {
            adsBetween.init()
        }
        )();
        adsBetween.setAdsPosition()
    })
});
(function($) {
    $(document).ready(function() {
        "use strict";
        var $body = $("body");
        var $form = $("form.related-projects-enquire-form");
        var $submitedForm = null;
        $body.on("form.setup-related-projects-enquire-form", function(e, form) {
            $submitedForm = form
        });
        $form.on("submit.related-projects-enquire-form", function(e) {
            e.preventDefault();
            var $form = $(this)
              , action = $form.data("action")
              , callbacks = {
                done: function(R) {
                    trackingEvent($form);
                    $form.removeClass("processing").find("input[type=submit]").prop("disabled", false);
                    $(".modal-header", $form).hide();
                    $("#related-projects-enquire-content .listing-card").each(function() {
                        if ($("input[name='id[]']", $(this)).prop("checked") == false) {
                            $(this).closest(".col-xs-4").hide()
                        }
                    });
                    $(".alert-success", $form).show().removeClass("hide").siblings().hide()
                },
                fail: function(R) {
                    if (R.responseJSON) {
                        alert(R.responseJSON.message)
                    } else if (R.responseText) {
                        alert(R.responseText)
                    } else {
                        alert("Unknown error!")
                    }
                    $form.removeClass("processing").find("input[type=submit]").prop("disabled", false)
                }
            };
            if ($form.is(".processing")) {
                return false
            }
            if ($("input[name='id[]']:checked", $form).length == 0) {
                alert($form.data("please-select"));
                return false
            }
            $form.addClass("processing").find("input[type=submit]").prop("disabled", true);
            var $data = $form.serialize()
              , agentForm = "";
            $.each($submitedForm, function() {
                if ($(this).hasClass("enquiry-submitted")) {
                    agentForm = $(this).serialize()
                }
            });
            $data = $data + "&" + agentForm;
            $.post(action, $data, callbacks.done, "json").fail(callbacks.fail);
            return false
        });
        var trackingEvent = function(form) {
            var listingIds = [];
            $("input[name='id[]']:checked", form).each(function() {
                var val = $(this).val();
                if (val) {
                    listingIds.push(val)
                }
            });
            form.trigger("ga.dev-listing.enquirerelatedproject.success", [form, listingIds]);
            form.trigger("leads.dev-listing.enquire-related-project.success", [listingIds])
        }
    })
}
)(jQuery);
function virtualTourloading(state) {
    if (state) {
        var height = $("#listing.container").height();
        $(".virtualtours-loading").height(height);
        $(".virtualtours-loading").width($("#listing.container").width());
        $(".virtualtours-loading-img").css({
            "margin-top": (height + $(".virtualtours-loading-img").height()) / 2 + "px"
        });
        $(".virtualtours-loading").removeClass("hide")
    } else {
        $(".virtualtours-loading").addClass("hide")
    }
}
function updatePagination(pagination) {
    $(".listing-pagination").html(pagination)
}
function updatePaggination(basePath, page) {
    page = parseInt(page);
    var firstPage = parseInt($(".pagination li:not('.pagination-back'):first").text());
    var lastPage = parseInt($(".pagination li:not('.pagination-next'):last").text());
    $(".pagination li.pagination-back").removeClass("disabled");
    $(".pagination li.pagination-next").removeClass("disabled");
    var backNav = $(".pagination li.pagination-back");
    var nextNav = $(".pagination li.pagination-next");
    if (firstPage == page) {
        backNav.addClass("disabled").html("<span>" + backNav.text() + "</span>")
    } else {
        backNav.removeClass("disabled").html("<a>" + backNav.text() + "</a>")
    }
    if (lastPage == page) {
        nextNav.addClass("disabled").html("<span>" + nextNav.text() + "</span>")
    } else {
        nextNav.removeClass("disabled").html("<a>" + nextNav.text() + "</a>")
    }
    $(".pagination li.pagination-back a").attr("href", basePath + "#!/" + parseInt(page - 1));
    $(".pagination li.pagination-next a").attr("href", basePath + "#!/" + parseInt(page + 1));
    $(".listing-pagination li").each(function() {
        if ($(this).text() == page) {
            $(this).addClass("active");
            $(this).siblings("li").removeClass("active")
        }
    })
}
(function(angular) {
    "use strict";
    var $virtualTourPage = $("body.virtual-tour");
    $(".virtual-tour .pagination li").click(function(event) {
        event.stopPropagation();
        if ($(".virtualtours-items:last li.virtualtours-item").length > 0) {
            $(".virtualtours-items:first").html($(".virtualtours-items:last").html())
        }
    });
    if ($("#carousel-virtual-tours").length > 0) {
        $("#carousel-virtual-tours .cycle-control").click(function(event) {
            event.preventDefault()
        });
        $("#carousel-virtual-tours .cycle-control.cycle-next").click(function(event) {
            $("#carousel-virtual-tours .cycle-slideshow").cycle("next")
        });
        $("#carousel-virtual-tours .cycle-control.cycle-prev").click(function(event) {
            $("#carousel-virtual-tours .cycle-slideshow").cycle("prev")
        });
        $("#carousel-virtual-tours .item .fl-img").click(function(event) {
            var $item = $(this).closest(".item");
            $(".item-div", $item).html($item.data("player"))
        })
    }
    if ($virtualTourPage.length > 0) {
        var virtualtourApp = angular.module("virtualtourApp", ["ngRoute", "virtualtourControllers"]);
        virtualtourApp.config(function($interpolateProvider) {
            $interpolateProvider.startSymbol("{[{").endSymbol("}]}")
        });
        virtualtourApp.config(["$routeProvider", "$locationProvider", function($routeProvider, $locationProvider) {
            $locationProvider.hashPrefix("!");
            $routeProvider.when("/", {
                templateUrl: "/sf2-developer/partials/virtual-tour-list.html",
                controller: "VirtualTourRootCtrl"
            }).when("/:page", {
                templateUrl: "/sf2-developer/partials/virtual-tour-list.html",
                controller: "VirtualTourCtrl"
            }).otherwise({
                redirectTo: ""
            })
        }
        ]);
        var virtualtourControllers = angular.module("virtualtourControllers", []);
        virtualtourControllers.controller("VirtualTourCtrl", ["$scope", "$http", "$routeParams", function($scope, $http, $routeParams) {
            $(".virtualtours-items:first").removeClass("hide");
            var page = 1;
            $scope.init = function(basePath, url) {
                $scope.basePath = basePath;
                $scope.url = url
            }
            ;
            $scope.listings = [];
            if ($routeParams.page !== undefined) {
                page = $routeParams.page
            }
            var url = $scope.url + "/" + page;
            virtualTourloading(true);
            if ($scope.url !== undefined) {
                $http.get(url).success(function(data) {
                    $scope.listings = data.listings;
                    $(".virtualtours-items:first").addClass("hide");
                    virtualTourloading(false);
                    updatePagination(data.richPagination)
                })
            }
        }
        ]);
        virtualtourControllers.controller("VirtualTourRootCtrl", ["$scope", "$http", "$routeParams", function($scope, $http, $routeParams) {
            virtualTourloading(false)
        }
        ]);
        virtualtourControllers.directive("ngLazyImg", function() {
            return {
                restrict: "C",
                link: function(scope, element) {
                    element.lazyload({
                        effect: "fadeIn",
                        failure_limit: element.length,
                        skip_invisible: false,
                        load: function() {
                            var $img = $(this);
                            $img.removeClass("lazy")
                        }
                    })
                }
            }
        })
    }
}
)(window.angular);
$(function() {
    var $body = $("body.listing_detail");
    if ($body.length) {
        $(".modal").appendTo("body");
        $(".js-developer-phone-number-call").on("click", function() {
            var listingId = guruApp.developerListing.developerObject.listingId();
            $(this).trigger("ga.dev-listing.phone.click", ["Bottom"]);
            $(this).trigger("leads.dev-listing.call-responsive", [listingId])
        });
        if (3492650 == guruApp.developerListing.developerObject.listingId()) {
            $("head").append('<script type="text/javascript" src="https://d3eaoagkr70p1.cloudfront.net/516e03ed-fzuZN/track.js"><\/script>')
        }
    }
});
!function(a) {
    "function" == typeof define && define.amd ? define(["inputmask.dependencyLib"], a) : "object" == typeof exports ? module.exports = a(require("./inputmask.dependencyLib.jquery")) : a(window.dependencyLib || jQuery)
}(function(a) {
    function b(c, d) {
        return this instanceof b ? (a.isPlainObject(c) ? d = c : (d = d || {},
        d.alias = c),
        this.el = void 0,
        this.opts = a.extend(!0, {}, this.defaults, d),
        this.noMasksCache = d && void 0 !== d.definitions,
        this.userOptions = d || {},
        this.events = {},
        void e(this.opts.alias, d, this.opts)) : new b(c,d)
    }
    function c(a) {
        var b = document.createElement("input")
          , c = "on" + a
          , d = c in b;
        return d || (b.setAttribute(c, "return;"),
        d = "function" == typeof b[c]),
        b = null,
        d
    }
    function d(b, c) {
        var d = b.getAttribute("type")
          , e = "INPUT" === b.tagName && -1 !== a.inArray(d, c.supportsInputType) || b.isContentEditable || "TEXTAREA" === b.tagName;
        if (!e && "INPUT" === b.tagName) {
            var f = document.createElement("input");
            f.setAttribute("type", d),
            e = "text" === f.type,
            f = null
        }
        return e
    }
    function e(b, c, d) {
        var f = d.aliases[b];
        return f ? (f.alias && e(f.alias, void 0, d),
        a.extend(!0, d, f),
        a.extend(!0, d, c),
        !0) : (null === d.mask && (d.mask = b),
        !1)
    }
    function f(b, c, d) {
        function f(a, c) {
            c = void 0 !== c ? c : b.getAttribute("data-inputmask-" + a),
            null !== c && ("string" == typeof c && (0 === a.indexOf("on") ? c = window[c] : "false" === c ? c = !1 : "true" === c && (c = !0)),
            d[a] = c)
        }
        var g, h, i, j, k = b.getAttribute("data-inputmask");
        if (k && "" !== k && (k = k.replace(new RegExp("'","g"), '"'),
        h = JSON.parse("{" + k + "}")),
        h) {
            i = void 0;
            for (j in h)
                if ("alias" === j.toLowerCase()) {
                    i = h[j];
                    break
                }
        }
        f("alias", i),
        d.alias && e(d.alias, d, c);
        for (g in c) {
            if (h) {
                i = void 0;
                for (j in h)
                    if (j.toLowerCase() === g.toLowerCase()) {
                        i = h[j];
                        break
                    }
            }
            f(g, i)
        }
        return a.extend(!0, c, d),
        c
    }
    function g(c, d) {
        function e(b) {
            function d(a, b, c, d) {
                this.matches = [],
                this.isGroup = a || !1,
                this.isOptional = b || !1,
                this.isQuantifier = c || !1,
                this.isAlternator = d || !1,
                this.quantifier = {
                    min: 1,
                    max: 1
                }
            }
            function e(b, d, e) {
                var f = c.definitions[d];
                e = void 0 !== e ? e : b.matches.length;
                var g = b.matches[e - 1];
                if (f && !r) {
                    f.placeholder = a.isFunction(f.placeholder) ? f.placeholder(c) : f.placeholder;
                    for (var h = f.prevalidator, i = h ? h.length : 0, j = 1; j < f.cardinality; j++) {
                        var k = i >= j ? h[j - 1] : []
                          , l = k.validator
                          , m = k.cardinality;
                        b.matches.splice(e++, 0, {
                            fn: l ? "string" == typeof l ? new RegExp(l) : new function() {
                                this.test = l
                            }
                            : new RegExp("."),
                            cardinality: m ? m : 1,
                            optionality: b.isOptional,
                            newBlockMarker: void 0 === g || g.def !== (f.definitionSymbol || d),
                            casing: f.casing,
                            def: f.definitionSymbol || d,
                            placeholder: f.placeholder,
                            mask: d
                        }),
                        g = b.matches[e - 1]
                    }
                    b.matches.splice(e++, 0, {
                        fn: f.validator ? "string" == typeof f.validator ? new RegExp(f.validator) : new function() {
                            this.test = f.validator
                        }
                        : new RegExp("."),
                        cardinality: f.cardinality,
                        optionality: b.isOptional,
                        newBlockMarker: void 0 === g || g.def !== (f.definitionSymbol || d),
                        casing: f.casing,
                        def: f.definitionSymbol || d,
                        placeholder: f.placeholder,
                        mask: d
                    })
                } else
                    b.matches.splice(e++, 0, {
                        fn: null,
                        cardinality: 0,
                        optionality: b.isOptional,
                        newBlockMarker: void 0 === g || g.def !== d,
                        casing: null,
                        def: c.staticDefinitionSymbol || d,
                        placeholder: void 0 !== c.staticDefinitionSymbol ? d : void 0,
                        mask: d
                    }),
                    r = !1
            }
            function f(a, b) {
                a.isGroup && (a.isGroup = !1,
                e(a, c.groupmarker.start, 0),
                b !== !0 && e(a, c.groupmarker.end))
            }
            function g(a, b, c, d) {
                b.matches.length > 0 && (void 0 === d || d) && (c = b.matches[b.matches.length - 1],
                f(c)),
                e(b, a)
            }
            function h() {
                if (t.length > 0) {
                    if (m = t[t.length - 1],
                    g(k, m, o, !m.isAlternator),
                    m.isAlternator) {
                        n = t.pop();
                        for (var a = 0; a < n.matches.length; a++)
                            n.matches[a].isGroup = !1;
                        t.length > 0 ? (m = t[t.length - 1],
                        m.matches.push(n)) : s.matches.push(n)
                    }
                } else
                    g(k, s, o)
            }
            function i(a) {
                function b(a) {
                    return a === c.optionalmarker.start ? a = c.optionalmarker.end : a === c.optionalmarker.end ? a = c.optionalmarker.start : a === c.groupmarker.start ? a = c.groupmarker.end : a === c.groupmarker.end && (a = c.groupmarker.start),
                    a
                }
                a.matches = a.matches.reverse();
                for (var d in a.matches) {
                    var e = parseInt(d);
                    if (a.matches[d].isQuantifier && a.matches[e + 1] && a.matches[e + 1].isGroup) {
                        var f = a.matches[d];
                        a.matches.splice(d, 1),
                        a.matches.splice(e + 1, 0, f)
                    }
                    void 0 !== a.matches[d].matches ? a.matches[d] = i(a.matches[d]) : a.matches[d] = b(a.matches[d])
                }
                return a
            }
            for (var j, k, l, m, n, o, p, q = /(?:[?*+]|\{[0-9\+\*]+(?:,[0-9\+\*]*)?\})|[^.?*+^${[]()|\\]+|./g, r = !1, s = new d, t = [], u = []; j = q.exec(b); )
                if (k = j[0],
                r)
                    h();
                else
                    switch (k.charAt(0)) {
                    case c.escapeChar:
                        r = !0;
                        break;
                    case c.optionalmarker.end:
                    case c.groupmarker.end:
                        if (l = t.pop(),
                        void 0 !== l)
                            if (t.length > 0) {
                                if (m = t[t.length - 1],
                                m.matches.push(l),
                                m.isAlternator) {
                                    n = t.pop();
                                    for (var v = 0; v < n.matches.length; v++)
                                        n.matches[v].isGroup = !1;
                                    t.length > 0 ? (m = t[t.length - 1],
                                    m.matches.push(n)) : s.matches.push(n)
                                }
                            } else
                                s.matches.push(l);
                        else
                            h();
                        break;
                    case c.optionalmarker.start:
                        t.push(new d(!1,!0));
                        break;
                    case c.groupmarker.start:
                        t.push(new d(!0));
                        break;
                    case c.quantifiermarker.start:
                        var w = new d(!1,!1,!0);
                        k = k.replace(/[{}]/g, "");
                        var x = k.split(",")
                          , y = isNaN(x[0]) ? x[0] : parseInt(x[0])
                          , z = 1 === x.length ? y : isNaN(x[1]) ? x[1] : parseInt(x[1]);
                        if (("*" === z || "+" === z) && (y = "*" === z ? 0 : 1),
                        w.quantifier = {
                            min: y,
                            max: z
                        },
                        t.length > 0) {
                            var A = t[t.length - 1].matches;
                            j = A.pop(),
                            j.isGroup || (p = new d(!0),
                            p.matches.push(j),
                            j = p),
                            A.push(j),
                            A.push(w)
                        } else
                            j = s.matches.pop(),
                            j.isGroup || (p = new d(!0),
                            p.matches.push(j),
                            j = p),
                            s.matches.push(j),
                            s.matches.push(w);
                        break;
                    case c.alternatormarker:
                        t.length > 0 ? (m = t[t.length - 1],
                        o = m.matches.pop()) : o = s.matches.pop(),
                        o.isAlternator ? t.push(o) : (n = new d(!1,!1,!1,!0),
                        n.matches.push(o),
                        t.push(n));
                        break;
                    default:
                        h()
                    }
            for (; t.length > 0; )
                l = t.pop(),
                f(l, !0),
                s.matches.push(l);
            return s.matches.length > 0 && (o = s.matches[s.matches.length - 1],
            f(o),
            u.push(s)),
            c.numericInput && i(u[0]),
            u
        }
        function f(f, g) {
            if (null === f || "" === f)
                return void 0;
            if (1 === f.length && c.greedy === !1 && 0 !== c.repeat && (c.placeholder = ""),
            c.repeat > 0 || "*" === c.repeat || "+" === c.repeat) {
                var h = "*" === c.repeat ? 0 : "+" === c.repeat ? 1 : c.repeat;
                f = c.groupmarker.start + f + c.groupmarker.end + c.quantifiermarker.start + h + "," + c.repeat + c.quantifiermarker.end
            }
            var i;
            return void 0 === b.prototype.masksCache[f] || d === !0 ? (i = {
                mask: f,
                maskToken: e(f),
                validPositions: {},
                _buffer: void 0,
                buffer: void 0,
                tests: {},
                metadata: g
            },
            d !== !0 && (b.prototype.masksCache[c.numericInput ? f.split("").reverse().join("") : f] = i,
            i = a.extend(!0, {}, b.prototype.masksCache[c.numericInput ? f.split("").reverse().join("") : f]))) : i = a.extend(!0, {}, b.prototype.masksCache[c.numericInput ? f.split("").reverse().join("") : f]),
            i
        }
        function g(a) {
            return a = a.toString()
        }
        var h;
        if (a.isFunction(c.mask) && (c.mask = c.mask(c)),
        a.isArray(c.mask)) {
            if (c.mask.length > 1) {
                c.keepStatic = null === c.keepStatic ? !0 : c.keepStatic;
                var i = "(";
                return a.each(c.numericInput ? c.mask.reverse() : c.mask, function(b, c) {
                    i.length > 1 && (i += ")|("),
                    i += g(void 0 === c.mask || a.isFunction(c.mask) ? c : c.mask)
                }),
                i += ")",
                f(i, c.mask)
            }
            c.mask = c.mask.pop()
        }
        return c.mask && (h = void 0 === c.mask.mask || a.isFunction(c.mask.mask) ? f(g(c.mask), c.mask) : f(g(c.mask.mask), c.mask)),
        h
    }
    function h(e, f, g) {
        function i(a, b, c) {
            b = b || 0;
            var d, e, f, h = [], i = 0, j = o();
            ga = void 0 !== ea ? ea.maxLength : void 0,
            -1 === ga && (ga = void 0);
            do {
                if (a === !0 && m().validPositions[i]) {
                    var k = m().validPositions[i];
                    e = k.match,
                    d = k.locator.slice(),
                    h.push(c === !0 ? k.input : H(i, e))
                } else
                    f = r(i, d, i - 1),
                    e = f.match,
                    d = f.locator.slice(),
                    (g.jitMasking === !1 || j > i || isFinite(g.jitMasking) && g.jitMasking > i) && h.push(H(i, e));
                i++
            } while ((void 0 === ga || ga > i) && (null !== e.fn || "" !== e.def) || b > i);return "" === h[h.length - 1] && h.pop(),
            m().maskLength = i + 1,
            h
        }
        function m() {
            return f
        }
        function n(a) {
            var b = m();
            b.buffer = void 0,
            a !== !0 && (b.tests = {},
            b._buffer = void 0,
            b.validPositions = {},
            b.p = 0)
        }
        function o(a, b, c) {
            var d = -1
              , e = -1
              , f = c || m().validPositions;
            void 0 === a && (a = -1);
            for (var g in f) {
                var h = parseInt(g);
                f[h] && (b || null !== f[h].match.fn) && (a >= h && (d = h),
                h >= a && (e = h))
            }
            return -1 !== d && a - d > 1 || a > e ? d : e
        }
        function p(b, c, d, e) {
            if (e || g.insertMode && void 0 !== m().validPositions[b] && void 0 === d) {
                var f, h = a.extend(!0, {}, m().validPositions), i = o();
                for (f = b; i >= f; f++)
                    delete m().validPositions[f];
                m().validPositions[b] = c;
                var j, k = !0, l = m().validPositions, p = !1;
                for (f = j = b; i >= f; f++) {
                    var q = h[f];
                    if (void 0 !== q)
                        for (var r = j, s = -1; r < m().maskLength && (null == q.match.fn && l[f] && (l[f].match.optionalQuantifier === !0 || l[f].match.optionality === !0) || null != q.match.fn); ) {
                            if (null === q.match.fn || !g.keepStatic && l[f] && (void 0 !== l[f + 1] && v(f + 1, l[f].locator.slice(), f).length > 1 || void 0 !== l[f].alternation) ? r++ : r = D(j),
                            p === !1 && h[r] && h[r].match.def === q.match.def) {
                                m().validPositions[r] = a.extend(!0, {}, h[r]),
                                m().validPositions[r].input = q.input,
                                j = r,
                                k = !0;
                                break
                            }
                            if (t(r, q.match.def)) {
                                var u = B(r, q.input, !0, !0);
                                if (k = u !== !1,
                                j = u.caret || u.insert ? o() : r,
                                p = !0,
                                k)
                                    break
                            } else {
                                if (k = null == q.match.fn,
                                s === r)
                                    break;
                                s = r
                            }
                        }
                    if (!k)
                        break
                }
                if (!k)
                    return m().validPositions = a.extend(!0, {}, h),
                    n(!0),
                    !1
            } else
                m().validPositions[b] = c;
            return n(!0),
            !0
        }
        function q(b, c, d, e) {
            function f(a) {
                var b = m().validPositions[a];
                if (void 0 !== b && null === b.match.fn) {
                    var c = m().validPositions[a - 1]
                      , d = m().validPositions[a + 1];
                    return void 0 !== c && void 0 !== d
                }
                return !1
            }
            var h, i = b, j = a.extend(!0, {}, m().validPositions), k = !1;
            for (m().p = b,
            h = c - 1; h >= i; h--)
                void 0 !== m().validPositions[h] && (d === !0 || !f(h) && g.canClearPosition(m(), h, o(), e, g) !== !1) && delete m().validPositions[h];
            for (n(!0),
            h = i + 1; h <= o(); ) {
                for (; void 0 !== m().validPositions[i]; )
                    i++;
                var l = m().validPositions[i];
                if (i > h && (h = i + 1),
                void 0 === m().validPositions[h] && C(h) || void 0 !== l)
                    h++;
                else {
                    var p = r(h);
                    k === !1 && j[i] && j[i].match.def === p.match.def ? (m().validPositions[i] = a.extend(!0, {}, j[i]),
                    m().validPositions[i].input = p.input,
                    delete m().validPositions[h],
                    h++) : t(i, p.match.def) ? B(i, p.input || H(h), !0) !== !1 && (delete m().validPositions[h],
                    h++,
                    k = !0) : C(h) || (h++,
                    i--),
                    i++
                }
            }
            n(!0)
        }
        function r(a, b, c) {
            var d = m().validPositions[a];
            if (void 0 === d)
                for (var e = v(a, b ? b.slice() : b, c), f = o(), h = m().validPositions[f] || v(0)[0], i = void 0 !== h.alternation ? h.locator[h.alternation].toString().split(",") : [], j = 0; j < e.length && (d = e[j],
                !(d.match && (g.greedy && d.match.optionalQuantifier !== !0 || (d.match.optionality === !1 || d.match.newBlockMarker === !1) && d.match.optionalQuantifier !== !0) && (void 0 === h.alternation || h.alternation !== d.alternation || void 0 !== d.locator[h.alternation] && A(d.locator[h.alternation].toString().split(","), i)))); j++)
                    ;
            return d
        }
        function s(a) {
            return m().validPositions[a] ? m().validPositions[a].match : v(a)[0].match
        }
        function t(a, b) {
            for (var c = !1, d = v(a), e = 0; e < d.length; e++)
                if (d[e].match && d[e].match.def === b) {
                    c = !0;
                    break
                }
            return c
        }
        function u(b, c) {
            var d, e;
            return (m().tests[b] || m().validPositions[b]) && a.each(m().tests[b] || [m().validPositions[b]], function(a, b) {
                var f = b.alternation ? b.locator[b.alternation].toString().indexOf(c) : -1;
                (void 0 === e || e > f) && -1 !== f && (d = b,
                e = f)
            }),
            d
        }
        function v(b, c, d) {
            function e(c, d, f, g) {
                function i(f, g, k) {
                    function p(b, c) {
                        var d = 0 === a.inArray(b, c.matches);
                        return d || a.each(c.matches, function(a, e) {
                            return e.isQuantifier === !0 && (d = p(b, c.matches[a - 1])) ? !1 : void 0
                        }),
                        d
                    }
                    function q(a, b) {
                        var c = u(a, b);
                        return c ? c.locator.slice(c.alternation + 1) : []
                    }
                    if (j > 1e4)
                        throw "Inputmask: There is probably an error in your mask definition or in the code. Create an issue on github with an example of the mask you are using. " + m().mask;
                    if (j === b && void 0 === f.matches)
                        return l.push({
                            match: f,
                            locator: g.reverse(),
                            cd: o
                        }),
                        !0;
                    if (void 0 !== f.matches) {
                        if (f.isGroup && k !== f) {
                            if (f = i(c.matches[a.inArray(f, c.matches) + 1], g))
                                return !0
                        } else if (f.isOptional) {
                            var r = f;
                            if (f = e(f, d, g, k)) {
                                if (h = l[l.length - 1].match,
                                !p(h, r))
                                    return !0;
                                n = !0,
                                j = b
                            }
                        } else if (f.isAlternator) {
                            var s, t = f, v = [], w = l.slice(), x = g.length, y = d.length > 0 ? d.shift() : -1;
                            if (-1 === y || "string" == typeof y) {
                                var z, A = j, B = d.slice(), C = [];
                                if ("string" == typeof y)
                                    C = y.split(",");
                                else
                                    for (z = 0; z < t.matches.length; z++)
                                        C.push(z);
                                for (var D = 0; D < C.length; D++) {
                                    if (z = parseInt(C[D]),
                                    l = [],
                                    d = q(j, z),
                                    f = i(t.matches[z] || c.matches[z], [z].concat(g), k) || f,
                                    f !== !0 && void 0 !== f && C[C.length - 1] < t.matches.length) {
                                        var E = a.inArray(f, c.matches) + 1;
                                        c.matches.length > E && (f = i(c.matches[E], [E].concat(g.slice(1, g.length)), k),
                                        f && (C.push(E.toString()),
                                        a.each(l, function(a, b) {
                                            b.alternation = g.length - 1
                                        })))
                                    }
                                    s = l.slice(),
                                    j = A,
                                    l = [];
                                    for (var F = 0; F < B.length; F++)
                                        d[F] = B[F];
                                    for (var G = 0; G < s.length; G++) {
                                        var H = s[G];
                                        H.alternation = H.alternation || x;
                                        for (var I = 0; I < v.length; I++) {
                                            var J = v[I];
                                            if (H.match.def === J.match.def && ("string" != typeof y || -1 !== a.inArray(H.locator[H.alternation].toString(), C))) {
                                                H.match.mask === J.match.mask && (s.splice(G, 1),
                                                G--),
                                                -1 === J.locator[H.alternation].toString().indexOf(H.locator[H.alternation]) && (J.locator[H.alternation] = J.locator[H.alternation] + "," + H.locator[H.alternation],
                                                J.alternation = H.alternation);
                                                break
                                            }
                                        }
                                    }
                                    v = v.concat(s)
                                }
                                "string" == typeof y && (v = a.map(v, function(b, c) {
                                    if (isFinite(c)) {
                                        var d, e = b.alternation, f = b.locator[e].toString().split(",");
                                        b.locator[e] = void 0,
                                        b.alternation = void 0;
                                        for (var g = 0; g < f.length; g++)
                                            d = -1 !== a.inArray(f[g], C),
                                            d && (void 0 !== b.locator[e] ? (b.locator[e] += ",",
                                            b.locator[e] += f[g]) : b.locator[e] = parseInt(f[g]),
                                            b.alternation = e);
                                        if (void 0 !== b.locator[e])
                                            return b
                                    }
                                })),
                                l = w.concat(v),
                                j = b,
                                n = l.length > 0
                            } else
                                f = i(t.matches[y] || c.matches[y], [y].concat(g), k);
                            if (f)
                                return !0
                        } else if (f.isQuantifier && k !== c.matches[a.inArray(f, c.matches) - 1])
                            for (var K = f, L = d.length > 0 ? d.shift() : 0; L < (isNaN(K.quantifier.max) ? L + 1 : K.quantifier.max) && b >= j; L++) {
                                var M = c.matches[a.inArray(K, c.matches) - 1];
                                if (f = i(M, [L].concat(g), M)) {
                                    if (h = l[l.length - 1].match,
                                    h.optionalQuantifier = L > K.quantifier.min - 1,
                                    p(h, M)) {
                                        if (L > K.quantifier.min - 1) {
                                            n = !0,
                                            j = b;
                                            break
                                        }
                                        return !0
                                    }
                                    return !0
                                }
                            }
                        else if (f = e(f, d, g, k))
                            return !0
                    } else
                        j++
                }
                for (var k = d.length > 0 ? d.shift() : 0; k < c.matches.length; k++)
                    if (c.matches[k].isQuantifier !== !0) {
                        var p = i(c.matches[k], [k].concat(f), g);
                        if (p && j === b)
                            return p;
                        if (j > b)
                            break
                    }
            }
            function f(b) {
                var c = [];
                return a.isArray(b) || (b = [b]),
                void 0 === b[0].alternation ? c = b[0].locator.slice() : a.each(b, function(a, b) {
                    if ("" !== b.def)
                        if (0 === c.length)
                            c = b.locator.slice();
                        else
                            for (var d = 0; d < c.length; d++)
                                b.locator[d] && -1 === c[d].toString().indexOf(b.locator[d]) && (c[d] += "," + b.locator[d])
                }),
                c
            }
            function g(a) {
                return a
            }
            var h, i = m().maskToken, j = c ? d : 0, k = c ? c.slice() : [0], l = [], n = !1, o = c ? c.join("") : "";
            if (b > -1) {
                if (void 0 === c) {
                    for (var p, q = b - 1; void 0 === (p = m().validPositions[q] || m().tests[q]) && q > -1; )
                        q--;
                    void 0 !== p && q > -1 && (k = f(p),
                    o = k.join(""),
                    j = q)
                }
                if (m().tests[b] && m().tests[b][0].cd === o)
                    return g(m().tests[b]);
                for (var r = k.shift(); r < i.length; r++) {
                    var s = e(i[r], k, [r]);
                    if (s && j === b || j > b)
                        break
                }
            }
            return (0 === l.length || n) && l.push({
                match: {
                    fn: null,
                    cardinality: 0,
                    optionality: !0,
                    casing: null,
                    def: ""
                },
                locator: [],
                cd: o
            }),
            m().tests[b] = a.extend(!0, [], l),
            m().tests[b]
        }
        function w() {
            return void 0 === m()._buffer && (m()._buffer = i(!1, 1)),
            m()._buffer
        }
        function x(a) {
            if (void 0 === m().buffer || a === !0) {
                if (a === !0)
                    for (var b in m().tests)
                        void 0 === m().validPositions[b] && delete m().tests[b];
                m().buffer = i(!0, o(), !0)
            }
            return m().buffer
        }
        function y(a, b, c) {
            var d;
            if (c = c,
            a === !0)
                n(),
                a = 0,
                b = c.length;
            else
                for (d = a; b > d; d++)
                    delete m().validPositions[d],
                    delete m().tests[d];
            for (d = a; b > d; d++)
                n(!0),
                c[d] !== g.skipOptionalPartCharacter && B(d, c[d], !0, !0)
        }
        function z(a, c, d) {
            switch (c.casing) {
            case "upper":
                a = a.toUpperCase();
                break;
            case "lower":
                a = a.toLowerCase();
                break;
            case "title":
                var e = m().validPositions[d - 1];
                a = 0 === d || e && e.input === String.fromCharCode(b.keyCode.SPACE) ? a.toUpperCase() : a.toLowerCase()
            }
            return a
        }
        function A(b, c) {
            for (var d = g.greedy ? c : c.slice(0, 1), e = !1, f = 0; f < b.length; f++)
                if (-1 !== a.inArray(b[f], d)) {
                    e = !0;
                    break
                }
            return e
        }
        function B(c, d, e, f) {
            function h(a) {
                return ia ? a.begin - a.end > 1 || a.begin - a.end === 1 && g.insertMode : a.end - a.begin > 1 || a.end - a.begin === 1 && g.insertMode
            }
            function i(b, d, e, f) {
                var i = !1;
                return a.each(v(b), function(j, k) {
                    for (var l = k.match, r = d ? 1 : 0, s = "", t = l.cardinality; t > r; t--)
                        s += F(b - (t - 1));
                    if (d && (s += d),
                    x(!0),
                    i = null != l.fn ? l.fn.test(s, m(), b, e, g, h(c)) : d !== l.def && d !== g.skipOptionalPartCharacter || "" === l.def ? !1 : {
                        c: l.placeholder || l.def,
                        pos: b
                    },
                    i !== !1) {
                        var u = void 0 !== i.c ? i.c : d;
                        u = u === g.skipOptionalPartCharacter && null === l.fn ? l.placeholder || l.def : u;
                        var v = b
                          , w = x();
                        if (void 0 !== i.remove && (a.isArray(i.remove) || (i.remove = [i.remove]),
                        a.each(i.remove.sort(function(a, b) {
                            return b - a
                        }), function(a, b) {
                            q(b, b + 1, !0)
                        })),
                        void 0 !== i.insert && (a.isArray(i.insert) || (i.insert = [i.insert]),
                        a.each(i.insert.sort(function(a, b) {
                            return a - b
                        }), function(a, b) {
                            B(b.pos, b.c, !1, f)
                        })),
                        i.refreshFromBuffer) {
                            var A = i.refreshFromBuffer;
                            if (e = !0,
                            y(A === !0 ? A : A.start, A.end, w),
                            void 0 === i.pos && void 0 === i.c)
                                return i.pos = o(),
                                !1;
                            if (v = void 0 !== i.pos ? i.pos : b,
                            v !== b)
                                return i = a.extend(i, B(v, u, !0, f)),
                                !1
                        } else if (i !== !0 && void 0 !== i.pos && i.pos !== b && (v = i.pos,
                        y(b, v, x().slice()),
                        v !== b))
                            return i = a.extend(i, B(v, u, !0)),
                            !1;
                        return i !== !0 && void 0 === i.pos && void 0 === i.c ? !1 : (j > 0 && n(!0),
                        p(v, a.extend({}, k, {
                            input: z(u, l, v)
                        }), f, h(c)) || (i = !1),
                        !1)
                    }
                }),
                i
            }
            function j(b, c, d, e) {
                for (var f, h, i, j, k, l, p = a.extend(!0, {}, m().validPositions), q = a.extend(!0, {}, m().tests), s = o(); s >= 0 && (j = m().validPositions[s],
                !j || void 0 === j.alternation || (f = s,
                h = m().validPositions[f].alternation,
                r(f).locator[j.alternation] === j.locator[j.alternation])); s--)
                    ;
                if (void 0 !== h) {
                    f = parseInt(f);
                    for (var t in m().validPositions)
                        if (t = parseInt(t),
                        j = m().validPositions[t],
                        t >= f && void 0 !== j.alternation) {
                            var v;
                            0 === f ? (v = [],
                            a.each(m().tests[f], function(a, b) {
                                void 0 !== b.locator[h] && (v = v.concat(b.locator[h].toString().split(",")))
                            })) : v = m().validPositions[f].locator[h].toString().split(",");
                            var w = void 0 !== j.locator[h] ? j.locator[h] : v[0];
                            w.length > 0 && (w = w.split(",")[0]);
                            for (var x = 0; x < v.length; x++) {
                                var y = []
                                  , z = 0
                                  , A = 0;
                                if (w < v[x]) {
                                    for (var C, D, E = t; E >= 0; E--)
                                        if (C = m().validPositions[E],
                                        void 0 !== C) {
                                            var F = u(E, v[x]);
                                            m().validPositions[E].match.def !== F.match.def && (y.push(m().validPositions[E].input),
                                            m().validPositions[E] = F,
                                            m().validPositions[E].input = H(E),
                                            null === m().validPositions[E].match.fn && A++,
                                            C = F),
                                            D = C.locator[h],
                                            C.locator[h] = parseInt(v[x]);
                                            break
                                        }
                                    if (w !== C.locator[h]) {
                                        for (k = t + 1; k < o(void 0, !0) + 1; k++)
                                            l = m().validPositions[k],
                                            l && null != l.match.fn ? y.push(l.input) : b > k && z++,
                                            delete m().validPositions[k],
                                            delete m().tests[k];
                                        for (n(!0),
                                        g.keepStatic = !g.keepStatic,
                                        i = !0; y.length > 0; ) {
                                            var G = y.shift();
                                            if (G !== g.skipOptionalPartCharacter && !(i = B(o(void 0, !0) + 1, G, !1, e)))
                                                break
                                        }
                                        if (C.alternation = h,
                                        C.locator[h] = D,
                                        i) {
                                            var I = o(b) + 1;
                                            for (k = t + 1; k < o() + 1; k++)
                                                l = m().validPositions[k],
                                                (void 0 === l || null == l.match.fn) && b > k && A++;
                                            b += A - z,
                                            i = B(b > I ? I : b, c, d, e)
                                        }
                                        if (g.keepStatic = !g.keepStatic,
                                        i)
                                            return i;
                                        n(),
                                        m().validPositions = a.extend(!0, {}, p),
                                        m().tests = a.extend(!0, {}, q)
                                    }
                                }
                            }
                            break
                        }
                }
                return !1
            }
            function k(b, c) {
                for (var d = m().validPositions[c], e = d.locator, f = e.length, g = b; c > g; g++)
                    if (void 0 === m().validPositions[g] && !C(g, !0)) {
                        var h = v(g)
                          , i = h[0]
                          , j = -1;
                        a.each(h, function(a, b) {
                            for (var c = 0; f > c && (void 0 !== b.locator[c] && A(b.locator[c].toString().split(","), e[c].toString().split(","))); c++)
                                c > j && (j = c,
                                i = b)
                        }),
                        p(g, a.extend({}, i, {
                            input: i.match.placeholder || i.match.def
                        }), !0)
                    }
            }
            e = e === !0;
            var l = c;
            void 0 !== c.begin && (l = ia && !h(c) ? c.end : c.begin);
            for (var s = !1, t = a.extend(!0, {}, m().validPositions), w = l - 1; w > -1 && !m().validPositions[w]; w--)
                ;
            var E;
            for (w++; l > w; w++)
                void 0 === m().validPositions[w] && (g.jitMasking === !1 || g.jitMasking > w) && ((E = r(w)).match.def === g.radixPointDefinitionSymbol || !C(w, !0) || a.inArray(g.radixPoint, x()) < w && E.match.fn && E.match.fn.test(H(w), m(), w, !1, g)) && i(o(w, !0) + 1, E.match.placeholder || (null == E.match.fn ? E.match.def : "" !== H(w) ? H(w) : x()[w]), !0, f);
            if (h(c) && (P(void 0, b.keyCode.DELETE, c),
            l = m().p),
            l < m().maskLength && (s = i(l, d, e, f),
            (!e || f === !0) && s === !1)) {
                var G = m().validPositions[l];
                if (!G || null !== G.match.fn || G.match.def !== d && d !== g.skipOptionalPartCharacter) {
                    if ((g.insertMode || void 0 === m().validPositions[D(l)]) && !C(l, !0)) {
                        var I = r(l).match;
                        I = I.placeholder || I.def,
                        i(l, I, e, f);
                        for (var J = l + 1, K = D(l); K >= J; J++)
                            if (s = i(J, d, e, f),
                            s !== !1) {
                                k(l, J),
                                l = J;
                                break
                            }
                    }
                } else
                    s = {
                        caret: D(l)
                    }
            }
            return s === !1 && g.keepStatic && (s = j(l, d, e, f)),
            s === !0 && (s = {
                pos: l
            }),
            a.isFunction(g.postValidation) && s !== !1 && !e && f !== !0 && (s = g.postValidation(x(!0), s, g) ? s : !1),
            void 0 === s.pos && (s.pos = l),
            s === !1 && (n(!0),
            m().validPositions = a.extend(!0, {}, t)),
            s
        }
        function C(a, b) {
            var c;
            if (b ? (c = r(a).match,
            "" === c.def && (c = s(a))) : c = s(a),
            null != c.fn)
                return c.fn;
            if (b !== !0 && a > -1 && !g.keepStatic && void 0 === m().validPositions[a]) {
                var d = v(a);
                return d.length > 2
            }
            return !1
        }
        function D(a, b) {
            var c = m().maskLength;
            if (a >= c)
                return c;
            for (var d = a; ++d < c && (b === !0 && (s(d).newBlockMarker !== !0 || !C(d)) || b !== !0 && !C(d) && (g.nojumps !== !0 || g.nojumpsThreshold > d)); )
                ;
            return d
        }
        function E(a, b) {
            var c = a;
            if (0 >= c)
                return 0;
            for (; --c > 0 && (b === !0 && s(c).newBlockMarker !== !0 || b !== !0 && !C(c)); )
                ;
            return c
        }
        function F(a) {
            return void 0 === m().validPositions[a] ? H(a) : m().validPositions[a].input
        }
        function G(b, c, d, e, f) {
            if (e && a.isFunction(g.onBeforeWrite)) {
                var h = g.onBeforeWrite(e, c, d, g);
                if (h) {
                    if (h.refreshFromBuffer) {
                        var i = h.refreshFromBuffer;
                        y(i === !0 ? i : i.start, i.end, h.buffer || c),
                        c = x(!0)
                    }
                    void 0 !== d && (d = void 0 !== h.caret ? h.caret : d)
                }
            }
            b.inputmask._valueSet(c.join("")),
            void 0 === d || void 0 !== e && "blur" === e.type || K(b, d),
            f === !0 && (ka = !0,
            a(b).trigger("input"))
        }
        function H(a, b) {
            if (b = b || s(a),
            void 0 !== b.placeholder)
                return b.placeholder;
            if (null === b.fn) {
                if (a > -1 && !g.keepStatic && void 0 === m().validPositions[a]) {
                    var c, d = v(a), e = [];
                    if (d.length > 2)
                        for (var f = 0; f < d.length; f++)
                            if (d[f].match.optionality !== !0 && d[f].match.optionalQuantifier !== !0 && (null === d[f].match.fn || void 0 === c || d[f].match.fn.test(c.match.def, m(), a, !0, g) !== !1) && (e.push(d[f]),
                            null === d[f].match.fn && (c = d[f]),
                            e.length > 1))
                                return g.placeholder.charAt(a % g.placeholder.length)
                }
                return b.def
            }
            return g.placeholder.charAt(a % g.placeholder.length)
        }
        function I(c, d, e, f) {
            function h() {
                var a = !1
                  , b = w().slice(l, D(l)).join("").indexOf(k);
                if (-1 !== b && !C(l)) {
                    a = !0;
                    for (var c = w().slice(l, l + b), d = 0; d < c.length; d++)
                        if (" " !== c[d]) {
                            a = !1;
                            break
                        }
                }
                return a
            }
            var i, j = f.slice(), k = "", l = 0;
            if (n(),
            m().p = D(-1),
            !e)
                if (g.autoUnmask !== !0) {
                    var p = w().slice(0, D(-1)).join("")
                      , q = j.join("").match(new RegExp("^" + b.escapeRegex(p),"g"));
                    q && q.length > 0 && (j.splice(0, q.length * p.length),
                    l = D(l))
                } else
                    l = D(l);
            a.each(j, function(b, d) {
                if (void 0 !== d) {
                    var f = new a.Event("keypress");
                    f.which = d.charCodeAt(0),
                    k += d;
                    var j = o(void 0, !0)
                      , p = m().validPositions[j]
                      , q = r(j + 1, p ? p.locator.slice() : void 0, j);
                    if (!h() || e || g.autoUnmask) {
                        var s = e ? b : null == q.match.fn && q.match.optionality && j + 1 < m().p ? j + 1 : m().p;
                        i = R.call(c, f, !0, !1, e, s),
                        l = s + 1,
                        k = ""
                    } else
                        i = R.call(c, f, !0, !1, !0, j + 1);
                    if (!e && a.isFunction(g.onBeforeWrite) && (i = g.onBeforeWrite(f, x(), i.forwardPosition, g),
                    i && i.refreshFromBuffer)) {
                        var t = i.refreshFromBuffer;
                        y(t === !0 ? t : t.start, t.end, i.buffer),
                        n(!0),
                        i.caret && (m().p = i.caret)
                    }
                }
            }),
            d && G(c, x(), document.activeElement === c ? D(o(0)) : void 0, new a.Event("checkval"))
        }
        function J(b) {
            if (b && void 0 === b.inputmask)
                return b.value;
            var c = []
              , d = m().validPositions;
            for (var e in d)
                d[e].match && null != d[e].match.fn && c.push(d[e].input);
            var f = 0 === c.length ? null : (ia ? c.reverse() : c).join("");
            if (null !== f) {
                var h = (ia ? x().slice().reverse() : x()).join("");
                a.isFunction(g.onUnMask) && (f = g.onUnMask(h, f, g) || f)
            }
            return f
        }
        function K(a, b, c, d) {
            function e(a) {
                if (d !== !0 && ia && "number" == typeof a && (!g.greedy || "" !== g.placeholder)) {
                    var b = x().join("").length;
                    a = b - a
                }
                return a
            }
            var f;
            if ("number" != typeof b)
                return a.setSelectionRange ? (b = a.selectionStart,
                c = a.selectionEnd) : window.getSelection ? (f = window.getSelection().getRangeAt(0),
                (f.commonAncestorContainer.parentNode === a || f.commonAncestorContainer === a) && (b = f.startOffset,
                c = f.endOffset)) : document.selection && document.selection.createRange && (f = document.selection.createRange(),
                b = 0 - f.duplicate().moveStart("character", -a.inputmask._valueGet().length),
                c = b + f.text.length),
                {
                    begin: e(b),
                    end: e(c)
                };
            b = e(b),
            c = e(c),
            c = "number" == typeof c ? c : b;
            var h = parseInt(((a.ownerDocument.defaultView || window).getComputedStyle ? (a.ownerDocument.defaultView || window).getComputedStyle(a, null) : a.currentStyle).fontSize) * c;
            if (a.scrollLeft = h > a.scrollWidth ? h : 0,
            j || g.insertMode !== !1 || b !== c || c++,
            a.setSelectionRange)
                a.selectionStart = b,
                a.selectionEnd = c;
            else if (window.getSelection) {
                if (f = document.createRange(),
                void 0 === a.firstChild || null === a.firstChild) {
                    var i = document.createTextNode("");
                    a.appendChild(i)
                }
                f.setStart(a.firstChild, b < a.inputmask._valueGet().length ? b : a.inputmask._valueGet().length),
                f.setEnd(a.firstChild, c < a.inputmask._valueGet().length ? c : a.inputmask._valueGet().length),
                f.collapse(!0);
                var k = window.getSelection();
                k.removeAllRanges(),
                k.addRange(f)
            } else
                a.createTextRange && (f = a.createTextRange(),
                f.collapse(!0),
                f.moveEnd("character", c),
                f.moveStart("character", b),
                f.select())
        }
        function L(b) {
            var c, d, e = x(), f = e.length, g = o(), h = {}, i = m().validPositions[g], j = void 0 !== i ? i.locator.slice() : void 0;
            for (c = g + 1; c < e.length; c++)
                d = r(c, j, c - 1),
                j = d.locator.slice(),
                h[c] = a.extend(!0, {}, d);
            var k = i && void 0 !== i.alternation ? i.locator[i.alternation] : void 0;
            for (c = f - 1; c > g && (d = h[c],
            (d.match.optionality || d.match.optionalQuantifier || k && (k !== h[c].locator[i.alternation] && null != d.match.fn || null === d.match.fn && d.locator[i.alternation] && A(d.locator[i.alternation].toString().split(","), k.toString().split(",")) && "" !== v(c)[0].def)) && e[c] === H(c, d.match)); c--)
                f--;
            return b ? {
                l: f,
                def: h[f] ? h[f].match : void 0
            } : f
        }
        function M(a) {
            for (var b = L(), c = a.length - 1; c > b && !C(c); c--)
                ;
            return a.splice(b, c + 1 - b),
            a
        }
        function N(b) {
            if (a.isFunction(g.isComplete))
                return g.isComplete(b, g);
            if ("*" === g.repeat)
                return void 0;
            var c = !1
              , d = L(!0)
              , e = E(d.l);
            if (void 0 === d.def || d.def.newBlockMarker || d.def.optionality || d.def.optionalQuantifier) {
                c = !0;
                for (var f = 0; e >= f; f++) {
                    var h = r(f).match;
                    if (null !== h.fn && void 0 === m().validPositions[f] && h.optionality !== !0 && h.optionalQuantifier !== !0 || null === h.fn && b[f] !== H(f, h)) {
                        c = !1;
                        break
                    }
                }
            }
            return c
        }
        function O(b) {
            function c(b) {
                if (a.valHooks && (void 0 === a.valHooks[b] || a.valHooks[b].inputmaskpatch !== !0)) {
                    var c = a.valHooks[b] && a.valHooks[b].get ? a.valHooks[b].get : function(a) {
                        return a.value
                    }
                      , d = a.valHooks[b] && a.valHooks[b].set ? a.valHooks[b].set : function(a, b) {
                        return a.value = b,
                        a
                    }
                    ;
                    a.valHooks[b] = {
                        get: function(a) {
                            if (a.inputmask) {
                                if (a.inputmask.opts.autoUnmask)
                                    return a.inputmask.unmaskedvalue();
                                var b = c(a);
                                return -1 !== o(void 0, void 0, a.inputmask.maskset.validPositions) || g.nullable !== !0 ? b : ""
                            }
                            return c(a)
                        },
                        set: function(b, c) {
                            var e, f = a(b);
                            return e = d(b, c),
                            b.inputmask && f.trigger("setvalue"),
                            e
                        },
                        inputmaskpatch: !0
                    }
                }
            }
            function d() {
                return this.inputmask ? this.inputmask.opts.autoUnmask ? this.inputmask.unmaskedvalue() : -1 !== o() || g.nullable !== !0 ? document.activeElement === this && g.clearMaskOnLostFocus ? (ia ? M(x().slice()).reverse() : M(x().slice())).join("") : h.call(this) : "" : h.call(this)
            }
            function e(b) {
                i.call(this, b),
                this.inputmask && a(this).trigger("setvalue")
            }
            function f(b) {
                na.on(b, "mouseenter", function(b) {
                    var c = a(this)
                      , d = this
                      , e = d.inputmask._valueGet();
                    e !== x().join("") && c.trigger("setvalue")
                })
            }
            var h, i;
            if (!b.inputmask.__valueGet) {
                if (Object.getOwnPropertyDescriptor) {
                    "function" != typeof Object.getPrototypeOf && (Object.getPrototypeOf = "object" == typeof "test".__proto__ ? function(a) {
                        return a.__proto__
                    }
                    : function(a) {
                        return a.constructor.prototype
                    }
                    );
                    var j = Object.getPrototypeOf ? Object.getOwnPropertyDescriptor(Object.getPrototypeOf(b), "value") : void 0;
                    j && j.get && j.set ? (h = j.get,
                    i = j.set,
                    Object.defineProperty(b, "value", {
                        get: d,
                        set: e,
                        configurable: !0
                    })) : "INPUT" !== b.tagName && (h = function() {
                        return this.textContent
                    }
                    ,
                    i = function(a) {
                        this.textContent = a
                    }
                    ,
                    Object.defineProperty(b, "value", {
                        get: d,
                        set: e,
                        configurable: !0
                    }))
                } else
                    document.__lookupGetter__ && b.__lookupGetter__("value") && (h = b.__lookupGetter__("value"),
                    i = b.__lookupSetter__("value"),
                    b.__defineGetter__("value", d),
                    b.__defineSetter__("value", e));
                b.inputmask.__valueGet = h,
                b.inputmask._valueGet = function(a) {
                    return ia && a !== !0 ? h.call(this.el).split("").reverse().join("") : h.call(this.el)
                }
                ,
                b.inputmask.__valueSet = i,
                b.inputmask._valueSet = function(a, b) {
                    i.call(this.el, null === a || void 0 === a ? "" : b !== !0 && ia ? a.split("").reverse().join("") : a)
                }
                ,
                void 0 === h && (h = function() {
                    return this.value
                }
                ,
                i = function(a) {
                    this.value = a
                }
                ,
                c(b.type),
                f(b))
            }
        }
        function P(c, d, e, f) {
            function h() {
                if (g.keepStatic) {
                    n(!0);
                    var b, d = [], e = a.extend(!0, {}, m().validPositions);
                    for (b = o(); b >= 0; b--) {
                        var f = m().validPositions[b];
                        if (f && (null != f.match.fn && d.push(f.input),
                        delete m().validPositions[b],
                        void 0 !== f.alternation && f.locator[f.alternation] === r(b).locator[f.alternation]))
                            break
                    }
                    if (b > -1)
                        for (; d.length > 0; ) {
                            m().p = D(o());
                            var h = new a.Event("keypress");
                            h.which = d.pop().charCodeAt(0),
                            R.call(c, h, !0, !1, !1, m().p)
                        }
                    else
                        m().validPositions = a.extend(!0, {}, e)
                }
            }
            if ((g.numericInput || ia) && (d === b.keyCode.BACKSPACE ? d = b.keyCode.DELETE : d === b.keyCode.DELETE && (d = b.keyCode.BACKSPACE),
            ia)) {
                var i = e.end;
                e.end = e.begin,
                e.begin = i
            }
            d === b.keyCode.BACKSPACE && (e.end - e.begin < 1 || g.insertMode === !1) ? (e.begin = E(e.begin),
            void 0 === m().validPositions[e.begin] || m().validPositions[e.begin].input !== g.groupSeparator && m().validPositions[e.begin].input !== g.radixPoint || e.begin--) : d === b.keyCode.DELETE && e.begin === e.end && (e.end = C(e.end) ? e.end + 1 : D(e.end) + 1,
            void 0 === m().validPositions[e.begin] || m().validPositions[e.begin].input !== g.groupSeparator && m().validPositions[e.begin].input !== g.radixPoint || e.end++),
            q(e.begin, e.end, !1, f),
            f !== !0 && h();
            var j = o(e.begin);
            j < e.begin ? (-1 === j && n(),
            m().p = D(j)) : f !== !0 && (m().p = e.begin)
        }
        function Q(d) {
            var e = this
              , f = a(e)
              , h = d.keyCode
              , i = K(e);
            if (h === b.keyCode.BACKSPACE || h === b.keyCode.DELETE || l && h === b.keyCode.BACKSPACE_SAFARI || d.ctrlKey && h === b.keyCode.X && !c("cut"))
                d.preventDefault(),
                P(e, h, i),
                G(e, x(), m().p, d, da !== x().join("")),
                e.inputmask._valueGet() === w().join("") ? f.trigger("cleared") : N(x()) === !0 && f.trigger("complete"),
                g.showTooltip && (e.title = g.tooltip || m().mask);
            else if (h === b.keyCode.END || h === b.keyCode.PAGE_DOWN) {
                d.preventDefault();
                var j = D(o());
                g.insertMode || j !== m().maskLength || d.shiftKey || j--,
                K(e, d.shiftKey ? i.begin : j, j, !0)
            } else
                h === b.keyCode.HOME && !d.shiftKey || h === b.keyCode.PAGE_UP ? (d.preventDefault(),
                K(e, 0, d.shiftKey ? i.begin : 0, !0)) : (g.undoOnEscape && h === b.keyCode.ESCAPE || 90 === h && d.ctrlKey) && d.altKey !== !0 ? (I(e, !0, !1, da.split("")),
                f.trigger("click")) : h !== b.keyCode.INSERT || d.shiftKey || d.ctrlKey ? g.tabThrough === !0 && h === b.keyCode.TAB ? (d.shiftKey === !0 ? (null === s(i.begin).fn && (i.begin = D(i.begin)),
                i.end = E(i.begin, !0),
                i.begin = E(i.end, !0)) : (i.begin = D(i.begin, !0),
                i.end = D(i.begin, !0),
                i.end < m().maskLength && i.end--),
                i.begin < m().maskLength && (d.preventDefault(),
                K(e, i.begin, i.end))) : g.insertMode !== !1 || d.shiftKey || (h === b.keyCode.RIGHT ? setTimeout(function() {
                    var a = K(e);
                    K(e, a.begin)
                }, 0) : h === b.keyCode.LEFT && setTimeout(function() {
                    var a = K(e);
                    K(e, ia ? a.begin + 1 : a.begin - 1)
                }, 0)) : (g.insertMode = !g.insertMode,
                K(e, g.insertMode || i.begin !== m().maskLength ? i.begin : i.begin - 1));
            g.onKeyDown.call(this, d, x(), K(e).begin, g),
            la = -1 !== a.inArray(h, g.ignorables)
        }
        function R(c, d, e, f, h) {
            var i = this
              , j = a(i)
              , k = c.which || c.charCode || c.keyCode;
            if (!(d === !0 || c.ctrlKey && c.altKey) && (c.ctrlKey || c.metaKey || la))
                return k === b.keyCode.ENTER && da !== x().join("") && (da = x().join(""),
                setTimeout(function() {
                    j.trigger("change")
                }, 0)),
                !0;
            if (k) {
                46 === k && c.shiftKey === !1 && "," === g.radixPoint && (k = 44);
                var l, o = d ? {
                    begin: h,
                    end: h
                } : K(i), p = String.fromCharCode(k);
                m().writeOutBuffer = !0;
                var q = B(o, p, f);
                if (q !== !1) {
                    var r = q.pos;
                    if (n(!0),
                    void 0 !== q.caret)
                        l = q.caret;
                    else {
                        var s = m().validPositions;
                        l = !g.keepStatic && (void 0 !== s[r + 1] && v(r + 1, s[r].locator.slice(), r).length > 1 || void 0 !== s[r].alternation) ? r + 1 : D(r)
                    }
                    m().p = l
                }
                if (e !== !1) {
                    var t = this;
                    if (setTimeout(function() {
                        g.onKeyValidation.call(t, k, q, g)
                    }, 0),
                    m().writeOutBuffer && q !== !1) {
                        var u = x();
                        G(i, u, g.numericInput && void 0 === q.caret ? E(l) : l, c, d !== !0),
                        d !== !0 && setTimeout(function() {
                            N(u) === !0 && j.trigger("complete")
                        }, 0)
                    }
                }
                if (g.showTooltip && (i.title = g.tooltip || m().mask),
                c.preventDefault(),
                d)
                    return q.forwardPosition = l,
                    q
            }
        }
        function S(b) {
            var c, d = this, e = b.originalEvent || b, f = a(d), h = d.inputmask._valueGet(!0), i = K(d);
            ia && (c = i.end,
            i.end = i.begin,
            i.begin = c);
            var j = h.substr(0, i.begin)
              , k = h.substr(i.end, h.length);
            j === (ia ? w().reverse() : w()).slice(0, i.begin).join("") && (j = ""),
            k === (ia ? w().reverse() : w()).slice(i.end).join("") && (k = ""),
            ia && (c = j,
            j = k,
            k = c),
            window.clipboardData && window.clipboardData.getData ? h = j + window.clipboardData.getData("Text") + k : e.clipboardData && e.clipboardData.getData && (h = j + e.clipboardData.getData("text/plain") + k);
            var l = h;
            if (a.isFunction(g.onBeforePaste)) {
                if (l = g.onBeforePaste(h, g),
                l === !1)
                    return b.preventDefault();
                l || (l = h)
            }
            return I(d, !1, !1, ia ? l.split("").reverse() : l.toString().split("")),
            G(d, x(), D(o()), b, !0),
            N(x()) === !0 && f.trigger("complete"),
            b.preventDefault()
        }
        function T(c) {
            var d = this
              , e = d.inputmask._valueGet();
            if (x().join("") !== e) {
                var f = K(d);
                if (e = e.replace(new RegExp("(" + b.escapeRegex(w().join("")) + ")*"), ""),
                k) {
                    var g = e.replace(x().join(""), "");
                    if (1 === g.length) {
                        var h = new a.Event("keypress");
                        return h.which = g.charCodeAt(0),
                        R.call(d, h, !0, !0, !1, m().validPositions[f.begin - 1] ? f.begin : f.begin - 1),
                        !1
                    }
                }
                if (f.begin > e.length && (K(d, e.length),
                f = K(d)),
                x().length - e.length !== 1 || e.charAt(f.begin) === x()[f.begin] || e.charAt(f.begin + 1) === x()[f.begin] || C(f.begin)) {
                    for (var i = o() + 1, j = x().slice(i).join(""); null === e.match(b.escapeRegex(j) + "$"); )
                        j = j.slice(1);
                    e = e.replace(j, ""),
                    e = e.split(""),
                    I(d, !0, !1, e),
                    N(x()) === !0 && a(d).trigger("complete")
                } else
                    c.keyCode = b.keyCode.BACKSPACE,
                    Q.call(d, c);
                c.preventDefault()
            }
        }
        function U(b) {
            var c = this
              , d = c.inputmask._valueGet();
            I(c, !0, !1, (a.isFunction(g.onBeforeMask) ? g.onBeforeMask(d, g) || d : d).split("")),
            da = x().join(""),
            (g.clearMaskOnLostFocus || g.clearIncomplete) && c.inputmask._valueGet() === w().join("") && c.inputmask._valueSet("")
        }
        function V(a) {
            var b = this
              , c = b.inputmask._valueGet();
            g.showMaskOnFocus && (!g.showMaskOnHover || g.showMaskOnHover && "" === c) ? b.inputmask._valueGet() !== x().join("") && G(b, x(), D(o())) : ma === !1 && K(b, D(o())),
            g.positionCaretOnTab === !0 && setTimeout(function() {
                K(b, D(o()))
            }, 0),
            da = x().join("")
        }
        function W(a) {
            var b = this;
            if (ma = !1,
            g.clearMaskOnLostFocus && document.activeElement !== b) {
                var c = x().slice()
                  , d = b.inputmask._valueGet();
                d !== b.getAttribute("placeholder") && "" !== d && (-1 === o() && d === w().join("") ? c = [] : M(c),
                G(b, c))
            }
        }
        function X(b) {
            function c(b) {
                if (g.radixFocus && "" !== g.radixPoint) {
                    var c = m().validPositions;
                    if (void 0 === c[b] || c[b].input === H(b)) {
                        if (b < D(-1))
                            return !0;
                        var d = a.inArray(g.radixPoint, x());
                        if (-1 !== d) {
                            for (var e in c)
                                if (e > d && c[e].input !== H(e))
                                    return !1;
                            return !0
                        }
                    }
                }
                return !1
            }
            var d = this;
            setTimeout(function() {
                if (document.activeElement === d) {
                    var b = K(d);
                    if (b.begin === b.end)
                        if (c(b.begin))
                            K(d, g.numericInput ? D(a.inArray(g.radixPoint, x())) : a.inArray(g.radixPoint, x()));
                        else {
                            var e = b.begin
                              , f = o(e, !0)
                              , h = D(f);
                            if (h > e)
                                K(d, C(e) || C(e - 1) ? e : D(e));
                            else {
                                var i = H(h);
                                ("" !== i && x()[h] !== i || !C(h, !0) && s(h).def === i) && (h = D(h)),
                                K(d, h)
                            }
                        }
                }
            }, 0)
        }
        function Y(a) {
            var b = this;
            setTimeout(function() {
                K(b, 0, D(o()))
            }, 0)
        }
        function Z(c) {
            var d = this
              , e = a(d)
              , f = K(d)
              , h = c.originalEvent || c
              , i = window.clipboardData || h.clipboardData
              , j = ia ? x().slice(f.end, f.begin) : x().slice(f.begin, f.end);
            i.setData("text", ia ? j.reverse().join("") : j.join("")),
            document.execCommand && document.execCommand("copy"),
            P(d, b.keyCode.DELETE, f),
            G(d, x(), m().p, c, da !== x().join("")),
            d.inputmask._valueGet() === w().join("") && e.trigger("cleared"),
            g.showTooltip && (d.title = g.tooltip || m().mask)
        }
        function $(b) {
            var c = a(this)
              , d = this;
            if (d.inputmask) {
                var e = d.inputmask._valueGet()
                  , f = x().slice();
                da !== f.join("") && setTimeout(function() {
                    c.trigger("change"),
                    da = f.join("")
                }, 0),
                "" !== e && (g.clearMaskOnLostFocus && (-1 === o() && e === w().join("") ? f = [] : M(f)),
                N(f) === !1 && (setTimeout(function() {
                    c.trigger("incomplete")
                }, 0),
                g.clearIncomplete && (n(),
                f = g.clearMaskOnLostFocus ? [] : w().slice())),
                G(d, f, void 0, b))
            }
        }
        function _(a) {
            var b = this;
            ma = !0,
            document.activeElement !== b && g.showMaskOnHover && b.inputmask._valueGet() !== x().join("") && G(b, x())
        }
        function aa(a) {
            da !== x().join("") && fa.trigger("change"),
            g.clearMaskOnLostFocus && -1 === o() && ea.inputmask._valueGet && ea.inputmask._valueGet() === w().join("") && ea.inputmask._valueSet(""),
            g.removeMaskOnSubmit && (ea.inputmask._valueSet(ea.inputmask.unmaskedvalue(), !0),
            setTimeout(function() {
                G(ea, x())
            }, 0))
        }
        function ba(a) {
            setTimeout(function() {
                fa.trigger("setvalue")
            }, 0)
        }
        function ca(b) {
            if (ea = b,
            fa = a(ea),
            g.showTooltip && (ea.title = g.tooltip || m().mask),
            ("rtl" === ea.dir || g.rightAlign) && (ea.style.textAlign = "right"),
            ("rtl" === ea.dir || g.numericInput) && (ea.dir = "ltr",
            ea.removeAttribute("dir"),
            ea.inputmask.isRTL = !0,
            ia = !0),
            na.off(ea),
            O(ea),
            d(ea, g) && (na.on(ea, "submit", aa),
            na.on(ea, "reset", ba),
            na.on(ea, "mouseenter", _),
            na.on(ea, "blur", $),
            na.on(ea, "focus", V),
            na.on(ea, "mouseleave", W),
            na.on(ea, "click", X),
            na.on(ea, "dblclick", Y),
            na.on(ea, "paste", S),
            na.on(ea, "dragdrop", S),
            na.on(ea, "drop", S),
            na.on(ea, "cut", Z),
            na.on(ea, "complete", g.oncomplete),
            na.on(ea, "incomplete", g.onincomplete),
            na.on(ea, "cleared", g.oncleared),
            g.inputEventOnly !== !0 && (na.on(ea, "keydown", Q),
            na.on(ea, "keypress", R)),
            na.on(ea, "input", T)),
            na.on(ea, "setvalue", U),
            "" !== ea.inputmask._valueGet() || g.clearMaskOnLostFocus === !1 || document.activeElement === ea) {
                var c = a.isFunction(g.onBeforeMask) ? g.onBeforeMask(ea.inputmask._valueGet(), g) || ea.inputmask._valueGet() : ea.inputmask._valueGet();
                I(ea, !0, !1, c.split(""));
                var e = x().slice();
                da = e.join(""),
                N(e) === !1 && g.clearIncomplete && n(),
                g.clearMaskOnLostFocus && document.activeElement !== ea && (-1 === o() ? e = [] : M(e)),
                G(ea, e),
                document.activeElement === ea && K(ea, D(o()))
            }
        }
        var da, ea, fa, ga, ha, ia = !1, ja = !1, ka = !1, la = !1, ma = !0, na = {
            on: function(c, d, e) {
                var f = function(c) {
                    if (void 0 === this.inputmask && "FORM" !== this.nodeName) {
                        var d = a.data(this, "_inputmask_opts");
                        d ? new b(d).mask(this) : na.off(this)
                    } else {
                        if ("setvalue" === c.type || !(this.disabled || this.readOnly && !("keydown" === c.type && c.ctrlKey && 67 === c.keyCode || g.tabThrough === !1 && c.keyCode === b.keyCode.TAB))) {
                            switch (c.type) {
                            case "input":
                                if (ka === !0)
                                    return ka = !1,
                                    c.preventDefault();
                                break;
                            case "keydown":
                                ja = !1,
                                ka = !1;
                                break;
                            case "keypress":
                                if (ja === !0)
                                    return c.preventDefault();
                                ja = !0;
                                break;
                            case "click":
                                if (k) {
                                    var f = this;
                                    return setTimeout(function() {
                                        e.apply(f, arguments)
                                    }, 0),
                                    !1
                                }
                            }
                            var h = e.apply(this, arguments);
                            return h === !1 && (c.preventDefault(),
                            c.stopPropagation()),
                            h
                        }
                        c.preventDefault()
                    }
                };
                c.inputmask.events[d] = c.inputmask.events[d] || [],
                c.inputmask.events[d].push(f),
                -1 !== a.inArray(d, ["submit", "reset"]) ? null != c.form && a(c.form).on(d, f) : a(c).on(d, f)
            },
            off: function(b, c) {
                if (b.inputmask && b.inputmask.events) {
                    var d;
                    c ? (d = [],
                    d[c] = b.inputmask.events[c]) : d = b.inputmask.events,
                    a.each(d, function(c, d) {
                        for (; d.length > 0; ) {
                            var e = d.pop();
                            -1 !== a.inArray(c, ["submit", "reset"]) ? null != b.form && a(b.form).off(c, e) : a(b).off(c, e)
                        }
                        delete b.inputmask.events[c]
                    })
                }
            }
        };
        if (void 0 !== e)
            switch (e.action) {
            case "isComplete":
                return ea = e.el,
                N(x());
            case "unmaskedvalue":
                return ea = e.el,
                void 0 !== ea && void 0 !== ea.inputmask ? (f = ea.inputmask.maskset,
                g = ea.inputmask.opts,
                ia = ea.inputmask.isRTL) : (ha = e.value,
                g.numericInput && (ia = !0),
                ha = (a.isFunction(g.onBeforeMask) ? g.onBeforeMask(ha, g) || ha : ha).split(""),
                I(void 0, !1, !1, ia ? ha.reverse() : ha),
                a.isFunction(g.onBeforeWrite) && g.onBeforeWrite(void 0, x(), 0, g)),
                J(ea);
            case "mask":
                ea = e.el,
                f = ea.inputmask.maskset,
                g = ea.inputmask.opts,
                ia = ea.inputmask.isRTL,
                da = x().join(""),
                ca(ea);
                break;
            case "format":
                return g.numericInput && (ia = !0),
                ha = (a.isFunction(g.onBeforeMask) ? g.onBeforeMask(e.value, g) || e.value : e.value).split(""),
                I(void 0, !1, !1, ia ? ha.reverse() : ha),
                a.isFunction(g.onBeforeWrite) && g.onBeforeWrite(void 0, x(), 0, g),
                e.metadata ? {
                    value: ia ? x().slice().reverse().join("") : x().join(""),
                    metadata: h({
                        action: "getmetadata"
                    }, f, g)
                } : ia ? x().slice().reverse().join("") : x().join("");
            case "isValid":
                g.numericInput && (ia = !0),
                e.value ? (ha = e.value.split(""),
                I(void 0, !1, !0, ia ? ha.reverse() : ha)) : e.value = x().join("");
                for (var oa = x(), pa = L(), qa = oa.length - 1; qa > pa && !C(qa); qa--)
                    ;
                return oa.splice(pa, qa + 1 - pa),
                N(oa) && e.value === x().join("");
            case "getemptymask":
                return w().join("");
            case "remove":
                ea = e.el,
                fa = a(ea),
                f = ea.inputmask.maskset,
                g = ea.inputmask.opts,
                ea.inputmask._valueSet(J(ea)),
                na.off(ea);
                var ra;
                Object.getOwnPropertyDescriptor && Object.getPrototypeOf ? (ra = Object.getOwnPropertyDescriptor(Object.getPrototypeOf(ea), "value"),
                ra && ea.inputmask.__valueGet && Object.defineProperty(ea, "value", {
                    get: ea.inputmask.__valueGet,
                    set: ea.inputmask.__valueSet,
                    configurable: !0
                })) : document.__lookupGetter__ && ea.__lookupGetter__("value") && ea.inputmask.__valueGet && (ea.__defineGetter__("value", ea.inputmask.__valueGet),
                ea.__defineSetter__("value", ea.inputmask.__valueSet)),
                ea.inputmask = void 0;
                break;
            case "getmetadata":
                if (a.isArray(f.metadata)) {
                    for (var sa, ta = o(void 0, !0), ua = ta; ua >= 0; ua--)
                        if (m().validPositions[ua] && void 0 !== m().validPositions[ua].alternation) {
                            sa = m().validPositions[ua].alternation;
                            break
                        }
                    return void 0 !== sa ? f.metadata[m().validPositions[ua].locator[sa]] : []
                }
                return f.metadata
            }
    }
    b.prototype = {
        defaults: {
            placeholder: "_",
            optionalmarker: {
                start: "[",
                end: "]"
            },
            quantifiermarker: {
                start: "{",
                end: "}"
            },
            groupmarker: {
                start: "(",
                end: ")"
            },
            alternatormarker: "|",
            escapeChar: "\\",
            mask: null,
            oncomplete: a.noop,
            onincomplete: a.noop,
            oncleared: a.noop,
            repeat: 0,
            greedy: !0,
            autoUnmask: !1,
            removeMaskOnSubmit: !1,
            clearMaskOnLostFocus: !0,
            insertMode: !0,
            clearIncomplete: !1,
            aliases: {},
            alias: null,
            onKeyDown: a.noop,
            onBeforeMask: null,
            onBeforePaste: function(b, c) {
                return a.isFunction(c.onBeforeMask) ? c.onBeforeMask(b, c) : b
            },
            onBeforeWrite: null,
            onUnMask: null,
            showMaskOnFocus: !0,
            showMaskOnHover: !0,
            onKeyValidation: a.noop,
            skipOptionalPartCharacter: " ",
            showTooltip: !1,
            tooltip: void 0,
            numericInput: !1,
            rightAlign: !1,
            undoOnEscape: !0,
            radixPoint: "",
            radixPointDefinitionSymbol: void 0,
            groupSeparator: "",
            radixFocus: !1,
            nojumps: !1,
            nojumpsThreshold: 0,
            keepStatic: null,
            positionCaretOnTab: !1,
            tabThrough: !1,
            supportsInputType: ["text", "tel", "password"],
            definitions: {
                9: {
                    validator: "[0-9]",
                    cardinality: 1,
                    definitionSymbol: "*"
                },
                a: {
                    validator: "[A-Za-z--]",
                    cardinality: 1,
                    definitionSymbol: "*"
                },
                "*": {
                    validator: "[0-9A-Za-z--]",
                    cardinality: 1
                }
            },
            ignorables: [8, 9, 13, 19, 27, 33, 34, 35, 36, 37, 38, 39, 40, 45, 46, 93, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123],
            isComplete: null,
            canClearPosition: a.noop,
            postValidation: null,
            staticDefinitionSymbol: void 0,
            jitMasking: !1,
            nullable: !0,
            inputEventOnly: !1
        },
        masksCache: {},
        mask: function(c) {
            var d = this;
            return "string" == typeof c && (c = document.getElementById(c) || document.querySelectorAll(c)),
            c = c.nodeName ? [c] : c,
            a.each(c, function(c, e) {
                var i = a.extend(!0, {}, d.opts);
                f(e, i, a.extend(!0, {}, d.userOptions));
                var j = g(i, d.noMasksCache);
                void 0 !== j && (void 0 !== e.inputmask && e.inputmask.remove(),
                e.inputmask = new b,
                e.inputmask.opts = i,
                e.inputmask.noMasksCache = d.noMasksCache,
                e.inputmask.userOptions = a.extend(!0, {}, d.userOptions),
                e.inputmask.el = e,
                e.inputmask.maskset = j,
                e.inputmask.isRTL = !1,
                a.data(e, "_inputmask_opts", i),
                h({
                    action: "mask",
                    el: e
                }))
            }),
            c && c[0] ? c[0].inputmask || this : this
        },
        option: function(b, c) {
            return "string" == typeof b ? this.opts[b] : "object" == typeof b ? (a.extend(this.userOptions, b),
            this.el && c !== !0 && this.mask(this.el),
            this) : void 0
        },
        unmaskedvalue: function(a) {
            return h({
                action: "unmaskedvalue",
                el: this.el,
                value: a
            }, this.el && this.el.inputmask ? this.el.inputmask.maskset : g(this.opts, this.noMasksCache), this.opts)
        },
        remove: function() {
            return this.el ? (h({
                action: "remove",
                el: this.el
            }),
            this.el.inputmask = void 0,
            this.el) : void 0
        },
        getemptymask: function() {
            return h({
                action: "getemptymask"
            }, this.maskset || g(this.opts, this.noMasksCache), this.opts)
        },
        hasMaskedValue: function() {
            return !this.opts.autoUnmask
        },
        isComplete: function() {
            return h({
                action: "isComplete",
                el: this.el
            }, this.maskset || g(this.opts, this.noMasksCache), this.opts)
        },
        getmetadata: function() {
            return h({
                action: "getmetadata"
            }, this.maskset || g(this.opts, this.noMasksCache), this.opts)
        },
        isValid: function(a) {
            return h({
                action: "isValid",
                value: a
            }, this.maskset || g(this.opts, this.noMasksCache), this.opts)
        },
        format: function(a, b) {
            return h({
                action: "format",
                value: a,
                metadata: b
            }, this.maskset || g(this.opts, this.noMasksCache), this.opts)
        }
    },
    b.extendDefaults = function(c) {
        a.extend(!0, b.prototype.defaults, c)
    }
    ,
    b.extendDefinitions = function(c) {
        a.extend(!0, b.prototype.defaults.definitions, c)
    }
    ,
    b.extendAliases = function(c) {
        a.extend(!0, b.prototype.defaults.aliases, c)
    }
    ,
    b.format = function(a, c, d) {
        return b(c).format(a, d)
    }
    ,
    b.unmask = function(a, c) {
        return b(c).unmaskedvalue(a)
    }
    ,
    b.isValid = function(a, c) {
        return b(c).isValid(a)
    }
    ,
    b.remove = function(b) {
        a.each(b, function(a, b) {
            b.inputmask && b.inputmask.remove()
        })
    }
    ,
    b.escapeRegex = function(a) {
        var b = ["/", ".", "*", "+", "?", "|", "(", ")", "[", "]", "{", "}", "\\", "$", "^"];
        return a.replace(new RegExp("(\\" + b.join("|\\") + ")","gim"), "\\$1")
    }
    ,
    b.keyCode = {
        ALT: 18,
        BACKSPACE: 8,
        BACKSPACE_SAFARI: 127,
        CAPS_LOCK: 20,
        COMMA: 188,
        COMMAND: 91,
        COMMAND_LEFT: 91,
        COMMAND_RIGHT: 93,
        CONTROL: 17,
        DELETE: 46,
        DOWN: 40,
        END: 35,
        ENTER: 13,
        ESCAPE: 27,
        HOME: 36,
        INSERT: 45,
        LEFT: 37,
        MENU: 93,
        NUMPAD_ADD: 107,
        NUMPAD_DECIMAL: 110,
        NUMPAD_DIVIDE: 111,
        NUMPAD_ENTER: 108,
        NUMPAD_MULTIPLY: 106,
        NUMPAD_SUBTRACT: 109,
        PAGE_DOWN: 34,
        PAGE_UP: 33,
        PERIOD: 190,
        RIGHT: 39,
        SHIFT: 16,
        SPACE: 32,
        TAB: 9,
        UP: 38,
        WINDOWS: 91,
        X: 88
    };
    var i = navigator.userAgent
      , j = /mobile/i.test(i)
      , k = /iemobile/i.test(i)
      , l = /iphone/i.test(i) && !k;
    return window.Inputmask = b,
    b
});
(function(factory) {
    if (typeof define === "function" && define.amd) {
        define(["inputmask.dependencyLib", "inputmask"], factory)
    } else if (typeof exports === "object") {
        module.exports = factory(require("./inputmask.dependencyLib.jquery"), require("./inputmask"))
    } else {
        factory(window.dependencyLib || jQuery, window.Inputmask)
    }
}
)(function($, Inputmask) {
    Inputmask.extendDefinitions({
        p: {
            validator: "[0-9]",
            cardinality: 1
        },
        g: {
            validator: "[0-9]",
            cardinality: 1
        },
        "#": {
            validator: "[0-9]",
            cardinality: 1
        },
        d: {
            validator: "0[1-9]|[12][0-9]|3[01]",
            cardinality: 2,
            prevalidator: [{
                validator: "[0-3]",
                cardinality: 1
            }]
        },
        m: {
            validator: "0[1-9]|1[012]",
            cardinality: 2,
            prevalidator: [{
                validator: "[01]",
                cardinality: 1
            }]
        },
        y: {
            validator: "\\d{2}",
            cardinality: 2,
            prevalidator: [{
                validator: "[01]",
                cardinality: 1
            }, {
                validator: "[01]\\d",
                cardinality: 2
            }]
        }
    });
    Inputmask.extendAliases({
        "dd/mm/yyyy": {
            mask: "1/2/y",
            placeholder: "dd/mm/yyyy",
            regex: {
                val1pre: new RegExp("[0-3]"),
                val1: new RegExp("0[1-9]|[12][0-9]|3[01]"),
                val2pre: function(separator) {
                    var escapedSeparator = Inputmask.escapeRegex.call(this, separator);
                    return new RegExp("((0[1-9]|[12][0-9]|3[01])" + escapedSeparator + "[01])")
                },
                val2: function(separator) {
                    var escapedSeparator = Inputmask.escapeRegex.call(this, separator);
                    return new RegExp("((0[1-9]|[12][0-9])" + escapedSeparator + "(0[1-9]|1[012]))|(30" + escapedSeparator + "(0[13-9]|1[012]))|(31" + escapedSeparator + "(0[13578]|1[02]))")
                }
            },
            leapday: "29/02/",
            separator: "/",
            yearrange: {
                minyear: 0,
                maxyear: 99
            },
            isInYearRange: function(chrs, minyear, maxyear) {
                if (isNaN(chrs))
                    return false;
                var enteredyear = parseInt(chrs.concat(minyear.toString().slice(chrs.length)));
                var enteredyear2 = parseInt(chrs.concat(maxyear.toString().slice(chrs.length)));
                return (!isNaN(enteredyear) ? minyear <= enteredyear && enteredyear <= maxyear : false) || (!isNaN(enteredyear2) ? minyear <= enteredyear2 && enteredyear2 <= maxyear : false)
            },
            determinebaseyear: function(minyear, maxyear, hint) {
                var currentyear = (new Date).getFullYear();
                if (minyear > currentyear)
                    return minyear;
                if (maxyear < currentyear) {
                    var maxYearPrefix = maxyear.toString().slice(0, 2);
                    var maxYearPostfix = maxyear.toString().slice(2, 4);
                    while (maxyear < maxYearPrefix + hint) {
                        maxYearPrefix--
                    }
                    var maxxYear = maxYearPrefix + maxYearPostfix;
                    return minyear > maxxYear ? minyear : maxxYear
                }
                if (minyear <= currentyear && currentyear <= maxyear) {
                    var currentYearPrefix = currentyear.toString().slice(0, 2);
                    while (maxyear < currentYearPrefix + hint) {
                        currentYearPrefix--
                    }
                    var currentYearAndHint = currentYearPrefix + hint;
                    return currentYearAndHint < minyear ? minyear : currentYearAndHint
                }
                return currentyear
            },
            onKeyDown: function(e, buffer, caretPos, opts) {
                var $input = $(this);
                if (e.ctrlKey && e.keyCode === Inputmask.keyCode.RIGHT) {
                    var today = new Date;
                    $input.val(today.getDate().toString() + (today.getMonth() + 1).toString() + today.getFullYear().toString());
                    $input.trigger("setvalue")
                }
            },
            getFrontValue: function(mask, buffer, opts) {
                var start = 0
                  , length = 0;
                for (var i = 0; i < mask.length; i++) {
                    if (mask.charAt(i) === "2")
                        break;
                    var definition = opts.definitions[mask.charAt(i)];
                    if (definition) {
                        start += length;
                        length = definition.cardinality
                    } else
                        length++
                }
                return buffer.join("").substr(start, length)
            },
            definitions: {
                1: {
                    validator: function(chrs, maskset, pos, strict, opts) {
                        var isValid = opts.regex.val1.test(chrs);
                        if (!strict && !isValid) {
                            if (chrs.charAt(1) === opts.separator || "-./".indexOf(chrs.charAt(1)) !== -1) {
                                isValid = opts.regex.val1.test("0" + chrs.charAt(0));
                                if (isValid) {
                                    maskset.buffer[pos - 1] = "0";
                                    return {
                                        refreshFromBuffer: {
                                            start: pos - 1,
                                            end: pos
                                        },
                                        pos: pos,
                                        c: chrs.charAt(0)
                                    }
                                }
                            }
                        }
                        return isValid
                    },
                    cardinality: 2,
                    prevalidator: [{
                        validator: function(chrs, maskset, pos, strict, opts) {
                            var pchrs = chrs;
                            if (!isNaN(maskset.buffer[pos + 1]))
                                pchrs += maskset.buffer[pos + 1];
                            var isValid = pchrs.length === 1 ? opts.regex.val1pre.test(pchrs) : opts.regex.val1.test(pchrs);
                            if (!strict && !isValid) {
                                isValid = opts.regex.val1.test(chrs + "0");
                                if (isValid) {
                                    maskset.buffer[pos] = chrs;
                                    maskset.buffer[++pos] = "0";
                                    return {
                                        pos: pos,
                                        c: "0"
                                    }
                                }
                                isValid = opts.regex.val1.test("0" + chrs);
                                if (isValid) {
                                    maskset.buffer[pos] = "0";
                                    pos++;
                                    return {
                                        pos: pos
                                    }
                                }
                            }
                            return isValid
                        },
                        cardinality: 1
                    }]
                },
                2: {
                    validator: function(chrs, maskset, pos, strict, opts) {
                        var frontValue = opts.getFrontValue(maskset.mask, maskset.buffer, opts);
                        if (frontValue.indexOf(opts.placeholder[0]) !== -1)
                            frontValue = "01" + opts.separator;
                        var isValid = opts.regex.val2(opts.separator).test(frontValue + chrs);
                        if (!strict && !isValid) {
                            if (chrs.charAt(1) === opts.separator || "-./".indexOf(chrs.charAt(1)) !== -1) {
                                isValid = opts.regex.val2(opts.separator).test(frontValue + "0" + chrs.charAt(0));
                                if (isValid) {
                                    maskset.buffer[pos - 1] = "0";
                                    return {
                                        refreshFromBuffer: {
                                            start: pos - 1,
                                            end: pos
                                        },
                                        pos: pos,
                                        c: chrs.charAt(0)
                                    }
                                }
                            }
                        }
                        if (opts.mask.indexOf("2") === opts.mask.length - 1 && isValid) {
                            var dayMonthValue = maskset.buffer.join("").substr(4, 4) + chrs;
                            if (dayMonthValue !== opts.leapday) {
                                return true
                            } else {
                                var year = parseInt(maskset.buffer.join("").substr(0, 4), 10);
                                if (year % 4 === 0) {
                                    if (year % 100 === 0) {
                                        if (year % 400 === 0) {
                                            return true
                                        } else {
                                            return false
                                        }
                                    } else {
                                        return true
                                    }
                                } else
                                    return false
                            }
                        }
                        return isValid
                    },
                    cardinality: 2,
                    prevalidator: [{
                        validator: function(chrs, maskset, pos, strict, opts) {
                            if (!isNaN(maskset.buffer[pos + 1]))
                                chrs += maskset.buffer[pos + 1];
                            var frontValue = opts.getFrontValue(maskset.mask, maskset.buffer, opts);
                            if (frontValue.indexOf(opts.placeholder[0]) !== -1)
                                frontValue = "01" + opts.separator;
                            var isValid = chrs.length === 1 ? opts.regex.val2pre(opts.separator).test(frontValue + chrs) : opts.regex.val2(opts.separator).test(frontValue + chrs);
                            if (!strict && !isValid) {
                                isValid = opts.regex.val2(opts.separator).test(frontValue + "0" + chrs);
                                if (isValid) {
                                    maskset.buffer[pos] = "0";
                                    pos++;
                                    return {
                                        pos: pos
                                    }
                                }
                            }
                            return isValid
                        },
                        cardinality: 1
                    }]
                },
                y: {
                    validator: function(chrs, maskset, pos, strict, opts) {
                        if (opts.isInYearRange(chrs, opts.yearrange.minyear, opts.yearrange.maxyear)) {
                            var dayMonthValue = maskset.buffer.join("").substr(0, 6);
                            if (dayMonthValue !== opts.leapday) {
                                return true
                            } else {
                                var year = parseInt(chrs, 10);
                                if (year % 4 === 0) {
                                    if (year % 100 === 0) {
                                        if (year % 400 === 0)
                                            return true;
                                        else
                                            return false
                                    } else
                                        return true
                                } else
                                    return false
                            }
                        } else
                            return false
                    },
                    cardinality: 2,
                    prevalidator: [{
                        validator: function(chrs, maskset, pos, strict, opts) {
                            var isValid = opts.isInYearRange(chrs + "0", opts.yearrange.minyear, opts.yearrange.maxyear);
                            if (!strict && !isValid) {
                                var yearPrefix = opts.determinebaseyear(opts.yearrange.minyear, opts.yearrange.maxyear, chrs + "0").toString().slice(0, 1);
                                isValid = opts.isInYearRange(yearPrefix + chrs, opts.yearrange.minyear, opts.yearrange.maxyear);
                                if (isValid) {
                                    maskset.buffer[pos++] = yearPrefix.charAt(0);
                                    return {
                                        pos: pos
                                    }
                                }
                                yearPrefix = opts.determinebaseyear(opts.yearrange.minyear, opts.yearrange.maxyear, chrs + "0").toString().slice(0, 2);
                                isValid = opts.isInYearRange(yearPrefix + chrs, opts.yearrange.minyear, opts.yearrange.maxyear);
                                if (isValid) {
                                    maskset.buffer[pos++] = yearPrefix.charAt(0);
                                    maskset.buffer[pos++] = yearPrefix.charAt(1);
                                    return {
                                        pos: pos
                                    }
                                }
                            }
                            return isValid
                        },
                        cardinality: 1
                    }]
                }
            },
            insertMode: false,
            autoUnmask: false
        },
        "mm/dd/yyyy": {
            placeholder: "mm/dd/yyyy",
            alias: "dd/mm/yyyy",
            regex: {
                val2pre: function(separator) {
                    var escapedSeparator = Inputmask.escapeRegex.call(this, separator);
                    return new RegExp("((0[13-9]|1[012])" + escapedSeparator + "[0-3])|(02" + escapedSeparator + "[0-2])")
                },
                val2: function(separator) {
                    var escapedSeparator = Inputmask.escapeRegex.call(this, separator);
                    return new RegExp("((0[1-9]|1[012])" + escapedSeparator + "(0[1-9]|[12][0-9]))|((0[13-9]|1[012])" + escapedSeparator + "30)|((0[13578]|1[02])" + escapedSeparator + "31)")
                },
                val1pre: new RegExp("[01]"),
                val1: new RegExp("0[1-9]|1[012]")
            },
            leapday: "02/29/",
            onKeyDown: function(e, buffer, caretPos, opts) {
                var $input = $(this);
                if (e.ctrlKey && e.keyCode === Inputmask.keyCode.RIGHT) {
                    var today = new Date;
                    $input.val((today.getMonth() + 1).toString() + today.getDate().toString() + today.getFullYear().toString());
                    $input.trigger("setvalue")
                }
            }
        },
        "yyyy/mm/dd": {
            mask: "y/1/2",
            placeholder: "yyyy/mm/dd",
            alias: "mm/dd/yyyy",
            leapday: "/02/29",
            onKeyDown: function(e, buffer, caretPos, opts) {
                var $input = $(this);
                if (e.ctrlKey && e.keyCode === Inputmask.keyCode.RIGHT) {
                    var today = new Date;
                    $input.val(today.getFullYear().toString() + (today.getMonth() + 1).toString() + today.getDate().toString());
                    $input.trigger("setvalue")
                }
            }
        },
        "YYMMDDPB###G": {
            mask: "y12pp###g",
            placeholder: "",
            leapday: "0229",
            separator: "",
            alias: "yyyy/mm/dd"
        }
    });
    return Inputmask
});
!function(a) {
    "function" == typeof define && define.amd ? define(["jquery", "inputmask"], a) : "object" == typeof exports ? module.exports = a(require("jquery"), require("./inputmask")) : a(jQuery, window.Inputmask)
}(function(a, b) {
    return void 0 === a.fn.inputmask && (a.fn.inputmask = function(c, d) {
        var e, f = this[0];
        if (void 0 === d && (d = {}),
        "string" == typeof c)
            switch (c) {
            case "unmaskedvalue":
                return f && f.inputmask ? f.inputmask.unmaskedvalue() : a(f).val();
            case "remove":
                return this.each(function() {
                    this.inputmask && this.inputmask.remove()
                });
            case "getemptymask":
                return f && f.inputmask ? f.inputmask.getemptymask() : "";
            case "hasMaskedValue":
                return f && f.inputmask ? f.inputmask.hasMaskedValue() : !1;
            case "isComplete":
                return f && f.inputmask ? f.inputmask.isComplete() : !0;
            case "getmetadata":
                return f && f.inputmask ? f.inputmask.getmetadata() : void 0;
            case "setvalue":
                a(f).val(d),
                f && void 0 !== f.inputmask && a(f).triggerHandler("setvalue");
                break;
            case "option":
                if ("string" != typeof d)
                    return this.each(function() {
                        return void 0 !== this.inputmask ? this.inputmask.option(d) : void 0
                    });
                if (f && void 0 !== f.inputmask)
                    return f.inputmask.option(d);
                break;
            default:
                return d.alias = c,
                e = new b(d),
                this.each(function() {
                    e.mask(this)
                })
            }
        else {
            if ("object" == typeof c)
                return e = new b(c),
                void 0 === c.mask && void 0 === c.alias ? this.each(function() {
                    return void 0 !== this.inputmask ? this.inputmask.option(c) : void e.mask(this)
                }) : this.each(function() {
                    e.mask(this)
                });
            if (void 0 === c)
                return this.each(function() {
                    e = new b(d),
                    e.mask(this)
                })
        }
    }
    ),
    a.fn.inputmask
});
!function(a, b) {
    "object" == typeof exports && "undefined" != typeof module ? module.exports = b() : "function" == typeof define && define.amd ? define(b) : a.moment = b()
}(this, function() {
    "use strict";
    function a() {
        return md.apply(null, arguments)
    }
    function b(a) {
        md = a
    }
    function c(a) {
        return a instanceof Array || "[object Array]" === Object.prototype.toString.call(a)
    }
    function d(a) {
        return "[object Object]" === Object.prototype.toString.call(a)
    }
    function e(a) {
        var b;
        for (b in a)
            return !1;
        return !0
    }
    function f(a) {
        return a instanceof Date || "[object Date]" === Object.prototype.toString.call(a)
    }
    function g(a, b) {
        var c, d = [];
        for (c = 0; c < a.length; ++c)
            d.push(b(a[c], c));
        return d
    }
    function h(a, b) {
        return Object.prototype.hasOwnProperty.call(a, b)
    }
    function i(a, b) {
        for (var c in b)
            h(b, c) && (a[c] = b[c]);
        return h(b, "toString") && (a.toString = b.toString),
        h(b, "valueOf") && (a.valueOf = b.valueOf),
        a
    }
    function j(a, b, c, d) {
        return qb(a, b, c, d, !0).utc()
    }
    function k() {
        return {
            empty: !1,
            unusedTokens: [],
            unusedInput: [],
            overflow: -2,
            charsLeftOver: 0,
            nullInput: !1,
            invalidMonth: null,
            invalidFormat: !1,
            userInvalidated: !1,
            iso: !1,
            parsedDateParts: [],
            meridiem: null
        }
    }
    function l(a) {
        return null == a._pf && (a._pf = k()),
        a._pf
    }
    function m(a) {
        if (null == a._isValid) {
            var b = l(a)
              , c = nd.call(b.parsedDateParts, function(a) {
                return null != a
            });
            a._isValid = !isNaN(a._d.getTime()) && b.overflow < 0 && !b.empty && !b.invalidMonth && !b.invalidWeekday && !b.nullInput && !b.invalidFormat && !b.userInvalidated && (!b.meridiem || b.meridiem && c),
            a._strict && (a._isValid = a._isValid && 0 === b.charsLeftOver && 0 === b.unusedTokens.length && void 0 === b.bigHour)
        }
        return a._isValid
    }
    function n(a) {
        var b = j(NaN);
        return null != a ? i(l(b), a) : l(b).userInvalidated = !0,
        b
    }
    function o(a) {
        return void 0 === a
    }
    function p(a, b) {
        var c, d, e;
        if (o(b._isAMomentObject) || (a._isAMomentObject = b._isAMomentObject),
        o(b._i) || (a._i = b._i),
        o(b._f) || (a._f = b._f),
        o(b._l) || (a._l = b._l),
        o(b._strict) || (a._strict = b._strict),
        o(b._tzm) || (a._tzm = b._tzm),
        o(b._isUTC) || (a._isUTC = b._isUTC),
        o(b._offset) || (a._offset = b._offset),
        o(b._pf) || (a._pf = l(b)),
        o(b._locale) || (a._locale = b._locale),
        od.length > 0)
            for (c in od)
                d = od[c],
                e = b[d],
                o(e) || (a[d] = e);
        return a
    }
    function q(b) {
        p(this, b),
        this._d = new Date(null != b._d ? b._d.getTime() : NaN),
        pd === !1 && (pd = !0,
        a.updateOffset(this),
        pd = !1)
    }
    function r(a) {
        return a instanceof q || null != a && null != a._isAMomentObject
    }
    function s(a) {
        return 0 > a ? Math.ceil(a) || 0 : Math.floor(a)
    }
    function t(a) {
        var b = +a
          , c = 0;
        return 0 !== b && isFinite(b) && (c = s(b)),
        c
    }
    function u(a, b, c) {
        var d, e = Math.min(a.length, b.length), f = Math.abs(a.length - b.length), g = 0;
        for (d = 0; e > d; d++)
            (c && a[d] !== b[d] || !c && t(a[d]) !== t(b[d])) && g++;
        return g + f
    }
    function v(b) {
        a.suppressDeprecationWarnings === !1 && "undefined" != typeof console && console.warn && console.warn("Deprecation warning: " + b)
    }
    function w(b, c) {
        var d = !0;
        return i(function() {
            return null != a.deprecationHandler && a.deprecationHandler(null, b),
            d && (v(b + "\nArguments: " + Array.prototype.slice.call(arguments).join(", ") + "\n" + (new Error).stack),
            d = !1),
            c.apply(this, arguments)
        }, c)
    }
    function x(b, c) {
        null != a.deprecationHandler && a.deprecationHandler(b, c),
        qd[b] || (v(c),
        qd[b] = !0)
    }
    function y(a) {
        return a instanceof Function || "[object Function]" === Object.prototype.toString.call(a)
    }
    function z(a) {
        var b, c;
        for (c in a)
            b = a[c],
            y(b) ? this[c] = b : this["_" + c] = b;
        this._config = a,
        this._ordinalParseLenient = new RegExp(this._ordinalParse.source + "|" + /\d{1,2}/.source)
    }
    function A(a, b) {
        var c, e = i({}, a);
        for (c in b)
            h(b, c) && (d(a[c]) && d(b[c]) ? (e[c] = {},
            i(e[c], a[c]),
            i(e[c], b[c])) : null != b[c] ? e[c] = b[c] : delete e[c]);
        for (c in a)
            h(a, c) && !h(b, c) && d(a[c]) && (e[c] = i({}, e[c]));
        return e
    }
    function B(a) {
        null != a && this.set(a)
    }
    function C(a, b, c) {
        var d = this._calendar[a] || this._calendar.sameElse;
        return y(d) ? d.call(b, c) : d
    }
    function D(a) {
        var b = this._longDateFormat[a]
          , c = this._longDateFormat[a.toUpperCase()];
        return b || !c ? b : (this._longDateFormat[a] = c.replace(/MMMM|MM|DD|dddd/g, function(a) {
            return a.slice(1)
        }),
        this._longDateFormat[a])
    }
    function E() {
        return this._invalidDate
    }
    function F(a) {
        return this._ordinal.replace("%d", a)
    }
    function G(a, b, c, d) {
        var e = this._relativeTime[c];
        return y(e) ? e(a, b, c, d) : e.replace(/%d/i, a)
    }
    function H(a, b) {
        var c = this._relativeTime[a > 0 ? "future" : "past"];
        return y(c) ? c(b) : c.replace(/%s/i, b)
    }
    function I(a, b) {
        var c = a.toLowerCase();
        zd[c] = zd[c + "s"] = zd[b] = a
    }
    function J(a) {
        return "string" == typeof a ? zd[a] || zd[a.toLowerCase()] : void 0
    }
    function K(a) {
        var b, c, d = {};
        for (c in a)
            h(a, c) && (b = J(c),
            b && (d[b] = a[c]));
        return d
    }
    function L(a, b) {
        Ad[a] = b
    }
    function M(a) {
        var b = [];
        for (var c in a)
            b.push({
                unit: c,
                priority: Ad[c]
            });
        return b.sort(function(a, b) {
            return a.priority - b.priority
        }),
        b
    }
    function N(b, c) {
        return function(d) {
            return null != d ? (P(this, b, d),
            a.updateOffset(this, c),
            this) : O(this, b)
        }
    }
    function O(a, b) {
        return a.isValid() ? a._d["get" + (a._isUTC ? "UTC" : "") + b]() : NaN
    }
    function P(a, b, c) {
        a.isValid() && a._d["set" + (a._isUTC ? "UTC" : "") + b](c)
    }
    function Q(a) {
        return a = J(a),
        y(this[a]) ? this[a]() : this
    }
    function R(a, b) {
        if ("object" == typeof a) {
            a = K(a);
            for (var c = M(a), d = 0; d < c.length; d++)
                this[c[d].unit](a[c[d].unit])
        } else if (a = J(a),
        y(this[a]))
            return this[a](b);
        return this
    }
    function S(a, b, c) {
        var d = "" + Math.abs(a)
          , e = b - d.length
          , f = a >= 0;
        return (f ? c ? "+" : "" : "-") + Math.pow(10, Math.max(0, e)).toString().substr(1) + d
    }
    function T(a, b, c, d) {
        var e = d;
        "string" == typeof d && (e = function() {
            return this[d]()
        }
        ),
        a && (Ed[a] = e),
        b && (Ed[b[0]] = function() {
            return S(e.apply(this, arguments), b[1], b[2])
        }
        ),
        c && (Ed[c] = function() {
            return this.localeData().ordinal(e.apply(this, arguments), a)
        }
        )
    }
    function U(a) {
        return a.match(/\[[\s\S]/) ? a.replace(/^\[|\]$/g, "") : a.replace(/\\/g, "")
    }
    function V(a) {
        var b, c, d = a.match(Bd);
        for (b = 0,
        c = d.length; c > b; b++)
            Ed[d[b]] ? d[b] = Ed[d[b]] : d[b] = U(d[b]);
        return function(b) {
            var e, f = "";
            for (e = 0; c > e; e++)
                f += d[e]instanceof Function ? d[e].call(b, a) : d[e];
            return f
        }
    }
    function W(a, b) {
        return a.isValid() ? (b = X(b, a.localeData()),
        Dd[b] = Dd[b] || V(b),
        Dd[b](a)) : a.localeData().invalidDate()
    }
    function X(a, b) {
        function c(a) {
            return b.longDateFormat(a) || a
        }
        var d = 5;
        for (Cd.lastIndex = 0; d >= 0 && Cd.test(a); )
            a = a.replace(Cd, c),
            Cd.lastIndex = 0,
            d -= 1;
        return a
    }
    function Y(a, b, c) {
        Wd[a] = y(b) ? b : function(a, d) {
            return a && c ? c : b
        }
    }
    function Z(a, b) {
        return h(Wd, a) ? Wd[a](b._strict, b._locale) : new RegExp($(a))
    }
    function $(a) {
        return _(a.replace("\\", "").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function(a, b, c, d, e) {
            return b || c || d || e
        }))
    }
    function _(a) {
        return a.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&")
    }
    function aa(a, b) {
        var c, d = b;
        for ("string" == typeof a && (a = [a]),
        "number" == typeof b && (d = function(a, c) {
            c[b] = t(a)
        }
        ),
        c = 0; c < a.length; c++)
            Xd[a[c]] = d
    }
    function ba(a, b) {
        aa(a, function(a, c, d, e) {
            d._w = d._w || {},
            b(a, d._w, d, e)
        })
    }
    function ca(a, b, c) {
        null != b && h(Xd, a) && Xd[a](b, c._a, c, a)
    }
    function da(a, b) {
        return new Date(Date.UTC(a, b + 1, 0)).getUTCDate()
    }
    function ea(a, b) {
        return c(this._months) ? this._months[a.month()] : this._months[(this._months.isFormat || fe).test(b) ? "format" : "standalone"][a.month()]
    }
    function fa(a, b) {
        return c(this._monthsShort) ? this._monthsShort[a.month()] : this._monthsShort[fe.test(b) ? "format" : "standalone"][a.month()]
    }
    function ga(a, b, c) {
        var d, e, f, g = a.toLocaleLowerCase();
        if (!this._monthsParse)
            for (this._monthsParse = [],
            this._longMonthsParse = [],
            this._shortMonthsParse = [],
            d = 0; 12 > d; ++d)
                f = j([2e3, d]),
                this._shortMonthsParse[d] = this.monthsShort(f, "").toLocaleLowerCase(),
                this._longMonthsParse[d] = this.months(f, "").toLocaleLowerCase();
        return c ? "MMM" === b ? (e = sd.call(this._shortMonthsParse, g),
        -1 !== e ? e : null) : (e = sd.call(this._longMonthsParse, g),
        -1 !== e ? e : null) : "MMM" === b ? (e = sd.call(this._shortMonthsParse, g),
        -1 !== e ? e : (e = sd.call(this._longMonthsParse, g),
        -1 !== e ? e : null)) : (e = sd.call(this._longMonthsParse, g),
        -1 !== e ? e : (e = sd.call(this._shortMonthsParse, g),
        -1 !== e ? e : null))
    }
    function ha(a, b, c) {
        var d, e, f;
        if (this._monthsParseExact)
            return ga.call(this, a, b, c);
        for (this._monthsParse || (this._monthsParse = [],
        this._longMonthsParse = [],
        this._shortMonthsParse = []),
        d = 0; 12 > d; d++) {
            if (e = j([2e3, d]),
            c && !this._longMonthsParse[d] && (this._longMonthsParse[d] = new RegExp("^" + this.months(e, "").replace(".", "") + "$","i"),
            this._shortMonthsParse[d] = new RegExp("^" + this.monthsShort(e, "").replace(".", "") + "$","i")),
            c || this._monthsParse[d] || (f = "^" + this.months(e, "") + "|^" + this.monthsShort(e, ""),
            this._monthsParse[d] = new RegExp(f.replace(".", ""),"i")),
            c && "MMMM" === b && this._longMonthsParse[d].test(a))
                return d;
            if (c && "MMM" === b && this._shortMonthsParse[d].test(a))
                return d;
            if (!c && this._monthsParse[d].test(a))
                return d
        }
    }
    function ia(a, b) {
        var c;
        if (!a.isValid())
            return a;
        if ("string" == typeof b)
            if (/^\d+$/.test(b))
                b = t(b);
            else if (b = a.localeData().monthsParse(b),
            "number" != typeof b)
                return a;
        return c = Math.min(a.date(), da(a.year(), b)),
        a._d["set" + (a._isUTC ? "UTC" : "") + "Month"](b, c),
        a
    }
    function ja(b) {
        return null != b ? (ia(this, b),
        a.updateOffset(this, !0),
        this) : O(this, "Month")
    }
    function ka() {
        return da(this.year(), this.month())
    }
    function la(a) {
        return this._monthsParseExact ? (h(this, "_monthsRegex") || na.call(this),
        a ? this._monthsShortStrictRegex : this._monthsShortRegex) : (h(this, "_monthsShortRegex") || (this._monthsShortRegex = ie),
        this._monthsShortStrictRegex && a ? this._monthsShortStrictRegex : this._monthsShortRegex)
    }
    function ma(a) {
        return this._monthsParseExact ? (h(this, "_monthsRegex") || na.call(this),
        a ? this._monthsStrictRegex : this._monthsRegex) : (h(this, "_monthsRegex") || (this._monthsRegex = je),
        this._monthsStrictRegex && a ? this._monthsStrictRegex : this._monthsRegex)
    }
    function na() {
        function a(a, b) {
            return b.length - a.length
        }
        var b, c, d = [], e = [], f = [];
        for (b = 0; 12 > b; b++)
            c = j([2e3, b]),
            d.push(this.monthsShort(c, "")),
            e.push(this.months(c, "")),
            f.push(this.months(c, "")),
            f.push(this.monthsShort(c, ""));
        for (d.sort(a),
        e.sort(a),
        f.sort(a),
        b = 0; 12 > b; b++)
            d[b] = _(d[b]),
            e[b] = _(e[b]);
        for (b = 0; 24 > b; b++)
            f[b] = _(f[b]);
        this._monthsRegex = new RegExp("^(" + f.join("|") + ")","i"),
        this._monthsShortRegex = this._monthsRegex,
        this._monthsStrictRegex = new RegExp("^(" + e.join("|") + ")","i"),
        this._monthsShortStrictRegex = new RegExp("^(" + d.join("|") + ")","i")
    }
    function oa(a) {
        return pa(a) ? 366 : 365
    }
    function pa(a) {
        return a % 4 === 0 && a % 100 !== 0 || a % 400 === 0
    }
    function qa() {
        return pa(this.year())
    }
    function ra(a, b, c, d, e, f, g) {
        var h = new Date(a,b,c,d,e,f,g);
        return 100 > a && a >= 0 && isFinite(h.getFullYear()) && h.setFullYear(a),
        h
    }
    function sa(a) {
        var b = new Date(Date.UTC.apply(null, arguments));
        return 100 > a && a >= 0 && isFinite(b.getUTCFullYear()) && b.setUTCFullYear(a),
        b
    }
    function ta(a, b, c) {
        var d = 7 + b - c
          , e = (7 + sa(a, 0, d).getUTCDay() - b) % 7;
        return -e + d - 1
    }
    function ua(a, b, c, d, e) {
        var f, g, h = (7 + c - d) % 7, i = ta(a, d, e), j = 1 + 7 * (b - 1) + h + i;
        return 0 >= j ? (f = a - 1,
        g = oa(f) + j) : j > oa(a) ? (f = a + 1,
        g = j - oa(a)) : (f = a,
        g = j),
        {
            year: f,
            dayOfYear: g
        }
    }
    function va(a, b, c) {
        var d, e, f = ta(a.year(), b, c), g = Math.floor((a.dayOfYear() - f - 1) / 7) + 1;
        return 1 > g ? (e = a.year() - 1,
        d = g + wa(e, b, c)) : g > wa(a.year(), b, c) ? (d = g - wa(a.year(), b, c),
        e = a.year() + 1) : (e = a.year(),
        d = g),
        {
            week: d,
            year: e
        }
    }
    function wa(a, b, c) {
        var d = ta(a, b, c)
          , e = ta(a + 1, b, c);
        return (oa(a) - d + e) / 7
    }
    function xa(a) {
        return va(a, this._week.dow, this._week.doy).week
    }
    function ya() {
        return this._week.dow
    }
    function za() {
        return this._week.doy
    }
    function Aa(a) {
        var b = this.localeData().week(this);
        return null == a ? b : this.add(7 * (a - b), "d")
    }
    function Ba(a) {
        var b = va(this, 1, 4).week;
        return null == a ? b : this.add(7 * (a - b), "d")
    }
    function Ca(a, b) {
        return "string" != typeof a ? a : isNaN(a) ? (a = b.weekdaysParse(a),
        "number" == typeof a ? a : null) : parseInt(a, 10)
    }
    function Da(a, b) {
        return "string" == typeof a ? b.weekdaysParse(a) % 7 || 7 : isNaN(a) ? null : a
    }
    function Ea(a, b) {
        return c(this._weekdays) ? this._weekdays[a.day()] : this._weekdays[this._weekdays.isFormat.test(b) ? "format" : "standalone"][a.day()]
    }
    function Fa(a) {
        return this._weekdaysShort[a.day()]
    }
    function Ga(a) {
        return this._weekdaysMin[a.day()]
    }
    function Ha(a, b, c) {
        var d, e, f, g = a.toLocaleLowerCase();
        if (!this._weekdaysParse)
            for (this._weekdaysParse = [],
            this._shortWeekdaysParse = [],
            this._minWeekdaysParse = [],
            d = 0; 7 > d; ++d)
                f = j([2e3, 1]).day(d),
                this._minWeekdaysParse[d] = this.weekdaysMin(f, "").toLocaleLowerCase(),
                this._shortWeekdaysParse[d] = this.weekdaysShort(f, "").toLocaleLowerCase(),
                this._weekdaysParse[d] = this.weekdays(f, "").toLocaleLowerCase();
        return c ? "dddd" === b ? (e = sd.call(this._weekdaysParse, g),
        -1 !== e ? e : null) : "ddd" === b ? (e = sd.call(this._shortWeekdaysParse, g),
        -1 !== e ? e : null) : (e = sd.call(this._minWeekdaysParse, g),
        -1 !== e ? e : null) : "dddd" === b ? (e = sd.call(this._weekdaysParse, g),
        -1 !== e ? e : (e = sd.call(this._shortWeekdaysParse, g),
        -1 !== e ? e : (e = sd.call(this._minWeekdaysParse, g),
        -1 !== e ? e : null))) : "ddd" === b ? (e = sd.call(this._shortWeekdaysParse, g),
        -1 !== e ? e : (e = sd.call(this._weekdaysParse, g),
        -1 !== e ? e : (e = sd.call(this._minWeekdaysParse, g),
        -1 !== e ? e : null))) : (e = sd.call(this._minWeekdaysParse, g),
        -1 !== e ? e : (e = sd.call(this._weekdaysParse, g),
        -1 !== e ? e : (e = sd.call(this._shortWeekdaysParse, g),
        -1 !== e ? e : null)))
    }
    function Ia(a, b, c) {
        var d, e, f;
        if (this._weekdaysParseExact)
            return Ha.call(this, a, b, c);
        for (this._weekdaysParse || (this._weekdaysParse = [],
        this._minWeekdaysParse = [],
        this._shortWeekdaysParse = [],
        this._fullWeekdaysParse = []),
        d = 0; 7 > d; d++) {
            if (e = j([2e3, 1]).day(d),
            c && !this._fullWeekdaysParse[d] && (this._fullWeekdaysParse[d] = new RegExp("^" + this.weekdays(e, "").replace(".", ".?") + "$","i"),
            this._shortWeekdaysParse[d] = new RegExp("^" + this.weekdaysShort(e, "").replace(".", ".?") + "$","i"),
            this._minWeekdaysParse[d] = new RegExp("^" + this.weekdaysMin(e, "").replace(".", ".?") + "$","i")),
            this._weekdaysParse[d] || (f = "^" + this.weekdays(e, "") + "|^" + this.weekdaysShort(e, "") + "|^" + this.weekdaysMin(e, ""),
            this._weekdaysParse[d] = new RegExp(f.replace(".", ""),"i")),
            c && "dddd" === b && this._fullWeekdaysParse[d].test(a))
                return d;
            if (c && "ddd" === b && this._shortWeekdaysParse[d].test(a))
                return d;
            if (c && "dd" === b && this._minWeekdaysParse[d].test(a))
                return d;
            if (!c && this._weekdaysParse[d].test(a))
                return d
        }
    }
    function Ja(a) {
        if (!this.isValid())
            return null != a ? this : NaN;
        var b = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
        return null != a ? (a = Ca(a, this.localeData()),
        this.add(a - b, "d")) : b
    }
    function Ka(a) {
        if (!this.isValid())
            return null != a ? this : NaN;
        var b = (this.day() + 7 - this.localeData()._week.dow) % 7;
        return null == a ? b : this.add(a - b, "d")
    }
    function La(a) {
        if (!this.isValid())
            return null != a ? this : NaN;
        if (null != a) {
            var b = Da(a, this.localeData());
            return this.day(this.day() % 7 ? b : b - 7)
        }
        return this.day() || 7
    }
    function Ma(a) {
        return this._weekdaysParseExact ? (h(this, "_weekdaysRegex") || Pa.call(this),
        a ? this._weekdaysStrictRegex : this._weekdaysRegex) : (h(this, "_weekdaysRegex") || (this._weekdaysRegex = pe),
        this._weekdaysStrictRegex && a ? this._weekdaysStrictRegex : this._weekdaysRegex)
    }
    function Na(a) {
        return this._weekdaysParseExact ? (h(this, "_weekdaysRegex") || Pa.call(this),
        a ? this._weekdaysShortStrictRegex : this._weekdaysShortRegex) : (h(this, "_weekdaysShortRegex") || (this._weekdaysShortRegex = qe),
        this._weekdaysShortStrictRegex && a ? this._weekdaysShortStrictRegex : this._weekdaysShortRegex)
    }
    function Oa(a) {
        return this._weekdaysParseExact ? (h(this, "_weekdaysRegex") || Pa.call(this),
        a ? this._weekdaysMinStrictRegex : this._weekdaysMinRegex) : (h(this, "_weekdaysMinRegex") || (this._weekdaysMinRegex = re),
        this._weekdaysMinStrictRegex && a ? this._weekdaysMinStrictRegex : this._weekdaysMinRegex)
    }
    function Pa() {
        function a(a, b) {
            return b.length - a.length
        }
        var b, c, d, e, f, g = [], h = [], i = [], k = [];
        for (b = 0; 7 > b; b++)
            c = j([2e3, 1]).day(b),
            d = this.weekdaysMin(c, ""),
            e = this.weekdaysShort(c, ""),
            f = this.weekdays(c, ""),
            g.push(d),
            h.push(e),
            i.push(f),
            k.push(d),
            k.push(e),
            k.push(f);
        for (g.sort(a),
        h.sort(a),
        i.sort(a),
        k.sort(a),
        b = 0; 7 > b; b++)
            h[b] = _(h[b]),
            i[b] = _(i[b]),
            k[b] = _(k[b]);
        this._weekdaysRegex = new RegExp("^(" + k.join("|") + ")","i"),
        this._weekdaysShortRegex = this._weekdaysRegex,
        this._weekdaysMinRegex = this._weekdaysRegex,
        this._weekdaysStrictRegex = new RegExp("^(" + i.join("|") + ")","i"),
        this._weekdaysShortStrictRegex = new RegExp("^(" + h.join("|") + ")","i"),
        this._weekdaysMinStrictRegex = new RegExp("^(" + g.join("|") + ")","i")
    }
    function Qa() {
        return this.hours() % 12 || 12
    }
    function Ra() {
        return this.hours() || 24
    }
    function Sa(a, b) {
        T(a, 0, 0, function() {
            return this.localeData().meridiem(this.hours(), this.minutes(), b)
        })
    }
    function Ta(a, b) {
        return b._meridiemParse
    }
    function Ua(a) {
        return "p" === (a + "").toLowerCase().charAt(0)
    }
    function Va(a, b, c) {
        return a > 11 ? c ? "pm" : "PM" : c ? "am" : "AM"
    }
    function Wa(a) {
        return a ? a.toLowerCase().replace("_", "-") : a
    }
    function Xa(a) {
        for (var b, c, d, e, f = 0; f < a.length; ) {
            for (e = Wa(a[f]).split("-"),
            b = e.length,
            c = Wa(a[f + 1]),
            c = c ? c.split("-") : null; b > 0; ) {
                if (d = Ya(e.slice(0, b).join("-")))
                    return d;
                if (c && c.length >= b && u(e, c, !0) >= b - 1)
                    break;
                b--
            }
            f++
        }
        return null
    }
    function Ya(a) {
        var b = null;
        if (!we[a] && "undefined" != typeof module && module && module.exports)
            try {
                b = se._abbr,
                require("./locale/" + a),
                Za(b)
            } catch (c) {}
        return we[a]
    }
    function Za(a, b) {
        var c;
        return a && (c = o(b) ? ab(a) : $a(a, b),
        c && (se = c)),
        se._abbr
    }
    function $a(a, b) {
        if (null !== b) {
            var c = ve;
            return b.abbr = a,
            null != we[a] ? (x("defineLocaleOverride", "use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),
            c = we[a]._config) : null != b.parentLocale && (null != we[b.parentLocale] ? c = we[b.parentLocale]._config : x("parentLocaleUndefined", "specified parentLocale is not defined yet. See http://momentjs.com/guides/#/warnings/parent-locale/")),
            we[a] = new B(A(c, b)),
            Za(a),
            we[a]
        }
        return delete we[a],
        null
    }
    function _a(a, b) {
        if (null != b) {
            var c, d = ve;
            null != we[a] && (d = we[a]._config),
            b = A(d, b),
            c = new B(b),
            c.parentLocale = we[a],
            we[a] = c,
            Za(a)
        } else
            null != we[a] && (null != we[a].parentLocale ? we[a] = we[a].parentLocale : null != we[a] && delete we[a]);
        return we[a]
    }
    function ab(a) {
        var b;
        if (a && a._locale && a._locale._abbr && (a = a._locale._abbr),
        !a)
            return se;
        if (!c(a)) {
            if (b = Ya(a))
                return b;
            a = [a]
        }
        return Xa(a)
    }
    function bb() {
        return rd(we)
    }
    function cb(a) {
        var b, c = a._a;
        return c && -2 === l(a).overflow && (b = c[Zd] < 0 || c[Zd] > 11 ? Zd : c[$d] < 1 || c[$d] > da(c[Yd], c[Zd]) ? $d : c[_d] < 0 || c[_d] > 24 || 24 === c[_d] && (0 !== c[ae] || 0 !== c[be] || 0 !== c[ce]) ? _d : c[ae] < 0 || c[ae] > 59 ? ae : c[be] < 0 || c[be] > 59 ? be : c[ce] < 0 || c[ce] > 999 ? ce : -1,
        l(a)._overflowDayOfYear && (Yd > b || b > $d) && (b = $d),
        l(a)._overflowWeeks && -1 === b && (b = de),
        l(a)._overflowWeekday && -1 === b && (b = ee),
        l(a).overflow = b),
        a
    }
    function db(a) {
        var b, c, d, e, f, g, h = a._i, i = xe.exec(h) || ye.exec(h);
        if (i) {
            for (l(a).iso = !0,
            b = 0,
            c = Ae.length; c > b; b++)
                if (Ae[b][1].exec(i[1])) {
                    e = Ae[b][0],
                    d = Ae[b][2] !== !1;
                    break
                }
            if (null == e)
                return void (a._isValid = !1);
            if (i[3]) {
                for (b = 0,
                c = Be.length; c > b; b++)
                    if (Be[b][1].exec(i[3])) {
                        f = (i[2] || " ") + Be[b][0];
                        break
                    }
                if (null == f)
                    return void (a._isValid = !1)
            }
            if (!d && null != f)
                return void (a._isValid = !1);
            if (i[4]) {
                if (!ze.exec(i[4]))
                    return void (a._isValid = !1);
                g = "Z"
            }
            a._f = e + (f || "") + (g || ""),
            jb(a)
        } else
            a._isValid = !1
    }
    function eb(b) {
        var c = Ce.exec(b._i);
        return null !== c ? void (b._d = new Date(+c[1])) : (db(b),
        void (b._isValid === !1 && (delete b._isValid,
        a.createFromInputFallback(b))))
    }
    function fb(a, b, c) {
        return null != a ? a : null != b ? b : c
    }
    function gb(b) {
        var c = new Date(a.now());
        return b._useUTC ? [c.getUTCFullYear(), c.getUTCMonth(), c.getUTCDate()] : [c.getFullYear(), c.getMonth(), c.getDate()]
    }
    function hb(a) {
        var b, c, d, e, f = [];
        if (!a._d) {
            for (d = gb(a),
            a._w && null == a._a[$d] && null == a._a[Zd] && ib(a),
            a._dayOfYear && (e = fb(a._a[Yd], d[Yd]),
            a._dayOfYear > oa(e) && (l(a)._overflowDayOfYear = !0),
            c = sa(e, 0, a._dayOfYear),
            a._a[Zd] = c.getUTCMonth(),
            a._a[$d] = c.getUTCDate()),
            b = 0; 3 > b && null == a._a[b]; ++b)
                a._a[b] = f[b] = d[b];
            for (; 7 > b; b++)
                a._a[b] = f[b] = null == a._a[b] ? 2 === b ? 1 : 0 : a._a[b];
            24 === a._a[_d] && 0 === a._a[ae] && 0 === a._a[be] && 0 === a._a[ce] && (a._nextDay = !0,
            a._a[_d] = 0),
            a._d = (a._useUTC ? sa : ra).apply(null, f),
            null != a._tzm && a._d.setUTCMinutes(a._d.getUTCMinutes() - a._tzm),
            a._nextDay && (a._a[_d] = 24)
        }
    }
    function ib(a) {
        var b, c, d, e, f, g, h, i;
        b = a._w,
        null != b.GG || null != b.W || null != b.E ? (f = 1,
        g = 4,
        c = fb(b.GG, a._a[Yd], va(rb(), 1, 4).year),
        d = fb(b.W, 1),
        e = fb(b.E, 1),
        (1 > e || e > 7) && (i = !0)) : (f = a._locale._week.dow,
        g = a._locale._week.doy,
        c = fb(b.gg, a._a[Yd], va(rb(), f, g).year),
        d = fb(b.w, 1),
        null != b.d ? (e = b.d,
        (0 > e || e > 6) && (i = !0)) : null != b.e ? (e = b.e + f,
        (b.e < 0 || b.e > 6) && (i = !0)) : e = f),
        1 > d || d > wa(c, f, g) ? l(a)._overflowWeeks = !0 : null != i ? l(a)._overflowWeekday = !0 : (h = ua(c, d, e, f, g),
        a._a[Yd] = h.year,
        a._dayOfYear = h.dayOfYear)
    }
    function jb(b) {
        if (b._f === a.ISO_8601)
            return void db(b);
        b._a = [],
        l(b).empty = !0;
        var c, d, e, f, g, h = "" + b._i, i = h.length, j = 0;
        for (e = X(b._f, b._locale).match(Bd) || [],
        c = 0; c < e.length; c++)
            f = e[c],
            d = (h.match(Z(f, b)) || [])[0],
            d && (g = h.substr(0, h.indexOf(d)),
            g.length > 0 && l(b).unusedInput.push(g),
            h = h.slice(h.indexOf(d) + d.length),
            j += d.length),
            Ed[f] ? (d ? l(b).empty = !1 : l(b).unusedTokens.push(f),
            ca(f, d, b)) : b._strict && !d && l(b).unusedTokens.push(f);
        l(b).charsLeftOver = i - j,
        h.length > 0 && l(b).unusedInput.push(h),
        b._a[_d] <= 12 && l(b).bigHour === !0 && b._a[_d] > 0 && (l(b).bigHour = void 0),
        l(b).parsedDateParts = b._a.slice(0),
        l(b).meridiem = b._meridiem,
        b._a[_d] = kb(b._locale, b._a[_d], b._meridiem),
        hb(b),
        cb(b)
    }
    function kb(a, b, c) {
        var d;
        return null == c ? b : null != a.meridiemHour ? a.meridiemHour(b, c) : null != a.isPM ? (d = a.isPM(c),
        d && 12 > b && (b += 12),
        d || 12 !== b || (b = 0),
        b) : b
    }
    function lb(a) {
        var b, c, d, e, f;
        if (0 === a._f.length)
            return l(a).invalidFormat = !0,
            void (a._d = new Date(NaN));
        for (e = 0; e < a._f.length; e++)
            f = 0,
            b = p({}, a),
            null != a._useUTC && (b._useUTC = a._useUTC),
            b._f = a._f[e],
            jb(b),
            m(b) && (f += l(b).charsLeftOver,
            f += 10 * l(b).unusedTokens.length,
            l(b).score = f,
            (null == d || d > f) && (d = f,
            c = b));
        i(a, c || b)
    }
    function mb(a) {
        if (!a._d) {
            var b = K(a._i);
            a._a = g([b.year, b.month, b.day || b.date, b.hour, b.minute, b.second, b.millisecond], function(a) {
                return a && parseInt(a, 10)
            }),
            hb(a)
        }
    }
    function nb(a) {
        var b = new q(cb(ob(a)));
        return b._nextDay && (b.add(1, "d"),
        b._nextDay = void 0),
        b
    }
    function ob(a) {
        var b = a._i
          , d = a._f;
        return a._locale = a._locale || ab(a._l),
        null === b || void 0 === d && "" === b ? n({
            nullInput: !0
        }) : ("string" == typeof b && (a._i = b = a._locale.preparse(b)),
        r(b) ? new q(cb(b)) : (c(d) ? lb(a) : f(b) ? a._d = b : d ? jb(a) : pb(a),
        m(a) || (a._d = null),
        a))
    }
    function pb(b) {
        var d = b._i;
        void 0 === d ? b._d = new Date(a.now()) : f(d) ? b._d = new Date(d.valueOf()) : "string" == typeof d ? eb(b) : c(d) ? (b._a = g(d.slice(0), function(a) {
            return parseInt(a, 10)
        }),
        hb(b)) : "object" == typeof d ? mb(b) : "number" == typeof d ? b._d = new Date(d) : a.createFromInputFallback(b)
    }
    function qb(a, b, f, g, h) {
        var i = {};
        return "boolean" == typeof f && (g = f,
        f = void 0),
        (d(a) && e(a) || c(a) && 0 === a.length) && (a = void 0),
        i._isAMomentObject = !0,
        i._useUTC = i._isUTC = h,
        i._l = f,
        i._i = a,
        i._f = b,
        i._strict = g,
        nb(i)
    }
    function rb(a, b, c, d) {
        return qb(a, b, c, d, !1)
    }
    function sb(a, b) {
        var d, e;
        if (1 === b.length && c(b[0]) && (b = b[0]),
        !b.length)
            return rb();
        for (d = b[0],
        e = 1; e < b.length; ++e)
            b[e].isValid() && !b[e][a](d) || (d = b[e]);
        return d
    }
    function tb() {
        var a = [].slice.call(arguments, 0);
        return sb("isBefore", a)
    }
    function ub() {
        var a = [].slice.call(arguments, 0);
        return sb("isAfter", a)
    }
    function vb(a) {
        var b = K(a)
          , c = b.year || 0
          , d = b.quarter || 0
          , e = b.month || 0
          , f = b.week || 0
          , g = b.day || 0
          , h = b.hour || 0
          , i = b.minute || 0
          , j = b.second || 0
          , k = b.millisecond || 0;
        this._milliseconds = +k + 1e3 * j + 6e4 * i + 1e3 * h * 60 * 60,
        this._days = +g + 7 * f,
        this._months = +e + 3 * d + 12 * c,
        this._data = {},
        this._locale = ab(),
        this._bubble()
    }
    function wb(a) {
        return a instanceof vb
    }
    function xb(a, b) {
        T(a, 0, 0, function() {
            var a = this.utcOffset()
              , c = "+";
            return 0 > a && (a = -a,
            c = "-"),
            c + S(~~(a / 60), 2) + b + S(~~a % 60, 2)
        })
    }
    function yb(a, b) {
        var c = (b || "").match(a) || []
          , d = c[c.length - 1] || []
          , e = (d + "").match(Ge) || ["-", 0, 0]
          , f = +(60 * e[1]) + t(e[2]);
        return "+" === e[0] ? f : -f
    }
    function zb(b, c) {
        var d, e;
        return c._isUTC ? (d = c.clone(),
        e = (r(b) || f(b) ? b.valueOf() : rb(b).valueOf()) - d.valueOf(),
        d._d.setTime(d._d.valueOf() + e),
        a.updateOffset(d, !1),
        d) : rb(b).local()
    }
    function Ab(a) {
        return 15 * -Math.round(a._d.getTimezoneOffset() / 15)
    }
    function Bb(b, c) {
        var d, e = this._offset || 0;
        return this.isValid() ? null != b ? ("string" == typeof b ? b = yb(Td, b) : Math.abs(b) < 16 && (b = 60 * b),
        !this._isUTC && c && (d = Ab(this)),
        this._offset = b,
        this._isUTC = !0,
        null != d && this.add(d, "m"),
        e !== b && (!c || this._changeInProgress ? Sb(this, Mb(b - e, "m"), 1, !1) : this._changeInProgress || (this._changeInProgress = !0,
        a.updateOffset(this, !0),
        this._changeInProgress = null)),
        this) : this._isUTC ? e : Ab(this) : null != b ? this : NaN
    }
    function Cb(a, b) {
        return null != a ? ("string" != typeof a && (a = -a),
        this.utcOffset(a, b),
        this) : -this.utcOffset()
    }
    function Db(a) {
        return this.utcOffset(0, a)
    }
    function Eb(a) {
        return this._isUTC && (this.utcOffset(0, a),
        this._isUTC = !1,
        a && this.subtract(Ab(this), "m")),
        this
    }
    function Fb() {
        return this._tzm ? this.utcOffset(this._tzm) : "string" == typeof this._i && this.utcOffset(yb(Sd, this._i)),
        this
    }
    function Gb(a) {
        return this.isValid() ? (a = a ? rb(a).utcOffset() : 0,
        (this.utcOffset() - a) % 60 === 0) : !1
    }
    function Hb() {
        return this.utcOffset() > this.clone().month(0).utcOffset() || this.utcOffset() > this.clone().month(5).utcOffset()
    }
    function Ib() {
        if (!o(this._isDSTShifted))
            return this._isDSTShifted;
        var a = {};
        if (p(a, this),
        a = ob(a),
        a._a) {
            var b = a._isUTC ? j(a._a) : rb(a._a);
            this._isDSTShifted = this.isValid() && u(a._a, b.toArray()) > 0
        } else
            this._isDSTShifted = !1;
        return this._isDSTShifted
    }
    function Jb() {
        return this.isValid() ? !this._isUTC : !1
    }
    function Kb() {
        return this.isValid() ? this._isUTC : !1
    }
    function Lb() {
        return this.isValid() ? this._isUTC && 0 === this._offset : !1
    }
    function Mb(a, b) {
        var c, d, e, f = a, g = null;
        return wb(a) ? f = {
            ms: a._milliseconds,
            d: a._days,
            M: a._months
        } : "number" == typeof a ? (f = {},
        b ? f[b] = a : f.milliseconds = a) : (g = He.exec(a)) ? (c = "-" === g[1] ? -1 : 1,
        f = {
            y: 0,
            d: t(g[$d]) * c,
            h: t(g[_d]) * c,
            m: t(g[ae]) * c,
            s: t(g[be]) * c,
            ms: t(g[ce]) * c
        }) : (g = Ie.exec(a)) ? (c = "-" === g[1] ? -1 : 1,
        f = {
            y: Nb(g[2], c),
            M: Nb(g[3], c),
            w: Nb(g[4], c),
            d: Nb(g[5], c),
            h: Nb(g[6], c),
            m: Nb(g[7], c),
            s: Nb(g[8], c)
        }) : null == f ? f = {} : "object" == typeof f && ("from"in f || "to"in f) && (e = Pb(rb(f.from), rb(f.to)),
        f = {},
        f.ms = e.milliseconds,
        f.M = e.months),
        d = new vb(f),
        wb(a) && h(a, "_locale") && (d._locale = a._locale),
        d
    }
    function Nb(a, b) {
        var c = a && parseFloat(a.replace(",", "."));
        return (isNaN(c) ? 0 : c) * b
    }
    function Ob(a, b) {
        var c = {
            milliseconds: 0,
            months: 0
        };
        return c.months = b.month() - a.month() + 12 * (b.year() - a.year()),
        a.clone().add(c.months, "M").isAfter(b) && --c.months,
        c.milliseconds = +b - +a.clone().add(c.months, "M"),
        c
    }
    function Pb(a, b) {
        var c;
        return a.isValid() && b.isValid() ? (b = zb(b, a),
        a.isBefore(b) ? c = Ob(a, b) : (c = Ob(b, a),
        c.milliseconds = -c.milliseconds,
        c.months = -c.months),
        c) : {
            milliseconds: 0,
            months: 0
        }
    }
    function Qb(a) {
        return 0 > a ? -1 * Math.round(-1 * a) : Math.round(a)
    }
    function Rb(a, b) {
        return function(c, d) {
            var e, f;
            return null === d || isNaN(+d) || (x(b, "moment()." + b + "(period, number) is deprecated. Please use moment()." + b + "(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),
            f = c,
            c = d,
            d = f),
            c = "string" == typeof c ? +c : c,
            e = Mb(c, d),
            Sb(this, e, a),
            this
        }
    }
    function Sb(b, c, d, e) {
        var f = c._milliseconds
          , g = Qb(c._days)
          , h = Qb(c._months);
        b.isValid() && (e = null == e ? !0 : e,
        f && b._d.setTime(b._d.valueOf() + f * d),
        g && P(b, "Date", O(b, "Date") + g * d),
        h && ia(b, O(b, "Month") + h * d),
        e && a.updateOffset(b, g || h))
    }
    function Tb(a, b) {
        var c = a.diff(b, "days", !0);
        return -6 > c ? "sameElse" : -1 > c ? "lastWeek" : 0 > c ? "lastDay" : 1 > c ? "sameDay" : 2 > c ? "nextDay" : 7 > c ? "nextWeek" : "sameElse"
    }
    function Ub(b, c) {
        var d = b || rb()
          , e = zb(d, this).startOf("day")
          , f = a.calendarFormat(this, e) || "sameElse"
          , g = c && (y(c[f]) ? c[f].call(this, d) : c[f]);
        return this.format(g || this.localeData().calendar(f, this, rb(d)))
    }
    function Vb() {
        return new q(this)
    }
    function Wb(a, b) {
        var c = r(a) ? a : rb(a);
        return this.isValid() && c.isValid() ? (b = J(o(b) ? "millisecond" : b),
        "millisecond" === b ? this.valueOf() > c.valueOf() : c.valueOf() < this.clone().startOf(b).valueOf()) : !1
    }
    function Xb(a, b) {
        var c = r(a) ? a : rb(a);
        return this.isValid() && c.isValid() ? (b = J(o(b) ? "millisecond" : b),
        "millisecond" === b ? this.valueOf() < c.valueOf() : this.clone().endOf(b).valueOf() < c.valueOf()) : !1
    }
    function Yb(a, b, c, d) {
        return d = d || "()",
        ("(" === d[0] ? this.isAfter(a, c) : !this.isBefore(a, c)) && (")" === d[1] ? this.isBefore(b, c) : !this.isAfter(b, c))
    }
    function Zb(a, b) {
        var c, d = r(a) ? a : rb(a);
        return this.isValid() && d.isValid() ? (b = J(b || "millisecond"),
        "millisecond" === b ? this.valueOf() === d.valueOf() : (c = d.valueOf(),
        this.clone().startOf(b).valueOf() <= c && c <= this.clone().endOf(b).valueOf())) : !1
    }
    function $b(a, b) {
        return this.isSame(a, b) || this.isAfter(a, b)
    }
    function _b(a, b) {
        return this.isSame(a, b) || this.isBefore(a, b)
    }
    function ac(a, b, c) {
        var d, e, f, g;
        return this.isValid() ? (d = zb(a, this),
        d.isValid() ? (e = 6e4 * (d.utcOffset() - this.utcOffset()),
        b = J(b),
        "year" === b || "month" === b || "quarter" === b ? (g = bc(this, d),
        "quarter" === b ? g /= 3 : "year" === b && (g /= 12)) : (f = this - d,
        g = "second" === b ? f / 1e3 : "minute" === b ? f / 6e4 : "hour" === b ? f / 36e5 : "day" === b ? (f - e) / 864e5 : "week" === b ? (f - e) / 6048e5 : f),
        c ? g : s(g)) : NaN) : NaN
    }
    function bc(a, b) {
        var c, d, e = 12 * (b.year() - a.year()) + (b.month() - a.month()), f = a.clone().add(e, "months");
        return 0 > b - f ? (c = a.clone().add(e - 1, "months"),
        d = (b - f) / (f - c)) : (c = a.clone().add(e + 1, "months"),
        d = (b - f) / (c - f)),
        -(e + d) || 0
    }
    function cc() {
        return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")
    }
    function dc() {
        var a = this.clone().utc();
        return 0 < a.year() && a.year() <= 9999 ? y(Date.prototype.toISOString) ? this.toDate().toISOString() : W(a, "YYYY-MM-DD[T]HH:mm:ss.SSS[Z]") : W(a, "YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")
    }
    function ec(b) {
        b || (b = this.isUtc() ? a.defaultFormatUtc : a.defaultFormat);
        var c = W(this, b);
        return this.localeData().postformat(c)
    }
    function fc(a, b) {
        return this.isValid() && (r(a) && a.isValid() || rb(a).isValid()) ? Mb({
            to: this,
            from: a
        }).locale(this.locale()).humanize(!b) : this.localeData().invalidDate()
    }
    function gc(a) {
        return this.from(rb(), a)
    }
    function hc(a, b) {
        return this.isValid() && (r(a) && a.isValid() || rb(a).isValid()) ? Mb({
            from: this,
            to: a
        }).locale(this.locale()).humanize(!b) : this.localeData().invalidDate()
    }
    function ic(a) {
        return this.to(rb(), a)
    }
    function jc(a) {
        var b;
        return void 0 === a ? this._locale._abbr : (b = ab(a),
        null != b && (this._locale = b),
        this)
    }
    function kc() {
        return this._locale
    }
    function lc(a) {
        switch (a = J(a)) {
        case "year":
            this.month(0);
        case "quarter":
        case "month":
            this.date(1);
        case "week":
        case "isoWeek":
        case "day":
        case "date":
            this.hours(0);
        case "hour":
            this.minutes(0);
        case "minute":
            this.seconds(0);
        case "second":
            this.milliseconds(0)
        }
        return "week" === a && this.weekday(0),
        "isoWeek" === a && this.isoWeekday(1),
        "quarter" === a && this.month(3 * Math.floor(this.month() / 3)),
        this
    }
    function mc(a) {
        return a = J(a),
        void 0 === a || "millisecond" === a ? this : ("date" === a && (a = "day"),
        this.startOf(a).add(1, "isoWeek" === a ? "week" : a).subtract(1, "ms"))
    }
    function nc() {
        return this._d.valueOf() - 6e4 * (this._offset || 0)
    }
    function oc() {
        return Math.floor(this.valueOf() / 1e3)
    }
    function pc() {
        return new Date(this.valueOf())
    }
    function qc() {
        var a = this;
        return [a.year(), a.month(), a.date(), a.hour(), a.minute(), a.second(), a.millisecond()]
    }
    function rc() {
        var a = this;
        return {
            years: a.year(),
            months: a.month(),
            date: a.date(),
            hours: a.hours(),
            minutes: a.minutes(),
            seconds: a.seconds(),
            milliseconds: a.milliseconds()
        }
    }
    function sc() {
        return this.isValid() ? this.toISOString() : null
    }
    function tc() {
        return m(this)
    }
    function uc() {
        return i({}, l(this))
    }
    function vc() {
        return l(this).overflow
    }
    function wc() {
        return {
            input: this._i,
            format: this._f,
            locale: this._locale,
            isUTC: this._isUTC,
            strict: this._strict
        }
    }
    function xc(a, b) {
        T(0, [a, a.length], 0, b)
    }
    function yc(a) {
        return Cc.call(this, a, this.week(), this.weekday(), this.localeData()._week.dow, this.localeData()._week.doy)
    }
    function zc(a) {
        return Cc.call(this, a, this.isoWeek(), this.isoWeekday(), 1, 4)
    }
    function Ac() {
        return wa(this.year(), 1, 4)
    }
    function Bc() {
        var a = this.localeData()._week;
        return wa(this.year(), a.dow, a.doy)
    }
    function Cc(a, b, c, d, e) {
        var f;
        return null == a ? va(this, d, e).year : (f = wa(a, d, e),
        b > f && (b = f),
        Dc.call(this, a, b, c, d, e))
    }
    function Dc(a, b, c, d, e) {
        var f = ua(a, b, c, d, e)
          , g = sa(f.year, 0, f.dayOfYear);
        return this.year(g.getUTCFullYear()),
        this.month(g.getUTCMonth()),
        this.date(g.getUTCDate()),
        this
    }
    function Ec(a) {
        return null == a ? Math.ceil((this.month() + 1) / 3) : this.month(3 * (a - 1) + this.month() % 3)
    }
    function Fc(a) {
        var b = Math.round((this.clone().startOf("day") - this.clone().startOf("year")) / 864e5) + 1;
        return null == a ? b : this.add(a - b, "d")
    }
    function Gc(a, b) {
        b[ce] = t(1e3 * ("0." + a))
    }
    function Hc() {
        return this._isUTC ? "UTC" : ""
    }
    function Ic() {
        return this._isUTC ? "Coordinated Universal Time" : ""
    }
    function Jc(a) {
        return rb(1e3 * a)
    }
    function Kc() {
        return rb.apply(null, arguments).parseZone()
    }
    function Lc(a) {
        return a
    }
    function Mc(a, b, c, d) {
        var e = ab()
          , f = j().set(d, b);
        return e[c](f, a)
    }
    function Nc(a, b, c) {
        if ("number" == typeof a && (b = a,
        a = void 0),
        a = a || "",
        null != b)
            return Mc(a, b, c, "month");
        var d, e = [];
        for (d = 0; 12 > d; d++)
            e[d] = Mc(a, d, c, "month");
        return e
    }
    function Oc(a, b, c, d) {
        "boolean" == typeof a ? ("number" == typeof b && (c = b,
        b = void 0),
        b = b || "") : (b = a,
        c = b,
        a = !1,
        "number" == typeof b && (c = b,
        b = void 0),
        b = b || "");
        var e = ab()
          , f = a ? e._week.dow : 0;
        if (null != c)
            return Mc(b, (c + f) % 7, d, "day");
        var g, h = [];
        for (g = 0; 7 > g; g++)
            h[g] = Mc(b, (g + f) % 7, d, "day");
        return h
    }
    function Pc(a, b) {
        return Nc(a, b, "months")
    }
    function Qc(a, b) {
        return Nc(a, b, "monthsShort")
    }
    function Rc(a, b, c) {
        return Oc(a, b, c, "weekdays")
    }
    function Sc(a, b, c) {
        return Oc(a, b, c, "weekdaysShort")
    }
    function Tc(a, b, c) {
        return Oc(a, b, c, "weekdaysMin")
    }
    function Uc() {
        var a = this._data;
        return this._milliseconds = Ue(this._milliseconds),
        this._days = Ue(this._days),
        this._months = Ue(this._months),
        a.milliseconds = Ue(a.milliseconds),
        a.seconds = Ue(a.seconds),
        a.minutes = Ue(a.minutes),
        a.hours = Ue(a.hours),
        a.months = Ue(a.months),
        a.years = Ue(a.years),
        this
    }
    function Vc(a, b, c, d) {
        var e = Mb(b, c);
        return a._milliseconds += d * e._milliseconds,
        a._days += d * e._days,
        a._months += d * e._months,
        a._bubble()
    }
    function Wc(a, b) {
        return Vc(this, a, b, 1)
    }
    function Xc(a, b) {
        return Vc(this, a, b, -1)
    }
    function Yc(a) {
        return 0 > a ? Math.floor(a) : Math.ceil(a)
    }
    function Zc() {
        var a, b, c, d, e, f = this._milliseconds, g = this._days, h = this._months, i = this._data;
        return f >= 0 && g >= 0 && h >= 0 || 0 >= f && 0 >= g && 0 >= h || (f += 864e5 * Yc(_c(h) + g),
        g = 0,
        h = 0),
        i.milliseconds = f % 1e3,
        a = s(f / 1e3),
        i.seconds = a % 60,
        b = s(a / 60),
        i.minutes = b % 60,
        c = s(b / 60),
        i.hours = c % 24,
        g += s(c / 24),
        e = s($c(g)),
        h += e,
        g -= Yc(_c(e)),
        d = s(h / 12),
        h %= 12,
        i.days = g,
        i.months = h,
        i.years = d,
        this
    }
    function $c(a) {
        return 4800 * a / 146097
    }
    function _c(a) {
        return 146097 * a / 4800
    }
    function ad(a) {
        var b, c, d = this._milliseconds;
        if (a = J(a),
        "month" === a || "year" === a)
            return b = this._days + d / 864e5,
            c = this._months + $c(b),
            "month" === a ? c : c / 12;
        switch (b = this._days + Math.round(_c(this._months)),
        a) {
        case "week":
            return b / 7 + d / 6048e5;
        case "day":
            return b + d / 864e5;
        case "hour":
            return 24 * b + d / 36e5;
        case "minute":
            return 1440 * b + d / 6e4;
        case "second":
            return 86400 * b + d / 1e3;
        case "millisecond":
            return Math.floor(864e5 * b) + d;
        default:
            throw new Error("Unknown unit " + a)
        }
    }
    function bd() {
        return this._milliseconds + 864e5 * this._days + this._months % 12 * 2592e6 + 31536e6 * t(this._months / 12)
    }
    function cd(a) {
        return function() {
            return this.as(a)
        }
    }
    function dd(a) {
        return a = J(a),
        this[a + "s"]()
    }
    function ed(a) {
        return function() {
            return this._data[a]
        }
    }
    function fd() {
        return s(this.days() / 7)
    }
    function gd(a, b, c, d, e) {
        return e.relativeTime(b || 1, !!c, a, d)
    }
    function hd(a, b, c) {
        var d = Mb(a).abs()
          , e = jf(d.as("s"))
          , f = jf(d.as("m"))
          , g = jf(d.as("h"))
          , h = jf(d.as("d"))
          , i = jf(d.as("M"))
          , j = jf(d.as("y"))
          , k = e < kf.s && ["s", e] || 1 >= f && ["m"] || f < kf.m && ["mm", f] || 1 >= g && ["h"] || g < kf.h && ["hh", g] || 1 >= h && ["d"] || h < kf.d && ["dd", h] || 1 >= i && ["M"] || i < kf.M && ["MM", i] || 1 >= j && ["y"] || ["yy", j];
        return k[2] = b,
        k[3] = +a > 0,
        k[4] = c,
        gd.apply(null, k)
    }
    function id(a) {
        return void 0 === a ? jf : "function" == typeof a ? (jf = a,
        !0) : !1
    }
    function jd(a, b) {
        return void 0 === kf[a] ? !1 : void 0 === b ? kf[a] : (kf[a] = b,
        !0)
    }
    function kd(a) {
        var b = this.localeData()
          , c = hd(this, !a, b);
        return a && (c = b.pastFuture(+this, c)),
        b.postformat(c)
    }
    function ld() {
        var a, b, c, d = lf(this._milliseconds) / 1e3, e = lf(this._days), f = lf(this._months);
        a = s(d / 60),
        b = s(a / 60),
        d %= 60,
        a %= 60,
        c = s(f / 12),
        f %= 12;
        var g = c
          , h = f
          , i = e
          , j = b
          , k = a
          , l = d
          , m = this.asSeconds();
        return m ? (0 > m ? "-" : "") + "P" + (g ? g + "Y" : "") + (h ? h + "M" : "") + (i ? i + "D" : "") + (j || k || l ? "T" : "") + (j ? j + "H" : "") + (k ? k + "M" : "") + (l ? l + "S" : "") : "P0D"
    }
    var md, nd;
    nd = Array.prototype.some ? Array.prototype.some : function(a) {
        for (var b = Object(this), c = b.length >>> 0, d = 0; c > d; d++)
            if (d in b && a.call(this, b[d], d, b))
                return !0;
        return !1
    }
    ;
    var od = a.momentProperties = []
      , pd = !1
      , qd = {};
    a.suppressDeprecationWarnings = !1,
    a.deprecationHandler = null;
    var rd;
    rd = Object.keys ? Object.keys : function(a) {
        var b, c = [];
        for (b in a)
            h(a, b) && c.push(b);
        return c
    }
    ;
    var sd, td = {
        sameDay: "[Today at] LT",
        nextDay: "[Tomorrow at] LT",
        nextWeek: "dddd [at] LT",
        lastDay: "[Yesterday at] LT",
        lastWeek: "[Last] dddd [at] LT",
        sameElse: "L"
    }, ud = {
        LTS: "h:mm:ss A",
        LT: "h:mm A",
        L: "MM/DD/YYYY",
        LL: "MMMM D, YYYY",
        LLL: "MMMM D, YYYY h:mm A",
        LLLL: "dddd, MMMM D, YYYY h:mm A"
    }, vd = "Invalid date", wd = "%d", xd = /\d{1,2}/, yd = {
        future: "in %s",
        past: "%s ago",
        s: "a few seconds",
        m: "a minute",
        mm: "%d minutes",
        h: "an hour",
        hh: "%d hours",
        d: "a day",
        dd: "%d days",
        M: "a month",
        MM: "%d months",
        y: "a year",
        yy: "%d years"
    }, zd = {}, Ad = {}, Bd = /(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g, Cd = /(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g, Dd = {}, Ed = {}, Fd = /\d/, Gd = /\d\d/, Hd = /\d{3}/, Id = /\d{4}/, Jd = /[+-]?\d{6}/, Kd = /\d\d?/, Ld = /\d\d\d\d?/, Md = /\d\d\d\d\d\d?/, Nd = /\d{1,3}/, Od = /\d{1,4}/, Pd = /[+-]?\d{1,6}/, Qd = /\d+/, Rd = /[+-]?\d+/, Sd = /Z|[+-]\d\d:?\d\d/gi, Td = /Z|[+-]\d\d(?::?\d\d)?/gi, Ud = /[+-]?\d+(\.\d{1,3})?/, Vd = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i, Wd = {}, Xd = {}, Yd = 0, Zd = 1, $d = 2, _d = 3, ae = 4, be = 5, ce = 6, de = 7, ee = 8;
    sd = Array.prototype.indexOf ? Array.prototype.indexOf : function(a) {
        var b;
        for (b = 0; b < this.length; ++b)
            if (this[b] === a)
                return b;
        return -1
    }
    ,
    T("M", ["MM", 2], "Mo", function() {
        return this.month() + 1
    }),
    T("MMM", 0, 0, function(a) {
        return this.localeData().monthsShort(this, a)
    }),
    T("MMMM", 0, 0, function(a) {
        return this.localeData().months(this, a)
    }),
    I("month", "M"),
    L("month", 8),
    Y("M", Kd),
    Y("MM", Kd, Gd),
    Y("MMM", function(a, b) {
        return b.monthsShortRegex(a)
    }),
    Y("MMMM", function(a, b) {
        return b.monthsRegex(a)
    }),
    aa(["M", "MM"], function(a, b) {
        b[Zd] = t(a) - 1
    }),
    aa(["MMM", "MMMM"], function(a, b, c, d) {
        var e = c._locale.monthsParse(a, d, c._strict);
        null != e ? b[Zd] = e : l(c).invalidMonth = a
    });
    var fe = /D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/
      , ge = "January_February_March_April_May_June_July_August_September_October_November_December".split("_")
      , he = "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_")
      , ie = Vd
      , je = Vd;
    T("Y", 0, 0, function() {
        var a = this.year();
        return 9999 >= a ? "" + a : "+" + a
    }),
    T(0, ["YY", 2], 0, function() {
        return this.year() % 100
    }),
    T(0, ["YYYY", 4], 0, "year"),
    T(0, ["YYYYY", 5], 0, "year"),
    T(0, ["YYYYYY", 6, !0], 0, "year"),
    I("year", "y"),
    L("year", 1),
    Y("Y", Rd),
    Y("YY", Kd, Gd),
    Y("YYYY", Od, Id),
    Y("YYYYY", Pd, Jd),
    Y("YYYYYY", Pd, Jd),
    aa(["YYYYY", "YYYYYY"], Yd),
    aa("YYYY", function(b, c) {
        c[Yd] = 2 === b.length ? a.parseTwoDigitYear(b) : t(b)
    }),
    aa("YY", function(b, c) {
        c[Yd] = a.parseTwoDigitYear(b)
    }),
    aa("Y", function(a, b) {
        b[Yd] = parseInt(a, 10)
    }),
    a.parseTwoDigitYear = function(a) {
        return t(a) + (t(a) > 68 ? 1900 : 2e3)
    }
    ;
    var ke = N("FullYear", !0);
    T("w", ["ww", 2], "wo", "week"),
    T("W", ["WW", 2], "Wo", "isoWeek"),
    I("week", "w"),
    I("isoWeek", "W"),
    L("week", 5),
    L("isoWeek", 5),
    Y("w", Kd),
    Y("ww", Kd, Gd),
    Y("W", Kd),
    Y("WW", Kd, Gd),
    ba(["w", "ww", "W", "WW"], function(a, b, c, d) {
        b[d.substr(0, 1)] = t(a)
    });
    var le = {
        dow: 0,
        doy: 6
    };
    T("d", 0, "do", "day"),
    T("dd", 0, 0, function(a) {
        return this.localeData().weekdaysMin(this, a)
    }),
    T("ddd", 0, 0, function(a) {
        return this.localeData().weekdaysShort(this, a)
    }),
    T("dddd", 0, 0, function(a) {
        return this.localeData().weekdays(this, a)
    }),
    T("e", 0, 0, "weekday"),
    T("E", 0, 0, "isoWeekday"),
    I("day", "d"),
    I("weekday", "e"),
    I("isoWeekday", "E"),
    L("day", 11),
    L("weekday", 11),
    L("isoWeekday", 11),
    Y("d", Kd),
    Y("e", Kd),
    Y("E", Kd),
    Y("dd", function(a, b) {
        return b.weekdaysMinRegex(a)
    }),
    Y("ddd", function(a, b) {
        return b.weekdaysShortRegex(a)
    }),
    Y("dddd", function(a, b) {
        return b.weekdaysRegex(a)
    }),
    ba(["dd", "ddd", "dddd"], function(a, b, c, d) {
        var e = c._locale.weekdaysParse(a, d, c._strict);
        null != e ? b.d = e : l(c).invalidWeekday = a
    }),
    ba(["d", "e", "E"], function(a, b, c, d) {
        b[d] = t(a)
    });
    var me = "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_")
      , ne = "Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_")
      , oe = "Su_Mo_Tu_We_Th_Fr_Sa".split("_")
      , pe = Vd
      , qe = Vd
      , re = Vd;
    T("H", ["HH", 2], 0, "hour"),
    T("h", ["hh", 2], 0, Qa),
    T("k", ["kk", 2], 0, Ra),
    T("hmm", 0, 0, function() {
        return "" + Qa.apply(this) + S(this.minutes(), 2)
    }),
    T("hmmss", 0, 0, function() {
        return "" + Qa.apply(this) + S(this.minutes(), 2) + S(this.seconds(), 2)
    }),
    T("Hmm", 0, 0, function() {
        return "" + this.hours() + S(this.minutes(), 2)
    }),
    T("Hmmss", 0, 0, function() {
        return "" + this.hours() + S(this.minutes(), 2) + S(this.seconds(), 2)
    }),
    Sa("a", !0),
    Sa("A", !1),
    I("hour", "h"),
    L("hour", 13),
    Y("a", Ta),
    Y("A", Ta),
    Y("H", Kd),
    Y("h", Kd),
    Y("HH", Kd, Gd),
    Y("hh", Kd, Gd),
    Y("hmm", Ld),
    Y("hmmss", Md),
    Y("Hmm", Ld),
    Y("Hmmss", Md),
    aa(["H", "HH"], _d),
    aa(["a", "A"], function(a, b, c) {
        c._isPm = c._locale.isPM(a),
        c._meridiem = a
    }),
    aa(["h", "hh"], function(a, b, c) {
        b[_d] = t(a),
        l(c).bigHour = !0
    }),
    aa("hmm", function(a, b, c) {
        var d = a.length - 2;
        b[_d] = t(a.substr(0, d)),
        b[ae] = t(a.substr(d)),
        l(c).bigHour = !0
    }),
    aa("hmmss", function(a, b, c) {
        var d = a.length - 4
          , e = a.length - 2;
        b[_d] = t(a.substr(0, d)),
        b[ae] = t(a.substr(d, 2)),
        b[be] = t(a.substr(e)),
        l(c).bigHour = !0
    }),
    aa("Hmm", function(a, b, c) {
        var d = a.length - 2;
        b[_d] = t(a.substr(0, d)),
        b[ae] = t(a.substr(d))
    }),
    aa("Hmmss", function(a, b, c) {
        var d = a.length - 4
          , e = a.length - 2;
        b[_d] = t(a.substr(0, d)),
        b[ae] = t(a.substr(d, 2)),
        b[be] = t(a.substr(e))
    });
    var se, te = /[ap]\.?m?\.?/i, ue = N("Hours", !0), ve = {
        calendar: td,
        longDateFormat: ud,
        invalidDate: vd,
        ordinal: wd,
        ordinalParse: xd,
        relativeTime: yd,
        months: ge,
        monthsShort: he,
        week: le,
        weekdays: me,
        weekdaysMin: oe,
        weekdaysShort: ne,
        meridiemParse: te
    }, we = {}, xe = /^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/, ye = /^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/, ze = /Z|[+-]\d\d(?::?\d\d)?/, Ae = [["YYYYYY-MM-DD", /[+-]\d{6}-\d\d-\d\d/], ["YYYY-MM-DD", /\d{4}-\d\d-\d\d/], ["GGGG-[W]WW-E", /\d{4}-W\d\d-\d/], ["GGGG-[W]WW", /\d{4}-W\d\d/, !1], ["YYYY-DDD", /\d{4}-\d{3}/], ["YYYY-MM", /\d{4}-\d\d/, !1], ["YYYYYYMMDD", /[+-]\d{10}/], ["YYYYMMDD", /\d{8}/], ["GGGG[W]WWE", /\d{4}W\d{3}/], ["GGGG[W]WW", /\d{4}W\d{2}/, !1], ["YYYYDDD", /\d{7}/]], Be = [["HH:mm:ss.SSSS", /\d\d:\d\d:\d\d\.\d+/], ["HH:mm:ss,SSSS", /\d\d:\d\d:\d\d,\d+/], ["HH:mm:ss", /\d\d:\d\d:\d\d/], ["HH:mm", /\d\d:\d\d/], ["HHmmss.SSSS", /\d\d\d\d\d\d\.\d+/], ["HHmmss,SSSS", /\d\d\d\d\d\d,\d+/], ["HHmmss", /\d\d\d\d\d\d/], ["HHmm", /\d\d\d\d/], ["HH", /\d\d/]], Ce = /^\/?Date\((\-?\d+)/i;
    a.createFromInputFallback = w("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.", function(a) {
        a._d = new Date(a._i + (a._useUTC ? " UTC" : ""))
    }),
    a.ISO_8601 = function() {}
    ;
    var De = w("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/", function() {
        var a = rb.apply(null, arguments);
        return this.isValid() && a.isValid() ? this > a ? this : a : n()
    })
      , Ee = w("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/", function() {
        var a = rb.apply(null, arguments);
        return this.isValid() && a.isValid() ? a > this ? this : a : n()
    })
      , Fe = function() {
        return Date.now ? Date.now() : +new Date
    };
    xb("Z", ":"),
    xb("ZZ", ""),
    Y("Z", Td),
    Y("ZZ", Td),
    aa(["Z", "ZZ"], function(a, b, c) {
        c._useUTC = !0,
        c._tzm = yb(Td, a)
    });
    var Ge = /([\+\-]|\d\d)/gi;
    a.updateOffset = function() {}
    ;
    var He = /^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?\d*)?$/
      , Ie = /^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;
    Mb.fn = vb.prototype;
    var Je = Rb(1, "add")
      , Ke = Rb(-1, "subtract");
    a.defaultFormat = "YYYY-MM-DDTHH:mm:ssZ",
    a.defaultFormatUtc = "YYYY-MM-DDTHH:mm:ss[Z]";
    var Le = w("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.", function(a) {
        return void 0 === a ? this.localeData() : this.locale(a)
    });
    T(0, ["gg", 2], 0, function() {
        return this.weekYear() % 100
    }),
    T(0, ["GG", 2], 0, function() {
        return this.isoWeekYear() % 100
    }),
    xc("gggg", "weekYear"),
    xc("ggggg", "weekYear"),
    xc("GGGG", "isoWeekYear"),
    xc("GGGGG", "isoWeekYear"),
    I("weekYear", "gg"),
    I("isoWeekYear", "GG"),
    L("weekYear", 1),
    L("isoWeekYear", 1),
    Y("G", Rd),
    Y("g", Rd),
    Y("GG", Kd, Gd),
    Y("gg", Kd, Gd),
    Y("GGGG", Od, Id),
    Y("gggg", Od, Id),
    Y("GGGGG", Pd, Jd),
    Y("ggggg", Pd, Jd),
    ba(["gggg", "ggggg", "GGGG", "GGGGG"], function(a, b, c, d) {
        b[d.substr(0, 2)] = t(a)
    }),
    ba(["gg", "GG"], function(b, c, d, e) {
        c[e] = a.parseTwoDigitYear(b)
    }),
    T("Q", 0, "Qo", "quarter"),
    I("quarter", "Q"),
    L("quarter", 7),
    Y("Q", Fd),
    aa("Q", function(a, b) {
        b[Zd] = 3 * (t(a) - 1)
    }),
    T("D", ["DD", 2], "Do", "date"),
    I("date", "D"),
    L("date", 9),
    Y("D", Kd),
    Y("DD", Kd, Gd),
    Y("Do", function(a, b) {
        return a ? b._ordinalParse : b._ordinalParseLenient
    }),
    aa(["D", "DD"], $d),
    aa("Do", function(a, b) {
        b[$d] = t(a.match(Kd)[0], 10)
    });
    var Me = N("Date", !0);
    T("DDD", ["DDDD", 3], "DDDo", "dayOfYear"),
    I("dayOfYear", "DDD"),
    L("dayOfYear", 4),
    Y("DDD", Nd),
    Y("DDDD", Hd),
    aa(["DDD", "DDDD"], function(a, b, c) {
        c._dayOfYear = t(a)
    }),
    T("m", ["mm", 2], 0, "minute"),
    I("minute", "m"),
    L("minute", 14),
    Y("m", Kd),
    Y("mm", Kd, Gd),
    aa(["m", "mm"], ae);
    var Ne = N("Minutes", !1);
    T("s", ["ss", 2], 0, "second"),
    I("second", "s"),
    L("second", 15),
    Y("s", Kd),
    Y("ss", Kd, Gd),
    aa(["s", "ss"], be);
    var Oe = N("Seconds", !1);
    T("S", 0, 0, function() {
        return ~~(this.millisecond() / 100)
    }),
    T(0, ["SS", 2], 0, function() {
        return ~~(this.millisecond() / 10)
    }),
    T(0, ["SSS", 3], 0, "millisecond"),
    T(0, ["SSSS", 4], 0, function() {
        return 10 * this.millisecond()
    }),
    T(0, ["SSSSS", 5], 0, function() {
        return 100 * this.millisecond()
    }),
    T(0, ["SSSSSS", 6], 0, function() {
        return 1e3 * this.millisecond()
    }),
    T(0, ["SSSSSSS", 7], 0, function() {
        return 1e4 * this.millisecond()
    }),
    T(0, ["SSSSSSSS", 8], 0, function() {
        return 1e5 * this.millisecond()
    }),
    T(0, ["SSSSSSSSS", 9], 0, function() {
        return 1e6 * this.millisecond()
    }),
    I("millisecond", "ms"),
    L("millisecond", 16),
    Y("S", Nd, Fd),
    Y("SS", Nd, Gd),
    Y("SSS", Nd, Hd);
    var Pe;
    for (Pe = "SSSS"; Pe.length <= 9; Pe += "S")
        Y(Pe, Qd);
    for (Pe = "S"; Pe.length <= 9; Pe += "S")
        aa(Pe, Gc);
    var Qe = N("Milliseconds", !1);
    T("z", 0, 0, "zoneAbbr"),
    T("zz", 0, 0, "zoneName");
    var Re = q.prototype;
    Re.add = Je,
    Re.calendar = Ub,
    Re.clone = Vb,
    Re.diff = ac,
    Re.endOf = mc,
    Re.format = ec,
    Re.from = fc,
    Re.fromNow = gc,
    Re.to = hc,
    Re.toNow = ic,
    Re.get = Q,
    Re.invalidAt = vc,
    Re.isAfter = Wb,
    Re.isBefore = Xb,
    Re.isBetween = Yb,
    Re.isSame = Zb,
    Re.isSameOrAfter = $b,
    Re.isSameOrBefore = _b,
    Re.isValid = tc,
    Re.lang = Le,
    Re.locale = jc,
    Re.localeData = kc,
    Re.max = Ee,
    Re.min = De,
    Re.parsingFlags = uc,
    Re.set = R,
    Re.startOf = lc,
    Re.subtract = Ke,
    Re.toArray = qc,
    Re.toObject = rc,
    Re.toDate = pc,
    Re.toISOString = dc,
    Re.toJSON = sc,
    Re.toString = cc,
    Re.unix = oc,
    Re.valueOf = nc,
    Re.creationData = wc,
    Re.year = ke,
    Re.isLeapYear = qa,
    Re.weekYear = yc,
    Re.isoWeekYear = zc,
    Re.quarter = Re.quarters = Ec,
    Re.month = ja,
    Re.daysInMonth = ka,
    Re.week = Re.weeks = Aa,
    Re.isoWeek = Re.isoWeeks = Ba,
    Re.weeksInYear = Bc,
    Re.isoWeeksInYear = Ac,
    Re.date = Me,
    Re.day = Re.days = Ja,
    Re.weekday = Ka,
    Re.isoWeekday = La,
    Re.dayOfYear = Fc,
    Re.hour = Re.hours = ue,
    Re.minute = Re.minutes = Ne,
    Re.second = Re.seconds = Oe,
    Re.millisecond = Re.milliseconds = Qe,
    Re.utcOffset = Bb,
    Re.utc = Db,
    Re.local = Eb,
    Re.parseZone = Fb,
    Re.hasAlignedHourOffset = Gb,
    Re.isDST = Hb,
    Re.isLocal = Jb,
    Re.isUtcOffset = Kb,
    Re.isUtc = Lb,
    Re.isUTC = Lb,
    Re.zoneAbbr = Hc,
    Re.zoneName = Ic,
    Re.dates = w("dates accessor is deprecated. Use date instead.", Me),
    Re.months = w("months accessor is deprecated. Use month instead", ja),
    Re.years = w("years accessor is deprecated. Use year instead", ke),
    Re.zone = w("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/", Cb),
    Re.isDSTShifted = w("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information", Ib);
    var Se = Re
      , Te = B.prototype;
    Te.calendar = C,
    Te.longDateFormat = D,
    Te.invalidDate = E,
    Te.ordinal = F,
    Te.preparse = Lc,
    Te.postformat = Lc,
    Te.relativeTime = G,
    Te.pastFuture = H,
    Te.set = z,
    Te.months = ea,
    Te.monthsShort = fa,
    Te.monthsParse = ha,
    Te.monthsRegex = ma,
    Te.monthsShortRegex = la,
    Te.week = xa,
    Te.firstDayOfYear = za,
    Te.firstDayOfWeek = ya,
    Te.weekdays = Ea,
    Te.weekdaysMin = Ga,
    Te.weekdaysShort = Fa,
    Te.weekdaysParse = Ia,
    Te.weekdaysRegex = Ma,
    Te.weekdaysShortRegex = Na,
    Te.weekdaysMinRegex = Oa,
    Te.isPM = Ua,
    Te.meridiem = Va,
    Za("en", {
        ordinalParse: /\d{1,2}(th|st|nd|rd)/,
        ordinal: function(a) {
            var b = a % 10
              , c = 1 === t(a % 100 / 10) ? "th" : 1 === b ? "st" : 2 === b ? "nd" : 3 === b ? "rd" : "th";
            return a + c
        }
    }),
    a.lang = w("moment.lang is deprecated. Use moment.locale instead.", Za),
    a.langData = w("moment.langData is deprecated. Use moment.localeData instead.", ab);
    var Ue = Math.abs
      , Ve = cd("ms")
      , We = cd("s")
      , Xe = cd("m")
      , Ye = cd("h")
      , Ze = cd("d")
      , $e = cd("w")
      , _e = cd("M")
      , af = cd("y")
      , bf = ed("milliseconds")
      , cf = ed("seconds")
      , df = ed("minutes")
      , ef = ed("hours")
      , ff = ed("days")
      , gf = ed("months")
      , hf = ed("years")
      , jf = Math.round
      , kf = {
        s: 45,
        m: 45,
        h: 22,
        d: 26,
        M: 11
    }
      , lf = Math.abs
      , mf = vb.prototype;
    mf.abs = Uc,
    mf.add = Wc,
    mf.subtract = Xc,
    mf.as = ad,
    mf.asMilliseconds = Ve,
    mf.asSeconds = We,
    mf.asMinutes = Xe,
    mf.asHours = Ye,
    mf.asDays = Ze,
    mf.asWeeks = $e,
    mf.asMonths = _e,
    mf.asYears = af,
    mf.valueOf = bd,
    mf._bubble = Zc,
    mf.get = dd,
    mf.milliseconds = bf,
    mf.seconds = cf,
    mf.minutes = df,
    mf.hours = ef,
    mf.days = ff,
    mf.weeks = fd,
    mf.months = gf,
    mf.years = hf,
    mf.humanize = kd,
    mf.toISOString = ld,
    mf.toString = ld,
    mf.toJSON = ld,
    mf.locale = jc,
    mf.localeData = kc,
    mf.toIsoString = w("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)", ld),
    mf.lang = Le,
    T("X", 0, 0, "unix"),
    T("x", 0, 0, "valueOf"),
    Y("x", Rd),
    Y("X", Ud),
    aa("X", function(a, b, c) {
        c._d = new Date(1e3 * parseFloat(a, 10))
    }),
    aa("x", function(a, b, c) {
        c._d = new Date(t(a))
    }),
    a.version = "2.14.1",
    b(rb),
    a.fn = Se,
    a.min = tb,
    a.max = ub,
    a.now = Fe,
    a.utc = j,
    a.unix = Jc,
    a.months = Pc,
    a.isDate = f,
    a.locale = Za,
    a.invalid = n,
    a.duration = Mb,
    a.isMoment = r,
    a.weekdays = Rc,
    a.parseZone = Kc,
    a.localeData = ab,
    a.isDuration = wb,
    a.monthsShort = Qc,
    a.weekdaysMin = Tc,
    a.defineLocale = $a,
    a.updateLocale = _a,
    a.locales = bb,
    a.weekdaysShort = Sc,
    a.normalizeUnits = J,
    a.relativeTimeRounding = id,
    a.relativeTimeThreshold = jd,
    a.calendarFormat = Tb,
    a.prototype = Se;
    var nf = a;
    return nf
});
!function(a) {
    "function" == typeof define && define.amd ? define(["jquery"], a) : a("object" == typeof exports ? require("jquery") : jQuery)
}(function(a, b) {
    function c() {
        return new Date(Date.UTC.apply(Date, arguments))
    }
    function d() {
        var a = new Date;
        return c(a.getFullYear(), a.getMonth(), a.getDate())
    }
    function e(a, b) {
        return a.getUTCFullYear() === b.getUTCFullYear() && a.getUTCMonth() === b.getUTCMonth() && a.getUTCDate() === b.getUTCDate()
    }
    function f(a) {
        return function() {
            return this[a].apply(this, arguments)
        }
    }
    function g(a) {
        return a && !isNaN(a.getTime())
    }
    function h(b, c) {
        function d(a, b) {
            return b.toLowerCase()
        }
        var e, f = a(b).data(), g = {}, h = new RegExp("^" + c.toLowerCase() + "([A-Z])");
        c = new RegExp("^" + c.toLowerCase());
        for (var i in f)
            c.test(i) && (e = i.replace(h, d),
            g[e] = f[i]);
        return g
    }
    function i(b) {
        var c = {};
        if (q[b] || (b = b.split("-")[0],
        q[b])) {
            var d = q[b];
            return a.each(p, function(a, b) {
                b in d && (c[b] = d[b])
            }),
            c
        }
    }
    var j = function() {
        var b = {
            get: function(a) {
                return this.slice(a)[0]
            },
            contains: function(a) {
                for (var b = a && a.valueOf(), c = 0, d = this.length; d > c; c++)
                    if (0 <= this[c].valueOf() - b && this[c].valueOf() - b < 864e5)
                        return c;
                return -1
            },
            remove: function(a) {
                this.splice(a, 1)
            },
            replace: function(b) {
                b && (a.isArray(b) || (b = [b]),
                this.clear(),
                this.push.apply(this, b))
            },
            clear: function() {
                this.length = 0
            },
            copy: function() {
                var a = new j;
                return a.replace(this),
                a
            }
        };
        return function() {
            var c = [];
            return c.push.apply(c, arguments),
            a.extend(c, b),
            c
        }
    }()
      , k = function(b, c) {
        a.data(b, "datepicker", this),
        this._process_options(c),
        this.dates = new j,
        this.viewDate = this.o.defaultViewDate,
        this.focusDate = null,
        this.element = a(b),
        this.isInput = this.element.is("input"),
        this.inputField = this.isInput ? this.element : this.element.find("input"),
        this.component = this.element.hasClass("date") ? this.element.find(".add-on, .input-group-addon, .btn") : !1,
        this.component && 0 === this.component.length && (this.component = !1),
        this.isInline = !this.component && this.element.is("div"),
        this.picker = a(r.template),
        this._check_template(this.o.templates.leftArrow) && this.picker.find(".prev").html(this.o.templates.leftArrow),
        this._check_template(this.o.templates.rightArrow) && this.picker.find(".next").html(this.o.templates.rightArrow),
        this._buildEvents(),
        this._attachEvents(),
        this.isInline ? this.picker.addClass("datepicker-inline").appendTo(this.element) : this.picker.addClass("datepicker-dropdown dropdown-menu"),
        this.o.rtl && this.picker.addClass("datepicker-rtl"),
        this.o.calendarWeeks && this.picker.find(".datepicker-days .datepicker-switch, thead .datepicker-title, tfoot .today, tfoot .clear").attr("colspan", function(a, b) {
            return Number(b) + 1
        }),
        this._allow_update = !1,
        this.setStartDate(this._o.startDate),
        this.setEndDate(this._o.endDate),
        this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),
        this.setDaysOfWeekHighlighted(this.o.daysOfWeekHighlighted),
        this.setDatesDisabled(this.o.datesDisabled),
        this.setViewMode(this.o.startView),
        this.fillDow(),
        this.fillMonths(),
        this._allow_update = !0,
        this.update(),
        this.isInline && this.show()
    };
    k.prototype = {
        constructor: k,
        _resolveViewName: function(b) {
            return a.each(r.viewModes, function(c, d) {
                return b === c || -1 !== a.inArray(b, d.names) ? (b = c,
                !1) : void 0
            }),
            b
        },
        _resolveDaysOfWeek: function(b) {
            return a.isArray(b) || (b = b.split(/[,\s]*/)),
            a.map(b, Number)
        },
        _check_template: function(c) {
            try {
                if (c === b || "" === c)
                    return !1;
                if ((c.match(/[<>]/g) || []).length <= 0)
                    return !0;
                var d = a(c);
                return d.length > 0
            } catch (e) {
                return !1
            }
        },
        _process_options: function(b) {
            this._o = a.extend({}, this._o, b);
            var e = this.o = a.extend({}, this._o)
              , f = e.language;
            q[f] || (f = f.split("-")[0],
            q[f] || (f = o.language)),
            e.language = f,
            e.startView = this._resolveViewName(e.startView),
            e.minViewMode = this._resolveViewName(e.minViewMode),
            e.maxViewMode = this._resolveViewName(e.maxViewMode),
            e.startView = Math.max(this.o.minViewMode, Math.min(this.o.maxViewMode, e.startView)),
            e.multidate !== !0 && (e.multidate = Number(e.multidate) || !1,
            e.multidate !== !1 && (e.multidate = Math.max(0, e.multidate))),
            e.multidateSeparator = String(e.multidateSeparator),
            e.weekStart %= 7,
            e.weekEnd = (e.weekStart + 6) % 7;
            var g = r.parseFormat(e.format);
            e.startDate !== -(1 / 0) && (e.startDate ? e.startDate instanceof Date ? e.startDate = this._local_to_utc(this._zero_time(e.startDate)) : e.startDate = r.parseDate(e.startDate, g, e.language, e.assumeNearbyYear) : e.startDate = -(1 / 0)),
            e.endDate !== 1 / 0 && (e.endDate ? e.endDate instanceof Date ? e.endDate = this._local_to_utc(this._zero_time(e.endDate)) : e.endDate = r.parseDate(e.endDate, g, e.language, e.assumeNearbyYear) : e.endDate = 1 / 0),
            e.daysOfWeekDisabled = this._resolveDaysOfWeek(e.daysOfWeekDisabled || []),
            e.daysOfWeekHighlighted = this._resolveDaysOfWeek(e.daysOfWeekHighlighted || []),
            e.datesDisabled = e.datesDisabled || [],
            a.isArray(e.datesDisabled) || (e.datesDisabled = [e.datesDisabled]),
            e.datesDisabled = a.map(e.datesDisabled, function(a) {
                return r.parseDate(a, g, e.language, e.assumeNearbyYear)
            });
            var h = String(e.orientation).toLowerCase().split(/\s+/g)
              , i = e.orientation.toLowerCase();
            if (h = a.grep(h, function(a) {
                return /^auto|left|right|top|bottom$/.test(a)
            }),
            e.orientation = {
                x: "auto",
                y: "auto"
            },
            i && "auto" !== i)
                if (1 === h.length)
                    switch (h[0]) {
                    case "top":
                    case "bottom":
                        e.orientation.y = h[0];
                        break;
                    case "left":
                    case "right":
                        e.orientation.x = h[0]
                    }
                else
                    i = a.grep(h, function(a) {
                        return /^left|right$/.test(a)
                    }),
                    e.orientation.x = i[0] || "auto",
                    i = a.grep(h, function(a) {
                        return /^top|bottom$/.test(a)
                    }),
                    e.orientation.y = i[0] || "auto";
            else
                ;if (e.defaultViewDate) {
                var j = e.defaultViewDate.year || (new Date).getFullYear()
                  , k = e.defaultViewDate.month || 0
                  , l = e.defaultViewDate.day || 1;
                e.defaultViewDate = c(j, k, l)
            } else
                e.defaultViewDate = d()
        },
        _events: [],
        _secondaryEvents: [],
        _applyEvents: function(a) {
            for (var c, d, e, f = 0; f < a.length; f++)
                c = a[f][0],
                2 === a[f].length ? (d = b,
                e = a[f][1]) : 3 === a[f].length && (d = a[f][1],
                e = a[f][2]),
                c.on(e, d)
        },
        _unapplyEvents: function(a) {
            for (var c, d, e, f = 0; f < a.length; f++)
                c = a[f][0],
                2 === a[f].length ? (e = b,
                d = a[f][1]) : 3 === a[f].length && (e = a[f][1],
                d = a[f][2]),
                c.off(d, e)
        },
        _buildEvents: function() {
            var b = {
                keyup: a.proxy(function(b) {
                    -1 === a.inArray(b.keyCode, [27, 37, 39, 38, 40, 32, 13, 9]) && this.update()
                }, this),
                keydown: a.proxy(this.keydown, this),
                paste: a.proxy(this.paste, this)
            };
            this.o.showOnFocus === !0 && (b.focus = a.proxy(this.show, this)),
            this.isInput ? this._events = [[this.element, b]] : this.component && this.inputField.length ? this._events = [[this.inputField, b], [this.component, {
                click: a.proxy(this.show, this)
            }]] : this._events = [[this.element, {
                click: a.proxy(this.show, this),
                keydown: a.proxy(this.keydown, this)
            }]],
            this._events.push([this.element, "*", {
                blur: a.proxy(function(a) {
                    this._focused_from = a.target
                }, this)
            }], [this.element, {
                blur: a.proxy(function(a) {
                    this._focused_from = a.target
                }, this)
            }]),
            this.o.immediateUpdates && this._events.push([this.element, {
                "changeYear changeMonth": a.proxy(function(a) {
                    this.update(a.date)
                }, this)
            }]),
            this._secondaryEvents = [[this.picker, {
                click: a.proxy(this.click, this)
            }], [this.picker, ".prev, .next", {
                click: a.proxy(this.navArrowsClick, this)
            }], [a(window), {
                resize: a.proxy(this.place, this)
            }], [a(document), {
                "mousedown touchstart": a.proxy(function(a) {
                    this.element.is(a.target) || this.element.find(a.target).length || this.picker.is(a.target) || this.picker.find(a.target).length || this.isInline || this.hide()
                }, this)
            }]]
        },
        _attachEvents: function() {
            this._detachEvents(),
            this._applyEvents(this._events)
        },
        _detachEvents: function() {
            this._unapplyEvents(this._events)
        },
        _attachSecondaryEvents: function() {
            this._detachSecondaryEvents(),
            this._applyEvents(this._secondaryEvents)
        },
        _detachSecondaryEvents: function() {
            this._unapplyEvents(this._secondaryEvents)
        },
        _trigger: function(b, c) {
            var d = c || this.dates.get(-1)
              , e = this._utc_to_local(d);
            this.element.trigger({
                type: b,
                date: e,
                dates: a.map(this.dates, this._utc_to_local),
                format: a.proxy(function(a, b) {
                    0 === arguments.length ? (a = this.dates.length - 1,
                    b = this.o.format) : "string" == typeof a && (b = a,
                    a = this.dates.length - 1),
                    b = b || this.o.format;
                    var c = this.dates.get(a);
                    return r.formatDate(c, b, this.o.language)
                }, this)
            })
        },
        show: function() {
            return this.inputField.prop("disabled") || this.inputField.prop("readonly") && this.o.enableOnReadonly === !1 ? void 0 : (this.isInline || this.picker.appendTo(this.o.container),
            this.place(),
            this.picker.show(),
            this._attachSecondaryEvents(),
            this._trigger("show"),
            (window.navigator.msMaxTouchPoints || "ontouchstart"in document) && this.o.disableTouchKeyboard && a(this.element).blur(),
            this)
        },
        hide: function() {
            return this.isInline || !this.picker.is(":visible") ? this : (this.focusDate = null,
            this.picker.hide().detach(),
            this._detachSecondaryEvents(),
            this.setViewMode(this.o.startView),
            this.o.forceParse && this.inputField.val() && this.setValue(),
            this._trigger("hide"),
            this)
        },
        destroy: function() {
            return this.hide(),
            this._detachEvents(),
            this._detachSecondaryEvents(),
            this.picker.remove(),
            delete this.element.data().datepicker,
            this.isInput || delete this.element.data().date,
            this
        },
        paste: function(b) {
            var c;
            if (b.originalEvent.clipboardData && b.originalEvent.clipboardData.types && -1 !== a.inArray("text/plain", b.originalEvent.clipboardData.types))
                c = b.originalEvent.clipboardData.getData("text/plain");
            else {
                if (!window.clipboardData)
                    return;
                c = window.clipboardData.getData("Text")
            }
            this.setDate(c),
            this.update(),
            b.preventDefault()
        },
        _utc_to_local: function(a) {
            return a && new Date(a.getTime() + 6e4 * a.getTimezoneOffset())
        },
        _local_to_utc: function(a) {
            return a && new Date(a.getTime() - 6e4 * a.getTimezoneOffset())
        },
        _zero_time: function(a) {
            return a && new Date(a.getFullYear(),a.getMonth(),a.getDate())
        },
        _zero_utc_time: function(a) {
            return a && c(a.getUTCFullYear(), a.getUTCMonth(), a.getUTCDate())
        },
        getDates: function() {
            return a.map(this.dates, this._utc_to_local)
        },
        getUTCDates: function() {
            return a.map(this.dates, function(a) {
                return new Date(a)
            })
        },
        getDate: function() {
            return this._utc_to_local(this.getUTCDate())
        },
        getUTCDate: function() {
            var a = this.dates.get(-1);
            return a !== b ? new Date(a) : null
        },
        clearDates: function() {
            this.inputField.val(""),
            this.update(),
            this._trigger("changeDate"),
            this.o.autoclose && this.hide()
        },
        setDates: function() {
            var b = a.isArray(arguments[0]) ? arguments[0] : arguments;
            return this.update.apply(this, b),
            this._trigger("changeDate"),
            this.setValue(),
            this
        },
        setUTCDates: function() {
            var b = a.isArray(arguments[0]) ? arguments[0] : arguments;
            return this.setDates.apply(this, a.map(b, this._utc_to_local)),
            this
        },
        setDate: f("setDates"),
        setUTCDate: f("setUTCDates"),
        remove: f("destroy"),
        setValue: function() {
            var a = this.getFormattedDate();
            return this.inputField.val(a),
            this
        },
        getFormattedDate: function(c) {
            c === b && (c = this.o.format);
            var d = this.o.language;
            return a.map(this.dates, function(a) {
                return r.formatDate(a, c, d)
            }).join(this.o.multidateSeparator)
        },
        getStartDate: function() {
            return this.o.startDate
        },
        setStartDate: function(a) {
            return this._process_options({
                startDate: a
            }),
            this.update(),
            this.updateNavArrows(),
            this
        },
        getEndDate: function() {
            return this.o.endDate
        },
        setEndDate: function(a) {
            return this._process_options({
                endDate: a
            }),
            this.update(),
            this.updateNavArrows(),
            this
        },
        setDaysOfWeekDisabled: function(a) {
            return this._process_options({
                daysOfWeekDisabled: a
            }),
            this.update(),
            this
        },
        setDaysOfWeekHighlighted: function(a) {
            return this._process_options({
                daysOfWeekHighlighted: a
            }),
            this.update(),
            this
        },
        setDatesDisabled: function(a) {
            return this._process_options({
                datesDisabled: a
            }),
            this.update(),
            this
        },
        place: function() {
            if (this.isInline)
                return this;
            var b = this.picker.outerWidth()
              , c = this.picker.outerHeight()
              , d = 10
              , e = a(this.o.container)
              , f = e.width()
              , g = "body" === this.o.container ? a(document).scrollTop() : e.scrollTop()
              , h = e.offset()
              , i = [];
            this.element.parents().each(function() {
                var b = a(this).css("z-index");
                "auto" !== b && 0 !== b && i.push(parseInt(b))
            });
            var j = Math.max.apply(Math, i) + this.o.zIndexOffset
              , k = this.component ? this.component.parent().offset() : this.element.offset()
              , l = this.component ? this.component.outerHeight(!0) : this.element.outerHeight(!1)
              , m = this.component ? this.component.outerWidth(!0) : this.element.outerWidth(!1)
              , n = k.left - h.left
              , o = k.top - h.top;
            "body" !== this.o.container && (o += g),
            this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),
            "auto" !== this.o.orientation.x ? (this.picker.addClass("datepicker-orient-" + this.o.orientation.x),
            "right" === this.o.orientation.x && (n -= b - m)) : k.left < 0 ? (this.picker.addClass("datepicker-orient-left"),
            n -= k.left - d) : n + b > f ? (this.picker.addClass("datepicker-orient-right"),
            n += m - b) : this.picker.addClass("datepicker-orient-left");
            var p, q = this.o.orientation.y;
            if ("auto" === q && (p = -g + o - c,
            q = 0 > p ? "bottom" : "top"),
            this.picker.addClass("datepicker-orient-" + q),
            "top" === q ? o -= c + parseInt(this.picker.css("padding-top")) : o += l,
            this.o.rtl) {
                var r = f - (n + m);
                this.picker.css({
                    top: o,
                    right: r,
                    zIndex: j
                })
            } else
                this.picker.css({
                    top: o,
                    left: n,
                    zIndex: j
                });
            return this
        },
        _allow_update: !0,
        update: function() {
            if (!this._allow_update)
                return this;
            var b = this.dates.copy()
              , c = []
              , d = !1;
            return arguments.length ? (a.each(arguments, a.proxy(function(a, b) {
                b instanceof Date && (b = this._local_to_utc(b)),
                c.push(b)
            }, this)),
            d = !0) : (c = this.isInput ? this.element.val() : this.element.data("date") || this.inputField.val(),
            c = c && this.o.multidate ? c.split(this.o.multidateSeparator) : [c],
            delete this.element.data().date),
            c = a.map(c, a.proxy(function(a) {
                return r.parseDate(a, this.o.format, this.o.language, this.o.assumeNearbyYear)
            }, this)),
            c = a.grep(c, a.proxy(function(a) {
                return !this.dateWithinRange(a) || !a
            }, this), !0),
            this.dates.replace(c),
            this.dates.length ? this.viewDate = new Date(this.dates.get(-1)) : this.viewDate < this.o.startDate ? this.viewDate = new Date(this.o.startDate) : this.viewDate > this.o.endDate ? this.viewDate = new Date(this.o.endDate) : this.viewDate = this.o.defaultViewDate,
            d ? (this.setValue(),
            this.element.change()) : this.dates.length && String(b) !== String(this.dates) && d && (this._trigger("changeDate"),
            this.element.change()),
            !this.dates.length && b.length && (this._trigger("clearDate"),
            this.element.change()),
            this.fill(),
            this
        },
        fillDow: function() {
            var b = this.o.weekStart
              , c = "<tr>";
            for (this.o.calendarWeeks && (c += '<th class="cw">&#160;</th>'); b < this.o.weekStart + 7; )
                c += '<th class="dow',
                -1 !== a.inArray(b, this.o.daysOfWeekDisabled) && (c += " disabled"),
                c += '">' + q[this.o.language].daysMin[b++ % 7] + "</th>";
            c += "</tr>",
            this.picker.find(".datepicker-days thead").append(c)
        },
        fillMonths: function() {
            for (var a = this._utc_to_local(this.viewDate), b = "", c = 0; 12 > c; ) {
                var d = a && a.getMonth() === c ? " focused" : "";
                b += '<span class="month' + d + '">' + q[this.o.language].monthsShort[c++] + "</span>"
            }
            this.picker.find(".datepicker-months td").html(b)
        },
        setRange: function(b) {
            b && b.length ? this.range = a.map(b, function(a) {
                return a.valueOf()
            }) : delete this.range,
            this.fill()
        },
        getClassNames: function(b) {
            var c = []
              , f = this.viewDate.getUTCFullYear()
              , g = this.viewDate.getUTCMonth()
              , h = d();
            return b.getUTCFullYear() < f || b.getUTCFullYear() === f && b.getUTCMonth() < g ? c.push("old") : (b.getUTCFullYear() > f || b.getUTCFullYear() === f && b.getUTCMonth() > g) && c.push("new"),
            this.focusDate && b.valueOf() === this.focusDate.valueOf() && c.push("focused"),
            this.o.todayHighlight && e(b, h) && c.push("today"),
            -1 !== this.dates.contains(b) && c.push("active"),
            this.dateWithinRange(b) || c.push("disabled"),
            this.dateIsDisabled(b) && c.push("disabled", "disabled-date"),
            -1 !== a.inArray(b.getUTCDay(), this.o.daysOfWeekHighlighted) && c.push("highlighted"),
            this.range && (b > this.range[0] && b < this.range[this.range.length - 1] && c.push("range"),
            -1 !== a.inArray(b.valueOf(), this.range) && c.push("selected"),
            b.valueOf() === this.range[0] && c.push("range-start"),
            b.valueOf() === this.range[this.range.length - 1] && c.push("range-end")),
            c
        },
        _fill_yearsView: function(c, d, e, f, g, h, i, j) {
            var k, l, m, n, o, p, q, r, s, t, u;
            for (k = "",
            l = this.picker.find(c),
            m = parseInt(g / e, 10) * e,
            o = parseInt(h / f, 10) * f,
            p = parseInt(i / f, 10) * f,
            n = a.map(this.dates, function(a) {
                return parseInt(a.getUTCFullYear() / f, 10) * f
            }),
            l.find(".datepicker-switch").text(m + "-" + (m + 9 * f)),
            q = m - f,
            r = -1; 11 > r; r += 1)
                s = [d],
                t = null,
                -1 === r ? s.push("old") : 10 === r && s.push("new"),
                -1 !== a.inArray(q, n) && s.push("active"),
                (o > q || q > p) && s.push("disabled"),
                q === this.viewDate.getFullYear() && s.push("focused"),
                j !== a.noop && (u = j(new Date(q,0,1)),
                u === b ? u = {} : "boolean" == typeof u ? u = {
                    enabled: u
                } : "string" == typeof u && (u = {
                    classes: u
                }),
                u.enabled === !1 && s.push("disabled"),
                u.classes && (s = s.concat(u.classes.split(/\s+/))),
                u.tooltip && (t = u.tooltip)),
                k += '<span class="' + s.join(" ") + '"' + (t ? ' title="' + t + '"' : "") + ">" + q + "</span>",
                q += f;
            l.find("td").html(k)
        },
        fill: function() {
            var d, e, f = new Date(this.viewDate), g = f.getUTCFullYear(), h = f.getUTCMonth(), i = this.o.startDate !== -(1 / 0) ? this.o.startDate.getUTCFullYear() : -(1 / 0), j = this.o.startDate !== -(1 / 0) ? this.o.startDate.getUTCMonth() : -(1 / 0), k = this.o.endDate !== 1 / 0 ? this.o.endDate.getUTCFullYear() : 1 / 0, l = this.o.endDate !== 1 / 0 ? this.o.endDate.getUTCMonth() : 1 / 0, m = q[this.o.language].today || q.en.today || "", n = q[this.o.language].clear || q.en.clear || "", o = q[this.o.language].titleFormat || q.en.titleFormat;
            if (!isNaN(g) && !isNaN(h)) {
                this.picker.find(".datepicker-days .datepicker-switch").text(r.formatDate(f, o, this.o.language)),
                this.picker.find("tfoot .today").text(m).toggle(this.o.todayBtn !== !1),
                this.picker.find("tfoot .clear").text(n).toggle(this.o.clearBtn !== !1),
                this.picker.find("thead .datepicker-title").text(this.o.title).toggle("" !== this.o.title),
                this.updateNavArrows(),
                this.fillMonths();
                var p = c(g, h, 0)
                  , s = p.getUTCDate();
                p.setUTCDate(s - (p.getUTCDay() - this.o.weekStart + 7) % 7);
                var t = new Date(p);
                p.getUTCFullYear() < 100 && t.setUTCFullYear(p.getUTCFullYear()),
                t.setUTCDate(t.getUTCDate() + 42),
                t = t.valueOf();
                for (var u, v, w = []; p.valueOf() < t; ) {
                    if (u = p.getUTCDay(),
                    u === this.o.weekStart && (w.push("<tr>"),
                    this.o.calendarWeeks)) {
                        var x = new Date(+p + (this.o.weekStart - u - 7) % 7 * 864e5)
                          , y = new Date(Number(x) + (11 - x.getUTCDay()) % 7 * 864e5)
                          , z = new Date(Number(z = c(y.getUTCFullYear(), 0, 1)) + (11 - z.getUTCDay()) % 7 * 864e5)
                          , A = (y - z) / 864e5 / 7 + 1;
                        w.push('<td class="cw">' + A + "</td>")
                    }
                    v = this.getClassNames(p),
                    v.push("day"),
                    this.o.beforeShowDay !== a.noop && (e = this.o.beforeShowDay(this._utc_to_local(p)),
                    e === b ? e = {} : "boolean" == typeof e ? e = {
                        enabled: e
                    } : "string" == typeof e && (e = {
                        classes: e
                    }),
                    e.enabled === !1 && v.push("disabled"),
                    e.classes && (v = v.concat(e.classes.split(/\s+/))),
                    e.tooltip && (d = e.tooltip)),
                    v = a.unique(v),
                    w.push('<td class="' + v.join(" ") + '"' + (d ? ' title="' + d + '"' : "") + (this.o.dateCells ? ' data-date="' + p.getTime().toString() + '"' : "") + ">" + p.getUTCDate() + "</td>"),
                    d = null,
                    u === this.o.weekEnd && w.push("</tr>"),
                    p.setUTCDate(p.getUTCDate() + 1)
                }
                this.picker.find(".datepicker-days tbody").html(w.join(""));
                var B = q[this.o.language].monthsTitle || q.en.monthsTitle || "Months"
                  , C = this.picker.find(".datepicker-months").find(".datepicker-switch").text(this.o.maxViewMode < 2 ? B : g).end().find("tbody span").removeClass("active");
                if (a.each(this.dates, function(a, b) {
                    b.getUTCFullYear() === g && C.eq(b.getUTCMonth()).addClass("active")
                }),
                (i > g || g > k) && C.addClass("disabled"),
                g === i && C.slice(0, j).addClass("disabled"),
                g === k && C.slice(l + 1).addClass("disabled"),
                this.o.beforeShowMonth !== a.noop) {
                    var D = this;
                    a.each(C, function(c, d) {
                        var e = new Date(g,c,1)
                          , f = D.o.beforeShowMonth(e);
                        f === b ? f = {} : "boolean" == typeof f ? f = {
                            enabled: f
                        } : "string" == typeof f && (f = {
                            classes: f
                        }),
                        f.enabled !== !1 || a(d).hasClass("disabled") || a(d).addClass("disabled"),
                        f.classes && a(d).addClass(f.classes),
                        f.tooltip && a(d).prop("title", f.tooltip)
                    })
                }
                this._fill_yearsView(".datepicker-years", "year", 10, 1, g, i, k, this.o.beforeShowYear),
                this._fill_yearsView(".datepicker-decades", "decade", 100, 10, g, i, k, this.o.beforeShowDecade),
                this._fill_yearsView(".datepicker-centuries", "century", 1e3, 100, g, i, k, this.o.beforeShowCentury)
            }
        },
        updateNavArrows: function() {
            if (this._allow_update) {
                var a, b, c = new Date(this.viewDate), d = c.getUTCFullYear(), e = c.getUTCMonth();
                switch (this.viewMode) {
                case 0:
                    a = this.o.startDate !== -(1 / 0) && d <= this.o.startDate.getUTCFullYear() && e <= this.o.startDate.getUTCMonth(),
                    b = this.o.endDate !== 1 / 0 && d >= this.o.endDate.getUTCFullYear() && e >= this.o.endDate.getUTCMonth();
                    break;
                case 1:
                case 2:
                case 3:
                case 4:
                    a = this.o.startDate !== -(1 / 0) && d <= this.o.startDate.getUTCFullYear(),
                    b = this.o.endDate !== 1 / 0 && d >= this.o.endDate.getUTCFullYear()
                }
                this.picker.find(".prev").toggleClass("disabled", a),
                this.picker.find(".next").toggleClass("disabled", b)
            }
        },
        click: function(b) {
            b.preventDefault(),
            b.stopPropagation();
            var e, f, g, h, i;
            e = a(b.target),
            e.hasClass("datepicker-switch") && this.setViewMode(this.viewMode + 1),
            e.hasClass("today") && !e.hasClass("day") && (this.setViewMode(0),
            this._setDate(d(), "linked" === this.o.todayBtn ? null : "view")),
            e.hasClass("clear") && this.clearDates(),
            e.hasClass("disabled") || (e.hasClass("day") && (g = Number(e.text()),
            h = this.viewDate.getUTCFullYear(),
            i = this.viewDate.getUTCMonth(),
            (e.hasClass("old") || e.hasClass("new")) && (f = e.hasClass("old") ? -1 : 1,
            i = (i + f + 12) % 12,
            (-1 === f && 11 === i || 1 === f && 0 === i) && (h += f,
            this._trigger("changeYear", this.viewDate)),
            this._trigger("changeMonth", this.viewDate)),
            this._setDate(c(h, i, g))),
            (e.hasClass("month") || e.hasClass("year") || e.hasClass("decade") || e.hasClass("century")) && (this.viewDate.setUTCDate(1),
            g = 1,
            1 === this.viewMode ? (i = e.parent().find("span").index(e),
            h = this.viewDate.getUTCFullYear(),
            this.viewDate.setUTCMonth(i)) : (i = 0,
            h = Number(e.text()),
            this.viewDate.setUTCFullYear(h)),
            this._trigger(r.viewModes[this.viewMode - 1].e, this.viewDate),
            this.viewMode === this.o.minViewMode ? this._setDate(c(h, i, g)) : (this.setViewMode(this.viewMode - 1),
            this.fill()))),
            this.picker.is(":visible") && this._focused_from && this._focused_from.focus(),
            delete this._focused_from
        },
        navArrowsClick: function(b) {
            var c = a(b.target)
              , d = c.hasClass("prev") ? -1 : 1;
            0 !== this.viewMode && (d *= 12 * r.viewModes[this.viewMode].navStep),
            this.viewDate = this.moveMonth(this.viewDate, d),
            this._trigger(r.viewModes[this.viewMode].e, this.viewDate),
            this.fill()
        },
        _toggle_multidate: function(a) {
            var b = this.dates.contains(a);
            if (a || this.dates.clear(),
            -1 !== b ? (this.o.multidate === !0 || this.o.multidate > 1 || this.o.toggleActive) && this.dates.remove(b) : this.o.multidate === !1 ? (this.dates.clear(),
            this.dates.push(a)) : this.dates.push(a),
            "number" == typeof this.o.multidate)
                for (; this.dates.length > this.o.multidate; )
                    this.dates.remove(0)
        },
        _setDate: function(a, b) {
            b && "date" !== b || this._toggle_multidate(a && new Date(a)),
            b && "view" !== b || (this.viewDate = a && new Date(a)),
            this.fill(),
            this.setValue(),
            b && "view" === b || this._trigger("changeDate"),
            this.inputField.trigger("change"),
            !this.o.autoclose || b && "date" !== b || this.hide()
        },
        moveDay: function(a, b) {
            var c = new Date(a);
            return c.setUTCDate(a.getUTCDate() + b),
            c
        },
        moveWeek: function(a, b) {
            return this.moveDay(a, 7 * b)
        },
        moveMonth: function(a, b) {
            if (!g(a))
                return this.o.defaultViewDate;
            if (!b)
                return a;
            var c, d, e = new Date(a.valueOf()), f = e.getUTCDate(), h = e.getUTCMonth(), i = Math.abs(b);
            if (b = b > 0 ? 1 : -1,
            1 === i)
                d = -1 === b ? function() {
                    return e.getUTCMonth() === h
                }
                : function() {
                    return e.getUTCMonth() !== c
                }
                ,
                c = h + b,
                e.setUTCMonth(c),
                c = (c + 12) % 12;
            else {
                for (var j = 0; i > j; j++)
                    e = this.moveMonth(e, b);
                c = e.getUTCMonth(),
                e.setUTCDate(f),
                d = function() {
                    return c !== e.getUTCMonth()
                }
            }
            for (; d(); )
                e.setUTCDate(--f),
                e.setUTCMonth(c);
            return e
        },
        moveYear: function(a, b) {
            return this.moveMonth(a, 12 * b)
        },
        moveAvailableDate: function(a, b, c) {
            do {
                if (a = this[c](a, b),
                !this.dateWithinRange(a))
                    return !1;
                c = "moveDay"
            } while (this.dateIsDisabled(a));return a
        },
        weekOfDateIsDisabled: function(b) {
            return -1 !== a.inArray(b.getUTCDay(), this.o.daysOfWeekDisabled)
        },
        dateIsDisabled: function(b) {
            return this.weekOfDateIsDisabled(b) || a.grep(this.o.datesDisabled, function(a) {
                return e(b, a)
            }).length > 0
        },
        dateWithinRange: function(a) {
            return a >= this.o.startDate && a <= this.o.endDate
        },
        keydown: function(a) {
            if (!this.picker.is(":visible"))
                return void ((40 === a.keyCode || 27 === a.keyCode) && (this.show(),
                a.stopPropagation()));
            var b, c, d = !1, e = this.focusDate || this.viewDate;
            switch (a.keyCode) {
            case 27:
                this.focusDate ? (this.focusDate = null,
                this.viewDate = this.dates.get(-1) || this.viewDate,
                this.fill()) : this.hide(),
                a.preventDefault(),
                a.stopPropagation();
                break;
            case 37:
            case 38:
            case 39:
            case 40:
                if (!this.o.keyboardNavigation || 7 === this.o.daysOfWeekDisabled.length)
                    break;
                b = 37 === a.keyCode || 38 === a.keyCode ? -1 : 1,
                0 === this.viewMode ? a.ctrlKey ? (c = this.moveAvailableDate(e, b, "moveYear"),
                c && this._trigger("changeYear", this.viewDate)) : a.shiftKey ? (c = this.moveAvailableDate(e, b, "moveMonth"),
                c && this._trigger("changeMonth", this.viewDate)) : 37 === a.keyCode || 39 === a.keyCode ? c = this.moveAvailableDate(e, b, "moveDay") : this.weekOfDateIsDisabled(e) || (c = this.moveAvailableDate(e, b, "moveWeek")) : 1 === this.viewMode ? ((38 === a.keyCode || 40 === a.keyCode) && (b = 4 * b),
                c = this.moveAvailableDate(e, b, "moveMonth")) : 2 === this.viewMode && ((38 === a.keyCode || 40 === a.keyCode) && (b = 4 * b),
                c = this.moveAvailableDate(e, b, "moveYear")),
                c && (this.focusDate = this.viewDate = c,
                this.setValue(),
                this.fill(),
                a.preventDefault());
                break;
            case 13:
                if (!this.o.forceParse)
                    break;
                e = this.focusDate || this.dates.get(-1) || this.viewDate,
                this.o.keyboardNavigation && (this._toggle_multidate(e),
                d = !0),
                this.focusDate = null,
                this.viewDate = this.dates.get(-1) || this.viewDate,
                this.setValue(),
                this.fill(),
                this.picker.is(":visible") && (a.preventDefault(),
                a.stopPropagation(),
                this.o.autoclose && this.hide());
                break;
            case 9:
                this.focusDate = null,
                this.viewDate = this.dates.get(-1) || this.viewDate,
                this.fill(),
                this.hide()
            }
            d && (this.dates.length ? this._trigger("changeDate") : this._trigger("clearDate"),
            this.inputField.trigger("change"))
        },
        setViewMode: function(a) {
            this.viewMode = a,
            this.picker.children("div").hide().filter(".datepicker-" + r.viewModes[this.viewMode].clsName).show(),
            this.updateNavArrows()
        }
    };
    var l = function(b, c) {
        a.data(b, "datepicker", this),
        this.element = a(b),
        this.inputs = a.map(c.inputs, function(a) {
            return a.jquery ? a[0] : a
        }),
        delete c.inputs,
        this.keepEmptyValues = c.keepEmptyValues,
        delete c.keepEmptyValues,
        n.call(a(this.inputs), c).on("changeDate", a.proxy(this.dateUpdated, this)),
        this.pickers = a.map(this.inputs, function(b) {
            return a.data(b, "datepicker")
        }),
        this.updateDates()
    };
    l.prototype = {
        updateDates: function() {
            this.dates = a.map(this.pickers, function(a) {
                return a.getUTCDate()
            }),
            this.updateRanges()
        },
        updateRanges: function() {
            var b = a.map(this.dates, function(a) {
                return a.valueOf()
            });
            a.each(this.pickers, function(a, c) {
                c.setRange(b)
            })
        },
        dateUpdated: function(c) {
            if (!this.updating) {
                this.updating = !0;
                var d = a.data(c.target, "datepicker");
                if (d !== b) {
                    var e = d.getUTCDate()
                      , f = this.keepEmptyValues
                      , g = a.inArray(c.target, this.inputs)
                      , h = g - 1
                      , i = g + 1
                      , j = this.inputs.length;
                    if (-1 !== g) {
                        if (a.each(this.pickers, function(a, b) {
                            b.getUTCDate() || b !== d && f || b.setUTCDate(e)
                        }),
                        e < this.dates[h])
                            for (; h >= 0 && e < this.dates[h]; )
                                this.pickers[h--].setUTCDate(e);
                        else if (e > this.dates[i])
                            for (; j > i && e > this.dates[i]; )
                                this.pickers[i++].setUTCDate(e);
                        this.updateDates(),
                        delete this.updating
                    }
                }
            }
        },
        destroy: function() {
            a.map(this.pickers, function(a) {
                a.destroy()
            }),
            delete this.element.data().datepicker
        },
        remove: f("destroy")
    };
    var m = a.fn.datepicker
      , n = function(c) {
        var d = Array.apply(null, arguments);
        d.shift();
        var e;
        if (this.each(function() {
            var b = a(this)
              , f = b.data("datepicker")
              , g = "object" == typeof c && c;
            if (!f) {
                var j = h(this, "date")
                  , m = a.extend({}, o, j, g)
                  , n = i(m.language)
                  , p = a.extend({}, o, n, j, g);
                b.hasClass("input-daterange") || p.inputs ? (a.extend(p, {
                    inputs: p.inputs || b.find("input").toArray()
                }),
                f = new l(this,p)) : f = new k(this,p),
                b.data("datepicker", f)
            }
            "string" == typeof c && "function" == typeof f[c] && (e = f[c].apply(f, d))
        }),
        e === b || e instanceof k || e instanceof l)
            return this;
        if (this.length > 1)
            throw new Error("Using only allowed for the collection of a single element (" + c + " function)");
        return e
    };
    a.fn.datepicker = n;
    var o = a.fn.datepicker.defaults = {
        assumeNearbyYear: !1,
        autoclose: !1,
        beforeShowDay: a.noop,
        beforeShowMonth: a.noop,
        beforeShowYear: a.noop,
        beforeShowDecade: a.noop,
        beforeShowCentury: a.noop,
        calendarWeeks: !1,
        clearBtn: !1,
        toggleActive: !1,
        daysOfWeekDisabled: [],
        daysOfWeekHighlighted: [],
        datesDisabled: [],
        endDate: 1 / 0,
        forceParse: !0,
        format: "mm/dd/yyyy",
        keepEmptyValues: !1,
        keyboardNavigation: !0,
        language: "en",
        minViewMode: 0,
        maxViewMode: 4,
        multidate: !1,
        multidateSeparator: ",",
        orientation: "auto",
        rtl: !1,
        startDate: -(1 / 0),
        startView: 0,
        todayBtn: !1,
        todayHighlight: !1,
        weekStart: 0,
        disableTouchKeyboard: !1,
        enableOnReadonly: !0,
        showOnFocus: !0,
        zIndexOffset: 10,
        container: "body",
        immediateUpdates: !1,
        dateCells: !1,
        title: "",
        templates: {
            leftArrow: "&laquo;",
            rightArrow: "&raquo;"
        }
    }
      , p = a.fn.datepicker.locale_opts = ["format", "rtl", "weekStart"];
    a.fn.datepicker.Constructor = k;
    var q = a.fn.datepicker.dates = {
        en: {
            days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
            daysShort: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
            daysMin: ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"],
            months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
            monthsShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
            today: "Today",
            clear: "Clear",
            titleFormat: "MM yyyy"
        }
    }
      , r = {
        viewModes: [{
            names: ["days", "month"],
            clsName: "days",
            e: "changeMonth"
        }, {
            names: ["months", "year"],
            clsName: "months",
            e: "changeYear",
            navStep: 1
        }, {
            names: ["years", "decade"],
            clsName: "years",
            e: "changeDecade",
            navStep: 10
        }, {
            names: ["decades", "century"],
            clsName: "decades",
            e: "changeCentury",
            navStep: 100
        }, {
            names: ["centuries", "millennium"],
            clsName: "centuries",
            e: "changeMillennium",
            navStep: 1e3
        }],
        validParts: /dd?|DD?|mm?|MM?|yy(?:yy)?/g,
        nonpunctuation: /[^ -\/:-@\u5e74\u6708\u65e5\[-`{-~\t\n\r]+/g,
        parseFormat: function(a) {
            if ("function" == typeof a.toValue && "function" == typeof a.toDisplay)
                return a;
            var b = a.replace(this.validParts, "\0").split("\0")
              , c = a.match(this.validParts);
            if (!b || !b.length || !c || 0 === c.length)
                throw new Error("Invalid date format.");
            return {
                separators: b,
                parts: c
            }
        },
        parseDate: function(e, f, g, h) {
            function i(a, b) {
                return b === !0 && (b = 10),
                100 > a && (a += 2e3,
                a > (new Date).getFullYear() + b && (a -= 100)),
                a
            }
            function j() {
                var a = this.slice(0, s[n].length)
                  , b = s[n].slice(0, a.length);
                return a.toLowerCase() === b.toLowerCase()
            }
            if (!e)
                return b;
            if (e instanceof Date)
                return e;
            if ("string" == typeof f && (f = r.parseFormat(f)),
            f.toValue)
                return f.toValue(e, f, g);
            var l, m, n, o, p = /([\-+]\d+)([dmwy])/, s = e.match(/([\-+]\d+)([dmwy])/g), t = {
                d: "moveDay",
                m: "moveMonth",
                w: "moveWeek",
                y: "moveYear"
            }, u = {
                yesterday: "-1d",
                today: "+0d",
                tomorrow: "+1d"
            };
            if (/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(e)) {
                for (e = new Date,
                n = 0; n < s.length; n++)
                    l = p.exec(s[n]),
                    m = parseInt(l[1]),
                    o = t[l[2]],
                    e = k.prototype[o](e, m);
                return c(e.getUTCFullYear(), e.getUTCMonth(), e.getUTCDate())
            }
            if (e in u && (e = u[e],
            s = e.match(/([\-+]\d+)([dmwy])/g),
            /^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(e))) {
                for (e = new Date,
                n = 0; n < s.length; n++)
                    l = p.exec(s[n]),
                    m = parseInt(l[1]),
                    o = t[l[2]],
                    e = k.prototype[o](e, m);
                return c(e.getUTCFullYear(), e.getUTCMonth(), e.getUTCDate())
            }
            s = e && e.match(this.nonpunctuation) || [],
            e = new Date;
            var v, w, x = {}, y = ["yyyy", "yy", "M", "MM", "m", "mm", "d", "dd"], z = {
                yyyy: function(a, b) {
                    return a.setUTCFullYear(h ? i(b, h) : b)
                },
                m: function(a, b) {
                    if (isNaN(a))
                        return a;
                    for (b -= 1; 0 > b; )
                        b += 12;
                    for (b %= 12,
                    a.setUTCMonth(b); a.getUTCMonth() !== b; )
                        a.setUTCDate(a.getUTCDate() - 1);
                    return a
                },
                d: function(a, b) {
                    return a.setUTCDate(b)
                }
            };
            z.yy = z.yyyy,
            z.M = z.MM = z.mm = z.m,
            z.dd = z.d,
            e = d();
            var A = f.parts.slice();
            if (s.length !== A.length && (A = a(A).filter(function(b, c) {
                return -1 !== a.inArray(c, y)
            }).toArray()),
            s.length === A.length) {
                var B;
                for (n = 0,
                B = A.length; B > n; n++) {
                    if (v = parseInt(s[n], 10),
                    l = A[n],
                    isNaN(v))
                        switch (l) {
                        case "MM":
                            w = a(q[g].months).filter(j),
                            v = a.inArray(w[0], q[g].months) + 1;
                            break;
                        case "M":
                            w = a(q[g].monthsShort).filter(j),
                            v = a.inArray(w[0], q[g].monthsShort) + 1
                        }
                    x[l] = v
                }
                var C, D;
                for (n = 0; n < y.length; n++)
                    D = y[n],
                    D in x && !isNaN(x[D]) && (C = new Date(e),
                    z[D](C, x[D]),
                    isNaN(C) || (e = C))
            }
            return e
        },
        formatDate: function(b, c, d) {
            if (!b)
                return "";
            if ("string" == typeof c && (c = r.parseFormat(c)),
            c.toDisplay)
                return c.toDisplay(b, c, d);
            var e = {
                d: b.getUTCDate(),
                D: q[d].daysShort[b.getUTCDay()],
                DD: q[d].days[b.getUTCDay()],
                m: b.getUTCMonth() + 1,
                M: q[d].monthsShort[b.getUTCMonth()],
                MM: q[d].months[b.getUTCMonth()],
                yy: b.getUTCFullYear().toString().substring(2),
                yyyy: b.getUTCFullYear()
            };
            e.dd = (e.d < 10 ? "0" : "") + e.d,
            e.mm = (e.m < 10 ? "0" : "") + e.m,
            b = [];
            for (var f = a.extend([], c.separators), g = 0, h = c.parts.length; h >= g; g++)
                f.length && b.push(f.shift()),
                b.push(e[c.parts[g]]);
            return b.join("")
        },
        headTemplate: '<thead><tr><th colspan="7" class="datepicker-title"></th></tr><tr><th class="prev">&laquo;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&raquo;</th></tr></thead>',
        contTemplate: '<tbody><tr><td colspan="7"></td></tr></tbody>',
        footTemplate: '<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'
    };
    r.template = '<div class="datepicker"><div class="datepicker-days"><table class="table-condensed">' + r.headTemplate + "<tbody></tbody>" + r.footTemplate + '</table></div><div class="datepicker-months"><table class="table-condensed">' + r.headTemplate + r.contTemplate + r.footTemplate + '</table></div><div class="datepicker-years"><table class="table-condensed">' + r.headTemplate + r.contTemplate + r.footTemplate + '</table></div><div class="datepicker-decades"><table class="table-condensed">' + r.headTemplate + r.contTemplate + r.footTemplate + '</table></div><div class="datepicker-centuries"><table class="table-condensed">' + r.headTemplate + r.contTemplate + r.footTemplate + "</table></div></div>",
    a.fn.datepicker.DPGlobal = r,
    a.fn.datepicker.noConflict = function() {
        return a.fn.datepicker = m,
        this
    }
    ,
    a.fn.datepicker.version = "1.7.0-dev",
    a(document).on("focus.datepicker.data-api click.datepicker.data-api", '[data-provide="datepicker"]', function(b) {
        var c = a(this);
        c.data("datepicker") || (b.preventDefault(),
        n.call(c, "show"))
    }),
    a(function() {
        n.call(a('[data-provide="datepicker-inline"]'))
    })
});
var developer = {
    $body: null,
    init: function() {
        developer.$body = $("body");
        developer.bannerSizing()
    },
    bannerSizing: function() {
        var windowWidth = $(window).width()
          , width = windowWidth - 30;
        if (windowWidth < 768) {
            $(".google_dfp_ads_slot_desktop_top_leaderboard").css({
                width: width + "px"
            });
            if ($(".google_dfp_ads_slot_desktop_top_leaderboard").html() == "") {
                $(".google_dfp_ads_slot_desktop_top_leaderboard").hide()
            }
            $(".ads-between").css({
                width: width - 10 + "px"
            })
        }
    }
};
function callOtherDeveloperProjectsAjax(btn) {
    if (btn.data("requestRunning")) {
        return
    }
    btn.data("requestRunning", true);
    var reqdata = guruApp.otherDeveloperProjects.reqdata;
    var ajaxUrl = guruApp.otherDeveloperProjects.ajaxUrl;
    $.ajax({
        url: ajaxUrl,
        data: reqdata,
        type: "GET",
        beforeSend: function() {
            $(".loadmore-block a").addClass("loading");
            $(".loadmore-block a").addClass("disabled")
        },
        complete: function() {
            $(".loadmore-block a").removeClass("disabled");
            btn.data("requestRunning", false)
        },
        success: function(data) {
            if (data.status == "ok") {
                renderData(data);
                $(".loadmore-block").hide()
            }
        }
    })
}
function setAttributes(template, attributes) {
    $.each(attributes, function(position, attribute) {
        for (var key in attribute) {
            if (key == "text") {
                template.find(position).text(attribute[key])
            } else {
                template.find(position).attr(key, attribute[key])
            }
        }
    })
}
function renderData(data) {
    $.each(data["listings"], function(index, val) {
        $("#otherdeveloperlistings .listing-item:last").clone().hide().appendTo("#otherdeveloperlistings ul.listing-items");
        var entry = $("#otherdeveloperlistings .listing-item:last");
        var price = val["price"]["pretty"] || "";
        var topYear = val["topYear"] ? "Completion Year: " + val["topYear"] : "";
        var propertyType = val["propertyTypeText"] || "";
        var developmentName = val["developmentName"] || "";
        var noimage = val["noimage"] ? "noimage" : "";
        setAttributes($(".listing-img", entry), {
            a: {
                href: val["urls"]["listing"]["relative"]
            },
            img: {
                src: val["media"]["cover"],
                class: noimage
            }
        });
        setAttributes($(".listing-info", entry), {
            a: {
                href: val["urls"]["listing"]["relative"],
                title: val["title"],
                text: val["developmentName"] + " - " + val["title"]
            },
            "p[class='listing-location']": {
                text: val["location"]["fullAddress"]
            },
            "p[class='listing-type']": {
                text: val["propertyTypeText"]
            }
        });
        if (!entry.find(".listing-values p[class='listing-price']").length) {
            $(".listing-values").prepend('<p class="listing-price"></p')
        }
        setAttributes($(".listing-values", entry), {
            "p[class='listing-price']": {
                text: price
            }
        });
        setAttributes($(".listing-features", entry), {
            "li[class='lst-year']": {
                text: topYear
            }
        });
        setAttributes($(".listing-features", entry), {
            "li[class='lst-type']": {
                text: propertyType
            }
        });
        setAttributes($(".listing-features", entry), {
            "li[class='lst-dname']": {
                text: developmentName
            }
        });
        entry.find(".listing-info h3 a").wrapInner("<span></span>");
        entry.find(".listing-info .listing-type").wrapInner("<strong></strong>");
        entry.show()
    })
}
function snakeToCamel(s) {
    return s.replace(/(\_\w)/g, function(m) {
        return m[1].toUpperCase()
    })
}
function disabledCurrentPagination() {
    if ($(".listing-pagination").length > 0) {
        $(".listing-pagination li.active a").attr("onClick", "return false;")
    }
}
function getSearchParams() {
    var searchParams = getParamsFromSearchDataLayer();
    var searchParamFromUrl = getAllUrlParams();
    return typeof searchParams == "object" ? $.extend(searchParams, searchParamFromUrl) : searchParamFromUrl
}
function getParamsFromSearchDataLayer() {
    if (typeof guruApp.SearchDataLayer !== "undefined" && typeof guruApp.SearchDataLayer.searchParams !== "undefined") {
        return guruApp.SearchDataLayer.searchParams
    }
    return []
}
function getAllUrlParams(url) {
    var queryString = url ? url.split("?")[1] : decodeURIComponent(window.location.search).slice(1);
    var obj = {};
    if (queryString) {
        queryString = queryString.split("#")[0];
        var arr = queryString.split("&");
        for (var i = 0; i < arr.length; i++) {
            var a = arr[i].split("=");
            var paramNum = undefined;
            var paramName = a[0].replace(/\[\d*\]/, function(v) {
                paramNum = v.slice(1, -1);
                return ""
            });
            var paramValue = typeof a[1] === "undefined" ? true : a[1];
            paramName = paramName.toLowerCase();
            if (obj[paramName]) {
                if (typeof obj[paramName] === "string") {
                    obj[paramName] = [obj[paramName]]
                }
                obj[paramName].push(paramValue)
            } else {
                obj[paramName] = paramValue
            }
        }
    }
    return obj
}
String.prototype.ucfirst = function() {
    return this.charAt(0).toUpperCase() + this.substr(1)
}
;
$(document).ready(function() {
    "use strict";
    var $body = $("body");
    $("#carousel-featured-project").one("appear", function() {
        $(this).find(".carousel-inner img.lazy").trigger("appear")
    });
    $("#carousel-featured-project .carousel-indicators li").click(function() {
        var index = $(this).index();
        $("#carousel-featured-project .cycle-slideshow").cycle("goto", index)
    });
    $("#carousel-featured-project .cycle-slideshow").on("cycle-before", function(event, optionHash) {
        var index = optionHash.slideNum;
        $("#carousel-featured-project .carousel-indicators li").removeClass("active");
        $("#carousel-featured-project .carousel-indicators li:eq(" + (index - 1) + ")").addClass("active")
    });
    $("#carousel-featured-project div[data-id='featured-newprojects']").on("click", function(event) {
        var $el = $(this);
        var position = $el.closest("li").index() + 1;
        $el.trigger("ga.featured.listing.slide", [position])
    });
    $("#carousel-featured-project div[data-id='featured-newprojects'] a").on("click", function(event) {
        event.stopPropagation();
        var $el = $(this), position, location;
        if ($el.is("div.item a")) {
            position = $(".item.cycle-slide.cycle-slide-active").index()
        } else {
            position = $el.closest("li").index() + 1
        }
        $el.trigger("ga.featured.listing.open", ["Banner", position])
    });
    $("#carousel-featured-project .carousel-inner div.item").click(function(event) {
        event.stopPropagation();
        var $el = $(this)
          , position = $el.index();
        $el.trigger("ga.featured.listing.open", ["BannerThumbNail", position])
    });
    $('[data-toggle="tooltip"]').tooltip({
        container: "body"
    });
    $("#logout").click(function(e) {
        e.preventDefault();
        var invalidBasicHTTPAuth = window.location.href.replace("://", "://invalid:creds@");
        $.get(invalidBasicHTTPAuth).error(function() {
            alert("Bye!");
            window.location = "/"
        });
        return false
    });
    (function() {
        $body.off("click.ga-agent-show-number");
        $body.on("click.ga-developer-show-number", ".right-content.new-projects .js-agent-phone-number, .right-content.review .js-agent-phone-number", function(e) {
            e.preventDefault();
            var section = guruApp.developerListing.developerObject.section()
              , listingId = 0
              , label = "Right";
            if (section == "Property Review") {
                listingId = $('input[name="itemId"]').val()
            } else {
                listingId = $('input[name="listingId"]').val()
            }
            $body.trigger("ga.phone.show", [0, 0, listingId, section, label]).off("click.ga-developer-show-number").find(".developer-show-number, .right-content.new-projects .js-agent-phone-number").not(this).click()
        });
        $body.on("click.ga-developer-show-number", ".listing-list-developer .js-agent-phone-number", function(e) {
            e.preventDefault();
            var section = guruApp.developerListing.developerObject.section(), listingId, developerId, label = "Search Result";
            $(this).closest("li").attr("class").split(" ").forEach(function(str) {
                var result = str.match(/listing-id-(\d+)/);
                if (result) {
                    listingId = result[1]
                }
                result = str.match(/developer-id-(\d+)/);
                if (result) {
                    developerId = result[1]
                }
            });
            $body.trigger("ga.phone.show", [0, 0, listingId, section, label])
        });
        $body.on("click.ga-developer-show-number", ".js-developer-phone-number", function(e) {
            e.preventDefault();
            var section = guruApp.developerListing.developerObject.section()
              , listingId = $('input[name="listingId"]').val()
              , label = $(this).children(".developer-show-number").closest("aside").length > 0 ? "Right" : "Bottom";
            $body.trigger("ga.phone.show", [0, 0, listingId, section, label]).off("click.ga-developer-show-number").find(".js-developer-phone-number, .right-content.new-projects .js-agent-phone-number, .right-content.review .js-agent-phone-number").not(this).click()
        }).on("click", ".js-developer-phone-number", function(e) {
            e.preventDefault();
            var $numbers = $(this).children(".developer-phone-number.masked");
            var $showNumbers = $(this).children(".developer-show-number");
            $numbers.each(function() {
                var $n = $(this);
                $n.text($n.data("mobile")).removeClass("masked").unwrap()
            });
            $showNumbers.remove()
        })
    }
    )();
    $("#contact-advertiser form input, #contact-advertiser form textarea, #subscribeAlertsNewProjects input").on("keyup", function() {
        if ($(this).val().trim() == "") {
            $(this).val("")
        }
    });
    (function() {
        var $listingId = $("input[name=listingId]").val()
          , $gallery = $(".gallery-contacts a");
        $gallery.on("click", function(e) {
            e.preventDefault();
            $('div[data-item="saleGallery"]').fadeIn();
            $(".gallery-contacts").hide();
            $gallery.trigger("ga.listing.details.sale.gallery.click", [$listingId]);
            $gallery.trigger("leads.dev-listing.sales-gallery.view-phone", [$listingId])
        })
    }
    )();
    (function() {
        var exploreBox = $(".explore-box");
        if (exploreBox) {
            var btn = $("button", exploreBox);
            var lineNo = btn.attr("data-info");
            var height = $(".explore-item").length / 4;
            var items = $(".explore-items");
            $(".explore-item:gt(15)", exploreBox).hide();
            if (lineNo !== undefined) {
                if (height > lineNo) {
                    btn.removeClass("hide")
                }
            }
            btn.on("click", function(e) {
                e.preventDefault();
                $(".explore-item", exploreBox).show("slow");
                btn.addClass("hide")
            })
        }
        setTimeout(function() {
            var exploreCityBox = $(".app-id.new-projects .explore-box:eq(1)");
            if (exploreCityBox.length > 0) {
                if ($("img.noimage", exploreCityBox).length == 0) {
                    exploreCityBox.removeClass("hide")
                }
            }
        }, 1e3)
    }
    )();
    $(".nricValidate").inputmask("999999999999", {
        placeholder: ""
    });
    if ($("#otherdeveloperlistings").length > 0) {
        var totalItems = guruApp.otherDeveloperProjects.totalItems;
        if (totalItems <= 3) {
            $(".loadmore-block").hide()
        }
        $(".loadmore-block a").on("click", function(e) {
            e.preventDefault();
            callOtherDeveloperProjectsAjax($(this))
        })
    }
    disabledCurrentPagination();
    developer.init()
});
var SingleLineSearchBox = {
    init: function() {
        $.widgetSearch().addPreSubmitHook(this.setFormAction)
    },
    setFormAction: function() {
        var $searchForm = $.widgetSearch().getForms();
        if (guruApp.widgetSearch !== undefined && guruApp.widgetSearch.slugs !== undefined) {
            var region = $("input[name='region_code']", $searchForm)
              , propertyType = $("input[name='property_type']", $searchForm)
              , arrayDistricts = $("input[name='district_code[]']:checked", $searchForm)
              , freetext = $("input[name='freetext']", $searchForm).val()
              , plainDistrict = $("input[name='district_code']", $searchForm).val()
              , regionCode = region.val()
              , propertyTypeCode = propertyType.val()
              , hasReview = $("input[name='hasReview']:checked", $searchForm)
              , districtCodes = arrayDistricts.map(function() {
                return $(this).val()
            }).get()
              , stateSlug = guruApp.widgetSearch.slugs.stateSlug !== undefined ? guruApp.widgetSearch.slugs.stateSlug : {}
              , districtSlug = guruApp.widgetSearch.slugs.districtSlug !== undefined ? guruApp.widgetSearch.slugs.districtSlug : {}
              , propertyTypeSlug = guruApp.widgetSearch.slugs.propertyTypeSlug !== undefined ? guruApp.widgetSearch.slugs.propertyTypeSlug : {}
              , action = "";
            if (plainDistrict) {
                districtCodes = [plainDistrict];
                if (!regionCode) {
                    if (plainDistrict.length > 4) {
                        regionCode = plainDistrict.substring(0, 4)
                    } else {
                        for (var regionKey in districtSlug) {
                            if (districtSlug.hasOwnProperty(regionKey) && districtSlug[regionKey][plainDistrict]) {
                                regionCode = regionKey;
                                break
                            }
                        }
                    }
                }
            }
            if (regionCode != "" && stateSlug[regionCode] !== undefined) {
                action = "/" + stateSlug[regionCode];
                if (districtCodes) {
                    if (Array.isArray(districtCodes) && districtCodes.length == 1) {
                        districtCodes = districtCodes.pop();
                        if (districtSlug[regionCode][districtCodes]) {
                            action = action + "/" + districtSlug[regionCode][districtCodes]
                        }
                        arrayDistricts.prop("disabled", true)
                    }
                }
                region.prop("disabled", true)
            }
            if (propertyTypeCode !== undefined && propertyTypeSlug[propertyTypeCode] !== undefined) {
                action = "/" + propertyTypeSlug[propertyTypeCode] + action;
                propertyType.prop("disabled", true)
            }
            if (action !== "") {
                if (guruApp.widgetSearch.routePrefix !== undefined) {
                    action = guruApp.widgetSearch.routePrefix + action
                }
                $searchForm.attr("action", action + "/1")
            }
            $("body").trigger("ga.search.singleline.submit")
        }
        return true
    }
};
$(document).ready(function() {
    "use strict";
    var $searchForm = $(".new-projects-search-single-line");
    if ($searchForm.length > 0) {
        SingleLineSearchBox.init()
    }
});
var propertyReview = {
    section: null,
    init: function(section) {
        propertyReview.section = section;
        propertyReview.scrollTracking()
    },
    disableClickImage: function() {
        var section = this.section;
        $(".introduction img, .review-detail-collapse .content img", section).click(function(event) {
            event.preventDefault();
            event.stopPropagation()
        })
    },
    scrollTracking: function() {
        var $section = $(".review-detail-collapse .border")
          , $body = $("body");
        if ($section.length) {
            $.each($section, function() {
                var section = $(this)
                  , y = Math.round(section.offset().top) - $(window).height()
                  , $w = $(window)
                  , f = function(event) {
                    var showTime = $w.scrollTop() > y;
                    if (showTime && !section.hasClass("scroll-pass")) {
                        var caption = capitalizeFirstLetter(section.attr("id"));
                        $body.trigger("ga.property-review.section.show", caption);
                        section.addClass("scroll-pass")
                    }
                };
                f();
                $w.on("scroll.section", f)
            })
        }
    }
};
$(document).ready(function() {
    "use strict";
    var body = $("body")
      , section = $(".project-reviews-details");
    if (section.length > 0) {
        propertyReview.init()
    }
});
var referralAction = {
    send: function(form) {
        var action = form.attr("action");
        form.addClass("processing").find("input[type=submit]").prop("disabled", true);
        $.post(action, form.serialize(), referral.callbackDone, "json").fail(referral.callbackFail)
    }
};
var referral = {
    $form: null,
    callbackDone: function(data) {
        referral.$form.removeClass("processing").find("input[type=submit]").prop("disabled", false);
        if (data.errors !== undefined) {
            referral.highlightErrorInput(data.errors)
        } else {
            referral.$form.find(".modal-body.success").removeClass("hidden").siblings(".modal-body").hide().end().siblings(".modal-header").hide()
        }
    },
    callbackFail: function(data) {
        referral.$form.removeClass("processing").find("input[type=submit]").prop("disabled", false);
        if (data.responseJSON.errors !== undefined) {
            referral.highlightErrorInput(data.responseJSON.errors)
        }
    },
    highlightErrorInput: function(errors) {
        $.each(errors, function(index, value) {
            var error = value.error
              , element = referral.$form.find(".form-control[name='" + error.field + "']");
            $(element).closest(".form-group").addClass("has-error").on("change", function() {
                $(this).removeClass("has-error")
            })
        })
    }
};
$(document).ready(function() {
    "use strict";
    $("#propertyReviewEmailReferral").on("submit.shareArticle", "form", function(e) {
        e.preventDefault();
        var $form = $(this);
        referral.$form = $form;
        referralAction.send($form);
        return false
    });
    $("#propertyReviewSMSReferral").on("submit.shareArticle", "form", function(e) {
        e.preventDefault();
        var $form = $(this);
        referral.$form = $form;
        referralAction.send($form);
        return false
    })
});
var toggleSection = {
    $contents: null,
    init: function() {
        var headers = $(".review-detail-collapse .header i");
        $(".review-detail-collapse .show-more").on("click", function(e) {
            e.preventDefault();
            toggleSection.expand($(this).parent());
            toggleSection.tracking($(this))
        });
        headers.on("click", function(e) {
            e.preventDefault();
            toggleSection.headerClick($(this))
        });
        $.each(toggleSection.$contents, function() {
            var section = $(this).parent();
            if ($(this).height() < 400) {
                toggleSection.expand(section);
                if ($(this).attr("data-expand") == "true") {
                    toggleSection.expand(section)
                }
                $(this).siblings(".header").find("i").removeClass("pgicon-arrow-up")
            }
        });
        toggleSection.sectionClick()
    },
    collapse: function(section) {
        section.addClass("compacted").removeClass("expanded");
        section.find(".header i").addClass("pgicon-arrow-down").removeClass("pgicon-arrow-up");
        return false
    },
    expand: function(section) {
        section.addClass("expanded").removeClass("compacted");
        section.find(".header i").addClass("pgicon-arrow-up").removeClass("pgicon-arrow-down");
        section.find(".lazy").trigger("appear");
        return false
    },
    headerClick: function(header) {
        if (!header.hasClass("header")) {
            return
        }
        var section = header.closest(".border")
          , position = capitalizeFirstLetter(section.attr("id"));
        if (section.hasClass("expanded")) {
            toggleSection.collapse(section);
            $("body").trigger("ga.property-review.toggle-section", ["Collapse", position])
        } else if (section.hasClass("compacted")) {
            $("body").trigger("ga.property-review.toggle-section", ["Expand", position]);
            toggleSection.expand(section)
        }
    },
    tracking: function(btn) {
        var id = btn.attr("id")
          , action = "Unknown"
          , position = "Unknown";
        if (id) {
            id = btn.attr("id").match(/show-([^\s"]+)-([^\s"]+)/);
            if (id.length == 3) {
                action = capitalizeFirstLetter(id[1]);
                position = capitalizeFirstLetter(id[2])
            }
        }
        $("body").trigger("ga.property-review.show-more-section", [position])
    },
    sectionClick: function() {
        var width = $(window).width();
        $(".review-detail-collapse .header").on("click", function(event) {
            event.preventDefault();
            toggleSection.headerClick($(this))
        })
    }
};
var toggleTagsSection = {
    init: function() {
        $.each($(".property-review-tag"), function() {
            if ($(this).height() > 138) {
                $(this).addClass("collapse");
                $(this).next("div.more-review-tag").removeClass("hidden")
            }
        })
    },
    expand: function() {
        $(".more-review-tag").on("click", function(e) {
            e.preventDefault();
            $(this).addClass("hidden").prev("div.property-review-tag").removeClass("collapse")
        })
    }
};
function capitalizeFirstLetter(word) {
    return word.charAt(0).toUpperCase() + word.slice(1)
}
$(document).ready(function() {
    "use strict";
    var $body = $("body");
    if ($body.find(".property-review").length != 0) {
        toggleTagsSection.init();
        toggleTagsSection.expand()
    }
    if ($body.find("section .review-detail-collapse").length === 0) {
        return
    }
    var contents = $(".review-detail-collapse .content");
    if (contents.length > 0) {
        toggleSection.$contents = contents;
        toggleSection.init()
    }
});
var PropertyReviewSearchBox = {
    init: function() {
        $.widgetSearch().addPreSubmitHook(this.setFormAction)
    },
    setFormAction: function() {
        var findDeveloperSlug = function(value) {
            var slugs = guruApp.widgetSearch.developerSlugs;
            for (var slug in slugs) {
                if (slugs.hasOwnProperty(slug) && slugs[slug] == value) {
                    return slug
                }
            }
            return null
        };
        var build = function(urlParts) {
            var keys = Object.keys(urlParts);
            var action = "";
            if (!keys.length) {
                return ""
            }
            if (urlParts.property_type && urlParts.location) {
                action += "/" + urlParts.property_type + "/" + urlParts.location;
                $('input[name="property_type"]', $searchForm).prop("disabled", true);
                $('input[name="location"]', $searchForm).prop("disabled", true);
                return action
            }
            var useValue = null;
            if (keys.length == 1) {
                useValue = urlParts[keys[0]];
                $('input[name="' + keys[0] + '"]', $searchForm).prop("disabled", true)
            } else {
                var priority = ["property_type", "location", "price", "developer_name"];
                for (var i = 0; i < priority.length; i++) {
                    if (urlParts[priority[i]]) {
                        useValue = urlParts[priority[i]];
                        $('input[name="' + priority[i] + '"]', $searchForm).prop("disabled", true);
                        break
                    }
                }
            }
            action += "/" + useValue;
            return action
        };
        var $searchForm = $.widgetSearch().getForms();
        var searchFields = {};
        ["property_type", "location", "price"].forEach(function(field) {
            var value;
            var $element = $("input[name='" + field + "']", $searchForm);
            if (value = $element.val()) {
                searchFields[field] = value
            }
        });
        var $element = $("input[name='review_param']", $searchForm);
        if ($element) {
            var type = $element.attr("displayType");
            if (type == "Nama Developer" || type == "Developer Name" || type == "") {
                var slug = findDeveloperSlug($element.attr("displayText"));
                if (slug) {
                    searchFields["developer_name"] = slug;
                    $element.prop("disabled", true);
                    var $input = $('<input type="hidden" name="developer_name" value="' + searchFields["developer_name"] + '"/>');
                    $searchForm.append($input);
                    $('input[name="freetext"]').prop("disabled", true)
                }
            }
            $element.prop("disabled", true)
        }
        var action = build(searchFields);
        if (action !== "") {
            if (guruApp.widgetSearch.routePrefix !== undefined) {
                action = guruApp.widgetSearch.routePrefix + action
            }
        } else {
            action = guruApp.widgetSearch.routePrefix
        }
        action += "/1";
        $searchForm.attr("action", action);
        return true
    }
};
$(document).ready(function() {
    "use strict";
    var $searchForm = $(".review-search-box");
    if ($searchForm.length > 0) {
        PropertyReviewSearchBox.init();
        $("#show-filters").click(function() {
            $(".review-search-box").toggleClass("review-searchbox-hidden");
            $(".container.property-review").toggle();
            $("footer").toggle()
        });
        $(".cancel-filters").click(function() {
            $(".review-search-box").toggleClass("review-searchbox-hidden");
            $(".container.property-review").toggle();
            $("footer").toggle();
            $("#show-filters").parent().toggleClass("searchbox-hidden-xs-suppressed").toggleClass("searchbox-hidden-xs")
        })
    }
});
var data__widgets = {
    init: function() {
        var $ddlBinding = $("#faux-price-trend-widget .section-title")
          , $priceTrend = $ddlBinding.parent().find("#price-trend")
          , priceTrendStatus = $priceTrend.data("init");
        $ddlBinding.parent().show();
        if ($ddlBinding.length && $ddlBinding.parent().css("border-top-color").toLowerCase() == "rgb(255, 255, 255)") {
            $ddlBinding.on("click", function(e) {
                if ($(".w-graph__trends")[0] && priceTrendStatus == false) {
                    priceTrendStatus = true;
                    $priceTrend.data("init", true);
                    data__widgets.buildChart()
                } else {
                    $(".w-graph-chart").highcharts().reflow()
                }
            })
        } else {
            data__widgets.buildChart()
        }
    },
    buildChart: function() {
        if (typeof chartData === "undefined") {
            return
        }
        var type = chartData.transactionType;
        type = type.toLowerCase();
        data__widgets.trendChart(type);
        setTimeout(function() {
            $(".w-graph-chart").highcharts().reflow()
        }, 0)
    },
    trendChart: function(chartType) {
        var data__priceIndex = {};
        data__valid = true,
        bedList = {},
        room = $(".dropdown-graphRoom li .active").attr("data-roomcount"),
        defaultYear = $(".chart-wrap .btn-group-years").attr("data-defaultYear");
        chartType = typeof chartType !== "undefined" ? chartType : "default";
        room = typeof room !== "undefined" ? room : "all";
        if (room <= 0 || room == "All") {
            room = "all"
        }
        data__priceIndex = data__widgets.getChartData(chartType);
        trend__chart.createBedlist(chartType);
        trend__chart.displayRoomList(chartType);
        trend__chart.displayYearList(chartType);
        $(".w-graph__trends").removeClass("loading");
        if (data__valid == true) {
            trend__chart.bindGraphElements(data__priceIndex);
            trend__chart.createGraphData(chartType, defaultYear, data__priceIndex, room);
            $(".w-graph__trends .w-graph-chart").highcharts().xAxis[0].setExtremes(trend__chart.getXYearsInThePast(1), trend__chart.getXDaysInThePast(1));
            data__widgets.automationTests(data__priceIndex, room)
        } else {
            $(".w-graph__trends").addClass("not__found")
        }
    },
    automationTests: function(data__priceIndex, room) {
        var chartData = trend__chart.getRoom(data__priceIndex, room)
          , volumeTimeLow = 0
          , volumeTimeHigh = 0
          , volumeValueLow = 0
          , volumeValueHigh = 0
          , priceTimeLow = 0
          , priceTimeHigh = 0
          , priceIndexLow = 0
          , priceIndexHigh = 0
          , districtVolumeTrend = chartData.volumeTrend
          , districtPriceIndex = chartData.priceIndex;
        volumeTimeLow = $(districtVolumeTrend).first()[0][0];
        volumeTimeHigh = $(districtVolumeTrend).last()[0][0];
        volumeValueLow = $(districtVolumeTrend).first()[0][1];
        volumeValueHigh = $(districtVolumeTrend).last()[0][1];
        priceTimeLow = $(districtPriceIndex).first()[0][0];
        priceTimeHigh = $(districtPriceIndex).last()[0][0];
        priceIndexLow = $(districtPriceIndex).first()[0][1];
        priceIndexHigh = $(districtPriceIndex).last()[0][1];
        $(".chart-wrap").attr("data-volume-time-low", volumeTimeLow);
        $(".chart-wrap").attr("data-volume-time-high", volumeTimeHigh);
        $(".chart-wrap").attr("data-volume-value-low", volumeValueLow);
        $(".chart-wrap").attr("data-volume-value-high", volumeValueHigh);
        $(".chart-wrap").attr("data-price-time-low", priceTimeLow);
        $(".chart-wrap").attr("data-price-time-high", priceTimeHigh);
        $(".chart-wrap").attr("data-price-index-low", priceIndexLow);
        $(".chart-wrap").attr("data-price-index-high", priceIndexHigh)
    },
    getChartData: function(chartType) {
        var data__priceIndex = {};
        if (chartType == "sale") {
            data__priceIndex.json = $.parseJSON(chartData.trendSale)
        }
        if (chartType == "rent") {
            data__priceIndex.json = $.parseJSON(chartData.trendRent)
        }
        if (chartType == "default") {
            data__priceIndex.json = $.parseJSON(chartData.trend)
        }
        return data__priceIndex
    },
    bindings: function() {
        $body = $("body");
        var currentUrl = document.referrer
          , transactionType = ""
          , cellSize = 200
          , size = 0
          , rowCount = 0
          , highestCell = 0;
        if ($(".enable-login")[0]) {
            $(".widget-login").click(function(e) {
                $body.trigger("ga.new-login-intent-transaction-widget");
                parent.postMessage("loginforPremiumContent", "*")
            });
            $(".widget-signup").click(function(e) {
                $body.trigger("ga.new-registration-intent-transaction-widget");
                parent.postMessage("signupforPremiumContent", "*")
            })
        }
        if ($(".table-responsive-v-scroll")[0]) {
            $(".table-responsive-v-scroll").each(function(e) {
                size = 0;
                rowCount = 0;
                rowCount = $(this).find("tbody tr").length;
                size = rowCount * cellSize;
                $(this).find("tbody").width(Math.ceil(size))
            })
        }
        $(".insights-transactions li a").on("click", function(e) {
            var transactionType = $(this).attr("data-type"), productType;
            if (transactionType == "rent") {
                productType = "Rent"
            } else {
                productType = "Sale"
            }
            $body.trigger("ga.transaction-widget.tabclick", [toTitleCase(transactionType), productType])
        })
    }
};
var trend__chart = {
    createBedlist: function(chartType) {
        var options, activeBed, status = "", buttonText = "", $dropdownList = $(".dropdown-graphRoom"), unit = "Bedroom";
        if (chartType == "rent") {
            options = $.parseJSON(chartData.bedListRent)
        }
        if (chartType == "sale") {
            options = $.parseJSON(chartData.bedListSale)
        }
        if (chartType == "default") {
            options = $.parseJSON(chartData.bedList)
        }
        return options
    },
    displayRoomList: function(type) {
        $(".btn-graph-rooms").hide().removeClass("active");
        $(".btn-graph-rooms[data-type='" + type + "']").css("display", "inline-block").addClass("active")
    },
    displayYearList: function(type) {
        $(".btn-group-years").hide().removeClass("active");
        $(".btn-group-years[data-type='" + type + "']").css("display", "inline-block").addClass("active")
    },
    getXYearsInThePast: function(x) {
        return Date.now() - 1e3 * 3600 * 24 * 365.2425 * x
    },
    getXDaysInThePast: function(x) {
        return Date.now() - 1e3 * 3600 * 24 * x
    },
    getXDaysInTheFuture: function(x) {
        return Date.now() + 1e3 * 3600 * 24 * x
    },
    bindGraphElements: function(data__priceIndex) {
        var $wgraph = $(".w-graph")
          , $chart = $(".w-graph-chart")
          , $btnGroupYears = $wgraph.find(".btn-group-years")
          , btnGroupDefaultYear = parseInt($btnGroupYears.attr("data-defaultYear"), 10)
          , $btnGroupYearsLinks = $btnGroupYears.find("a")
          , $btnGroupYearsActive = $btnGroupYears.find(".active")
          , $btnGroupType = $wgraph.find(".dropdown-graphType a")
          , $btnGroupRoom = $wgraph.find(".dropdown-graphRoom a")
          , $btnGroupRoomActive = $btnGroupRoom.find(".active")
          , $resetZoom = $wgraph.find(".btn-reset-zoom a")
          , $years_trigger = $btnGroupYears.find(".btn-default")
          , $rooms_trigger = $(".btn-graph-rooms .btn-default")
          , graphRoom = $btnGroupRoom.parent().find(".active").attr("data-roomCount")
          , graphFilter = $btnGroupYears.find(".active").attr("data-yearrange")
          , graphRoomText = $btnGroupRoom.parent().find(".active").first().text()
          , propertyType = ""
          , unitType = ""
          , graphTypeParam = chartData.transactionType.toLowerCase()
          , needRedraw = true;
        if (graphTypeParam == "sale") {
            graphType = $btnGroupType.parent().find(".active").attr("data-graphType")
        } else {
            graphType = "rent"
        }
        $btnGroupType.unbind("click");
        $btnGroupRoom.unbind("click");
        $btnGroupYearsLinks.unbind("click");
        propertyType = chartData.propertyType;
        if (graphRoomText == "") {
            if (propertyType == "condo") {
                unitType = "Bedrooms"
            }
            if (propertyType == "hdb") {
                unitType = "Flats"
            }
            graphRoomText = "All"
        }
        $rooms_trigger.find(".roomText").html(graphRoomText + " " + unitType);
        $btnGroupType.click(function(e) {
            e.preventDefault();
            var $type_trigger = $(".btn-graph-type .btn-default"), text = $(this).text(), graphType = $(this).attr("data-graphType"), $yearObject = "", area;
            area = $(".areainsider-page").data("area");
            $body.trigger("ga.ai.area.price-trend.propertytype-dropdown", [area, text]);
            $btnGroupType.removeClass("active");
            $(this).addClass("active");
            $type_trigger.text(text).val(text);
            trend__chart.displayRoomList(graphType);
            trend__chart.displayYearList(graphType);
            $btnGroupYearsLinks.each(function(e) {
                if ($(this).attr("data-yearrange") == btnGroupDefaultYear) {
                    $yearObject = $(this)
                }
            });
            $btnGroupYearsLinks.removeClass("active");
            $yearObject.addClass("active");
            $years_trigger.text($yearObject.text()).val($yearObject.attr("data-yearrange"));
            graphFilter = $btnGroupYears.find(".active").attr("data-yearrange");
            if ($chart.highcharts()) {
                $chart.highcharts().destroy()
            }
            data__widgets.trendChart(graphType);
            $(".w-graph-chart").highcharts().xAxis[0].setExtremes(widget__graphs.getXYearsInThePast(graphFilter), widget__graphs.getXDaysInThePast(1))
        });
        $btnGroupRoom.click(function(e) {
            e.preventDefault();
            var roomNum = $(this).attr("roomCount"), text = $(this).text(), area, roomsSelected;
            area = $(".areainsider-page").data("area");
            $btnGroupRoom.removeClass("active");
            $(this).addClass("active");
            $rooms_trigger.attr("data-activeRoom", roomNum).val(roomNum).find("roomTxt").html(text);
            graphRoomText = $(this).text();
            if (graphTypeParam == "sale") {
                graphType = $btnGroupType.parent().find(".active").attr("data-graphType")
            } else {
                graphType = "rent"
            }
            roomsSelected = $(".dropdown-graphRoom li .active").attr("data-roomcount");
            switch (roomsSelected) {
            case "all":
                roomsSelected = "All";
                break;
            default:
                roomsSelected += "B";
                break
            }
            $body.trigger("ga.ai.area.price-trend.bedrooms-dropdown", [area, roomsSelected]);
            graphRoom = $btnGroupRoom.parent().find(".active").attr("data-roomCount");
            graphFilter = $btnGroupYearsActive.attr("data-yearRange");
            data__priceIndex = data__widgets.getChartData(graphType);
            if ($chart.highcharts()) {
                $chart.highcharts().destroy()
            }
            data__widgets.trendChart(graphType);
            $(".w-graph-chart").highcharts().xAxis[0].setExtremes(widget__graphs.getXYearsInThePast(graphFilter), widget__graphs.getXDaysInThePast(1))
        });
        $btnGroupYearsLinks.click(function(e) {
            e.preventDefault();
            var text = $(this).text(), area;
            area = $(".areainsider-page").data("area");
            if (graphTypeParam == "sale") {
                graphType = $btnGroupType.parent().find(".active").attr("data-graphType")
            } else {
                graphType = "rent"
            }
            graphRoom = $btnGroupRoom.parent().find(".active").attr("data-roomCount");
            graphFilter = $(this).attr("data-yearRange");
            var strYear = function(year) {
                if (year <= 1)
                    return year * 12 + "M";
                else
                    return year + "Y"
            }(graphFilter);
            $body.trigger("ga.ai.area.price-trend.years-dropdown", [area, strYear]);
            $btnGroupYearsLinks.removeClass("active");
            $(this).addClass("active");
            $btnGroupYearsActive = $(this);
            $years_trigger.text(text).val(text);
            if ($chart.highcharts()) {
                $chart.highcharts().destroy()
            }
            data__widgets.trendChart(graphType);
            $(".w-graph-chart").highcharts().xAxis[0].setExtremes(widget__graphs.getXYearsInThePast(graphFilter), widget__graphs.getXDaysInThePast(1))
        });
        $resetZoom.click(function(e) {
            var $btnGroupYears = $(".btn-group-years a");
            e.preventDefault();
            $btnGroupYears.removeClass("active");
            $chart.parent().removeClass("zoom-active");
            if ($chart.highcharts()) {
                $chart.highcharts().destroy()
            }
            data__widgets.trendChart(graphType)
        })
    },
    getLowestTimestamp: function(series) {
        var min_val = 1e22;
        for (var i = 0; i < series.length; i++) {
            if (series[i] === null) {
                continue
            }
            for (var j = 0; j < series[i].length; j++) {
                if (series[i][j] < min_val) {
                    min_val = series[i][j]
                }
                break
            }
        }
        return min_val
    },
    getHighestTimestamp: function(series) {
        var max_val = 0;
        for (var i = 0; i < series.length; i++) {
            for (var j = 0; j < series[i].length; j++) {
                if (series[i][j] > max_val) {
                    min_val = series[i][j]
                }
                break
            }
        }
        return max_val
    },
    reindexFromYear: function(serie, filter) {
        var x = trend__chart.getXYearsInThePast(filter);
        if (typeof serie == "undefined" || serie === null) {
            return null
        }
        var index = null;
        for (var i = 0; i < serie.length; i++) {
            if (serie[i][0] > x) {
                index = i;
                break
            }
        }
        if (index === 0 || index === null || serie[index - 1][1] === null || serie[index][1] === null) {
            return null
        }
        var x0 = serie[index - 1][0]
          , x1 = serie[index][0]
          , y0 = serie[index - 1][1]
          , y1 = serie[index][1];
        var valueAtNorm = y0 + (y1 - y0) * (x - x0) / (x1 - x0)
          , factor = 100 / valueAtNorm;
        return trend__chart.scaleSeries(serie, factor)
    },
    scaleSeries: function(serie, factor) {
        if (!$.isArray(serie)) {
            return null
        }
        var out = serie.slice(0);
        for (var i = 0; i < serie.length; i++) {
            out[i][1] = serie[i][1] === null ? null : serie[i][1] * factor
        }
        return out
    },
    getRoom: function(data, room) {
        var row, found = false, roomObject = {}, allRoomObject = {};
        for (var i = 0; i < data.json.length; i++) {
            if (data.json[i]["bedroomsType"]instanceof Array) {
                allRoomObject = data.json[i]
            } else {
                if (data.json[i]["bedroomsType"].charAt(0).toLowerCase() == room.toLowerCase()) {
                    found = true;
                    roomObject = data.json[i]
                }
            }
        }
        if (room.toLowerCase() != "all") {
            if (found == true) {
                return roomObject
            }
        }
        volumeTimeLow = 0,
        volumeTimeHigh = 0,
        volumeValueLow = 0,
        volumeValueHigh = 0,
        priceTimeLow = 0,
        priceTimeHigh = 0,
        priceIndexLow = 0,
        priceIndexHigh = 0;
        $(".btn-graph-rooms .btn-default .roomText").text($('.btn-graph-rooms *[data-roomcount="all"]').first().text());
        return allRoomObject
    },
    createGraphData: function(type, filter, data, froom) {
        var graphProperties = {}
          , date__filter = new Date
          , data_guru_locale = "my"
          , rentDataCache = {}
          , saleDataCache = {}
          , data__specific = {}
          , chartCached = false
          , districtMeta = $.parseJSON(chartData.districtMeta);
        data = jQuery.extend(true, {}, data);
        data.json = trend__chart.getRoom(data, froom);
        if (data.json != null && typeof data.json !== "undefined") {
            data.districtAvgPSF = data.json.avgPsf;
            data.districtVolumeTrend = data.json.volumeTrend;
            data.districtPriceIndex = data.json.priceIndex;
            data.districtBedrooms = data.json.bedroomsType
        } else {
            data.propertyCount = 0;
            data.propertyAvgPrice = 0;
            data.propertyAvgPricePerArea = 0
        }
        graphProperties.graphType = type;
        graphProperties.districtDescription = districtMeta.districtDescription;
        graphProperties.propertyType = districtMeta.propertyType;
        data.districtPriceIndex = trend__chart.scaleSeries(data.json.priceIndex, data.districtAvgPSF);
        graphProperties.title = type + " trend";
        graphProperties.count = data.json.numTrans;
        graphProperties.room = room + " room";
        if (room > 1 || room == "all") {
            graphProperties.room += "s"
        }
        graphProperties.siteName = "PropertyGuru";
        if (graphProperties.siteName == "") {
            graphProperties.siteName = "PropertyGuru"
        }
        graphProperties.series = [{
            name: "Volume",
            metric: "units",
            symbol: "",
            type: "column",
            color: "rgba(51, 154, 170, 0.5)",
            data: data.districtVolumeTrend,
            pointPadding: .1,
            groupPadding: 0
        }, {
            name: "Price Trend",
            metric: "psf",
            symbol: "$",
            type: "spline",
            color: "rgba(172, 31, 26, 0.5)",
            width: .5,
            yAxis: 1,
            data: data.districtPriceIndex
        }];
        graphProperties.crosshairs = {
            color: "#999999",
            dashStyle: "solid"
        };
        graphProperties.xAxisLabel = "";
        graphProperties.yAxisLabel = "Units";
        graphProperties.xfloor = trend__chart.getLowestTimestamp(data.districtPriceIndex);
        trend__chart.displayTimeSeries(graphProperties)
    },
    displayTimeSeries: function(graphProperties) {
        var disclaimer = "Source: URA, HDB & PropertyGuru.<br/>Based on " + parseInt(graphProperties.count, 10).format() + " " + graphProperties.propertyType + " transactions in " + graphProperties.districtDescription;
        var chart = $(".w-graph-chart").highcharts({
            chart: {
                backgroundColor: "transparent",
                spacingBottom: 40,
                spacingTop: 60,
                zoomType: "xy",
                height: 350,
                resetZoomButton: {
                    theme: {
                        display: "none"
                    }
                },
                events: {
                    selection: function(event) {
                        $(".w-graph__trends").addClass("zoom-active");
                        $(".btn-group-years a").removeClass("active")
                    }
                }
            },
            title: {
                text: "",
                align: "left",
                verticalAlign: "top",
                x: 0
            },
            subtitle: {
                align: "center",
                floating: true,
                verticalAlign: "bottom",
                text: disclaimer,
                borderWidth: 0,
                height: 20,
                x: 0,
                y: 40
            },
            legend: {
                align: "left",
                floating: true,
                verticalAlign: "top",
                layout: "horizontal",
                borderWidth: 0,
                x: -20,
                y: -60,
                itemStyle: {
                    color: "#5e5e6c"
                }
            },
            xAxis: {
                type: "datetime",
                dateTimeLabelFormats: {
                    month: "%e. %b",
                    year: "%b"
                },
                labels: {
                    format: "{value:%b}",
                    rotation: 0,
                    step: 1
                },
                title: {
                    text: graphProperties.xAxisLabel
                },
                tickColor: "#5e5e6c",
                floor: graphProperties.xfloor,
                ceiling: trend__chart.getXDaysInTheFuture(1),
                minRange: 1e3 * 3600 * 24 * 30
            },
            yAxis: [{
                floor: 0,
                title: {
                    text: "Transaction Volume",
                    style: {}
                },
                ceiling: trend__chart.getXDaysInTheFuture(1),
                labels: {
                    formatter: function() {
                        return Highcharts.numberFormat(this.value, 0)
                    },
                    style: {},
                    format: "{value:%b} {value:%y}",
                    rotation: 0,
                    step: 1
                }
            }, {
                gridLineWidth: 0,
                gridLineColor: "#5e5e6c",
                title: {
                    text: "Price (PSF)",
                    style: {}
                },
                ceiling: trend__chart.getXDaysInTheFuture(1),
                labels: {
                    formatter: function() {
                        return "$" + Highcharts.numberFormat(this.value, 2)
                    },
                    style: {},
                    format: "{value}",
                    rotation: 0,
                    step: 1
                },
                opposite: true
            }],
            plotOptions: {
                series: {
                    marker: {
                        enabled: false
                    },
                    events: {
                        legendItemClick: function() {}
                    }
                }
            },
            tooltip: {
                shared: true,
                useHTML: true,
                followPointer: true,
                formatter: function() {
                    var tooltip_markup = ""
                      , timestamp = new Date(this.points[0].x)
                      , y_value = 0;
                    tooltip_markup += '<div class="inside-tooltip"><div class="header">' + '<h2 class="series-type">' + graphProperties.graphType.capitalizeFirstLetter() + '</h2> <span class="date">' + timestamp.customFormat("#MMM# #D##th# #YY#") + "</span></div>" + '<span class="rooms"> ' + $(".btn-graph-rooms.active .btn-default").text() + "</span>" + "<table>";
                    $.each(this.points, function() {
                        y_value = this.y;
                        if (this.series.options.metric == "psf") {
                            y_value = Highcharts.numberFormat(this.y, 2)
                        }
                        tooltip_markup += "<tr>" + '<td class="series-label" style="color:' + this.series.color + '">' + this.series.name + ": </td>" + '<td style="text-align: right"><b>' + this.series.options.symbol + y_value + " " + this.series.options.metric + "</b></td>" + "</tr>"
                    });
                    tooltip_markup += "</table></div>";
                    return tooltip_markup
                },
                valueDecimals: 2,
                crosshairs: graphProperties.crosshairs
            },
            credits: {
                enabled: false
            },
            series: graphProperties.series
        })
    }
};
function updateQueryString(key, value) {
    var re = new RegExp("([?&])" + key + "=.*?(&|#|$)(.*)","gi"), hash, url = window.location.href;
    if (re.test(url)) {
        if (typeof value !== "undefined" && value !== null)
            return url.replace(re, "$1" + key + "=" + value + "$2$3");
        else {
            hash = url.split("#");
            url = hash[0].replace(re, "$1$3").replace(/(&|\?)$/, "");
            if (typeof hash[1] !== "undefined" && hash[1] !== null)
                url += "#" + hash[1];
            return url
        }
    } else {
        if (typeof value !== "undefined" && value !== null) {
            var separator = url.indexOf("?") !== -1 ? "&" : "?";
            hash = url.split("#");
            url = hash[0] + separator + key + "=" + value;
            if (typeof hash[1] !== "undefined" && hash[1] !== null)
                url += "#" + hash[1];
            return url
        } else
            return url
    }
}
function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)")
      , results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "))
}
String.prototype.escapeSpecialChars = function() {
    return this.replace(/&quot;/g, '"').replace(/\\n/g, "\\n").replace(/\\'/g, "\\'").replace(/\\"/g, '\\"').replace(/\\&/g, "\\&").replace(/\\r/g, "\\r").replace(/\\t/g, "\\t").replace(/\\b/g, "\\b").replace(/\\f/g, "\\f")
}
;
String.prototype.capitalizeFirstLetter = function() {
    return this.charAt(0).toUpperCase() + this.slice(1)
}
;
Date.prototype.customFormat = function(formatString) {
    var YYYY, YY, MMMM, MMM, MM, M, DDDD, DDD, DD, D, hhhh, hhh, hh, h, mm, m, ss, s, ampm, AMPM, dMod, th;
    YY = ((YYYY = this.getFullYear()) + "").slice(-2);
    MM = (M = this.getMonth() + 1) < 10 ? "0" + M : M;
    MMM = (MMMM = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][M - 1]).substring(0, 3);
    DD = (D = this.getDate()) < 10 ? "0" + D : D;
    DDD = (DDDD = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][this.getDay()]).substring(0, 3);
    th = D >= 10 && D <= 20 ? "th" : (dMod = D % 10) == 1 ? "st" : dMod == 2 ? "nd" : dMod == 3 ? "rd" : "th";
    formatString = formatString.replace("#YYYY#", YYYY).replace("#YY#", YY).replace("#MMMM#", MMMM).replace("#MMM#", MMM).replace("#MM#", MM).replace("#M#", M).replace("#DDDD#", DDDD).replace("#DDD#", DDD).replace("#DD#", DD).replace("#D#", D).replace("#th#", th);
    h = hhh = this.getHours();
    if (h == 0)
        h = 24;
    if (h > 12)
        h -= 12;
    hh = h < 10 ? "0" + h : h;
    hhhh = h < 10 ? "0" + hhh : hhh;
    AMPM = (ampm = hhh < 12 ? "am" : "pm").toUpperCase();
    mm = (m = this.getMinutes()) < 10 ? "0" + m : m;
    ss = (s = this.getSeconds()) < 10 ? "0" + s : s;
    return formatString.replace("#hhhh#", hhhh).replace("#hhh#", hhh).replace("#hh#", hh).replace("#h#", h).replace("#mm#", mm).replace("#m#", m).replace("#ss#", ss).replace("#s#", s).replace("#ampm#", ampm).replace("#AMPM#", AMPM)
}
;
function toTitleCase(str) {
    return str.replace(/\w\S*/g, function(txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()
    })
}
$(function() {
    if (!$("body").is(".app-sg")) {
        return
    }
    var $window = $(window);
    $window.on("highcharts.loaded", function() {
        data__widgets.init()
    });
    data__widgets.bindings()
});
$(document).ready(function() {
    var $body = $("body");
    if (typeof guruApp.widgetGoogleAnalytics === "undefined") {
        return
    }
    var category = "AreaInsider";
    var createGaDimension = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.createGaDimension;
    var track = function(category, action, label, value, noninteraction, dimensions) {
        label = cleanText(label);
        if (guruApp.widgetGoogleAnalytics.googleAnalyticsObject !== null) {
            guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent(category, action, label, value, noninteraction, dimensions)
        }
    }
      , cleanText = function(str) {
        return str.replace(/^https?:\/\/[^\/]+/, "").replace(/^\s+/, "").replace(/\s+$/, "").replace(/\s+/, " ")
    };
    $body.on("ga.ai.landing.ready", function(e, area) {
        var page = "AreaInsider Landing Page";
        var dimension20 = {
            Area: area,
            Page: page
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Impression", "GoToArea", "Page=" + page, null, null, dimensions)
    });
    $body.on("ga.ai.landing.area.click", function(e, area, position) {
        var dimension20 = {
            Area: area,
            Position: position
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToArea", "Area=" + area, null, null, dimensions)
    });
    $body.on("ga.ai.landing.dev-listing.click", function(e, listingId, position) {
        var dimension20 = {
            Project: listingId,
            Position: position
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToFeaturedProject", "Project=" + listingId, null, null, dimensions)
    });
    var alreadyScrollLanding = {};
    $body.on("ga.ai.landing.show", function(e, objectName) {
        if (alreadyScrollLanding[objectName])
            return;
        var dimension20 = {
            ScrollTo: objectName
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "ScrollLanding", "ScrollTo=" + objectName, null, null, dimensions);
        alreadyScrollLanding[objectName] = true
    });
    $body.on("ga.ai.area.article.click", function(e, area, articleId, position) {
        var dimension20 = {
            Area: area,
            Article: articleId,
            Position: position
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToArticle", "Article=" + articleId, null, null, dimensions)
    });
    $body.on("ga.ai.area.photo.click", function(e, area, photoName, position) {
        var dimension20 = {
            Area: area,
            Photo: photoName,
            Position: position
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "ViewPhoto", "View=" + photoName, null, null, dimensions)
    });
    $body.on("ga.ai.area.newproject.click", function(e, area, projectId) {
        var dimension20 = {
            Area: area,
            Project: projectId
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToProject", "Project=" + projectId, null, null, dimensions)
    });
    $body.on("ga.ai.area.review.click", function(e, area, reviewId) {
        var dimension20 = {
            Area: area,
            Review: reviewId
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToReview", "Review=" + reviewId, null, null, dimensions)
    });
    $body.on("ga.ai.area.property.sale.listing.click", function(e, area, listingId, position) {
        var dimension20 = {
            Area: area,
            listingId: listingId,
            Position: position
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToProperty", "PropertyForSale=" + listingId, null, null, dimensions)
    });
    $body.on("ga.ai.area.property.rent.listing.click", function(e, area, listingId, position) {
        var dimension20 = {
            Area: area,
            listingId: listingId,
            Position: position
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToProperty", "PropertyForRent=" + listingId, null, null, dimensions)
    });
    $body.on("ga.ai.area.property.sale.all.click", function(e, area, url) {
        var dimension20 = {
            Area: area,
            "Properties for Sales View All": url
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToViewAllProperties", "PropertiesForSales=" + url, null, null, dimensions)
    });
    $body.on("ga.ai.area.property.rent.all.click", function(e, area, url) {
        var dimension20 = {
            Area: area,
            "Properties for Rents View All": url
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToViewAllProperties", "PropertiesForRents=" + url, null, null, dimensions)
    });
    $body.on("ga.ai.area.map.zoom.action", function(e, area, direction) {
        var dimension20 = {
            Area: area,
            Zoom: direction
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzeMap", "Zoom=" + direction, null, null, dimensions)
    });
    $body.on("ga.ai.area.map.level.action", function(e, area, level) {
        var dimension20 = {
            Area: area,
            ZoomLevel: level
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzeMap", "ZoomLevel=" + level, null, null, dimensions)
    });
    $body.on("ga.ai.area.map.search.action", function(e, area, text) {
        var dimension20 = {
            Area: area,
            Search: text
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzeMap", "Search=" + text, null, null, dimensions)
    });
    $body.on("ga.ai.area.map.other-action.action", function(e, area, action) {
        var dimension20 = {
            Area: area,
            Act: action
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzeMap", "Act=" + action, null, null, dimensions)
    });
    $body.on("ga.ai.area.map.poi.click", function(e, area, poi) {
        var dimension20 = {
            Area: area,
            POI: poi
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzeMap", "POI=" + poi, null, null, dimensions)
    });
    $body.on("ga.ai.area.price-trend.propertytype-dropdown", function(e, area, propertyType) {
        var dimension20 = {
            Area: area,
            PropertyType: propertyType
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzePrice", "PropertyType=" + propertyType, null, null, dimensions)
    });
    $body.on("ga.ai.area.price-trend.bedrooms-dropdown", function(e, area, roomSelected) {
        var dimension20 = {
            Area: area,
            Bedroom: roomSelected
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzePrice", "Bedroom=" + roomSelected, null, null, dimensions)
    });
    $body.on("ga.ai.area.price-trend.years-dropdown", function(e, area, year) {
        var dimension20 = {
            Area: area,
            Period: year
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzePrice", "Period=" + year, null, null, dimensions)
    });
    $body.on("ga.ai.area.price-history.graphtype-dropdown", function(e, area, type) {
        var dimension20 = {
            Area: area,
            ListingPrice: type
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzePrice", "ListingPrice=" + type, null, null, dimensions)
    });
    $body.on("ga.ai.area.price-history.period-select", function(e, area, period) {
        var dimension20 = {
            Area: area,
            Period: period
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzePrice", "Period=" + period, null, null, dimensions)
    });
    var alreadyScrollArea = {};
    $body.on("ga.ai.area.show", function(e, area, objectName) {
        if (alreadyScrollArea[objectName])
            return;
        var dimension20 = {
            Area: area,
            ScrollTo: objectName
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "ScrollArea", "ScrollTo=" + objectName, null, null, dimensions);
        alreadyScrollArea[objectName] = true
    });
    $body.on("ga.ai.article.related.click", function(e, area, articleId, relatedArticleId, widget, position) {
        var dimension20 = {
            Area: area,
            Article: articleId,
            RelatedArticle: relatedArticleId,
            Widget: widget,
            Position: position
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToRelatedArticle", "RelatedArticle=" + relatedArticleId, null, null, dimensions)
    });
    var reachEndOfArticle = false;
    $body.on("ga.ai.article.end.show", function(e, area, articleId) {
        if (reachEndOfArticle)
            return;
        reachEndOfArticle = true;
        var dimension20 = {
            Area: area,
            Article: articleId,
            ScrollTo: "EndOfArticle"
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "ScrollArticle", "ScrollTo=EndOfArticle", null, null, dimensions)
    });
    $body.on("ga.ai.article.back.click", function(e, area, articleId, location) {
        var dimension20 = {
            Area: area,
            Article: articleId,
            Location: location
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoBack", "Location=RelatedArticles", null, null, dimensions)
    });
    $body.on("ga.ai.article.breadcrumb.click", function(e, area, articleId) {
        var dimension20 = {
            Area: area,
            Article: articleId,
            Location: "Breadcrumb"
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoBack", "Location=Breadcrumb", null, null, dimensions)
    });
    $body.on("ga.ai.area.virtualtour.click", function(e, area, url, position) {
        var dimension20 = {
            Area: area,
            VT: url,
            position: position
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "ViewVT", "VT=" + url, null, null, dimensions)
    })
});
var widget__graphs = {
    init: function() {
        var data__priceIndex = {}
          , data__valid = true;
        if (typeof guruApp.propertyInsightsWidget === "undefined" || typeof guruApp.propertyInsightsWidget.WidgetData === "undefined") {
            data__valid = false;
            return
        }
        data__priceIndex.json = $.parseJSON(guruApp.propertyInsightsWidget.WidgetData);
        setTimeout(function() {
            $(".w-graph__1").removeClass("loading");
            if (data__valid === true) {
                widget__graphs.bindGraphElements(data__priceIndex);
                widget__graphs.createGraphData("askPrice", 2, data__priceIndex);
                $(".w-graph-chart").highcharts().xAxis[0].setExtremes(widget__graphs.getXYearsInThePast(2), widget__graphs.getXDaysInThePast(1))
            } else {
                $(".w-graph__1").addClass("not__found")
            }
        }, 200)
    },
    getXYearsInThePast: function(x) {
        return Date.now() - 1e3 * 3600 * 24 * 365.2425 * x
    },
    getXDaysInThePast: function(x) {
        return Date.now() - 1e3 * 3600 * 24 * x
    },
    bindGraphElements: function(data__priceIndex) {
        var type = "askPrice"
          , filter = .25
          , needRedraw = false
          , $wgrap = $(".w-graph")
          , $btnGroupYears = $wgrap.find(".btn-group-years")
          , $btnGroupYearsLinks = $btnGroupYears.find("a")
          , $body = $("body")
          , area = $(".areainsider-page").data("area");
        $(".w-graph .dropdown-menu a").click(function(e) {
            e.preventDefault();
            type = $(this).attr("data-graphType");
            if (type == "askPrice") {
                $body.trigger("ga.ai.area.price-history.graphtype-dropdown", [area, "Price"])
            } else if (type == "askPsm") {
                $body.trigger("ga.ai.area.price-history.graphtype-dropdown", [area, "PSF"])
            } else if (type == "listIndex") {
                $body.trigger("ga.ai.area.price-history.graphtype-dropdown", [area, "Index"])
            } else if (type == "listIndexPsm") {
                $body.trigger("ga.ai.area.price-history.graphtype-dropdown", [area, "PSF Index"])
            }
            $(".btn-graph-type .btn:first-child").text($(this).text());
            $(".btn-graph-type .btn:first-child").val($(this).text());
            needRedraw = true;
            $(".w-graph .btn-group-years a:first-child").addClass("no-track").trigger("click")
        });
        $(".w-graph .btn-group-years a").click(function(e) {
            e.preventDefault();
            filter = $(this).attr("data-yearRange");
            if ($(this).hasClass("no-track")) {
                $(this).removeClass("no-track")
            } else {
                if (filter == "0.25") {
                    $body.trigger("ga.ai.area.price-history.period-select", [area, "3M"])
                } else if (filter == "1") {
                    $body.trigger("ga.ai.area.price-history.period-select", [area, "1Y"])
                } else if (filter == "2") {
                    $body.trigger("ga.ai.area.price-history.period-select", [area, "2Y"])
                }
            }
            $(".btn-group-years a").removeClass("active");
            $(this).addClass("active");
            if (needRedraw || type == "listIndex" || type == "listIndexPsm") {
                widget__graphs.createGraphData(type, filter, data__priceIndex)
            }
            needRedraw = false;
            $(".w-graph-chart").highcharts().xAxis[0].setExtremes(widget__graphs.getXYearsInThePast(filter), widget__graphs.getXDaysInThePast(1))
        })
    },
    getLowestTimestamp: function(series) {
        var min_val = 1e22;
        for (var i = 0; i < series.length; i++) {
            if (series[i] === null) {
                continue
            }
            for (var j = 0; j < series[i].length; j++) {
                if (series[i][j][1] !== null) {
                    if (series[i][j][0] < min_val) {
                        min_val = series[i][j][0]
                    }
                    break
                }
            }
        }
        return min_val
    },
    reindexFromYear: function(serie, filter) {
        var x = widget__graphs.getXYearsInThePast(filter);
        if (typeof serie == "undefined" || serie === null) {
            return null
        }
        var index = null;
        for (var i = 0; i < serie.length; i++) {
            if (serie[i][0] > x) {
                index = i;
                break
            }
        }
        if (index === 0 || index === null || serie[index - 1][1] === null || serie[index][1] === null) {
            return null
        }
        var x0 = serie[index - 1][0]
          , x1 = serie[index][0]
          , y0 = serie[index - 1][1]
          , y1 = serie[index][1];
        var valueAtNorm = y0 + (y1 - y0) * (x - x0) / (x1 - x0)
          , factor = 100 / valueAtNorm;
        return widget__graphs.scaleSeries(serie, factor)
    },
    scaleSeries: function(serie, factor) {
        if (!$.isArray(serie)) {
            return null
        }
        var out = serie.slice(0);
        for (var i = 0; i < serie.length; i++) {
            out[i][1] = serie[i][1] === null ? null : serie[i][1] * factor
        }
        return out
    },
    createColumnData: function(type, filter, data) {
        var graphProperties = {}
          , date__filter = new Date
          , title = "Average Rental Price";
        graphProperties.categories = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        graphProperties.series = [{
            name: "HDB 1",
            type: "column",
            color: "#cc2222",
            width: 50,
            data: [900, 400, 500, 800, 1e3, 1250, 1200, 1100, 1200, 1300, 950, 500]
        }, {
            name: "Exec Condo",
            type: "column",
            color: "#344953",
            width: 50,
            data: [2100, 4e3, 3e3, 1500, 2300, 2e3, 3200, 2500, 2600, 1900, 1750, 1500]
        }];
        graphProperties.crosshairs = false;
        graphProperties.xAxisLabel = "";
        graphProperties.yAxisLabel = "SGD$";
        widget__graphs.displayGraph(graphProperties)
    },
    createGraphData: function(type, filter, data) {
        var graphProperties = {}
          , date__filter = new Date;
        data_guru_locale = "ms";
        if (type == "column") {
            widget__graphs.createColumnData(type, filter, data);
            return
        }
        data = jQuery.extend(true, {}, data);
        data.districtCount = parseInt(data.json.district.count, 10);
        data.districtAvgPrice = data.json.district.avgPrice;
        data.districtAvgPricePerArea = data.json.district.avgPricePerArea;
        data.regionCount = parseInt(data.json.region.count, 10);
        data.regionAvgPrice = data.json.region.avgPrice;
        data.regionAvgPricePerArea = data.json.region.avgPricePerArea;
        var propertypriceIndex = 0
          , propertyPricePerAreaIndex = 0;
        if (data.json.property !== null && typeof data.json.property !== "undefined") {
            data.propertyCount = parseInt(data.json.property.count, 10);
            data.propertyAvgPrice = data.json.property.avgPrice;
            data.propertyAvgPricePerArea = data.json.property.avgPricePerArea;
            propertypriceIndex = data.json.property.priceIndex;
            propertyPricePerAreaIndex = data.json.property.pricePerAreaIndex
        } else {
            data.propertyCount = 0;
            data.propertyAvgPrice = 0;
            data.propertyAvgPricePerArea = 0
        }
        graphProperties.districtName = data.json.meta.districtName;
        graphProperties.regionName = data.json.meta.regionName;
        graphProperties.propertyName = data.json.meta.propertyName;
        graphProperties.listingCount = data.regionCount;
        switch (type) {
        case "askPrice":
            data.priceIndex = widget__graphs.scaleSeries(data.json.district.priceIndex, data.districtAvgPrice / 100);
            data.regionPriceIndex = widget__graphs.scaleSeries(data.json.region.priceIndex, data.regionAvgPrice / 100);
            data.propertyPriceIndex = widget__graphs.scaleSeries(propertypriceIndex, data.propertyAvgPrice / 100);
            graphProperties.yAxisLabel = data.json.meta.currencySymbol;
            break;
        case "askPsm":
            data.priceIndex = widget__graphs.scaleSeries(data.json.district.pricePerAreaIndex, data.districtAvgPricePerArea / 100);
            data.regionPriceIndex = widget__graphs.scaleSeries(data.json.region.pricePerAreaIndex, data.regionAvgPricePerArea / 100);
            data.propertyPriceIndex = widget__graphs.scaleSeries(propertyPricePerAreaIndex, data.propertyAvgPricePerArea / 100);
            graphProperties.yAxisLabel = data.json.meta.currencySymbol;
            break;
        case "listIndex":
            data.priceIndex = widget__graphs.reindexFromYear(data.json.district.priceIndex, filter);
            data.regionPriceIndex = widget__graphs.reindexFromYear(data.json.region.priceIndex, filter);
            data.propertyPriceIndex = widget__graphs.reindexFromYear(propertypriceIndex, filter);
            graphProperties.yAxisLabel = "";
            break;
        case "listIndexPsm":
            data.priceIndex = widget__graphs.reindexFromYear(data.json.district.pricePerAreaIndex, filter);
            data.regionPriceIndex = widget__graphs.reindexFromYear(data.json.region.pricePerAreaIndex, filter);
            data.propertyPriceIndex = widget__graphs.reindexFromYear(propertyPricePerAreaIndex, filter);
            graphProperties.yAxisLabel = "";
            break;
        default:
            widget__graphs.displayTimeSeries(graphProperties);
            return
        }
        graphProperties.title = "Asking Price";
        graphProperties.count = data.json.national.count;
        graphProperties.sourceText = $(".w-graph__1").attr("data-sourceText");
        graphProperties.comparableText = $(".w-graph__1").attr("data-comparableText");
        graphProperties.listingsText = $(".w-graph__1").attr("data-listingsText");
        graphProperties.siteName = $(".w-graph__1").attr("data-siteName");
        if (graphProperties.siteName === "") {
            graphProperties.siteName = "PropertyGuru"
        }
        graphProperties.series = [{
            name: graphProperties.districtName,
            type: "spline",
            color: "#333",
            width: .5,
            data: data.priceIndex
        }, {
            name: graphProperties.regionName,
            type: "spline",
            color: "#2980b9",
            width: .5,
            data: data.regionPriceIndex
        }];
        graphProperties.crosshairs = {
            color: "#999999",
            dashStyle: "solid"
        };
        graphProperties.xAxisLabel = "";
        graphProperties.xfloor = widget__graphs.getLowestTimestamp([data.priceIndex, data.regionPriceIndex]);
        widget__graphs.displayTimeSeries(graphProperties)
    },
    displayTimeSeries: function(graphProperties) {
        var disclaimer;
        if (typeof graphProperties.siteName !== "undefined") {
            disclaimer = graphProperties.sourceText + ": " + parseInt(graphProperties.count, 10).format() + " " + graphProperties.comparableText + " " + graphProperties.siteName + " " + graphProperties.listingsText + "."
        } else {
            disclaimer = "Source: " + parseInt(graphProperties.count, 10).format() + " comparable PropertyGuru listings. "
        }
        var chart = $(".w-graph-chart").highcharts({
            chart: {
                backgroundColor: "transparent",
                spacingBottom: 40,
                spacingTop: 30
            },
            title: {
                text: "",
                align: "left",
                verticalAlign: "top",
                x: 0
            },
            subtitle: {
                align: "center",
                floating: true,
                verticalAlign: "bottom",
                text: disclaimer,
                borderWidth: 0,
                height: 20,
                x: 0,
                y: 40
            },
            legend: {
                align: "right",
                floating: true,
                verticalAlign: "top",
                layout: "horizontal",
                borderWidth: 0,
                x: 0,
                y: -30
            },
            xAxis: {
                type: "datetime",
                dateTimeLabelFormats: {
                    month: "%e. %b",
                    year: "%b"
                },
                labels: {
                    format: "{value:%b} {value:%Y}'",
                    rotation: 0,
                    step: 3
                },
                title: {
                    text: graphProperties.xAxisLabel
                },
                tickPixelInterval: 100,
                floor: graphProperties.xfloor,
                minRange: 1e3 * 3600 * 24 * 30,
                ceiling: widget__graphs.getXDaysInThePast(1)
            },
            yAxis: {
                title: {
                    text: graphProperties.yAxisLabel
                },
                labels: {
                    formatter: function() {
                        return Highcharts.numberFormat(this.value, 0)
                    }
                }
            },
            plotOptions: {
                series: {
                    marker: {
                        enabled: false
                    }
                }
            },
            tooltip: {
                headerFormat: "<b>{series.name}</b><br/>",
                pointFormat: "<small>{point.x:%d %b %Y}</small><br/><b>Value: </b>{point.y:,.0f}",
                crosshairs: graphProperties.crosshairs
            },
            credits: {
                enabled: false
            },
            series: graphProperties.series
        })
    },
    displayGraph: function(graphProperties) {
        $(".w-graph-chart").highcharts({
            chart: {
                backgroundColor: "transparent",
                spacingBottom: 40
            },
            title: {
                text: "",
                align: "left",
                verticalAlign: "top",
                x: 0
            },
            subtitle: {
                align: "center",
                floating: true,
                verticalAlign: "bottom",
                text: "Source: propertyguru.com.sg",
                borderWidth: 0,
                height: 20,
                x: 0,
                y: 40
            },
            legend: {
                align: "top",
                floating: true,
                verticalAlign: "top",
                layout: "horizontal",
                borderWidth: 0,
                x: 100,
                y: 10
            },
            xAxis: {
                title: {
                    text: graphProperties.xAxisLabel
                },
                categories: graphProperties.categories,
                labels: {
                    step: 1
                },
                lineWidth: 0,
                minorGridLineWidth: 0,
                lineColor: "transparent",
                minorTickLength: 0,
                tickLength: 0
            },
            yAxis: {
                title: {
                    text: graphProperties.yAxisLabel
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: "#cc2222"
                }],
                lineWidth: 0,
                minorGridLineWidth: 0,
                lineColor: "transparent",
                minorTickLength: 0,
                tickLength: 0
            },
            tooltip: {
                valuePrefix: "SGD$",
                crosshairs: graphProperties.crosshairs
            },
            credits: {
                enabled: false
            },
            series: graphProperties.series
        })
    }
};
if ($("#title-latest-transactions").length > 0) {
    $(window).off("highcharts.loaded");
    $(window).on("highcharts.loaded", function() {
        widget__graphs.init()
    })
}
Number.prototype.format = function(n, x) {
    var re = "\\d(?=(\\d{" + (x || 3) + "})+" + (n > 0 ? "\\." : "$") + ")";
    return this.toFixed(Math.max(0, ~~n)).replace(new RegExp(re,"g"), "$&,")
}
;
$(document).ready(function() {
    var $body = $("body");
    if (typeof guruApp.widgetGoogleAnalytics === "undefined") {
        return
    }
    var category = "Property Market Index";
    var createGaDimension = guruApp.widgetGoogleAnalytics.googleAnalyticsObject.createGaDimension;
    var track = function(category, action, label, value, noninteraction, dimensions) {
        label = cleanText(label);
        if (guruApp.widgetGoogleAnalytics.googleAnalyticsObject !== null) {
            guruApp.widgetGoogleAnalytics.googleAnalyticsObject.trackEvent(category, action, label, value, noninteraction, dimensions)
        }
    }
      , cleanText = function(str) {
        return str.replace(/^https?:\/\/[^\/]+/, "").replace(/^\s+/, "").replace(/\s+$/, "").replace(/\s+/, " ")
    };
    $body.on("ga.pmi.report.download.require_login.click", function(e, reportTitle) {
        var dimension20 = {
            PMIReport: reportTitle
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "ClickToLogIn", "PMIReport=" + reportTitle, null, null, dimensions)
    });
    $body.on("ga.pmi.report.download.already_login.click", function(e, reportTitle) {
        var dimension20 = {
            PMIReport: reportTitle
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "DownLoadReport", "PMIReport=" + reportTitle, null, null, dimensions)
    });
    $body.on("ga.pmi.report.chart.period.click", function(e, reportTitle, period) {
        var dimension20 = {
            PMIReport: reportTitle,
            Period: period
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "AnalyzePrice", "Period=" + period, null, null, dimensions)
    });
    $body.on("ga.pmi.report.previous.report.click", function(e, reportTitle, position) {
        var dimension20 = {
            PMIReport: reportTitle,
            Position: position
        };
        var dimensions = [createGaDimension("dimension20", JSON.stringify(dimension20))];
        track(category + "-Engagement", "GoToPreviousReport", "PMIReport=" + reportTitle, null, null, dimensions)
    })
});
$(function() {
    var $reportDiv = $(".property-market-index-page");
    if (!$reportDiv.length) {
        return
    }
    var reportTitle = $reportDiv.data("report-title") + "-" + $reportDiv.data("report-id");
    var chart = $("#chart");
    if (guruApp.chartData !== undefined && guruApp.chartData.data !== undefined) {
        var chartData = guruApp.chartData.data;
        var series = JSON.parse(JSON.stringify(chartData.series));
        var categories = JSON.parse(JSON.stringify(chartData.xAxis.categories));
        $(".btn-group-years").css({
            visibility: "visible"
        });
        $(window).on("highcharts.loaded", function() {
            chart.highcharts(chartData)
        });
        $(".btn-group-years .dropdown-menu li a").on("click", function() {
            var period = $(this).data("label");
            $("body").trigger("ga.pmi.report.chart.period.click", [reportTitle, period]);
            $(this).parents(".btn-group").find(".dropdown-toggle").text($(this).text());
            $(this).parents(".btn-group").find(".dropdown-toggle").val($(this).text());
            var cloneSeries = JSON.parse(JSON.stringify(series));
            var cloneCategories = JSON.parse(JSON.stringify(categories));
            var series1, series2, filterCategories;
            var cloneSeries1Length = cloneSeries[0].data.length;
            var cloneSeries2Length = cloneSeries[1].data.length;
            var cloneCategoriesLength = cloneCategories.length;
            switch (period) {
            case "2Y":
                series1 = cloneSeries[0].data;
                series2 = cloneSeries[1].data;
                filterCategories = cloneCategories;
                break;
            case "12M":
                series1 = cloneSeries[0].data.slice(cloneSeries1Length - 4);
                series2 = cloneSeries[1].data.slice(cloneSeries2Length - 4);
                filterCategories = cloneCategories.slice(cloneCategoriesLength - 4);
                break;
            case "6M":
                series1 = cloneSeries[0].data.slice(cloneSeries1Length - 2);
                series2 = cloneSeries[1].data.slice(cloneSeries2Length - 2);
                filterCategories = cloneCategories.slice(cloneCategoriesLength - 2);
                break
            }
            chart.highcharts().series[0].setData(series1, true);
            chart.highcharts().series[1].setData(series2, true);
            chart.highcharts().xAxis[0].setCategories(filterCategories)
        })
    }
    $("#download-report").on("click", function() {
        var $btn = $(this).find("button");
        if ($btn.hasClass("already-login")) {
            $("body").trigger("ga.pmi.report.download.already_login.click", [reportTitle])
        } else {
            $("body").trigger("ga.pmi.report.download.require_login.click", [reportTitle])
        }
    });
    $("#previous-report .article").each(function() {
        var position = $(this).data("position");
        $(this).find("a").on("click", function() {
            $("body").trigger("ga.pmi.report.previous.report.click", [reportTitle, position])
        })
    })
});
